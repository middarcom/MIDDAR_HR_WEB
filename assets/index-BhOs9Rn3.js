import{r as P,j as e,B as S,P as Y,k as q,n as B,_ as D,a5 as ce,c as le,d as W,x as ie,y as de,E as me,I as G,X as ue,b as X,at as xe,C as he,e as je,f as ye,g as fe}from"./index-Bt_qYF7e.js";import{o as ve,n as p,s as b,g as pe,u as Se,t as ge}from"./types-CD2kk4bq.js";import{F as De,a as m,b as u,c as x,d as h,e as w}from"./form-DqQ5DwtJ.js";import{I as k}from"./input-Cs0r3c1h.js";import{S as Ne,a as be,b as we,c as Ee,d as U}from"./select-AiO2ANK_.js";import{T as Pe}from"./textarea-B53SCRvp.js";import{P as H,b as Q,c as K,C as $}from"./popover-VONLzH8b.js";import{a as C}from"./api-BYTcMetT.js";import{E as Ce}from"./EmployeeDropdown-DI7Wva_F.js";import{D as z,a as Z,b as V,c as ee,d as Te}from"./dialog-CWEZULTY.js";import{u as Oe}from"./useMutation-C9YiDKkV.js";import{T as Ie,a as Fe,b as E,c as j,d as Le,e as l}from"./table-CZIP08Oi.js";import{S as y}from"./skeleton-B5IxJdik.js";import{E as ke}from"./ellipsis-mRtKJbvV.js";import{T as Ue,a as Ae,b as J}from"./tabs-nV_fVNZu.js";import{P as Me}from"./plus-De3WeMOg.js";import{R as Be}from"./ReportViewer-BdI0b9Cd.js";import"./label-CTvvvVeK.js";import"./index-da16CiNc.js";import"./getDaysInMonth-DEtwUiq9.js";import"./chevron-left-3DLBy2_V.js";import"./loader-circle-d-5q11Hx.js";import"./alert-CJsotLI_.js";import"./date-picker-CRhZKckn.js";import"./download-BwSGJ_lt.js";const _e=ve({EmployeeID:p().min(1,"Employee is required"),ServiceStartDate:b().min(1,"Service start date is required"),ServiceEndDate:b().min(1,"Service end date is required"),LastBasicSalary:p().min(0,"Last basic salary must be a positive number"),UnusedLeaveAmount:p().min(0,"Unused leave amount must be a positive number").optional().default(0),NoticePeriodAmount:p().min(0,"Notice period amount must be a positive number").optional().default(0),OtherBenefits:p().min(0,"Other benefits must be a positive number").optional().default(0),Deductions:p().min(0,"Deductions must be a positive number").optional().default(0),PaymentStatus:pe(["Pending","Paid","Cancelled"]).default("Pending"),PaymentDate:b().optional().nullable(),Notes:b().optional().nullable()});function te({isOpen:r,onOpenChange:t,initialValues:n,onSuccess:i}){const[T,g]=P.useState(!1),c=Se({resolver:ge(_e),defaultValues:{PaymentStatus:"Pending",UnusedLeaveAmount:0,NoticePeriodAmount:0,OtherBenefits:0,Deductions:0,PaymentDate:null,Notes:null,...n}});P.useEffect(()=>{r&&c.reset({PaymentStatus:"Pending",UnusedLeaveAmount:0,NoticePeriodAmount:0,OtherBenefits:0,Deductions:0,PaymentDate:null,Notes:null,...n})},[r,n,c]);const f=c.watch("ServiceStartDate"),v=c.watch("ServiceEndDate"),O=c.watch("LastBasicSalary"),I=c.watch("UnusedLeaveAmount")||0,o=c.watch("NoticePeriodAmount")||0,F=c.watch("OtherBenefits")||0,se=c.watch("Deductions")||0,N=(s,a)=>{if(!s||!a)return{days:0,years:0};const d=new Date(s),re=new Date(a),ne=Math.abs(re.getTime()-d.getTime()),R=Math.ceil(ne/(1e3*60*60*24)),oe=R/365.25;return{days:R,years:Math.round(oe*1e4)/1e4}},_=(s,a)=>{if(s<=0||a<=0)return 0;let d=0;return s<=5?d=a*21*s/30:(d=a*21*5/30,d+=a*30*(s-5)/30),Math.round(d*100)/100},L=_(f&&v?N(f,v).years:0,O||0)+I+o+F-se,ae=async s=>{try{g(!0);const a=N(s.ServiceStartDate,s.ServiceEndDate),d={...s,TotalServiceDays:a.days,TotalServiceYears:a.years,GratuityAmount:_(a.years,s.LastBasicSalary),TotalEndOfServicePay:L,CalculationDate:new Date().toISOString().split("T")[0]};n!=null&&n.EndOfServiceID?(await C.endOfService.update(n.EndOfServiceID,d),D.success("End of service record updated successfully!")):(await C.endOfService.create(d),D.success("End of service record created successfully!")),i==null||i(),t(!1)}catch(a){console.error("Error submitting form:",a),D.error("Failed to save record.")}finally{g(!1)}};return e.jsx(z,{open:r,onOpenChange:t,children:e.jsxs(Z,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(V,{children:[e.jsx(ee,{children:n!=null&&n.EndOfServiceID?"Edit End of Service":"Calculate End of Service"}),e.jsx(Te,{children:n!=null&&n.EndOfServiceID?"Update the end of service details for this employee.":"Enter the details below to calculate the end of service payment for an employee."})]}),e.jsx(De,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(ae),className:"space-y-6",children:[e.jsx(m,{control:c.control,name:"EmployeeID",render:({field:s})=>{var a;return e.jsxs(u,{children:[e.jsx(x,{children:"Employee"}),e.jsx(h,{children:e.jsx(Ce,{value:(a=s.value)==null?void 0:a.toString(),onValueChange:d=>s.onChange(Number(d)),placeholder:"Select an employee",disabled:!!(n!=null&&n.EndOfServiceID)})}),e.jsx(w,{})]})}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{control:c.control,name:"ServiceStartDate",render:({field:s})=>e.jsxs(u,{className:"flex flex-col",children:[e.jsx(x,{children:"Service Start Date"}),e.jsxs(H,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(h,{children:e.jsxs(S,{variant:"outline",className:Y("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value||e.jsx("span",{children:"Pick start date"}),e.jsx(q,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx($,{mode:"single",selected:s.value?new Date(s.value):void 0,onSelect:a=>a&&s.onChange(B(a,"yyyy-MM-dd")),disabled:a=>a>new Date})})]}),e.jsx(w,{})]})}),e.jsx(m,{control:c.control,name:"ServiceEndDate",render:({field:s})=>e.jsxs(u,{className:"flex flex-col",children:[e.jsx(x,{children:"Service End Date"}),e.jsxs(H,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(h,{children:e.jsxs(S,{variant:"outline",className:Y("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value||e.jsx("span",{children:"Pick end date"}),e.jsx(q,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx($,{mode:"single",selected:s.value?new Date(s.value):void 0,onSelect:a=>a&&s.onChange(B(a,"yyyy-MM-dd")),disabled:a=>a>new Date})})]}),e.jsx(w,{})]})})]}),f&&v&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg text-sm grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Days:"}),e.jsx("span",{className:"ml-2 font-medium",children:N(f,v).days})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Years:"}),e.jsx("span",{className:"ml-2 font-medium",children:N(f,v).years})]})]}),e.jsx(m,{control:c.control,name:"LastBasicSalary",render:({field:s})=>e.jsxs(u,{children:[e.jsx(x,{children:"Last Basic Salary"}),e.jsx(h,{children:e.jsx(k,{type:"number",placeholder:"0.00",...s,onChange:a=>s.onChange(Number(a.target.value))})}),e.jsx(w,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{control:c.control,name:"UnusedLeaveAmount",render:({field:s})=>e.jsxs(u,{children:[e.jsx(x,{children:"Unused Leave Amount"}),e.jsx(h,{children:e.jsx(k,{type:"number",...s,onChange:a=>s.onChange(Number(a.target.value))})})]})}),e.jsx(m,{control:c.control,name:"NoticePeriodAmount",render:({field:s})=>e.jsxs(u,{children:[e.jsx(x,{children:"Notice Period Amount"}),e.jsx(h,{children:e.jsx(k,{type:"number",...s,onChange:a=>s.onChange(Number(a.target.value))})})]})})]}),L>0&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["$",L.toFixed(2)]}),e.jsx("div",{className:"text-xs text-blue-600",children:"Total Calculation"})]}),e.jsx(m,{control:c.control,name:"PaymentStatus",render:({field:s})=>e.jsxs(u,{children:[e.jsx(x,{children:"Payment Status"}),e.jsxs(Ne,{onValueChange:s.onChange,value:s.value,children:[e.jsx(h,{children:e.jsx(be,{children:e.jsx(we,{})})}),e.jsxs(Ee,{children:[e.jsx(U,{value:"Pending",children:"Pending"}),e.jsx(U,{value:"Paid",children:"Paid"}),e.jsx(U,{value:"Cancelled",children:"Cancelled"})]})]})]})}),e.jsx(m,{control:c.control,name:"Notes",render:({field:s})=>e.jsxs(u,{children:[e.jsx(x,{children:"Notes"}),e.jsx(h,{children:e.jsx(Pe,{...s,value:s.value||""})})]})}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsx(S,{type:"submit",disabled:T,children:"Save"})]})]})})]})})}function Re({isOpen:r,onOpenChange:t,initialValues:n,onSuccess:i}){return e.jsx(z,{open:r,onOpenChange:t,children:e.jsxs(Z,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{children:e.jsx(ee,{children:n!=null&&n.EndOfServiceID?"Edit End of Service":"Create End of Service Record"})}),e.jsx("div",{className:"py-4",children:e.jsx(te,{isOpen:r,onOpenChange:t,initialValues:n,onSuccess:i})})]})})}const A=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r),M=r=>{if(!r)return"N/A";try{const t=new Date(r);return isNaN(t.getTime())?"Invalid Date":B(t,"MMM d, yyyy")}catch{return"Invalid Date"}},Ye=r=>{switch(r){case"Paid":return"default";case"Pending":return"secondary";case"Cancelled":return"destructive";default:return"outline"}};function xt(){const[r,t]=P.useState(!1),[n,i]=P.useState(null),T=ce(),{data:g=[],isLoading:c}=le({queryKey:["employeeendofservice"],queryFn:async()=>(await C.endOfService.list({})).data||[]}),f=Oe({mutationFn:async o=>{await C.endOfService.delete(o)},onSuccess:()=>{D.success("End of service record deleted successfully."),T.invalidateQueries({queryKey:["employeeendofservice"]})},onError:()=>{D.error("Failed to delete end of service record.")}}),v=o=>{i(o),t(!0)},O=o=>{window.confirm("Are you sure you want to delete this record?")&&f.mutate(o)},I=()=>{t(!1),i(null)};return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ie,{children:[e.jsx(Fe,{children:e.jsxs(E,{children:[e.jsx(j,{children:"Employee ID"}),e.jsx(j,{children:"Service Period"}),e.jsx(j,{children:"Total Years"}),e.jsx(j,{children:"Last Salary"}),e.jsx(j,{children:"Gratuity"}),e.jsx(j,{children:"Total Pay"}),e.jsx(j,{children:"Payment Status"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(Le,{children:c?Array.from({length:5}).map((o,F)=>e.jsxs(E,{children:[e.jsx(l,{children:e.jsx(y,{className:"h-4 w-20"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-32"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-16"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-20"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-20"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-20"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-16"})}),e.jsx(l,{className:"text-right",children:e.jsx(y,{className:"h-8 w-8 ml-auto"})})]},F)):g.length===0?e.jsx(E,{children:e.jsx(l,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No end of service records found. Create one to get started."})}):g.map(o=>e.jsxs(E,{children:[e.jsx(l,{className:"font-medium",children:o.EmployeeID}),e.jsx(l,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{children:M(o.ServiceStartDate)}),e.jsx("div",{className:"text-muted-foreground",children:"to"}),e.jsx("div",{children:M(o.ServiceEndDate)})]})}),e.jsx(l,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium",children:[o.TotalServiceYears," years"]}),e.jsxs("div",{className:"text-muted-foreground",children:[o.TotalServiceDays," days"]})]})}),e.jsx(l,{className:"font-medium",children:A(o.LastBasicSalary)}),e.jsx(l,{className:"font-medium",children:A(o.GratuityAmount)}),e.jsx(l,{className:"font-medium text-lg",children:A(o.TotalEndOfServicePay)}),e.jsxs(l,{children:[e.jsx(W,{variant:Ye(o.PaymentStatus),children:o.PaymentStatus}),o.PaymentDate&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Paid: ",M(o.PaymentDate)]})]}),e.jsx(l,{className:"text-right",children:e.jsxs(ie,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(S,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ke,{className:"h-4 w-4"})]})}),e.jsxs(me,{align:"end",children:[e.jsx(G,{onClick:()=>v(o),children:"Edit"}),e.jsx(G,{className:"text-red-600",onClick:()=>O(o.EndOfServiceID),children:"Delete"})]})]})})]},o.EndOfServiceID))})]})}),e.jsx(Re,{isOpen:r,onOpenChange:t,initialValues:n||void 0,onSuccess:I})]})}function ht(){const r=ue(),t=X(),n=r.pathname.endsWith("/reports")?"reports":"overview";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"End of Service Records"})}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4",children:[e.jsx(Ue,{value:n,onValueChange:i=>{i==="overview"?t("/end_of_service"):i==="reports"&&t("/end_of_service/reports")},children:e.jsxs(Ae,{children:[e.jsx(J,{value:"overview",children:"Overview"}),e.jsx(J,{value:"reports",children:"Reports"})]})}),n==="overview"&&e.jsxs(S,{onClick:()=>t("/end_of_service/new"),children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"New Record"]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(xe,{})})]})}function jt(){const r=X();return e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(he,{children:[e.jsx(je,{children:e.jsx(ye,{children:"Create End of Service Record"})}),e.jsx(fe,{children:e.jsx(te,{isOpen:!0,onOpenChange:t=>!t&&r("/end_of_service"),onSuccess:()=>r("/end_of_service")})})]})})}const yt=()=>{const r={type:"report_end_of_service",title:"End of Service Report",description:"Summary of employee end of service settlements and payments.",columns:[{key:"EndOfServiceID",label:"ID"},{key:"EmployeeName",label:"Employee"},{key:"ServiceStartDate",label:"Start Date",format:t=>t?new Date(t).toLocaleDateString():"-"},{key:"ServiceEndDate",label:"End Date",format:t=>t?new Date(t).toLocaleDateString():"-"},{key:"TotalServiceYears",label:"Years",format:t=>t?Number(t).toFixed(2):"-"},{key:"LastBasicSalary",label:"Basic Salary",format:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},{key:"GratuityAmount",label:"Gratuity",format:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},{key:"UnusedLeaveAmount",label:"Unused Leave",format:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},{key:"OtherBenefits",label:"Other Benefits",format:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},{key:"Deductions",label:"Deductions",format:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},{key:"TotalEndOfServicePay",label:"Total Pay",format:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)},{key:"PaymentStatus",label:"Status",format:t=>e.jsx(W,{variant:t==="Paid"?"default":t==="Pending"?"secondary":"outline",children:t})},{key:"PaymentDate",label:"Payment Date",format:t=>t?new Date(t).toLocaleDateString():"-"}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]};return e.jsx("div",{className:"space-y-6",children:e.jsx(Be,{reportType:r.type,title:r.title,description:r.description,columns:r.columns,filterFields:r.filters,disableAutoFetch:!0})})};export{te as EndOfServiceForm,jt as EndOfServiceFormPage,ht as EndOfServiceLayout,xt as EndOfServiceList,Re as EndOfServiceModal,yt as EndOfServiceReports};
