import{r as i,w as N,j as e,_ as b,C as L,e as S,f as P,h as k,g as E,B as g,$ as d}from"./index-wTZVkADF.js";import{I as m}from"./input-C6h3o8yc.js";import{L as u}from"./label-TUJUEAa3.js";import{L as I}from"./loader-circle-QdenAcYj.js";const R="https://api.middar.com/api/v1/account/login",T=o=>{var t;console.log("getRedirectPath called with user:",o);const a=(t=o.userData)==null?void 0:t.permissions;return console.log("Permission ID from userData:",a,"Type:",typeof a),a===3||a===4||a===5||a===6?(console.log("Redirecting to employee dashboard"),"/employee-dashboard"):(console.log("Redirecting to main dashboard"),"/dashboard")};function _(){const[o,a]=i.useState(""),[t,y]=i.useState(""),[c,x]=i.useState(""),[p,h]=i.useState(!1),{login:f,isAuthenticated:j,user:l,logout:C}=N();if(j&&l){console.log("User is authenticated, checking redirect..."),console.log("User object in redirect check:",l);const s=T(l);return console.log("Final redirect path:",s),e.jsx(b,{to:s,replace:!0})}const w=()=>{C(),localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),window.location.reload()},v=async s=>{if(s.preventDefault(),!o||!t||!c){d.error("Please enter email, password, and company code");return}h(!0);try{const n=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o.trim(),password:t,company_code:c.trim()})}),r=await n.json();if(!n.ok)throw new Error(r.message||"Login failed. Please check your credentials.");if(!r.serviceToken||!r.user)throw new Error("Invalid response from server");console.log("Login response data:",r.user),console.log("User permissions field:",r.user.permissions),console.log("User permission ID type:",typeof r.user.permissions),f(r.serviceToken,r.user),d.success("Login successful")}catch(n){console.error("Login error:",n),d.error(n.message||"Failed to login. Please check your credentials.")}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs(L,{className:"w-full max-w-md",children:[e.jsxs(S,{className:"space-y-1",children:[e.jsx(P,{className:"text-2xl font-bold text-center",children:"Login"}),e.jsx(k,{className:"text-center",children:"Sign in to access your HR Management account"})]}),e.jsxs(E,{children:[e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsx(m,{id:"email",type:"email",placeholder:"Enter your email",value:o,onChange:s=>a(s.target.value),required:!0,autoComplete:"username",className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Password"}),e.jsx(m,{id:"password",type:"password",placeholder:"Enter your password",value:t,onChange:s=>y(s.target.value),required:!0,autoComplete:"current-password",className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"companyCode",children:"Company Code"}),e.jsx(m,{id:"companyCode",type:"text",placeholder:"Enter your company code (e.g., HR1)",value:c,onChange:s=>x(s.target.value),required:!0,autoComplete:"organization",className:"h-11"})]}),e.jsx(g,{type:"submit",className:"w-full h-11",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign in"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(g,{type:"button",variant:"outline",onClick:w,className:"text-sm",children:"Clear Auth & Try Again"})})]})]})})}export{_ as default};
