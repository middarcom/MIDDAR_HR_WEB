import{l as ms,r as n,j as e,C as P,g as C,n as D,e as A,f as k,S as ke,F as xs,B as y,k as hs,a0 as xe,a8 as he,W as Ie,U as Pe,h as ys}from"./index-DcTsfPOQ.js";import{R as us}from"./ReportViewer-mOsnLBaH.js";import{T as Me,a as ps,b as $,c as de}from"./tabs--CwFPUC6.js";import{a as S}from"./api-DUHMZ36Z.js";import{S as O}from"./skeleton-C0wj_6h9.js";import{I as te}from"./input-COXv_7eX.js";import{L}from"./label-CAQongzc.js";import{S as js}from"./ScrollableTabs-B5bhjMmm.js";import{S as ue,a as pe,b as je,c as fe,d as v}from"./select-DCRErqP0.js";import{D as J,a as W,b as Y,c as q,f as me,d as le}from"./dialog-BTqBvcGL.js";import{C as Ce}from"./date-picker-BfeghS0q.js";import{T as Te,a as Fe,b as re,c as N,d as Re,e as g}from"./table-BJW1dPs9.js";import{F as Oe}from"./filter-6kyjrtRX.js";import{P as _e}from"./plus-7yv9qKks.js";import{E as He}from"./eye-DjT-Oc95.js";import{L as X}from"./loader-circle-BaCmAyG7.js";import{C as Le}from"./chevron-left-CDQ6U5C1.js";import{D as ye}from"./download-CdRm0dBl.js";import{s as Ee,a as Ae}from"./popover-Bj1zDLHq.js";import"./alert-OO0Ojiqf.js";import"./index-9jX0xVs3.js";import"./getDaysInMonth-8Efe35wA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=ms("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),Ns=()=>{const[l,t]=n.useState("payroll_summary"),[i,h]=n.useState([]);n.useEffect(()=>{(async()=>{try{const f=((await S.list("payroll",{sort:"StartDate DESC",pageSize:100})).data||[]).map(w=>({label:`${w.Reason} (${w.StartDate} - ${w.EndDate})`,value:String(w.PayrollID)}));h(f)}catch(j){console.error("Failed to fetch payrolls for reports",j)}})()},[]);const E=[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}],x=[{key:"payroll_id",label:"Select Payroll",type:"select",options:i}],m={payroll_summary:{type:"payroll_summary",title:"Payroll Summary Report",description:"Overview of payroll periods within a date range.",columns:[{key:"PayrollID",label:"ID"},{key:"Description",label:"Description"},{key:"StartDate",label:"Start Date",format:o=>o?new Date(o).toLocaleDateString():"-"},{key:"EndDate",label:"End Date",format:o=>o?new Date(o).toLocaleDateString():"-"},{key:"TotalDays",label:"Days"},{key:"Status",label:"Status"},{key:"CreatedDate",label:"Created On",format:o=>o?new Date(o).toLocaleDateString():"-"}],filters:E},payroll_salary_sheet:{type:"payroll_salary_sheet",title:"Payroll Salary Sheet",description:"Detailed salary sheet for a specific payroll period.",columns:[{key:"EmployeeID",label:"ID"},{key:"EmployeeName",label:"Name"},{key:"NationalID",label:"National ID"},{key:"TotalHoursWorked",label:"Hours"},{key:"OvertimeHours",label:"Overtime"},{key:"AbsentHours",label:"Absent"},{key:"Currency",label:"Currency"},{key:"GrossSalary",label:"Gross",format:o=>Number(o).toLocaleString(void 0,{minimumFractionDigits:2})},{key:"NetSalary",label:"Net Pay",format:o=>Number(o).toLocaleString(void 0,{minimumFractionDigits:2})}],filters:x},payroll_components_breakdown:{type:"payroll_components_breakdown",title:"Payroll Components Breakdown",description:"Detailed list of additions and deductions per employee for a specific payroll.",columns:[{key:"EmployeeName",label:"Name"},{key:"ComponentName",label:"Component"},{key:"ComponentType",label:"Type",format:o=>e.jsx("span",{className:o==="Addition"?"text-green-600":"text-red-600",children:o})},{key:"Amount",label:"Amount",format:o=>Number(o).toLocaleString(void 0,{minimumFractionDigits:2})},{key:"Currency",label:"Curr"},{key:"Notes",label:"Notes"}],filters:x}}[l];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{children:e.jsx(C,{className:"p-4",children:e.jsx(Me,{value:l,onValueChange:t,className:"w-full",children:e.jsxs(ps,{className:"grid w-full grid-cols-1 md:grid-cols-3",children:[e.jsx($,{value:"payroll_summary",children:"Payroll Summary"}),e.jsx($,{value:"payroll_salary_sheet",children:"Salary Sheet"}),e.jsx($,{value:"payroll_components_breakdown",children:"Components Breakdown"})]})})})}),e.jsx(us,{reportType:m.type,title:m.title,description:m.description,columns:m.columns,filterFields:m.filters,disableAutoFetch:!0})]})},B={listPayrolls:async(l={})=>{const t=typeof l.page=="number"?l.page:0;return await S.list("payroll",{page:t,pageSize:l.pageSize||10,sort:"DESC",...l.filters||{}})},listEmployeeSalaries:async(l={})=>{const t=await S.list("employeesalary",{page:l.page||0,pageSize:l.pageSize||10,sort:"ASC",field:"EmployeeID",...l.payrollId&&{exact_filters:JSON.stringify({Payroll:l.payrollId})},...l.employeeName&&{EmployeeName:{$like:`%${l.employeeName}%`}},...l.department&&{Department:l.department},...l.status&&{Status:l.status}});if(t.data&&t.data.length>0){const i=await Promise.all(t.data.map(async h=>{try{const x=(await S.list("employeesalarysub",{exact_filters:JSON.stringify({SalaryID:h.SalaryID}),sort:"ASC"})).data.reduce((b,m)=>(m.IsAdd?b.additions+=m.Amount||0:b.deductions+=m.Amount||0,b),{additions:0,deductions:0});return{...h,TotalEarnings:x.additions,TotalDeductions:x.deductions}}catch(E){return console.error("Error fetching salary components:",E),h}}));return{...t,data:i}}return t},getSalaryDetails:async l=>{const t=await S.get("employeesalary",l),i=await S.list("employeesalarysub",{exact_filters:JSON.stringify({SalaryID:l}),sort:"ASC"});return{...t,components:i.data||[]}},createPayroll:async l=>await S.create("payroll",{...l,Status:"Pending",CreatedBy:1}),deletePayroll:async l=>(await S.list("employeesalary",{exact_filters:JSON.stringify({PayrollID:l}),sort:"ASC",pageSize:1e3}),await S.delete("payroll",l)),approvePayroll:async(l,t)=>await S.update("payroll",l,{Status:"Approved",ApprovedBy:t,ApprovalDate:D(new Date,"yyyy-MM-dd HH:mm:ss")}),exportPayroll:async(l,t="pdf")=>await S.get(`payroll/export/${l}`,{format:t}),getPayrollSummary:async l=>{try{return await S.get("payroll/summary",{payrollId:l})}catch(t){throw console.error("Error fetching payroll summary:",t),t}},updatePayrollStatus:async(l,t)=>await S.update("payroll",l,t)};function gs({payrolls:l,loading:t,payrollSearch:i,setPayrollSearch:h,payrollStatusFilter:E,setPayrollStatusFilter:x,payrollPage:b,setPayrollPage:m,payrollPageSize:o,payrollTotal:j,handleSelectPayroll:f,handleDeletePayroll:w,setApprovingPayroll:_,setApprovalComments:F,setShowApproveDialog:H,setShowNewPayrollDialog:I,formatDate:d,getStatusBadge:c}){return e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsx(k,{children:"Payroll Periods"}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(te,{placeholder:"Search payrolls...",className:"pl-10 w-full",value:i,onChange:r=>{h(r.target.value),m(1)}})]}),e.jsxs(ue,{value:E,onValueChange:r=>{x(r),m(1)},children:[e.jsxs(pe,{className:"w-[180px]",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),e.jsx(je,{placeholder:"Filter by status"})]}),e.jsxs(fe,{children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"Draft",children:"Draft"}),e.jsx(v,{value:"Pending",children:"Pending"}),e.jsx(v,{value:"Approved",children:"Approved"}),e.jsx(v,{value:"Rejected",children:"Rejected"}),e.jsx(v,{value:"Processing",children:"Processing"})]})]})]})]})}),e.jsx(C,{children:t.payroll?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xs,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No payroll periods"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new payroll period."}),e.jsx("div",{className:"mt-6",children:e.jsxs(y,{onClick:()=>I(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"New Payroll Period"]})})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsxs(re,{children:[e.jsx(N,{children:"ID"}),e.jsx(N,{children:"Period"}),e.jsx(N,{children:"Days"}),e.jsx(N,{children:"Reason"}),e.jsx(N,{children:"Status"}),e.jsx(N,{children:"Created"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(Re,{children:l.map(r=>e.jsxs(re,{children:[e.jsxs(g,{className:"font-medium",children:["#",r.PayrollID]}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(hs,{className:"w-4 h-4 mr-2 text-gray-500"}),d(new Date(r.StartDate))," - ",d(new Date(r.EndDate))]})}),e.jsx(g,{children:r.TotalDays}),e.jsx(g,{className:"max-w-xs truncate",children:r.Reason}),e.jsx(g,{children:c(r.Status)}),e.jsx(g,{children:d(new Date(r.CreatedDate))}),e.jsx(g,{children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>f(r),children:[e.jsx(He,{className:"w-4 h-4 mr-1"})," View"]}),(r.Status==="Draft"||r.Status==="Pending")&&e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>w(r),disabled:t.action,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[t.action?e.jsx(X,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Delete"]}),(r.Status==="Pending"||r.Status==="Processing")&&e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>{_(r),F(""),H(!0)},disabled:t.action,className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:[t.action?e.jsx(X,{className:"w-4 h-4 mr-1 animate-spin"}):e.jsx(he,{className:"w-4 h-4 mr-1"}),"Approve"]})]})})]},r.PayrollID))})]}),j>o&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(b-1)*o+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(b*o,j)})," ","of ",e.jsx("span",{className:"font-medium",children:j})," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>m(r=>Math.max(1,r-1)),disabled:b===1||t.payroll,children:[e.jsx(Le,{className:"w-4 h-4 mr-1"})," Previous"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>m(r=>r+1),disabled:b*o>=j||t.payroll,children:["Next ",e.jsx(Ie,{className:"w-4 h-4 ml-1"})]})]})]})]})})]})}function vs({selectedPayroll:l,salaries:t,loading:i,salarySearch:h,setSalarySearch:E,salaryStatusFilter:x,setSalaryStatusFilter:b,salaryPage:m,setSalaryPage:o,salaryPageSize:j,salaryTotal:f,selectedSalary:w,fetchSalaryDetails:_,setShowExportDialog:F,formatDate:H,formatCurrency:I,getStatusBadge:d}){return l?e.jsxs(P,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Employee Salaries"}),e.jsxs(ys,{children:[l.Reason," • ",H(l.StartDate)," - ",H(l.EndDate)]})]}),e.jsxs("div",{className:"mt-4 md:mt-0 flex space-x-2",children:[e.jsxs("div",{className:"relative flex-1 md:max-w-xs",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(te,{placeholder:"Search employees...",className:"pl-10 w-full",value:h,onChange:c=>{E(c.target.value),o(1)}})]}),e.jsxs(ue,{value:x,onValueChange:c=>{b(c),o(1)},children:[e.jsxs(pe,{className:"w-[180px]",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),e.jsx(je,{placeholder:"Filter by status"})]}),e.jsxs(fe,{children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"Draft",children:"Draft"}),e.jsx(v,{value:"Pending",children:"Pending"}),e.jsx(v,{value:"Approved",children:"Approved"}),e.jsx(v,{value:"Paid",children:"Paid"}),e.jsx(v,{value:"Rejected",children:"Rejected"})]})]}),e.jsxs(y,{variant:"outline",onClick:()=>F(!0),disabled:i.action,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})}),e.jsx(C,{children:i.salaries?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No employee salaries"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No salaries found for the selected payroll period."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsxs(re,{children:[e.jsx(N,{children:"Employee"}),e.jsx(N,{children:"Department"}),e.jsx(N,{children:"Position"}),e.jsx(N,{className:"text-right",children:"Gross Salary"}),e.jsx(N,{className:"text-right",children:"Additions"}),e.jsx(N,{className:"text-right",children:"Deductions"}),e.jsx(N,{className:"text-right",children:"Net Salary"}),e.jsx(N,{children:"Status"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(Re,{children:t.map(c=>{const r=c.GrossSalary||0,ne=c.TotalDeductions||0,V=c.NetSalary||r-ne;return e.jsxs(re,{children:[e.jsx(g,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-medium mr-2",children:c.EmployeeName?c.EmployeeName.charAt(0):"?"}),e.jsxs("div",{children:[e.jsx("div",{children:c.EmployeeName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",c.EmployeeID]})]})]})}),e.jsx(g,{children:c.Department}),e.jsx(g,{children:c.Position}),e.jsx(g,{className:"text-right",children:I(r,c.Currency)}),e.jsx(g,{className:"text-right text-green-600",children:I(c.TotalEarnings||0,c.Currency)}),e.jsxs(g,{className:"text-right text-red-600",children:["-",I(ne,c.Currency)]}),e.jsx(g,{className:"text-right font-medium",children:I(V,c.Currency)}),e.jsx(g,{children:d(c.Status)}),e.jsx(g,{children:e.jsx("div",{className:"flex justify-end",children:e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>_(c),disabled:i.details,children:[e.jsx(He,{className:"w-4 h-4 mr-1"}),i.details&&(w==null?void 0:w.SalaryID)===c.SalaryID?"Loading...":"View"]})})})]},c.SalaryID)})})]}),f>j&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:(m-1)*j+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(m*j,f)})," ","of ",e.jsx("span",{className:"font-medium",children:f})," results"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>o(c=>Math.max(1,c-1)),disabled:m===1||i.salaries,children:[e.jsx(Le,{className:"w-4 h-4 mr-1"})," Previous"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>o(c=>c+1),disabled:m*j>=f||i.salaries,children:["Next ",e.jsx(Ie,{className:"w-4 h-4 ml-1"})]})]})]})]})})]}):e.jsx(P,{children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No payroll selected"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Select a payroll period to view employee salaries."})]})})})}const Us=()=>{const[l,t]=n.useState("payroll"),[i,h]=n.useState({payroll:!1,salaries:!1,details:!1,action:!1}),[E,x]=n.useState(null),[b,m]=n.useState(null),[o,j]=n.useState(!1),[f,w]=n.useState(null),[_,F]=n.useState(""),[H,I]=n.useState([]),[d,c]=n.useState(null),[r,ne]=n.useState(null),[V,Be]=n.useState(1),[Ne]=n.useState(10),[$e,Ve]=n.useState(0),[K,ze]=n.useState(""),[Q,Ue]=n.useState("all"),[Ge,Je]=n.useState([]),[p,We]=n.useState(null),[z,Ye]=n.useState([]),[ie,ge]=n.useState(1),[ve]=n.useState(10),[qe,Xe]=n.useState(0),[Z,be]=n.useState(""),[ee,we]=n.useState("all"),[Ke,U]=n.useState(!1),[Qe,De]=n.useState(!1),[Ze,ce]=n.useState(!1),[es,G]=n.useState(!1),[M,se]=n.useState({StartDate:D(Ee(new Date),"yyyy-MM-dd"),EndDate:D(Ae(new Date),"yyyy-MM-dd"),Reason:`Payroll for ${D(new Date,"MMMM yyyy")}`,TotalDays:new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate()}),[ae,ss]=n.useState("pdf"),Se=async()=>{h(s=>({...s,payroll:!0})),x(null);try{const a={page:Math.max(0,V-1),pageSize:Ne,sort:"CreatedDate",order:"desc"};K&&(a.search=K),Q!=="all"&&(a.status=Q);const u=await B.listPayrolls(a);I(u.data),Ve(u.total)}catch(s){console.error("Error fetching payrolls:",s),x(s.message||"Failed to fetch payrolls")}finally{h(s=>({...s,payroll:!1}))}},as=async()=>{if(d){h(s=>({...s,salaries:!0})),x(null);try{const s={page:ie-1,pageSize:ve,payrollId:d.PayrollID,field:"EmployeeName",sort:"ASC"};Z&&(s.search=Z),ee!=="all"&&(s.status=ee);const a=await B.listEmployeeSalaries(s);Je(a.data),Xe(a.total)}catch(s){console.error("Error fetching employee salaries:",s),x(s.message||"Failed to fetch employee salaries")}finally{h(s=>({...s,salaries:!1}))}}},ls=async s=>{We(s),h(a=>({...a,details:!0})),x(null);try{const a=await B.getSalaryDetails(s.SalaryID);Ye(a.components),ce(!0)}catch(a){console.error("Error fetching salary details:",a),x(a.message||"Failed to fetch salary details")}finally{h(a=>({...a,details:!1}))}},ts=s=>s.reduce((a,u)=>(u.IsAdd?a.additions+=u.Amount||0:a.deductions+=u.Amount||0,a.net=a.additions-a.deductions,a),{additions:0,deductions:0,net:0}),rs=async()=>{if(!M.StartDate||!M.EndDate||!M.Reason){x("Please fill in all required fields");return}h(s=>({...s,action:!0})),x(null);try{const s={...M,Status:"Pending",CreatedBy:1,CreatedDate:D(new Date,"yyyy-MM-dd HH:mm:ss")};await B.createPayroll(s),await Se(),U(!1),m("Payroll period created successfully"),se({StartDate:D(Ee(new Date),"yyyy-MM-dd"),EndDate:D(Ae(new Date),"yyyy-MM-dd"),Reason:`Payroll for ${D(new Date,"MMMM yyyy")}`,TotalDays:new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate()})}catch(s){console.error("Error creating payroll:",s),x(s.message||"Failed to create payroll period")}finally{h(s=>({...s,action:!1}))}},ns=async s=>{if(window.confirm(`Are you sure you want to delete payroll for ${T(s.StartDate)} - ${T(s.EndDate)}? This will also delete all associated salary records.`)){h(a=>({...a,action:!0})),x(null);try{await B.deletePayroll(s.PayrollID),I(a=>a.filter(u=>u.PayrollID!==s.PayrollID)),(d==null?void 0:d.PayrollID)===s.PayrollID&&(c(null),t("payroll")),m("Payroll deleted successfully"),setTimeout(()=>m(null),5e3)}catch(a){console.error("Error deleting payroll:",a),x(a.message||"Failed to delete payroll")}finally{h(a=>({...a,action:!1}))}}},is=async()=>{if(f){h(s=>({...s,action:!0})),x(null);try{await S.update("payroll",f.PayrollID,{Status:"Approved",ApprovedBy:1,ApprovalDate:D(new Date,"yyyy-MM-dd HH:mm:ss"),ApprovalComments:_||null}),I(s=>s.map(a=>a.PayrollID===f.PayrollID?{...a,Status:"Approved",ApprovedBy:1,ApprovalDate:D(new Date,"yyyy-MM-dd HH:mm:ss"),ApprovalComments:_}:a)),j(!1),w(null),F(""),m("Payroll approved successfully"),setTimeout(()=>m(null),5e3)}catch(s){console.error("Error approving payroll:",s),x(s.message||"Failed to approve payroll")}finally{h(s=>({...s,action:!1}))}}},cs=async()=>{if(d){h(s=>({...s,action:!0})),x(null);try{await B.exportPayroll(d.PayrollID,ae),G(!1),m(`Payroll exported successfully as ${ae.toUpperCase()}`),setTimeout(()=>m(null),5e3)}catch(s){console.error("Error exporting payroll:",s),x(s.message||"Failed to export payroll")}finally{h(s=>({...s,action:!1}))}}},os=s=>{c(s),ge(1),be(""),we("all"),t("salaries")},R=(s,a="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:a||"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(s||0),T=s=>{if(!s)return"N/A";try{const a=typeof s=="string"?new Date(s):s;return isNaN(a.getTime())?"Invalid Date":a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(a){return console.error("Error formatting date:",a),"Invalid Date"}},oe=s=>{const u={Draft:{variant:"bg-gray-100 text-gray-800",label:"Draft"},Pending:{variant:"bg-yellow-100 text-yellow-800",label:"Pending"},Approved:{variant:"bg-green-100 text-green-800",label:"Approved"},Rejected:{variant:"bg-red-100 text-red-800",label:"Rejected"},Processing:{variant:"bg-blue-100 text-blue-800",label:"Processing"},Paid:{variant:"bg-purple-100 text-purple-800",label:"Paid"}}[s]||{variant:"bg-gray-100 text-gray-800",label:s};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${u.variant}`,children:u.label})};return n.useEffect(()=>{Se()},[V,K,Q]),n.useEffect(()=>{d&&as()},[d,ie,Z,ee]),i.payroll&&H.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"h-8 w-48"}),e.jsx(O,{className:"h-4 w-64"})]}),e.jsx(O,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(O,{className:"h-32 w-full"}),e.jsx(O,{className:"h-32 w-full"}),e.jsx(O,{className:"h-32 w-full"})]}),e.jsxs("div",{className:"space-y-4 mt-8",children:[e.jsx(O,{className:"h-10 w-full md:w-1/3"}),e.jsx("div",{className:"space-y-2",children:Array(5).fill(0).map((s,a)=>e.jsx(O,{className:"h-20 w-full"},a))})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Payroll Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage employee salaries and payroll processing"})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsxs(y,{onClick:()=>U(!0),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"New Payroll Period"]})})]}),b&&e.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded relative",children:[e.jsx("span",{className:"block sm:inline",children:b}),e.jsx("button",{onClick:()=>m(null),className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:e.jsx(xe,{className:"w-4 h-4"})})]}),E&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded relative",children:[e.jsx("span",{className:"block sm:inline",children:E}),e.jsx("button",{onClick:()=>x(null),className:"absolute top-0 bottom-0 right-0 px-4 py-3",children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsxs(Me,{value:l,onValueChange:t,className:"w-full",children:[e.jsxs(js,{className:"md:grid md:grid-cols-3 max-w-fit mb-5",children:[e.jsx($,{value:"payroll",children:"Payroll Periods"}),e.jsxs($,{value:"salaries",disabled:!d,children:["Employee Salaries",d&&` (${d.Reason})`]}),e.jsx($,{value:"reports",children:"Reports"})]}),e.jsx(de,{value:"payroll",className:"space-y-6",children:e.jsx(gs,{payrolls:H,loading:i,payrollSearch:K,setPayrollSearch:ze,payrollStatusFilter:Q,setPayrollStatusFilter:Ue,payrollPage:V,setPayrollPage:Be,payrollPageSize:Ne,payrollTotal:$e,handleSelectPayroll:os,handleDeletePayroll:ns,setApprovingPayroll:w,setApprovalComments:F,setShowApproveDialog:j,setShowNewPayrollDialog:U,formatDate:T,getStatusBadge:oe})}),e.jsx(de,{value:"salaries",className:"space-y-6",children:e.jsx(vs,{selectedPayroll:d,salaries:Ge,loading:i,salarySearch:Z,setSalarySearch:be,salaryStatusFilter:ee,setSalaryStatusFilter:we,salaryPage:ie,setSalaryPage:ge,salaryPageSize:ve,salaryTotal:qe,selectedSalary:p,fetchSalaryDetails:ls,setShowExportDialog:G,formatDate:T,formatCurrency:R,getStatusBadge:oe})}),e.jsx(de,{value:"reports",className:"space-y-6",children:e.jsx(Ns,{})})]}),e.jsx(J,{open:Ke,onOpenChange:U,children:e.jsxs(W,{className:"sm:max-w-[500px]",children:[e.jsx(Y,{children:e.jsx(q,{children:"Create New Payroll Period"})}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"startDate",children:"Start Date"}),e.jsx(Ce,{date:M.StartDate?new Date(M.StartDate):void 0,onChange:s=>{if(!s)return;const a=D(s,"yyyy-MM-dd"),u=new Date(s);u.setMonth(u.getMonth()+1),u.setDate(0),se(ds=>({...ds,StartDate:a,EndDate:D(u,"yyyy-MM-dd"),TotalDays:Math.ceil((u.getTime()-s.getTime())/(1e3*60*60*24))+1,Reason:`Payroll for ${D(s,"MMMM yyyy")}`}))}})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"endDate",children:"End Date"}),e.jsx(Ce,{date:M.EndDate?new Date(M.EndDate):void 0,onChange:s=>{if(!s)return;const a=D(s,"yyyy-MM-dd");se(u=>({...u,EndDate:a,TotalDays:Math.ceil((s.getTime()-new Date(u.StartDate||"").getTime())/(1e3*60*60*24))+1}))}})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"reason",children:"Reason / Description"}),e.jsx(te,{id:"reason",value:M.Reason,onChange:s=>se(a=>({...a,Reason:s.target.value})),placeholder:"e.g., Monthly Payroll - January 2024"})]}),e.jsxs("div",{children:[e.jsx(L,{children:"Total Days"}),e.jsx(te,{value:M.TotalDays||"",readOnly:!0,disabled:!0})]})]})}),e.jsxs(me,{children:[e.jsx(y,{variant:"outline",onClick:()=>U(!1),disabled:i.action,children:"Cancel"}),e.jsx(y,{onClick:rs,disabled:i.action,children:i.action?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):"Create Payroll"})]})]})}),e.jsx(J,{open:Qe,onOpenChange:De,children:e.jsxs(W,{className:"sm:max-w-2xl",children:[e.jsxs(Y,{children:[e.jsx(q,{children:"Payroll Summary"}),d&&e.jsxs(le,{children:[d.Reason," • ",T(d.StartDate)," - ",T(d.EndDate)]})]}),i.action?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(P,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(k,{className:"text-lg",children:"Total Employees"})}),e.jsx(C,{children:e.jsx("div",{className:"text-3xl font-bold",children:r.totalEmployees})})]}),e.jsxs(P,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(k,{className:"text-lg",children:"Total Gross"})}),e.jsx(C,{children:e.jsx("div",{className:"text-3xl font-bold",children:R(r.totalGross,r.currency)})})]}),e.jsxs(P,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(k,{className:"text-lg",children:"Total Net"})}),e.jsx(C,{children:e.jsx("div",{className:"text-3xl font-bold",children:R(r.totalNet,r.currency)})})]})]}),e.jsxs(P,{children:[e.jsx(A,{children:e.jsx(k,{children:"Status Breakdown"})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2",children:Object.entries(r.statusCounts||{}).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-16 text-right",children:a}),e.jsx("div",{className:"ml-2 w-32 bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${a/r.totalEmployees*100}%`}})})]})]},s))})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(y,{variant:"outline",onClick:()=>G(!0),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Export Report"]}),e.jsx(y,{onClick:()=>{De(!1),t("salaries")},children:"View Salaries"})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No summary data available"})]})}),e.jsx(J,{open:es,onOpenChange:G,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(q,{children:"Export Payroll Data"}),d&&e.jsxs(le,{children:["Export data for ",d.Reason]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{children:"Format"}),e.jsxs(ue,{value:ae,onValueChange:s=>ss(s),children:[e.jsx(pe,{className:"w-full",children:e.jsx(je,{placeholder:"Select format"})}),e.jsxs(fe,{children:[e.jsx(v,{value:"pdf",children:"PDF Document"}),e.jsx(v,{value:"excel",children:"Excel Spreadsheet"}),e.jsx(v,{value:"csv",children:"CSV File"})]})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"The export will include all employee salary details for the selected payroll period."})]}),e.jsxs(me,{className:"sm:justify-between",children:[e.jsx(y,{variant:"outline",onClick:()=>G(!1),disabled:i.action,children:"Cancel"}),e.jsx(y,{onClick:cs,disabled:i.action,children:i.action?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Export ",ae.toUpperCase()]})})]})]})}),e.jsx(J,{open:Ze,onOpenChange:ce,children:e.jsxs(W,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Y,{children:[e.jsx(q,{children:"Salary Details"}),p&&e.jsxs(le,{children:[p.EmployeeName," • ",p.Position]})]}),i.details?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(P,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium text-gray-500",children:"Employee"})}),e.jsxs(C,{children:[e.jsx("div",{className:"text-lg font-medium",children:p.EmployeeName}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",p.EmployeeID]})]})]}),e.jsxs(P,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium text-gray-500",children:"Department"})}),e.jsxs(C,{children:[e.jsx("div",{className:"text-lg",children:p.Department}),e.jsx("div",{className:"text-sm text-gray-500",children:p.Position})]})]}),e.jsxs(P,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium text-gray-500",children:"Payroll Period"})}),e.jsx(C,{children:e.jsx("div",{className:"text-sm",children:d?e.jsxs(e.Fragment,{children:[T(d.StartDate)," - ",T(d.EndDate),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:d.Reason})]}):"N/A"})})]})]}),e.jsxs(P,{children:[e.jsx(A,{children:e.jsx(k,{children:"Salary Breakdown"})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-green-700 mb-2",children:"Earnings"}),e.jsxs("div",{className:"space-y-2",children:[z.filter(s=>s.IsAdd).map(s=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s.ComponentName}),e.jsxs("span",{className:"font-medium",children:[s.IsPercentage&&s.PercentageOf?e.jsxs("span",{className:"text-xs text-gray-500 mr-1",children:["(",s.Amount,"% of ",s.PercentageOf,")"]}):null,"+",R(s.Amount,s.Currency)]})]},s.SalarySubID)),e.jsx("div",{className:"border-t border-gray-200 pt-2 mt-2 font-medium",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Earnings"}),e.jsx("span",{children:R(z.filter(s=>s.IsAdd).reduce((s,a)=>s+a.Amount,0),p.Currency)})]})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-700 mb-2",children:"Deductions"}),e.jsxs("div",{className:"space-y-2",children:[z.filter(s=>!s.IsAdd).map(s=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s.ComponentName}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",R(s.Amount,s.Currency),s.IsPercentage&&s.PercentageOf&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.Amount,"% of ",s.PercentageOf,")"]})]})]},s.SalarySubID)),e.jsx("div",{className:"border-t border-gray-200 pt-2 mt-2 font-medium",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600",children:["-",R(z.filter(s=>!s.IsAdd).reduce((s,a)=>s+a.Amount,0),p.Currency)]})]})})]})]}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Net Pay"}),e.jsx("span",{className:"text-2xl font-bold",children:R(ts(z).net,p.Currency)})]})})]})})]}),e.jsxs(P,{children:[e.jsx(A,{children:e.jsx(k,{children:"Additional Information"})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Payment Method"}),e.jsx("p",{children:p.PaymentMethod||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Bank Account"}),e.jsx("p",{children:p.BankAccount||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Status"}),e.jsx("div",{className:"mt-1",children:oe(p.Status)})]}),p.Status==="Rejected"&&p.RejectionReason&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-red-600",children:p.RejectionReason})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>ce(!1),children:"Close"}),e.jsxs(y,{onClick:()=>window.print(),children:[e.jsx(fs,{className:"w-4 h-4 mr-2"}),"Print Payslip"]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No salary details available"})]})}),e.jsx(J,{open:o,onOpenChange:j,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(q,{children:"Approve Payroll"}),f&&e.jsxs(le,{children:["Approve payroll for ",T(f.StartDate)," - ",T(f.EndDate),e.jsx("br",{}),e.jsx("strong",{children:"Reason:"})," ",f.Reason]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"approvalComments",children:"Approval Comments (Optional)"}),e.jsx("textarea",{id:"approvalComments",value:_,onChange:s=>F(s.target.value),placeholder:"Add any comments or notes about this approval...",className:"w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 resize-none",rows:4})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(he,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Payroll Approval"}),e.jsx("div",{className:"mt-2 text-sm text-blue-700",children:e.jsx("p",{children:'This will approve the payroll and update the status to "Approved". The approval details will be recorded in the system.'})})]})]})})]}),e.jsxs(me,{className:"sm:justify-between",children:[e.jsx(y,{variant:"outline",onClick:()=>{j(!1),w(null),F("")},disabled:i.action,children:"Cancel"}),e.jsx(y,{onClick:is,disabled:i.action,className:"bg-green-600 hover:bg-green-700 text-white",children:i.action?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Approve Payroll"]})})]})]})})]})};export{Us as default};
