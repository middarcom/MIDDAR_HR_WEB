import{r as g,j as e,ax as te,aq as Y,ay as Xe,az as we,at as D,aA as Ye,aB as Ze,aC as et,Q as re,aD as tt,B as I,a5 as rt,c as je,C as O,e as fe,g as Q,a7 as st,f as at,h as nt,d as K,$ as S,aE as ot}from"./index-CCrEZW60.js";import{u as U}from"./useMutation-B4tjqKUk.js";import{a as y}from"./api-DwYzDi__.js";import{T as lt,b as it}from"./tabs-DMeKmE-R.js";import{S as ct}from"./ScrollableTabs-B92Crodw.js";import{T as dt,a as mt,b as ge,c as ve,d as ut,e as be}from"./table-D_39BKO4.js";import{D as se,a as ae,b as ne,c as oe,d as le}from"./dialog-Dq0_R7ZG.js";import{S as w}from"./skeleton-BKuK8gZZ.js";import{u as Ie,C as H,o as pt,s as W,l as ye,n as X,e as Ne,f as ht,t as xt}from"./types-Bc27I7t-.js";import{I as T}from"./input-B52n123F.js";import{T as Fe}from"./textarea-C6lkPzsm.js";import{C as De}from"./checkbox-D011lLSb.js";import{S as Ae,a as Me,b as Ee,c as Te,d as L}from"./select-BUhFCEhu.js";import{L as J}from"./label-Dchh_76G.js";import{L as Z}from"./loader-circle-CT-eCON9.js";import{F as jt,a as F,b as A,c as M,d as E,e as G}from"./form-Cz_MZMqv.js";import{S as ft}from"./switch-lXl8QoDS.js";import{L as gt}from"./list-DG_8nrno.js";import{L as vt}from"./layout-grid-BbrBd4ud.js";import{P as bt}from"./plus-j7cHYJ2u.js";import"./index-75OEbrM5.js";function yt(t,c=[]){let u=[];function s(m,l){const n=g.createContext(l),j=u.length;u=[...u,l];function b(a){const{scope:i,children:x,...v}=a,_=(i==null?void 0:i[t][j])||n,p=g.useMemo(()=>v,Object.values(v));return e.jsx(_.Provider,{value:p,children:x})}function h(a,i){const x=(i==null?void 0:i[t][j])||n,v=g.useContext(x);if(v)return v;if(l!==void 0)return l;throw new Error(`\`${a}\` must be used within \`${m}\``)}return b.displayName=m+"Provider",[b,h]}const o=()=>{const m=u.map(l=>g.createContext(l));return function(n){const j=(n==null?void 0:n[t])||m;return g.useMemo(()=>({[`__scope${t}`]:{...n,[t]:j}}),[n,j])}};return o.scopeName=t,[s,Nt(o,...c)]}function Nt(...t){const c=t[0];if(t.length===1)return c;const u=()=>{const s=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(m){const l=s.reduce((n,{useScope:j,scopeName:b})=>{const a=j(m)[`__scope${b}`];return{...n,...a}},{});return g.useMemo(()=>({[`__scope${c.scopeName}`]:l}),[l])}};return u.scopeName=c.scopeName,u}var Dt="Toggle",ie=g.forwardRef((t,c)=>{const{pressed:u,defaultPressed:s=!1,onPressedChange:o,...m}=t,[l=!1,n]=te({prop:u,onChange:o,defaultProp:s});return e.jsx(Y.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":t.disabled?"":void 0,...m,ref:c,onClick:Xe(t.onClick,()=>{t.disabled||n(!l)})})});ie.displayName=Dt;var Pe=ie,$="ToggleGroup",[ke,er]=yt($,[we]),He=we(),ce=D.forwardRef((t,c)=>{const{type:u,...s}=t;if(u==="single"){const o=s;return e.jsx(Ct,{...o,ref:c})}if(u==="multiple"){const o=s;return e.jsx(St,{...o,ref:c})}throw new Error(`Missing prop \`type\` expected on \`${$}\``)});ce.displayName=$;var[Je,Ge]=ke($),Ct=D.forwardRef((t,c)=>{const{value:u,defaultValue:s,onValueChange:o=()=>{},...m}=t,[l,n]=te({prop:u,defaultProp:s,onChange:o});return e.jsx(Je,{scope:t.__scopeToggleGroup,type:"single",value:l?[l]:[],onItemActivate:n,onItemDeactivate:D.useCallback(()=>n(""),[n]),children:e.jsx($e,{...m,ref:c})})}),St=D.forwardRef((t,c)=>{const{value:u,defaultValue:s,onValueChange:o=()=>{},...m}=t,[l=[],n]=te({prop:u,defaultProp:s,onChange:o}),j=D.useCallback(h=>n((a=[])=>[...a,h]),[n]),b=D.useCallback(h=>n((a=[])=>a.filter(i=>i!==h)),[n]);return e.jsx(Je,{scope:t.__scopeToggleGroup,type:"multiple",value:l,onItemActivate:j,onItemDeactivate:b,children:e.jsx($e,{...m,ref:c})})});ce.displayName=$;var[wt,It]=ke($),$e=D.forwardRef((t,c)=>{const{__scopeToggleGroup:u,disabled:s=!1,rovingFocus:o=!0,orientation:m,dir:l,loop:n=!0,...j}=t,b=He(u),h=Ye(l),a={role:"group",dir:h,...j};return e.jsx(wt,{scope:u,rovingFocus:o,disabled:s,children:o?e.jsx(Ze,{asChild:!0,...b,orientation:m,dir:h,loop:n,children:e.jsx(Y.div,{...a,ref:c})}):e.jsx(Y.div,{...a,ref:c})})}),V="ToggleGroupItem",_e=D.forwardRef((t,c)=>{const u=Ge(V,t.__scopeToggleGroup),s=It(V,t.__scopeToggleGroup),o=He(t.__scopeToggleGroup),m=u.value.includes(t.value),l=s.disabled||t.disabled,n={...t,pressed:m,disabled:l},j=D.useRef(null);return s.rovingFocus?e.jsx(et,{asChild:!0,...o,focusable:!l,active:m,ref:j,children:e.jsx(Ce,{...n,ref:c})}):e.jsx(Ce,{...n,ref:c})});_e.displayName=V;var Ce=D.forwardRef((t,c)=>{const{__scopeToggleGroup:u,value:s,...o}=t,m=Ge(V,u),l={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},n=m.type==="single"?l:void 0;return e.jsx(ie,{...n,...o,ref:c,onPressedChange:j=>{j?m.onItemActivate(s):m.onItemDeactivate(s)}})}),Le=ce,Ve=_e;const ze=tt("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),Ft=g.forwardRef(({className:t,variant:c,size:u,...s},o)=>e.jsx(Pe,{ref:o,className:re(ze({variant:c,size:u,className:t})),...s}));Ft.displayName=Pe.displayName;const qe=g.createContext({size:"default",variant:"default"}),Re=g.forwardRef(({className:t,variant:c,size:u,children:s,...o},m)=>e.jsx(Le,{ref:m,className:re("flex items-center justify-center gap-1",t),...o,children:e.jsx(qe.Provider,{value:{variant:c,size:u},children:s})}));Re.displayName=Le.displayName;const ee=g.forwardRef(({className:t,children:c,variant:u,size:s,...o},m)=>{const l=g.useContext(qe);return e.jsx(Ve,{ref:m,className:re(ze({variant:l.variant||u,size:l.size||s}),t),...o,children:c})});ee.displayName=Ve.displayName;const At=({isOpen:t,onCancel:c,onSubmit:u,isSubmitting:s=!1,initialData:o,departments:m=[],isLoadingDepartments:l=!1})=>{const{control:n,handleSubmit:j,watch:b,reset:h,formState:{errors:a}}=Ie({defaultValues:{HrDepartmentName:"",Description:"",IsActive:!0,SubDepartment:!1,FatherDepartment:null,Color:"#3b82f6",...o}}),i=b("SubDepartment"),x=!!(o!=null&&o.HrDepartmentID);g.useEffect(()=>{t&&h({HrDepartmentName:"",Description:"",IsActive:!0,SubDepartment:!1,FatherDepartment:null,Color:"#3b82f6",...o})},[t,o,h]);const v=p=>{const N={...p,IsActive:!!p.IsActive,SubDepartment:!!p.SubDepartment,FatherDepartment:p.SubDepartment&&p.FatherDepartment?Number(p.FatherDepartment):null,children:void 0};u(N)},_=m.filter(p=>!x||p.HrDepartmentID!==o.HrDepartmentID);return e.jsx(se,{open:t,onOpenChange:p=>!p&&(c==null?void 0:c()),children:e.jsxs(ae,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(oe,{children:x?"Edit Department":"Create New Department"}),e.jsx(le,{children:x?"Update the department information below.":"Add a new department to your organizational structure."})]}),e.jsxs("form",{onSubmit:j(v),className:"space-y-6",children:[e.jsx(H,{name:"HrDepartmentName",control:n,rules:{required:"Department name is required"},render:({field:p})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"HrDepartmentName",children:["Department Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(T,{id:"HrDepartmentName",...p,disabled:s,placeholder:"Enter department name"}),a.HrDepartmentName&&e.jsx("p",{className:"text-sm text-destructive",children:a.HrDepartmentName.message})]})}),e.jsx(H,{name:"Description",control:n,render:({field:p})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"Description",children:"Description"}),e.jsx(Fe,{id:"Description",...p,disabled:s,placeholder:"Enter department description",rows:3})]})}),e.jsx(H,{name:"Color",control:n,render:({field:p})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"Color",children:"Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"Color",type:"color",...p,disabled:s,className:"w-20 h-10"}),e.jsx(T,{type:"text",value:p.value,onChange:p.onChange,disabled:s,placeholder:"#3b82f6",className:"flex-1"})]})]})}),e.jsx(H,{name:"SubDepartment",control:n,render:({field:p})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{id:"SubDepartment",checked:p.value,onCheckedChange:p.onChange,disabled:s}),e.jsx(J,{htmlFor:"SubDepartment",className:"!m-0",children:"Is Sub-Department?"})]})}),i&&e.jsx(H,{name:"FatherDepartment",control:n,rules:{required:i?"Parent department is required for sub-departments":!1},render:({field:p})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"FatherDepartment",children:["Parent Department ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(Ae,{onValueChange:N=>p.onChange(N==="null"?null:Number(N)),value:p.value?String(p.value):"null",disabled:s||l,children:[e.jsx(Me,{children:e.jsx(Ee,{placeholder:"Select parent department"})}),e.jsxs(Te,{children:[e.jsx(L,{value:"null",children:"No parent department"}),_.filter(N=>N.IsActive&&!N.SubDepartment).map(N=>e.jsx(L,{value:String(N.HrDepartmentID),children:N.HrDepartmentName},N.HrDepartmentID))]})]}),a.FatherDepartment&&e.jsx("p",{className:"text-sm text-destructive",children:a.FatherDepartment.message})]})}),e.jsx(H,{name:"IsActive",control:n,render:({field:p})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{id:"IsActive",checked:p.value,onCheckedChange:p.onChange,disabled:s}),e.jsx(J,{htmlFor:"IsActive",className:"!m-0",children:"Active"})]})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:c,disabled:s,children:"Cancel"}),e.jsxs(I,{type:"submit",disabled:s,children:[s&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),x?"Update":"Create"," Department"]})]})]})]})})},Mt=pt({JobName:W().min(1,"Job name is required").max(100,"Job name must be less than 100 characters"),JobNameEn:W().max(100,"English job name must be less than 100 characters").optional().or(ye("")),HrDepartmentID:X().min(1,"Department is required"),SalaryMin:X().min(0,"Minimum salary must be 0 or greater").optional().or(Ne()),SalaryMax:X().min(0,"Maximum salary must be 0 or greater").optional().or(Ne()),Description:W().optional().or(ye("")),IsActive:ht().default(!0)});function Et({open:t,onOpenChange:c,onSuccess:u,initialData:s}){const[o,m]=g.useState([]),[l,n]=g.useState(!1),[j,b]=g.useState(!0),h=Ie({resolver:xt(Mt),defaultValues:{JobName:"",JobNameEn:"",HrDepartmentID:0,SalaryMin:null,SalaryMax:null,Description:"",IsActive:!0,...s}});g.useEffect(()=>{t&&(async()=>{try{const x=await y.departments.list({pageSize:1e3});m(x.data||[])}catch(x){console.error("Failed to fetch departments:",x)}finally{b(!1)}})()},[t]),g.useEffect(()=>{t&&h.reset({JobName:"",JobNameEn:"",HrDepartmentID:0,SalaryMin:null,SalaryMax:null,Description:"",IsActive:!0,...s})},[t,s,h]);const a=async i=>{n(!0);try{const x={...i,JobNameEn:i.JobNameEn||null,SalaryMin:i.SalaryMin||null,SalaryMax:i.SalaryMax||null,Description:i.Description||null};s!=null&&s.JobID?await y.job.update(s.JobID,x):await y.job.create(x),u==null||u(),c(!1)}catch(x){console.error("Failed to save job:",x)}finally{n(!1)}};return e.jsx(se,{open:t,onOpenChange:c,children:e.jsxs(ae,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(oe,{children:s!=null&&s.JobID?"Edit Job":"Create New Job"}),e.jsx(le,{children:s!=null&&s.JobID?"Update the job information below.":"Fill in the job details below to create a new position."})]}),e.jsx(jt,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(a),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{control:h.control,name:"JobName",render:({field:i})=>e.jsxs(A,{children:[e.jsx(M,{children:"Job Name *"}),e.jsx(E,{children:e.jsx(T,{placeholder:"Enter job name",...i})}),e.jsx(G,{})]})}),e.jsx(F,{control:h.control,name:"JobNameEn",render:({field:i})=>e.jsxs(A,{children:[e.jsx(M,{children:"English Job Name"}),e.jsx(E,{children:e.jsx(T,{placeholder:"Enter English job name (optional)",...i})}),e.jsx(G,{})]})})]}),e.jsx(F,{control:h.control,name:"HrDepartmentID",render:({field:i})=>e.jsxs(A,{children:[e.jsx(M,{children:"Department *"}),e.jsxs(Ae,{onValueChange:x=>i.onChange(parseInt(x)),value:i.value?i.value.toString():"",children:[e.jsx(E,{children:e.jsx(Me,{children:e.jsx(Ee,{placeholder:"Select a department"})})}),e.jsx(Te,{children:j?e.jsx(L,{value:"loading",disabled:!0,children:"Loading departments..."}):o.map(x=>e.jsx(L,{value:x.HrDepartmentID.toString(),children:x.HrDepartmentName},x.HrDepartmentID))})]}),e.jsx(G,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{control:h.control,name:"SalaryMin",render:({field:i})=>e.jsxs(A,{children:[e.jsx(M,{children:"Minimum Salary"}),e.jsx(E,{children:e.jsx(T,{type:"number",step:"0.01",placeholder:"0.00",...i,value:i.value===null?"":i.value,onChange:x=>{const v=x.target.value;i.onChange(v===""?null:parseFloat(v))}})}),e.jsx(G,{})]})}),e.jsx(F,{control:h.control,name:"SalaryMax",render:({field:i})=>e.jsxs(A,{children:[e.jsx(M,{children:"Maximum Salary"}),e.jsx(E,{children:e.jsx(T,{type:"number",step:"0.01",placeholder:"0.00",...i,value:i.value===null?"":i.value,onChange:x=>{const v=x.target.value;i.onChange(v===""?null:parseFloat(v))}})}),e.jsx(G,{})]})})]}),e.jsx(F,{control:h.control,name:"Description",render:({field:i})=>e.jsxs(A,{children:[e.jsx(M,{children:"Description"}),e.jsx(E,{children:e.jsx(Fe,{placeholder:"Enter job description (optional)",className:"min-h-[100px]",...i})}),e.jsx(G,{})]})}),e.jsx(F,{control:h.control,name:"IsActive",render:({field:i})=>e.jsxs(A,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(M,{className:"text-base",children:"Active Status"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Whether this job position is currently active and available"})]}),e.jsx(E,{children:e.jsx(ft,{checked:i.value,onCheckedChange:i.onChange})})]})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>c(!1),disabled:l,children:"Cancel"}),e.jsx(I,{type:"submit",disabled:l||j,children:l?"Saving...":s!=null&&s.JobID?"Update Job":"Create Job"})]})]})})]})})}const Se={departments:{title:"Departments",tableName:"departments",idField:"HrDepartmentID",columns:[{key:"HrDepartmentName",header:"Department Name",render:(t,c)=>e.jsx("div",{children:t})},{key:"Description",header:"Description",render:t=>t||"N/A"},{key:"IsActive",header:"Status",render:t=>e.jsx(K,{variant:t?"default":"secondary",children:t?"Active":"Inactive"})},{key:"SubDepartment",header:"Type",render:t=>e.jsx(K,{variant:t?"outline":"secondary",children:t?"Sub-department":"Main Department"})},{key:"FatherDepartment",header:"Parent Department",render:(t,c)=>c.parentDepartment&&c.parentDepartment.HrDepartmentName||"N/A"}]},jobs:{title:"Jobs",tableName:"job",idField:"JobID",columns:[{key:"JobName",header:"Job Name"},{key:"JobNameEn",header:"Job Name (English)"},{key:"SalaryMin",header:"Min Salary"},{key:"SalaryMax",header:"Max Salary"},{key:"departments_HrDepartmentName",header:"Department",render:t=>t||"N/A"},{key:"IsActive",header:"Status",render:t=>e.jsx(K,{variant:t?"default":"secondary",children:t?"Active":"Inactive"})}]}},tr=()=>{var pe,he;const[t,c]=g.useState("departments"),[u,s]=g.useState("list"),[o,m]=g.useState(!1),[l,n]=g.useState(null),[j,b]=g.useState(!1),h=rt(),a=Se[t],i=()=>{n(null),m(!0)};g.useEffect(()=>{const r=localStorage.getItem("structureViewMode");r&&s(r)},[]);const x=r=>{s(r),localStorage.setItem("structureViewMode",r)},{data:v,isLoading:_,isError:p,refetch:N}=je({queryKey:["structure",t],queryFn:async()=>{try{if(t==="departments"){const r=await y.departments.list({sort:"ASC",pageSize:100});if(!r.data||!Array.isArray(r.data))throw new Error("Invalid data format received from API");const d=new Map(r.data.map(f=>[f.HrDepartmentID,f]));return{data:r.data.map(f=>({...f,parentDepartment:f.FatherDepartment?d.get(f.FatherDepartment):null}))}}return t==="jobs"?{data:(await y.job.list({sort:"ASC",pageSize:100,select_fields:"JobID,JobName,JobNameEn,HrDepartmentID,SalaryMin,SalaryMax,Description,IsActive,departments_HrDepartmentName"})).data}:{data:[]}}catch(r){throw console.error(`Error fetching ${t}:`,r),r}},placeholderData:ot}),{data:Be=[],isLoading:Oe}=je({queryKey:["departments-for-forms"],queryFn:async()=>{try{const r=await y.departments.list({sort:"ASC",pageSize:200,field:"HrDepartmentName"});return console.log("Departments fetched for forms:",r.data),Array.isArray(r.data)?r.data:[]}catch(r){return console.error("Error fetching departments for forms:",r),[]}},enabled:o||t==="jobs"||t==="departments"}),z=U({mutationFn:async r=>{if(t==="departments")return await y.departments.create(r);if(t==="jobs")return await y.job.create(r)},onSuccess:()=>{S.success(`${a.title.slice(0,-1)} created successfully`),h.invalidateQueries({queryKey:["structure",t]}),m(!1),n(null)},onError:r=>{S.error(`Failed to create ${a.title.slice(0,-1).toLowerCase()}`),console.error("Create error:",r)}}),q=U({mutationFn:async({id:r,data:d})=>{if(t==="departments")return await y.departments.update(r,d);if(t==="jobs")return await y.job.update(r,d)},onSuccess:()=>{S.success(`${a.title.slice(0,-1)} updated successfully`),h.invalidateQueries({queryKey:["structure",t]}),m(!1),n(null)},onError:r=>{S.error(`Failed to update ${a.title.slice(0,-1).toLowerCase()}`),console.error("Update error:",r)}}),Qe=U({mutationFn:async r=>{if(t==="departments")return await y.departments.delete(r);if(t==="jobs")return await y.job.delete(r)},onSuccess:()=>{S.success(`${a.title.slice(0,-1)} deleted successfully`),h.invalidateQueries({queryKey:["structure",t]})},onError:r=>{S.error(`Failed to delete ${a.title.slice(0,-1).toLowerCase()}`),console.error("Delete error:",r)}}),Ke=r=>{if(t!=="departments")return;const d={};if(d.IsActive=r.IsActive!==void 0?!!r.IsActive:!0,d.HrDepartmentName=r.HrDepartmentName||"",d.Description=r.Description||"",d.SubDepartment=!!r.SubDepartment,d.Color=r.Color||"#3b82f6",d.FatherDepartment=r.FatherDepartment?Number(r.FatherDepartment):null,console.log("Submitting department data:",d),l){const C=l[a.idField];if(C===void 0){console.error("Cannot update: Missing ID for",l),S.error(`Cannot update: Missing ID for ${a.title.slice(0,-1).toLowerCase()}`);return}q.mutate({id:C,data:d})}else z.mutate(d)},de=async r=>{var d,C;console.log("Edit button clicked with ID:",r),b(!0);try{let f=(d=v==null?void 0:v.data)==null?void 0:d.find(P=>P[a.idField]===r);if(!f){console.log("Item not found in current data, fetching from API...");const P={[a.idField]:r};let k;const xe={filters:JSON.stringify(P),pageSize:1,sort:"ASC"};switch(t){case"departments":k=await y.departments.list(xe);break;case"jobs":k=await y.job.list({...xe,select_fields:"JobID,JobName,JobNameEn,HrDepartmentID,SalaryMin,SalaryMax,Description,IsActive,departments_HrDepartmentName"});break;default:throw new Error(`Unsupported tab: ${t}`)}if((C=k==null?void 0:k.data)!=null&&C[0])f=k.data[0],console.log("Fetched item from API:",f);else throw new Error("Item not found in API response")}if(f){console.log("Item data found:",f);const P={...f,IsActive:f.IsActive!==void 0?!!f.IsActive:!0,...t==="departments"&&{SubDepartment:!!f.SubDepartment,Color:f.Color||"#3b82f6",FatherDepartment:f.FatherDepartment||null},...t==="jobs"&&{HrDepartmentID:f.HrDepartmentID||null,SalaryMin:f.SalaryMin||null,SalaryMax:f.SalaryMax||null}};console.log("Setting editingItem:",P),n(P),setTimeout(()=>{m(!0)},100)}else throw new Error("Item not found")}catch(f){console.error("Error fetching item data:",f),S.error(`Failed to load ${a.title.slice(0,-1).toLowerCase()} data for editing`)}finally{b(!1)}},me=r=>{const d=r[a.idField];if(!d){console.error("Cannot delete: Missing ID for",r),S.error(`Cannot delete: Missing ID for ${a.title.slice(0,-1).toLowerCase()}`);return}window.confirm(`Are you sure you want to delete this ${a.title.slice(0,-1).toLowerCase()}?`)&&Qe.mutate(d)},Ue=()=>{switch(t){case"departments":return At;case"jobs":return Et;default:return null}},We=t==="jobs",R=Ue(),B=!!l,ue=(()=>{const r=()=>{m(!1),n(null),h.invalidateQueries({queryKey:["structure",t]})},d=()=>{m(!1),n(null)},C=B&&l?{...l,IsActive:l.IsActive!==void 0?!!l.IsActive:!0}:void 0;return t==="jobs"?{open:o,onOpenChange:f=>{f||(m(!1),n(null))},onSuccess:r,initialData:C}:{isOpen:o,onSubmit:Ke,onCancel:d,initialData:C,isPending:z.isPending||q.isPending,departments:Be||[],isLoadingDepartments:Oe,isSubmitting:z.isPending||q.isPending}})();return _?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(w,{className:"h-8 w-48"}),e.jsx(w,{className:"h-4 w-64"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{className:"h-9 w-24"}),e.jsx(w,{className:"h-9 w-32"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(w,{className:"h-10 w-full md:w-64"}),e.jsxs(O,{children:[e.jsx(fe,{className:"pb-3",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx(w,{className:"h-6 w-32 mb-1"}),e.jsx(w,{className:"h-4 w-48"})]})})}),e.jsx(Q,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-4 border-b pb-2",children:[...Array(4)].map((r,d)=>e.jsx(w,{className:"h-6 w-32"},d))}),[...Array(5)].map((r,d)=>e.jsx(w,{className:"h-16 w-full"},d))]})})]})]})})]}):p?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"rounded-md bg-destructive/15 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(st,{className:"h-5 w-5 text-destructive"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-destructive",children:["Failed to load ",a.title.toLowerCase()]}),e.jsx("div",{className:"mt-2 text-sm text-destructive",children:e.jsx("p",{children:"An error occurred while loading the data. Please try again later."})})]})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Structure Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your organization's structure and hierarchy"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(Re,{type:"single",value:u,onValueChange:r=>x(r),variant:"outline",className:"rounded-md",children:[e.jsx(ee,{value:"list","aria-label":"List view",children:e.jsx(gt,{className:"h-4 w-4"})}),e.jsx(ee,{value:"grid","aria-label":"Grid view",children:e.jsx(vt,{className:"h-4 w-4"})})]}),e.jsxs(I,{onClick:i,children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Add ",a.title.slice(0,-1)]})]})]}),e.jsxs(lt,{value:t,onValueChange:r=>c(r),className:"space-y-4",children:[e.jsx(ct,{className:"md:grid md:grid-cols-2",children:Object.entries(Se).map(([r,d])=>e.jsx(it,{value:r,children:d.title},r))}),e.jsxs(O,{children:[e.jsx(fe,{className:"pb-3",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx(at,{children:a.title}),e.jsxs(nt,{children:["Manage your organization's ",a.title.toLowerCase()]})]})})}),e.jsx(Q,{children:u==="list"?e.jsx("div",{className:"rounded-md border",children:e.jsxs(dt,{children:[e.jsx(mt,{children:e.jsxs(ge,{children:[a.columns.map(r=>e.jsx(ve,{children:r.header},`header-${r.key}`)),e.jsx(ve,{className:"text-right",children:"Actions"})]})}),e.jsx(ut,{children:(pe=v==null?void 0:v.data)==null?void 0:pe.map(r=>e.jsxs(ge,{children:[a.columns.map(d=>e.jsx(be,{children:d.render?d.render(r[d.key],r):String(r[d.key]||"N/A")},`${r[a.idField]}-${d.key}`)),e.jsx(be,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(I,{variant:"ghost",size:"sm",onClick:()=>de(r[a.idField]),disabled:j,children:[j?e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Edit"]}),e.jsx(I,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>me(r),children:"Delete"})]})})]},r[a.idField]))},"table-body")]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(he=v==null?void 0:v.data)==null?void 0:he.map(r=>e.jsxs(O,{className:"hover:shadow-md transition-shadow overflow-hidden",children:[t==="departments"&&r.Color&&e.jsx("div",{className:"h-2 w-full",style:{backgroundColor:r.Color}}),e.jsxs(Q,{className:t==="departments"&&r.Color?"pt-4":"pt-6",children:[e.jsx("div",{className:"space-y-3",children:a.columns.filter(d=>d.key!=="Description").map(d=>e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[d.header,":"]}),e.jsx("span",{className:"text-sm text-right",children:d.render?d.render(r[d.key],r):String(r[d.key]||"N/A")})]},`${r[a.idField]}-${d.key}`))}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-2",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>de(r[a.idField]),disabled:j,children:[j?e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Edit"]}),e.jsx(I,{variant:"outline",size:"sm",className:"text-destructive border-destructive/50 hover:bg-destructive/10",onClick:()=>me(r),children:"Delete"})]})]})]},r[a.idField]))})})]})]}),We?e.jsx(R,{open:o,onOpenChange:r=>{r||(m(!1),n(null))},onSuccess:()=>{m(!1),n(null),h.invalidateQueries({queryKey:["structure",t]})},initialData:l}):e.jsx(se,{open:o,onOpenChange:r=>{r||(m(!1),n(null))},children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsxs(oe,{children:[B?"Edit":"Add New"," ",a.title.slice(0,-1)]}),e.jsx(le,{children:B?`Edit ${a.title.slice(0,-1)} details and save changes`:`Create a new ${a.title.slice(0,-1)} and add it to the system`})]}),e.jsx("div",{className:"py-4",children:o&&e.jsx(e.Fragment,{children:t==="jobs"?e.jsx(R,{...ue}):e.jsx(R,{...ue})})})]})})]})};export{tr as StructurePage,tr as default};
