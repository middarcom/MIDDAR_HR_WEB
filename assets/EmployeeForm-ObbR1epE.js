import{o as ce,b as de,r as i,n as D,j as e,t as g,A as pe,a1 as he,E as ue,B as c,k as A,Q as xe,C as fe,e as je,f as ye,h as De,g as ge,a0 as K,$ as U}from"./index-CCrEZW60.js";import{o as Ne,s as n,l as X,d as V,a as ve,n as be,u as Se,t as we}from"./types-Bc27I7t-.js";import{I as m}from"./input-B52n123F.js";import{L as l}from"./label-Dchh_76G.js";import{S as N,a as v,b,c as S,d as h}from"./select-BUhFCEhu.js";import{P as J,b as O,c as L,C as M}from"./popover-Dp7kce_M.js";import{A as w,a as B,b as I}from"./alert-CZaCO7D-.js";import{a as R}from"./api-DwYzDi__.js";import{p as Z}from"./parse-Dro3Y-Gp.js";import"./index-75OEbrM5.js";import"./getDaysInMonth-CHx9-T72.js";import"./chevron-left-Bqlkwn7Z.js";const Ie=Ne({FirstName:n().min(1,"First Name is required"),LastName:n().min(1,"Last Name is required"),Email:n().email("Invalid email address").min(1,"Email is required"),Phone:n().min(10,"Phone number must be at least 10 digits").nullish().or(X("")),DateOfBirth:V({required_error:"Date of Birth is required"}),Gender:n().min(1,"Gender is required"),NationalID:n().nullish(),Address:n().nullish(),City:n().nullish(),Country:n().nullish(),PostalCode:n().nullish(),HireDate:V({required_error:"Hire Date is required"}),ReportsTo:ve([be().int().positive().nullish(),X("")]).transform(r=>r===""?void 0:r),EmploymentStatus:n().nullish(),TerminationDate:V().nullish(),HrDepartmentID:n().min(1,"Department is required"),JobID:n().min(1,"Job Title is required")}),C=({title:r,description:u,children:E})=>e.jsxs(fe,{className:"border border-border/60 shadow-sm rounded-2xl",children:[e.jsxs(je,{className:"space-y-1 pb-6",children:[e.jsx(ye,{className:"text-lg font-semibold",children:r}),u&&e.jsx(De,{className:"text-sm text-muted-foreground",children:u})]}),e.jsx(ge,{className:"space-y-6 pt-0",children:E})]}),Be=()=>{const{t:r}=ce(),u=de(),[E,T]=i.useState(""),[ee,H]=i.useState(""),[se,q]=i.useState(!1),[te,k]=i.useState(!1),[P,x]=i.useState(null),[G,Y]=i.useState(!1),[f,F]=i.useState(null),[d,re]=i.useState({departments:[],jobs:[],employmentStatuses:[{id:"Active",name:r("common.active")},{id:"On Leave",name:r("employees.statusTypes.On Leave")},{id:"Terminated",name:r("employees.statusTypes.Terminated")},{id:"Retired",name:r("employees.statusTypes.Retired")}]}),[ae,$]=i.useState(!0);i.useEffect(()=>{(async()=>{try{$(!0);const[a,o]=await Promise.all([R.departments.list({page:0,pageSize:100,sort:"asc"}),R.job.list({page:0,pageSize:100,sort:"asc"})]);re(p=>({...p,departments:a.data||[],jobs:o.data||[]}))}catch(a){console.error("Error fetching job data:",a),F(r("employees.form.errors.loadJobDataFailed"))}finally{$(!1)}})()},[]);const s=Se({resolver:we(Ie),defaultValues:{FirstName:"",LastName:"",Email:"",Phone:"",Gender:"",NationalID:"",DateOfBirth:void 0,HireDate:new Date,ReportsTo:"",Address:"",City:"",Country:"",PostalCode:"",HrDepartmentID:"",JobID:"",EmploymentStatus:"Active"}});i.useEffect(()=>{const t=s.getValues("JobID");if(t){const a=s.watch("HrDepartmentID"),o=d.jobs.find(p=>String(p.JobID)===t);o&&a&&String(o.HrDepartmentID)!==a&&s.setValue("JobID","")}},[s.watch("HrDepartmentID"),d.jobs]),i.useEffect(()=>{x(null)},[s.watch()]),i.useEffect(()=>{const t=s.watch("DateOfBirth"),a=s.watch("HireDate");t&&T(D(t,"dd/MM/yyyy")),a&&H(D(a,"dd/MM/yyyy"))},[s.watch("DateOfBirth"),s.watch("HireDate")]);const le=t=>{const a=t.target.value;if(T(a),a.length===10){const o=Z(a,"dd/MM/yyyy",new Date);K(o)&&s.setValue("DateOfBirth",o,{shouldValidate:!0})}},oe=t=>{const a=t.target.value;if(H(a),a.length===10){const o=Z(a,"dd/MM/yyyy",new Date);K(o)&&s.setValue("HireDate",o,{shouldValidate:!0})}},z=t=>t?`ID${t.replace(/^ID/i,"").trim()}`:"",_=()=>{s.reset(),T(""),H(""),x(null)},ie=t=>t.includes("Email")?r("employees.form.duplicateError.email"):t.includes("NationalID")?r("employees.form.duplicateError.nationalId"):t.includes("Phone")?r("employees.form.duplicateError.phone"):r("employees.form.duplicateError.generic"),ne=async t=>{try{Y(!0),x(null),F(null);const a=W=>W?D(W,"yyyy-MM-dd"):null,o={FirstName:t.FirstName,LastName:t.LastName,Email:t.Email||null,Phone:t.Phone||null,DateOfBirth:a(t.DateOfBirth),Gender:t.Gender,NationalID:z(t.NationalID),Address:t.Address||null,City:t.City||null,Country:t.Country||null,PostalCode:t.PostalCode||null,HireDate:a(t.HireDate),ReportsTo:t.ReportsTo||null,EmploymentStatus:t.EmploymentStatus||"Active",TerminationDate:t.TerminationDate?a(t.TerminationDate):null,HrDepartmentID:t.HrDepartmentID,JobID:t.JobID,Status:"Active",CreatedBy:1,CreatedAt:new Date().toISOString()};console.log("Creating employee with data:",o);const p=await R.create("employees",o);console.log("Employee created successfully:",p),U.success(r("employees.form.errors.success")),u("/employees"),s.reset()}catch(a){console.error("Error creating employee:",a),F(a.message||r("employees.form.errors.createEmployeeFailed")),a.message&&a.message.includes("Value has to be unique")?x(ie(a.message)):U.error(r("employees.form.errors.genericError"))}finally{Y(!1)}};if(ae)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading form data..."})]})});if(f)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs(w,{variant:"destructive",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(B,{children:"Error"}),e.jsx(I,{children:f})]})});const j=s.watch("FirstName"),y=s.watch("LastName");s.watch("EmploymentStatus");const Q=[j,y].filter(Boolean).join(" ")||"New Employee",me=`${(j==null?void 0:j[0])??""}${(y==null?void 0:y[0])??""}`.trim()||"NE";return e.jsx("div",{className:"min-h-0 bg-muted/20 py-10 px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"container max-w-5xl mx-auto",children:e.jsxs("form",{onSubmit:s.handleSubmit(ne),className:"space-y-8",children:[Object.keys(s.formState.errors).length>0&&e.jsxs(w,{variant:"destructive",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(B,{children:r("employees.form.validationErrors")}),e.jsx(I,{children:e.jsx("ul",{className:"list-disc list-inside text-sm",children:Object.entries(s.formState.errors).map(([t,a])=>e.jsxs("li",{children:[t,": ",a.message]},t))})})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-3xl border bg-gradient-to-br from-primary/10 via-background to-background p-8 shadow-sm",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 hidden h-full w-1/3 translate-x-24 rounded-full bg-primary/15 blur-3xl md:block"}),e.jsxs("div",{className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-5",children:[e.jsxs(pe,{className:"h-20 w-20 border-2 border-white/60 shadow-lg",children:[e.jsx(he,{src:"",alt:Q}),e.jsx(ue,{className:"bg-primary/10 text-lg font-semibold text-primary",children:me})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:Q}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r("employees.form.description")})]})]}),e.jsx("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:items-end",children:e.jsx(c,{type:"button",variant:"outline",className:"w-full sm:w-auto",onClick:_,children:r("employees.form.reset")})})]})]}),P&&e.jsxs(w,{variant:"destructive",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(I,{children:P})]}),e.jsx(C,{title:r("employees.form.sections.personal.title"),description:r("employees.form.sections.personal.description"),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"NationalID",children:r("employees.form.nationalId")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 start-0 flex items-center ps-3 text-xs font-semibold uppercase text-muted-foreground",children:"ID"}),e.jsx(m,{id:"NationalID",...s.register("NationalID"),placeholder:"123456789",className:"ps-10"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Saved as ",s.watch("NationalID")?z(s.watch("NationalID")):"ID0000"]}),s.formState.errors.NationalID&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.NationalID.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"FirstName",children:r("employees.firstName")}),e.jsx(m,{id:"FirstName",...s.register("FirstName")}),s.formState.errors.FirstName&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.FirstName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"LastName",children:r("employees.lastName")}),e.jsx(m,{id:"LastName",...s.register("LastName")}),s.formState.errors.LastName&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.LastName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:r("employees.form.gender.label")}),e.jsxs(N,{onValueChange:t=>{s.setValue("Gender",t,{shouldValidate:!0})},value:s.watch("Gender"),children:[e.jsx(v,{children:e.jsx(b,{placeholder:r("employees.form.gender.placeholder")})}),e.jsxs(S,{children:[e.jsx(h,{value:"M",children:r("employees.form.gender.male")}),e.jsx(h,{value:"F",children:r("employees.form.gender.female")})]})]}),s.formState.errors.Gender&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.Gender.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:r("employees.form.dob")}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[minmax(0,1fr)_auto]",children:[e.jsx(m,{type:"text",placeholder:"DD/MM/YYYY",value:E,onChange:le}),e.jsxs(J,{open:se,onOpenChange:q,children:[e.jsx(O,{asChild:!0,children:e.jsx(c,{variant:"outline",type:"button",className:"h-10 w-full sm:w-11",children:e.jsx(A,{className:"h-4 w-4"})})}),e.jsx(L,{className:"w-auto p-0",align:"end",children:e.jsx(M,{mode:"single",selected:s.watch("DateOfBirth"),onSelect:t=>{t&&(s.setValue("DateOfBirth",t),q(!1))},initialFocus:!0,className:"rounded-md border p-2"})})]})]}),s.formState.errors.DateOfBirth&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.DateOfBirth.message})]})]})}),e.jsx(C,{title:r("employees.form.sections.contact.title"),description:r("employees.form.sections.contact.description"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"Email",children:r("employees.email")}),e.jsx(m,{id:"Email",type:"email",...s.register("Email")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("employees.form.uniqueEmail")}),s.formState.errors.Email&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.Email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"Phone",children:[r("employees.phone")," (",r("common.optional"),")"]}),e.jsx(m,{id:"Phone",...s.register("Phone")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("employees.form.uniquePhone")}),s.formState.errors.Phone&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.Phone.message})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"Address",children:[r("employees.form.address")," (",r("common.optional"),")"]}),e.jsx(m,{id:"Address",...s.register("Address")}),s.formState.errors.Address&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.Address.message})]}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"City",children:[r("employees.form.city")," (",r("common.optional"),")"]}),e.jsx(m,{id:"City",...s.register("City")}),s.formState.errors.City&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.City.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"Country",children:[r("employees.form.country")," (",r("common.optional"),")"]}),e.jsx(m,{id:"Country",...s.register("Country")}),s.formState.errors.Country&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.Country.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"PostalCode",children:[r("employees.form.postalCode")," (",r("common.optional"),")"]}),e.jsx(m,{id:"PostalCode",...s.register("PostalCode")}),s.formState.errors.PostalCode&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.PostalCode.message})]})]})]})]})}),e.jsx(C,{title:r("employees.form.sections.employment.title"),description:r("employees.form.sections.employment.description"),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:r("employees.hireDate")}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-[minmax(0,1fr)_auto]",children:[e.jsx(m,{type:"text",placeholder:"DD/MM/YYYY",value:ee,onChange:oe}),e.jsxs(J,{open:te,onOpenChange:k,children:[e.jsx(O,{asChild:!0,children:e.jsx(c,{variant:"outline",type:"button",className:"h-10 w-full sm:w-11",children:e.jsx(A,{className:"h-4 w-4"})})}),e.jsx(L,{className:"w-auto p-0",align:"end",children:e.jsx(M,{mode:"single",selected:s.watch("HireDate"),onSelect:t=>{t&&(s.setValue("HireDate",t),k(!1))},initialFocus:!0,className:"rounded-md border p-2"})})]})]}),s.formState.errors.HireDate&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.HireDate.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"ReportsTo",children:[r("employees.form.reportsTo")," (",r("common.optional"),")"]}),e.jsx(m,{type:"number",id:"ReportsTo",...s.register("ReportsTo",{setValueAs:t=>t===""?void 0:Number(t),required:!1}),placeholder:r("employees.form.reportsToPlaceholder"),min:"1",step:"1"}),s.formState.errors.ReportsTo&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.ReportsTo.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:r("employees.status")}),e.jsxs(N,{value:s.watch("EmploymentStatus"),onValueChange:t=>s.setValue("EmploymentStatus",t),children:[e.jsx(v,{children:e.jsx(b,{placeholder:r("employees.form.statusPlaceholder")})}),e.jsx(S,{children:d.employmentStatuses.map(t=>e.jsx(h,{value:t.id,children:t.name},t.id))})]}),s.formState.errors.EmploymentStatus&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.EmploymentStatus.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{children:[r("employees.form.terminationDate")," (",r("common.optional"),")"]}),e.jsxs(J,{children:[e.jsx(O,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:xe("w-full justify-start text-left font-normal",!s.watch("TerminationDate")&&"text-muted-foreground"),children:[e.jsx(A,{className:"me-2 h-4 w-4"}),s.watch("TerminationDate")?D(s.watch("TerminationDate"),"PPP"):e.jsx("span",{children:r("employees.form.pickDate")})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s.watch("TerminationDate"),onSelect:t=>s.setValue("TerminationDate",t||void 0),initialFocus:!0})})]}),s.formState.errors.TerminationDate&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.TerminationDate.message})]})]})}),e.jsx(C,{title:r("employees.form.sections.job.title"),description:r("employees.form.sections.job.description"),children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"HrDepartmentID",children:r("employees.department")}),e.jsxs(N,{onValueChange:t=>s.setValue("HrDepartmentID",t),value:s.watch("HrDepartmentID"),children:[e.jsx(v,{children:e.jsx(b,{placeholder:r("employees.form.departmentPlaceholder")})}),e.jsx(S,{children:d.departments.map(t=>e.jsx(h,{value:String(t.HrDepartmentID),children:t.HrDepartmentName},t.HrDepartmentID))})]}),s.formState.errors.HrDepartmentID&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.HrDepartmentID.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"JobID",children:r("employees.jobTitle")}),e.jsxs(N,{onValueChange:t=>s.setValue("JobID",t),value:s.watch("JobID"),disabled:!s.watch("HrDepartmentID"),children:[e.jsx(v,{children:e.jsx(b,{placeholder:s.watch("HrDepartmentID")?r("employees.form.jobPlaceholder"):r("employees.dashboard.directory.selectDepartmentFirst")})}),e.jsx(S,{children:d.jobs.filter(t=>!s.watch("HrDepartmentID")||String(t.HrDepartmentID)===s.watch("HrDepartmentID")).map(t=>e.jsx(h,{value:String(t.JobID),children:t.JobName},t.JobID))})]}),s.formState.errors.JobID&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.JobID.message})]})]})}),f&&!P&&e.jsxs(w,{variant:"destructive",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(B,{children:"Error"}),e.jsx(I,{children:f})]}),e.jsxs("div",{className:"flex flex-col gap-3 border-t pt-6 sm:flex-row sm:items-center sm:justify-end",children:[e.jsx(c,{type:"button",variant:"outline",className:"w-full sm:w-auto",onClick:_,children:r("employees.form.clear")}),e.jsx(c,{type:"submit",className:"w-full sm:w-auto",disabled:G,children:G?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"-ms-1 me-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r("common.saving")]}):r("employees.form.create")})]})]})})})};export{Be as default};
