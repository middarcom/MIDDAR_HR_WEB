import{l as re,ab as Ze,aq as Pt,r as j,j as e,ar as St,Q as Se,a5 as mt,b as Ee,c as ge,t as _e,B as f,d as Z,K as Xe,C as M,e as U,f as J,F as ke,g as R,k as ae,i as It,h as xt,n as B,$ as L,o as Fe,a7 as kt,D as Et,S as Ft,as as et,y as tt,z as at,G as st,J as ne,at as Mt,a9 as Te,a1 as $t,W as _t,Y as Ht,au as Rt,a as X,a0 as Vt,av as zt,aw as ce}from"./index-DcTsfPOQ.js";import{T as qe,a as Be,b as se,c as rt}from"./tabs--CwFPUC6.js";import{T as He,a as Re,b as Y,c as q,d as Ve,e as F}from"./table-BJW1dPs9.js";import{a as I}from"./api-DUHMZ36Z.js";import{A as ut}from"./arrow-left-BJcD4Gjc.js";import{P as Ce}from"./plus-7yv9qKks.js";import{o as ze,n as le,d as ie,s as oe,u as ht,t as pt,b as Lt,c as qt}from"./types-D04yGbvz.js";import{I as Q}from"./input-COXv_7eX.js";import{L as b}from"./label-CAQongzc.js";import{T as Ue}from"./textarea-BIbDcBqF.js";import{P as de,b as me,c as xe,C as ue,i as Bt,f as Ut}from"./popover-Bj1zDLHq.js";import{u as nt}from"./useMutation-CsdbkMre.js";import{S as he,a as pe,b as ye,c as je,d as H}from"./select-DCRErqP0.js";import{S as G}from"./skeleton-C0wj_6h9.js";import{C as te}from"./checkbox-Bg6Eu0gF.js";import{D as yt,a as jt,b as Ct,c as ft,d as Nt,f as Kt}from"./dialog-BTqBvcGL.js";import{T as ve}from"./trash-2-B_FQxvZR.js";import{C as Ot}from"./circle-check-zlo0jyXQ.js";import{F as Qt}from"./filter-6kyjrtRX.js";import{D as ct}from"./download-CdRm0dBl.js";import{E as ot}from"./eye-DjT-Oc95.js";import{S as Yt}from"./square-pen-DSVHbtJ0.js";import{P as gt}from"./pencil-BE3j2NYC.js";import{C as Jt}from"./chevron-left-CDQ6U5C1.js";import{p as Le}from"./parseISO-BnihigV6.js";import{R as Wt}from"./ReportViewer-mOsnLBaH.js";import"./getDaysInMonth-8Efe35wA.js";import"./index-9jX0xVs3.js";import"./alert-OO0Ojiqf.js";import"./date-picker-BfeghS0q.js";import"./loader-circle-BaCmAyG7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=re("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=re("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=re("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=re("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=re("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=re("FileType2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 13v-1h6v1",key:"1dh9dg"}],["path",{d:"M5 12v6",key:"150t9c"}],["path",{d:"M4 18h2",key:"1xrofg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=re("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function sa(t,n){const s=Ze(t),c=Ze(n),g=it(s,c),d=Math.abs(Pt(s,c));s.setDate(s.getDate()-g*d);const m=+(it(s,c)===-g),u=g*(d-m);return u===0?0:u}function it(t,n){const s=t.getFullYear()-n.getFullYear()||t.getMonth()-n.getMonth()||t.getDate()-n.getDate()||t.getHours()-n.getHours()||t.getMinutes()-n.getMinutes()||t.getSeconds()-n.getSeconds()||t.getMilliseconds()-n.getMilliseconds();return s<0?-1:s>0?1:s}const W={getContracts:async(t={})=>{const n=t.page!==void 0?Math.max(0,t.page-1):0,s={sort:(t.sortOrder||"desc").toLowerCase(),pageSize:t.pageSize||10,page:n};return t.search&&(s.search=t.search),t.status&&(s.status=t.status),t.type&&(s.type=t.type),t.sortBy&&(s.sortBy=t.sortBy),await I.contract.list(s)},getContractById:async t=>{const n=await I.contract.get(t,{columns:"ContractID,EmployeeID,employees_FirstName,employees_LastName,ContractAmount,ContractDate,ContractStartDate,ContractEndDate,ContractNote,ContractType,ContractTitle,ContractStatus,ContractDescription,Status,CreatedAt,UpdatedAt,CreatedBy,UpdatedBy"}),s=await W.getContractPayments(t),c=s.filter(w=>w.contractpaytype_IsAdd===1),g=s.filter(w=>w.contractpaytype_IsAdd===0),d=c.reduce((w,A)=>{const v=A.contractpaytype_IsHour===1?parseFloat(A.ContractPAmountHour)||0:parseFloat(A.ContractPAmount)||0;return w+v},0),m=g.reduce((w,A)=>{const v=A.contractpaytype_IsHour===1?parseFloat(A.ContractPAmountHour)||0:parseFloat(A.ContractPAmount)||0;return w+v},0),u=(parseFloat(n.ContractAmount)||0)+d-m;return{...n,payments:s,additions:c,deductions:g,totalAdditions:d,totalDeductions:m,netAmount:u}},createContract:async t=>I.contract.create(t),updateContract:async(t,n)=>I.contract.update(t,n),deleteContract:async t=>I.contract.delete(t),getContractPayments:async t=>(await I.list("contractp",{exact_filters:JSON.stringify({ContractID:t}),select_fields:"ContractPID,ContractID,ContractPayTypeID,ContractPAmount,ContractPAmountHour,ContractNote,contractpaytype_ContractPayTypeName,contractpaytype_IsAdd,contractpaytype_IsHour",sort:"ContractPID asc"})).data||[],addPayment:async t=>I.create("contractp",t),updatePayment:async(t,n)=>I.update("contractp",t,n),deletePayment:async t=>I.delete("contractp",t),getPaymentTypes:async()=>(await I.list("contractpaytype",{exact_filters:JSON.stringify({IsActive:!0}),sort:"ContractPayTypeName asc"})).data||[],getContractDocuments:async t=>(await I.list("contractdocument",{exact_filters:JSON.stringify({ContractID:t,IsActive:!0}),sort:"UploadedAt desc"})).data||[],uploadDocument:async t=>I.create("contractdocument",t),deleteDocument:async t=>I.update("contractdocument",t,{IsActive:!1}),getTemplates:async()=>(await I.list("contractstemplate",{exact_filters:JSON.stringify({IsActive:!0}),sort:"TemplateName asc"})).data||[],getTemplateById:async t=>I.get("contractstemplate",t),exportContracts:async(t="pdf",n)=>{var s,c;return(c=(s=I.contract).export)==null?void 0:c.call(s,t,n)},submitForApproval:async(t,n,s)=>I.contract.update(t,{Status:"pending_approval",SubmittedBy:n,Comments:s}),approveContract:async(t,n,s)=>I.contract.update(t,{Status:"active",ApprovedBy:n,ApprovalDate:new Date().toISOString(),Comments:s}),rejectContract:async(t,n,s)=>I.contract.update(t,{Status:"rejected",RejectedBy:n,RejectionDate:new Date().toISOString(),RejectionReason:s}),terminateContract:async(t,n,s,c)=>I.contract.update(t,{Status:"terminated",TerminatedBy:n,TerminationDate:s,TerminationReason:c})};var ra="Separator",dt="horizontal",na=["horizontal","vertical"],vt=j.forwardRef((t,n)=>{const{decorative:s,orientation:c=dt,...g}=t,d=ca(c)?c:dt,u=s?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return e.jsx(St.div,{"data-orientation":d,...u,...g,ref:n})});vt.displayName=ra;function ca(t){return na.includes(t)}var Dt=vt;const Ie=j.forwardRef(({className:t,orientation:n="horizontal",decorative:s=!0,...c},g)=>e.jsx(Dt,{ref:g,decorative:s,orientation:n,className:Se("shrink-0 bg-border",n==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...c}));Ie.displayName=Dt.displayName;const oa=()=>{const{id:t}=mt(),n=Ee();j.useState("overview");const{data:s,isLoading:c,error:g}=ge({queryKey:["contract",t],queryFn:()=>W.getContractById(Number(t)),enabled:!!t}),d=N=>{if(!N)return"N/A";try{return B(new Date(N),"PPP")}catch{return N}},m=N=>{const p=typeof N=="string"?parseFloat(N):N;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(p||0)};if(c)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})});if(g||!s)return e.jsxs("div",{className:"p-8 text-center bg-destructive/10 rounded-lg",children:[e.jsx(_e,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-destructive mb-2",children:"Error Loading Contract"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The contract details could not be retrieved."}),e.jsx(f,{onClick:()=>n("/contracts"),children:"Back to Contracts"})]});const u=s,w=u.ContractID||u.id,A=u.additions||[],v=u.deductions||[],y=u.totalAdditions||0,D=u.totalDeductions||0,V=u.netAmount||0;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-2",children:e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>n("/contracts"),className:"p-0 hover:bg-transparent",children:[e.jsx(ut,{className:"h-5 w-5 mr-1"}),"Back to Contracts"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Contract #",w]}),e.jsx(Z,{variant:u.ContractStatus==="Active"?"success":"outline",children:u.ContractStatus||"New"})]}),e.jsxs("p",{className:"text-muted-foreground flex items-center",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),u.employees_FirstName," ",u.employees_LastName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{variant:"outline",onClick:()=>n(`/contracts/${w}/edit`),children:"Edit Contract"}),e.jsx(f,{children:"Download PDF"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(M,{children:[e.jsx(U,{children:e.jsxs(J,{className:"flex items-center",children:[e.jsx(ke,{className:"h-5 w-5 mr-2 text-primary"}),"Contract Overview"]})}),e.jsxs(R,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Base Salary"}),e.jsx("p",{className:"text-2xl font-bold",children:m(u.ContractAmount)})]}),e.jsx(Ie,{}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ae,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Dates"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d(u.ContractStartDate)," - ",u.ContractEndDate?d(u.ContractEndDate):"Open Ended"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Contract Type"}),e.jsx("p",{className:"text-lg",children:u.ContractType||"Standard Employment"})]}),e.jsx(Ie,{}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(It,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Status"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current Status: ",e.jsx("span",{className:"font-semibold text-foreground",children:u.ContractStatus||"New"})]})]})]})]})]}),u.ContractNote&&e.jsxs("div",{className:"mt-8 p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Administrative Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:u.ContractNote})]})]})]}),e.jsxs(qe,{defaultValue:"payments",className:"w-full",children:[e.jsxs(Be,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(se,{value:"payments",children:"Financial Details"}),e.jsx(se,{value:"documents",children:"Documents"})]}),e.jsx(rt,{value:"payments",className:"space-y-4 mt-6",children:e.jsxs(M,{children:[e.jsxs(U,{children:[e.jsx(J,{className:"text-lg",children:"Salary Components"}),e.jsx(xt,{children:"All additions and deductions related to this contract"})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center text-sm font-semibold text-green-600 mb-3",children:[e.jsx(Zt,{className:"h-4 w-4 mr-1"}),"Additions & Allowances"]}),e.jsxs(He,{children:[e.jsx(Re,{children:e.jsxs(Y,{children:[e.jsx(q,{children:"Type"}),e.jsx(q,{children:"Amount"}),e.jsx(q,{children:"Hourly"}),e.jsx(q,{children:"Note"})]})}),e.jsx(Ve,{children:A.length>0?A.map(N=>e.jsxs(Y,{children:[e.jsx(F,{className:"font-medium",children:N.contractpaytype_ContractPayTypeName}),e.jsxs(F,{className:"text-green-600",children:["+",m(N.ContractPAmount)]}),e.jsx(F,{children:N.ContractPAmountHour>0?m(N.ContractPAmountHour):"-"}),e.jsx(F,{className:"text-xs text-muted-foreground",children:N.ContractNote||"-"})]},N.ContractPID)):e.jsx(Y,{children:e.jsx(F,{colSpan:4,className:"text-center py-4 text-muted-foreground",children:"No additional payments"})})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center text-sm font-semibold text-red-600 mb-3",children:[e.jsx(Gt,{className:"h-4 w-4 mr-1"}),"Deductions"]}),e.jsxs(He,{children:[e.jsx(Re,{children:e.jsxs(Y,{children:[e.jsx(q,{children:"Type"}),e.jsx(q,{children:"Amount"}),e.jsx(q,{children:"Hourly"}),e.jsx(q,{children:"Note"})]})}),e.jsx(Ve,{children:v.length>0?v.map(N=>e.jsxs(Y,{children:[e.jsx(F,{className:"font-medium",children:N.contractpaytype_ContractPayTypeName}),e.jsxs(F,{className:"text-red-600",children:["-",m(N.ContractPAmount)]}),e.jsx(F,{children:N.ContractPAmountHour>0?m(N.ContractPAmountHour):"-"}),e.jsx(F,{className:"text-xs text-muted-foreground",children:N.ContractNote||"-"})]},N.ContractPID)):e.jsx(Y,{children:e.jsx(F,{colSpan:4,className:"text-center py-4 text-muted-foreground",children:"No deductions"})})})]})]})]})})]})}),e.jsx(rt,{value:"documents",className:"mt-6",children:e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{className:"text-lg",children:"Contract Documents"})}),e.jsxs(R,{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(ke,{className:"h-12 w-12 opacity-20 mb-2"}),e.jsx("p",{children:"No documents uploaded for this contract."}),e.jsxs(f,{variant:"outline",size:"sm",className:"mt-4",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Upload Document"]})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{className:"bg-primary/5 border-primary/20",children:[e.jsx(U,{children:e.jsx(J,{className:"text-lg",children:"Financial Summary"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Base Salary"}),e.jsx("span",{className:"font-medium",children:m(u.ContractAmount)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Additions"}),e.jsxs("span",{className:"text-green-600 font-medium",children:["+",m(y)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["-",m(D)]})]}),e.jsx(Ie,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold",children:"Net Salary"}),e.jsx("span",{className:"text-xl font-bold text-primary",children:m(V)})]})]})]}),e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{className:"text-lg",children:"Employee Info"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(Xe,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",children:[u.employees_FirstName," ",u.employees_LastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Employee ID: ",u.EmployeeID]})]})]}),e.jsx(f,{variant:"outline",className:"w-full",onClick:()=>n(`/employees/${u.EmployeeID}`),children:"View Employee Profile"})]})]})]})]})]})},la=ze({ContractID:le(),EmployeeID:le().min(1,"Employee ID is required"),ContractAmount:le().min(0,"Amount must be positive"),ContractDate:ie(),ContractStartDate:ie(),ContractEndDate:ie(),ContractNote:oe().optional()}),ia=()=>{const{id:t}=mt(),[n,s]=j.useState(!1),[c,g]=j.useState(!0),[d,m]=j.useState([]),[u,w]=j.useState([]),A=Ee(),v=ht({resolver:pt(la),defaultValues:{ContractID:0,EmployeeID:0,ContractAmount:0,ContractDate:new Date,ContractStartDate:new Date,ContractEndDate:new Date,ContractNote:""}}),y=l=>{const a=typeof l=="string"?parseFloat(l):l;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a||0)},D=l=>l.contractpaytype_IsHour?l.ContractPAmountHour||0:l.ContractPAmount||0,V=j.useMemo(()=>u.filter(l=>l.contractpaytype_IsAdd===1),[u]),N=j.useMemo(()=>u.filter(l=>l.contractpaytype_IsAdd===0),[u]),p=j.useMemo(()=>{const l=u.find(i=>i.ContractPayTypeID==1),a=l?parseFloat(D(l)):0;return isNaN(a)?0:a},[u]),S=j.useMemo(()=>V.filter(l=>l.ContractPayTypeID!=1).reduce((l,a)=>l+(parseFloat(D(a))||0),0),[V]),K=j.useMemo(()=>N.reduce((l,a)=>l+(parseFloat(D(a))||0),0),[N]),E=j.useMemo(()=>p+S-K,[p,S,K]);j.useEffect(()=>{(async()=>{if(t)try{g(!0);const i=(await I.contract.get(parseInt(t))).data;i&&v.reset({ContractID:i.ContractID,EmployeeID:i.EmployeeID,ContractAmount:parseFloat(i.ContractAmount)||0,ContractDate:i.ContractDate?new Date(i.ContractDate):new Date,ContractStartDate:i.ContractStartDate?new Date(i.ContractStartDate):new Date,ContractEndDate:i.ContractEndDate?new Date(i.ContractEndDate):new Date,ContractNote:i.ContractNote||""});const h=await I.list("contractp",{exact_filters:{ContractID:parseInt(t)},sort:"ContractPID:asc",pageSize:200});Array.isArray(h.data)&&w(h.data);const C=await I.list("contractpaytype",{pageSize:100});Array.isArray(C.data)&&m(C.data)}catch(a){console.error("Error fetching data:",a),L.error("Failed to load contract data.")}finally{g(!1)}})()},[t,v]);const x=async l=>{try{s(!0);const a={EmployeeID:l.EmployeeID,ContractAmount:l.ContractAmount,ContractDate:B(l.ContractDate,"yyyy-MM-dd"),ContractStartDate:B(l.ContractStartDate,"yyyy-MM-dd"),ContractEndDate:B(l.ContractEndDate,"yyyy-MM-dd"),ContractNote:l.ContractNote};await I.contract.update(l.ContractID,a),L.success("Contract updated successfully"),A("/contracts")}catch(a){console.error("Error updating contract:",a),L.error("Failed to update contract.")}finally{s(!1)}};return c?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(f,{variant:"ghost",className:"w-fit p-0 hover:bg-transparent",onClick:()=>A(-1),children:[e.jsx(ut,{className:"h-4 w-4 mr-2"}),"Back to Contracts"]}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Edit Contract #",t]})]}),e.jsxs("form",{onSubmit:v.handleSubmit(x),className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{children:"Contract Information"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"ContractAmount",children:"Base Salary Amount"}),e.jsx(Q,{id:"ContractAmount",type:"number",step:"0.01",...v.register("ContractAmount",{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Contract Date"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:Se("w-full justify-start text-left font-normal",!v.watch("ContractDate")&&"text-muted-foreground"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),v.watch("ContractDate")?B(v.watch("ContractDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(xe,{className:"w-auto p-0",children:e.jsx(ue,{mode:"single",selected:v.watch("ContractDate"),onSelect:l=>v.setValue("ContractDate",l||new Date),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Start Date"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:Se("w-full justify-start text-left font-normal"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),v.watch("ContractStartDate")?B(v.watch("ContractStartDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(xe,{className:"w-auto p-0",children:e.jsx(ue,{mode:"single",selected:v.watch("ContractStartDate"),onSelect:l=>v.setValue("ContractStartDate",l||new Date),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"End Date"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:Se("w-full justify-start text-left font-normal"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),v.watch("ContractEndDate")?B(v.watch("ContractEndDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(xe,{className:"w-auto p-0",children:e.jsx(ue,{mode:"single",selected:v.watch("ContractEndDate"),onSelect:l=>v.setValue("ContractEndDate",l||new Date),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"ContractNote",children:"Notes"}),e.jsx(Ue,{id:"ContractNote",...v.register("ContractNote")})]})]})]}),e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{children:"Financial Summary"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Base Salary"}),e.jsx("span",{children:y(p)})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Total Additions"}),e.jsxs("span",{children:["+",y(S)]})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"Total Deductions"}),e.jsxs("span",{children:["-",y(K)]})]}),e.jsxs("div",{className:"pt-4 border-t flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Net Amount"}),e.jsx("span",{children:y(E)})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>A(-1),children:"Cancel"}),e.jsx(f,{type:"submit",disabled:n,children:n?"Saving...":"Update Contract"})]})]})]})},da=ze({ContractTemplate:oe().optional(),EmployeeID:oe().min(1,"Employee ID is required"),ContractAmount:le().min(0,"Amount must be positive"),ContractDate:ie(),ContractStartDate:ie(),ContractEndDate:ie(),ContractNote:oe().optional(),payments:Lt(ze({ContractPayTypeID:oe().min(1,"Payment type is required"),ContractPAmount:le().min(0,"Amount must be positive"),ContractPAmountHour:le().optional(),ContractNote:oe().optional()})).min(1,"At least one payment is required")}),wt=({open:t,onOpenChange:n,onSuccess:s})=>{const[c,g]=j.useState(!1),d=ht({resolver:pt(da),defaultValues:{ContractDate:new Date,ContractStartDate:new Date,ContractEndDate:new Date(new Date().setFullYear(new Date().getFullYear()+1)),payments:[{ContractPayTypeID:"",ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}]}}),{fields:m,append:u,remove:w,replace:A}=qt({control:d.control,name:"payments"}),{data:v=[],isLoading:y}=ge({queryKey:["employees","withoutContract"],queryFn:()=>I.list("employees",{hasContract:!1}).then(x=>x.data||[])}),D=j.useMemo(()=>{const x=new Set;return v.filter(l=>x.has(l.EmployeeID)?!1:(x.add(l.EmployeeID),!0))},[v]),{data:V=[]}=ge({queryKey:["contractpaytype"],queryFn:()=>W.getPaymentTypes()}),N=j.useMemo(()=>{const x=new Set;return V.filter(l=>x.has(l.ContractPayTypeID)?!1:(x.add(l.ContractPayTypeID),!0))},[V]),{data:p=[]}=ge({queryKey:["contractstemplate"],queryFn:()=>W.getTemplates()}),S=j.useMemo(()=>{const x=new Set;return p.filter(l=>x.has(l.ContractTemplateID)?!1:(x.add(l.ContractTemplateID),!0))},[p]),K=j.useCallback(async x=>{const l=S.find(a=>{var i;return((i=a.ContractTemplateID)==null?void 0:i.toString())===x});if(l){d.setValue("ContractAmount",parseFloat(l.ContractAmount)||0);const a=new Date;if(d.setValue("ContractStartDate",a),l.ContractDurationDays){const i=new Date(a);i.setDate(a.getDate()+l.ContractDurationDays),d.setValue("ContractEndDate",i)}try{const i=await I.list("contracttemplatepaytype",{exact_filters:{ContractTemplateID:x}});if(Array.isArray(i.data)&&i.data.length>0){const h=i.data.map(C=>({ContractPayTypeID:C.ContractPayTypeID.toString(),ContractPAmount:parseFloat(C.ContractPAmount)||0,ContractPAmountHour:parseFloat(C.ContractPAmountHour)||0,ContractNote:C.ContractNote||""}));A(h)}}catch(i){console.error("Error fetching template pay types:",i)}}},[S,d,A]),E=async x=>{try{g(!0);const l={EmployeeID:parseInt(x.EmployeeID),ContractAmount:x.ContractAmount,ContractDate:B(x.ContractDate,"yyyy-MM-dd"),ContractStartDate:B(x.ContractStartDate,"yyyy-MM-dd"),ContractEndDate:B(x.ContractEndDate,"yyyy-MM-dd"),ContractNote:x.ContractNote,ContractStatus:"New"},a=await I.contract.create(l),i=a.ContractID||a.id;if(!i)throw new Error("Failed to get ContractID from response");for(const h of x.payments)await I.create("contractp",{ContractID:i,ContractPayTypeID:parseInt(h.ContractPayTypeID),ContractPAmount:h.ContractPAmount,ContractPAmountHour:h.ContractPAmountHour||0,ContractNote:h.ContractNote||""});L.success("Contract created successfully"),s==null||s(),n(!1),d.reset()}catch(l){console.error("Failed to create contract:",l),L.error("Failed to create contract")}finally{g(!1)}};return e.jsx(yt,{open:t,onOpenChange:n,children:e.jsxs(jt,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ct,{children:[e.jsx(ft,{children:"Create New Contract"}),e.jsx(Nt,{children:"Create a new employment contract for an employee"})]}),e.jsxs("form",{onSubmit:d.handleSubmit(E),className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{className:"text-lg text-primary",children:"Contract Details"})}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"EmployeeID",children:"Employee"}),e.jsxs(he,{value:d.watch("EmployeeID"),onValueChange:x=>d.setValue("EmployeeID",x),children:[e.jsx(pe,{id:"EmployeeID",className:d.formState.errors.EmployeeID?"border-destructive":"",children:e.jsx(ye,{placeholder:y?"Loading employees...":"Select an employee"})}),e.jsx(je,{children:D.map(x=>e.jsxs(H,{value:x.EmployeeID.toString(),children:[x.FirstName," ",x.LastName," (",x.EmployeeCode,")"]},x.EmployeeID))})]}),d.formState.errors.EmployeeID&&e.jsx("p",{className:"text-sm text-destructive",children:d.formState.errors.EmployeeID.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"ContractTemplate",children:"Contract Template"}),e.jsxs(he,{value:d.watch("ContractTemplate"),onValueChange:x=>{d.setValue("ContractTemplate",x),K(x)},children:[e.jsx(pe,{id:"ContractTemplate",children:e.jsx(ye,{placeholder:"Select a template"})}),e.jsx(je,{children:S.map(x=>e.jsx(H,{value:x.ContractTemplateID.toString(),children:x.TemplateName},x.ContractTemplateID))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"ContractAmount",children:"Base Salary Amount"}),e.jsx(Q,{id:"ContractAmount",type:"number",step:"0.01",...d.register("ContractAmount",{valueAsNumber:!0}),className:d.formState.errors.ContractAmount?"border-destructive":""}),d.formState.errors.ContractAmount&&e.jsx("p",{className:"text-sm text-destructive",children:d.formState.errors.ContractAmount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Contract Date"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),d.watch("ContractDate")?B(d.watch("ContractDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(xe,{className:"w-auto p-0",children:e.jsx(ue,{mode:"single",selected:d.watch("ContractDate"),onSelect:x=>d.setValue("ContractDate",x||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Start Date"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),d.watch("ContractStartDate")?B(d.watch("ContractStartDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(xe,{className:"w-auto p-0",children:e.jsx(ue,{mode:"single",selected:d.watch("ContractStartDate"),onSelect:x=>d.setValue("ContractStartDate",x||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"End Date"}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),d.watch("ContractEndDate")?B(d.watch("ContractEndDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(xe,{className:"w-auto p-0",children:e.jsx(ue,{mode:"single",selected:d.watch("ContractEndDate"),onSelect:x=>d.setValue("ContractEndDate",x||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(b,{htmlFor:"ContractNote",children:"Notes"}),e.jsx(Ue,{id:"ContractNote",...d.register("ContractNote"),className:"min-h-[80px]",placeholder:"Any additional notes about this contract"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Payment Items"}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:()=>u({ContractPayTypeID:"",ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),m.map((x,l)=>e.jsx(M,{children:e.jsx(R,{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Payment Type"}),e.jsxs(he,{onValueChange:a=>d.setValue(`payments.${l}.ContractPayTypeID`,a),value:d.watch(`payments.${l}.ContractPayTypeID`),children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Type"})}),e.jsx(je,{className:"max-h-60",children:N.map(a=>e.jsxs(H,{value:a.ContractPayTypeID.toString(),children:[a.ContractPayTypeName," ",a.IsAdd===1?"(+)":"(-)"]},a.ContractPayTypeID))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Amount"}),e.jsx(Q,{type:"number",step:"0.01",...d.register(`payments.${l}.ContractPAmount`,{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Hourly Rate (Optional)"}),e.jsx(Q,{type:"number",step:"0.01",...d.register(`payments.${l}.ContractPAmountHour`,{valueAsNumber:!0})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(b,{children:"Note"}),e.jsx(Q,{...d.register(`payments.${l}.ContractNote`)})]}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"text-destructive mb-0.5",onClick:()=>w(l),disabled:m.length===1,children:e.jsx(ve,{className:"h-4 w-4"})})]})]})})},x.id))]}),e.jsxs(Kt,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:c,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:c,children:c?"Saving...":"Create Contract"})]})]})]})})},be=10,Ae=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),fe=(t,n="MMM dd, yyyy")=>{if(!t)return"N/A";try{return B(Le(t),n)}catch{return"Invalid date"}},Ne=t=>{const n=new Date,s=t.ContractEndDate?Le(t.ContractEndDate):null,c=t.ContractStartDate?Le(t.ContractStartDate):null;if(!s||!c)return{label:"Draft",variant:"outline"};if(Bt(n,c))return{label:"Upcoming",variant:"secondary"};if(Ut(n,s))return{label:"Expired",variant:"destructive"};const g=sa(s,n);return g<=30?{label:`Expires in ${g} days`,variant:"warning"}:{label:"Active",variant:"success"}},ma=()=>{var Oe,Qe;const{t,i18n:n}=Fe();n.dir();const s=Ee(),c=kt(),[g,d]=j.useState(""),[m,u]=j.useState("all"),[w,A]=j.useState("all"),[v,y]=j.useState({}),[D,V]=j.useState(1),[N,p]=j.useState("ContractStartDate"),[S,K]=j.useState("desc"),[E,x]=j.useState([]),[l,a]=j.useState({}),[i,h]=j.useState(!1),{data:C,isLoading:P,error:T,refetch:z}=ge({queryKey:["contract",{page:D,search:g,status:m,type:w,sortBy:N,sortOrder:S}],queryFn:()=>W.getContracts({page:D,pageSize:be,search:g,status:m!=="all"?[m]:void 0,type:w!=="all"?[w]:void 0,sortBy:N,sortOrder:S==="asc"?"asc":"desc"}),placeholderData:o=>o}),r=C,De=j.useMemo(()=>{if(!C)return{totalContracts:0,activeContracts:0,total:0,active:0,expiringSoon:0,expiring30:0,terminated:0,avgAmount:0};const o=Array.isArray(r)?r:(r==null?void 0:r.data)||[],k=Array.isArray(r)?r.length:(r==null?void 0:r.total)||0,$=new Date;new Date().setDate($.getDate()+30);let O=0,Ye=0,Je=0,We=0;return o.forEach(Ge=>{const $e=Ne(Ge);$e.label==="Active"&&O++,$e.variant==="destructive"&&Je++,$e.variant==="warning"&&Ye++;const At=parseFloat(Ge.ContractAmount)||0;We+=At}),{total:k,active:O,expiringSoon:Ye,terminated:Je,avgAmount:k>0?We/k:0}},[r]);nt({mutationFn:W.deleteContract,onSuccess:()=>{c.invalidateQueries({queryKey:["contracts"]}),c.invalidateQueries({queryKey:["contract-stats"]}),L.success(t("common.success"))},onError:o=>{L.error(`${t("common.error")}: ${o.message}`)}});const Me=nt({mutationFn:o=>W.exportContracts(o),onSuccess:(o,k)=>{const $=new Blob([o],{type:`application/${k}`}),_=window.URL.createObjectURL($),O=document.createElement("a");O.href=_,O.download=`contracts-${new Date().toISOString().split("T")[0]}.${k}`,document.body.appendChild(O),O.click(),window.URL.revokeObjectURL(_),document.body.removeChild(O),L.success(`Exported contracts as ${k.toUpperCase()}`)},onError:o=>{L.error(`Error exporting contracts: ${o.message}`)}}),we=o=>{N===o?K(S==="asc"?"desc":"asc"):(p(o),K("desc"))},Ke=()=>{var o;E.length===(Array.isArray(r)?r.length:((o=r==null?void 0:r.data)==null?void 0:o.length)||0)?x([]):x((Array.isArray(r)?r:(r==null?void 0:r.data)||[]).map(k=>k.ContractID)||[])},Tt=(o,k)=>{x(k?$=>[...$,o]:$=>$.filter(_=>_!==o))},bt=o=>{a(k=>({...k,[o]:!k[o]}))},ee=j.useMemo(()=>!r||Array.isArray(r)?1:Math.ceil((r.total||0)/(r.pageSize||be)),[r]);return P?e.jsxs("div",{className:"container mx-auto py-2 space-y-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((o,k)=>e.jsxs(M,{children:[e.jsxs(U,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"h-4 w-24"}),e.jsx(G,{className:"h-4 w-4"})]}),e.jsx(R,{children:e.jsx(G,{className:"h-8 w-16"})})]},k))}),e.jsx(M,{children:e.jsx(U,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[e.jsx(G,{className:"h-10 w-full md:w-1/3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{className:"h-10 w-32"}),e.jsx(G,{className:"h-10 w-24"})]})]})})}),e.jsx(M,{children:e.jsx(R,{className:"p-0",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(G,{className:"h-8 w-48"}),e.jsx(G,{className:"h-8 w-24"})]}),[...Array(5)].map((o,k)=>e.jsx(G,{className:"h-16 w-full"},k))]})})})]}):e.jsxs("div",{className:"h-full flex flex-col gap-3 overflow-hidden",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-2 lg:grid-cols-4 flex-shrink-0 pt-2",children:[e.jsx(Pe,{title:t("contracts.stats.total"),value:De.total.toString(),icon:e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(Pe,{title:t("contracts.stats.active"),value:De.active.toString(),icon:e.jsx(Ot,{className:"h-4 w-4 text-muted-foreground"}),variant:"success"}),e.jsx(Pe,{title:t("contracts.stats.expiringSoon"),value:De.expiringSoon.toString(),icon:e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"}),variant:"warning"}),e.jsx(Pe,{title:t("contracts.stats.totalValue"),value:Ae(De.avgAmount),icon:e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),variant:"accent"})]}),e.jsx(M,{className:"flex-shrink-0 pt-2",children:e.jsx(U,{className:"pb-3 py-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(b,{htmlFor:"search",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ft,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground rtl:left-auto rtl:right-3"}),e.jsx(Q,{id:"search",placeholder:t("contracts.filters.searchPlaceholder"),className:"ps-10",value:g,onChange:o=>d(o.target.value)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(he,{value:m,onValueChange:u,children:[e.jsxs(pe,{className:"w-[180px]",children:[e.jsx(Qt,{className:"me-2 h-4 w-4"}),e.jsx(ye,{placeholder:t("contracts.table.status")})]}),e.jsxs(je,{children:[e.jsx(H,{value:"all",children:t("contracts.filters.allStatuses")}),e.jsx(H,{value:"active",children:t("contracts.status.active")}),e.jsx(H,{value:"expired",children:t("contracts.status.expired")}),e.jsx(H,{value:"upcoming",children:t("contracts.status.upcoming")}),e.jsx(H,{value:"draft",children:t("contracts.status.draft")})]})]}),e.jsxs(f,{variant:"outline",onClick:()=>{d(""),u("all"),A("all"),y({})},children:[e.jsx(et,{className:"me-2 h-4 w-4"}),t("contracts.filters.reset")]})]})]})})}),e.jsxs(M,{className:"flex flex-col min-h-[300px] flex-1 pt-2",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"select-all",checked:E.length>0&&E.length===(Array.isArray(r)?r.length:((Oe=r==null?void 0:r.data)==null?void 0:Oe.length)||0),onCheckedChange:Ke,className:"h-4 w-4"}),e.jsx(b,{htmlFor:"select-all",className:"text-sm font-medium",children:E.length>0?`${E.length} ${t("contracts.table.selected")}`:t("contracts.table.selectAll")}),E.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",className:"h-8",onClick:()=>{L.info("Bulk action triggered")},children:[e.jsx(ct,{className:"me-2 h-4 w-4"}),t("contracts.table.exportSelected")]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"h-8 text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>{confirm(t("common.confirmDelete"))&&Promise.all(E.map(o=>W.deleteContract(o))).then(()=>{c.invalidateQueries({queryKey:["contracts"]}),c.invalidateQueries({queryKey:["contract-stats"]}),x([]),L.success(t("common.success"))}).catch(o=>{L.error(`${t("common.error")}: ${o.message}`)})},children:[e.jsx(ve,{className:"me-2 h-4 w-4"}),t("common.delete")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(f,{variant:"outline",size:"sm",className:"h-8",onClick:()=>z(),disabled:P,children:[e.jsx(et,{className:`me-2 h-4 w-4 ${P?"animate-spin":""}`}),t("common.refresh")]}),e.jsxs(tt,{children:[e.jsx(at,{asChild:!0,children:e.jsxs(f,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),"Export"]})}),e.jsxs(st,{align:"end",children:[e.jsxs(ne,{onClick:()=>Me.mutate("pdf"),children:[e.jsx(ta,{className:"me-2 h-4 w-4"}),t("common.exportPdf")]}),e.jsxs(ne,{onClick:()=>Me.mutate("excel"),children:[e.jsx(lt,{className:"me-2 h-4 w-4"}),t("common.exportExcel")]}),e.jsxs(ne,{onClick:()=>Me.mutate("csv"),children:[e.jsx(lt,{className:"me-2 h-4 w-4"}),t("common.exportCsv")]})]})]})]})]}),e.jsx(Mt,{className:"flex-1 min-h-[200px]",children:e.jsxs(He,{children:[e.jsx(Re,{className:"bg-muted/50",children:e.jsxs(Y,{children:[e.jsx(q,{className:"w-12",children:e.jsx(te,{id:"select-all-header",checked:E.length>0&&E.length===(Array.isArray(r)?r.length:((Qe=r==null?void 0:r.data)==null?void 0:Qe.length)||0),onCheckedChange:Ke,className:"h-4 w-4"})}),e.jsx(q,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>we("employees_LastName"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.employee"),N==="employees_LastName"&&e.jsx(Te,{className:`ms-1 h-4 w-4 ${S==="desc"?"rotate-180":""}`})]})}),e.jsx(q,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>we("ContractAmount"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.amount"),N==="ContractAmount"&&e.jsx(Te,{className:`ms-1 h-4 w-4 ${S==="desc"?"rotate-180":""}`})]})}),e.jsx(q,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>we("ContractStartDate"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.startDate"),N==="ContractStartDate"&&e.jsx(Te,{className:`ms-1 h-4 w-4 ${S==="desc"?"rotate-180":""}`})]})}),e.jsx(q,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>we("ContractEndDate"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.endDate"),N==="ContractEndDate"&&e.jsx(Te,{className:`ms-1 h-4 w-4 ${S==="desc"?"rotate-180":""}`})]})}),e.jsx(q,{children:t("contracts.table.status")}),e.jsx(q,{className:"text-end",children:t("contracts.table.actions")})]})}),e.jsx(Ve,{children:T?e.jsx(Y,{children:e.jsx(F,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-destructive",children:[e.jsx(_e,{className:"h-8 w-8"}),e.jsx("p",{children:t("contracts.errorLoading")}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>z(),children:t("common.retry")})]})})}):!r||Array.isArray(r)&&r.length===0||!Array.isArray(r)&&(!r.data||r.data.length===0)?e.jsx(Y,{children:e.jsx(F,{colSpan:8,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx(ke,{className:"h-12 w-12 opacity-20"}),e.jsx("p",{className:"text-lg font-medium",children:t("contracts.noContractsFound")}),e.jsx("p",{className:"text-sm",children:t("contracts.noContractsFoundDesc")}),e.jsxs(f,{variant:"outline",className:"mt-4",onClick:()=>h(!0),children:[e.jsx(Ce,{className:"me-2 h-4 w-4"}),t("contracts.add")]})]})})}):(Array.isArray(r)?r:(r==null?void 0:r.data)||[]).map(o=>{var k,$;return e.jsxs($t.Fragment,{children:[e.jsxs(Y,{className:`${l[o.ContractID]?"bg-muted/20":""} hover:bg-muted/10`,onClick:()=>bt(o.ContractID),children:[e.jsx(F,{onClick:_=>_.stopPropagation(),children:e.jsx(te,{checked:E.includes(o.ContractID),onCheckedChange:_=>Tt(o.ContractID,!!_),onClick:_=>_.stopPropagation(),className:"h-4 w-4"})}),e.jsxs(F,{children:[e.jsxs("div",{className:"font-medium",children:[o.employees_FirstName," ",o.employees_LastName]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",o.EmployeeID]})]}),e.jsx(F,{children:Ae(o.ContractAmount)}),e.jsx(F,{children:fe(o.ContractStartDate)}),e.jsx(F,{children:fe(o.ContractEndDate)}),e.jsx(F,{children:e.jsx(Z,{variant:Ne(o).variant,className:"capitalize",children:Ne(o).label})}),e.jsx(F,{className:"text-end",children:e.jsxs(tt,{children:[e.jsx(at,{asChild:!0,children:e.jsxs(f,{variant:"ghost",size:"icon",onClick:_=>_.stopPropagation(),children:[e.jsx(ea,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:t("contracts.table.actions")})]})}),e.jsxs(st,{align:"end",children:[e.jsxs(ne,{onClick:()=>s(`/contracts/${o.ContractID}`),children:[e.jsx(ot,{className:"me-2 h-4 w-4"}),t("common.view")]}),e.jsxs(ne,{onClick:()=>s(`/contracts/${o.ContractID}/edit`),children:[e.jsx(Yt,{className:"me-2 h-4 w-4"}),t("common.edit")]}),e.jsxs(ne,{className:"text-destructive",onClick:_=>{_.stopPropagation(),confirm(t("common.confirmDelete"))&&W.deleteContract(o.ContractID).then(()=>{c.invalidateQueries({queryKey:["contracts"]}),c.invalidateQueries({queryKey:["contract-stats"]}),L.success(t("common.success"))}).catch(O=>{L.error(`${t("common.error")}: ${O.message}`)})},children:[e.jsx(ve,{className:"me-2 h-4 w-4"}),t("common.delete")]})]})]})})]}),l[o.ContractID]&&e.jsx(Y,{className:"hover:bg-muted/30",children:e.jsx(F,{colSpan:8,className:"px-6 py-0 border-t-0",children:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.contractInfo")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.id"),":"]})," ",o.ContractID]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.type"),":"]})," ",o.ContractType||"N/A"]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.status"),":"]})," ",e.jsx(Z,{variant:Ne(o).variant,className:"capitalize",children:Ne(o).label})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.dates")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.created"),":"]})," ",fe(o.ContractDate)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.startDate"),":"]})," ",fe(o.ContractStartDate)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.endDate"),":"]})," ",fe(o.ContractEndDate)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.financials")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.amount"),":"]})," ",Ae(o.ContractAmount)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.payments"),":"]})," ",((k=o.payments)==null?void 0:k.length)||0]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.totalPaid"),":"]})," ",Ae((($=o.payments)==null?void 0:$.reduce((_,O)=>_+O.ContractPAmount,0))||0)]})]})]})]}),o.ContractNote&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.notes")}),e.jsx("p",{className:"text-sm",children:o.ContractNote})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(f,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px]",onClick:()=>s(`/contracts/${o.ContractID}`),"aria-label":t("contracts.viewDetails"),children:e.jsx(ot,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px]",onClick:()=>s(`/contracts/${o.ContractID}/edit`),"aria-label":t("contracts.edit"),children:e.jsx(gt,{className:"h-4 w-4"})}),e.jsx(f,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px] text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>{confirm(t("common.confirmDelete"))&&W.deleteContract(o.ContractID).then(()=>{c.invalidateQueries({queryKey:["contract"]}),c.invalidateQueries({queryKey:["contract-stats"]}),L.success(t("common.success"))}).catch(_=>{L.error(`${t("common.error")}: ${_.message}`)})},"aria-label":t("contracts.delete"),children:e.jsx(ve,{className:"h-4 w-4"})})]})]})})})]},o.ContractID)})})]})}),!Array.isArray(C)&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-medium",children:(((r==null?void 0:r.page)||1)-1)*((r==null?void 0:r.pageSize)||be)+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(((r==null?void 0:r.page)||1)*((r==null?void 0:r.pageSize)||be),(r==null?void 0:r.total)||0)})," ","of ",e.jsx("span",{className:"font-medium",children:(r==null?void 0:r.total)||0})," contracts"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>V(o=>Math.max(o-1,1)),disabled:D===1||P,children:[e.jsx(Jt,{className:"h-4 w-4 rtl:rotate-180"}),e.jsx("span",{className:"ms-1",children:t("common.previous")})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,ee)},(o,k)=>{let $;return ee<=5||D<=3?$=k+1:D>=ee-2?$=ee-4+k:$=D-2+k,e.jsx(f,{variant:$===D?"default":"outline",size:"sm",className:"w-10 h-10 p-0",onClick:()=>V($),disabled:P,children:$},$)})}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>V(o=>Math.min(o+1,ee)),disabled:D===ee||P||ee===0,children:[e.jsx("span",{className:"me-1",children:t("common.next")}),e.jsx(_t,{className:"h-4 w-4 rtl:rotate-180"})]})]})]})]}),e.jsx(wt,{open:i,onOpenChange:h,onSuccess:()=>z()})]})},Pe=({title:t,value:n,icon:s,variant:c="default"})=>{const g={default:"bg-background",success:"bg-green-50 dark:bg-green-900/20",warning:"bg-yellow-50 dark:bg-yellow-900/20",destructive:"bg-red-50 dark:bg-red-900/20",accent:"bg-blue-50 dark:bg-blue-900/20"},d={default:"text-foreground",success:"text-green-600 dark:text-green-400",warning:"text-yellow-600 dark:text-yellow-400",destructive:"text-red-600 dark:text-red-400",accent:"text-blue-600 dark:text-blue-400"};return e.jsx(M,{className:`${g[c]} transition-colors`,children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("h3",{className:`text-2xl font-bold ${d[c]}`,children:typeof n=="number"?n.toLocaleString():n})]}),e.jsx("div",{className:`rounded-full p-2 ${d[c]} bg-opacity-20 ${g[c]}`,children:s})]})})})};function xa(){const t=Ht(),n=Ee(),[s,c]=j.useState(!1),{t:g,i18n:d}=Fe(),m=d.dir()==="rtl",u=t.pathname.endsWith("/reports")?"reports":t.pathname.endsWith("/templates")?"templates":"overview";return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-130px)]",children:[e.jsxs("div",{className:"flex-shrink-0 space-y-2 pt-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:g("contracts.title")}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 pt-2",children:[e.jsx(qe,{value:u,onValueChange:w=>{w==="overview"?n("/contracts"):w==="reports"?n("/contracts/reports"):w==="templates"&&n("/contracts/templates")},dir:m?"rtl":"ltr",children:e.jsxs(Be,{children:[e.jsx(se,{value:"overview",children:g("contracts.tabs.overview")}),e.jsx(se,{value:"templates",children:g("contracts.tabs.templates")}),e.jsx(se,{value:"reports",children:g("contracts.tabs.reports")})]})}),u==="overview"&&e.jsxs(f,{onClick:()=>c(!0),children:[e.jsx(Ce,{className:"me-2 h-4 w-4"}),g("contracts.add")]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Rt,{})}),e.jsx(wt,{open:s,onOpenChange:c,onSuccess:()=>{window.location.reload()}})]})}const ua=()=>{const[t,n]=j.useState("contract_summary"),s={contract_summary:{type:"report_contract_summary",title:"Contract Summary Report",description:"List of all employee contracts with their status and details.",columns:[{key:"ContractID",label:"ID"},{key:"EmployeeName",label:"Employee"},{key:"ContractAmount",label:"Amount",format:c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c)},{key:"ContractStartDate",label:"Start Date",format:c=>c?new Date(c).toLocaleDateString():"-"},{key:"ContractEndDate",label:"End Date",format:c=>c?new Date(c).toLocaleDateString():"-"},{key:"ContractStatus",label:"Status",format:c=>e.jsx(Z,{variant:c==="Running"?"default":c==="Completed"?"secondary":c==="Terminated"?"destructive":"outline",children:c})}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]},contract_components:{type:"report_contract_components",title:"Contract Pay Components Report",description:"Breakdown of salary components and deductions per contract.",columns:[{key:"ContractID",label:"Contract ID"},{key:"EmployeeName",label:"Employee"},{key:"ContractPayTypeName",label:"Component"},{key:"ComponentType",label:"Type",format:c=>e.jsx(Z,{variant:c==="Addition"?"default":"secondary",children:c})},{key:"ContractPAmount",label:"Amount",format:c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c)},{key:"ContractPAmountHour",label:"Hourly Rate",format:c=>c>0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c):"-"}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]}};return e.jsxs("div",{className:"h-full flex flex-col space-y-4 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(qe,{value:t,onValueChange:n,children:e.jsxs(Be,{children:[e.jsx(se,{value:"contract_summary",children:"Contract Summary"}),e.jsx(se,{value:"contract_components",children:"Pay Components"})]})})}),e.jsx(M,{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(R,{className:"h-full p-0",children:e.jsx(Wt,{type:s[t].type,title:s[t].title,description:s[t].description,columns:s[t].columns,filters:s[t].filters})})})]})};function ha({open:t,onOpenChange:n,template:s,onSave:c,onCancel:g,onRefresh:d}){const{t:m}=Fe(),[u,w]=j.useState(!1),[A,v]=j.useState([]),[y,D]=j.useState(s||{TemplateName:"",TemplateCode:"",TemplateDescription:"",ContractAmount:0,ContractDurationDays:30,ContractDurationMonths:12,TemplateType:"employment",ContractCategory:"Full-time",IsPublic:!1,IsActive:!0,IsDefault:!1,PayTypes:[]});j.useEffect(()=>{if(t)if(s!=null&&s.ContractTemplateID){const a={TemplateName:s.TemplateName||"",TemplateCode:s.TemplateCode||"",TemplateDescription:s.TemplateDescription||"",ContractAmount:s.ContractAmount||0,ContractDurationDays:s.ContractDurationDays||30,ContractDurationMonths:s.ContractDurationMonths||Math.round((s.ContractDurationDays||30)/30),TemplateType:s.TemplateType||"employment",ContractCategory:s.ContractCategory||"Full-time",IsPublic:s.IsPublic||!1,IsActive:s.IsActive!==void 0?s.IsActive:!0,IsDefault:s.IsDefault||!1,PayTypes:s.PayTypes||[],...s};D(a),A.length>0&&V(s.ContractTemplateID)}else D({TemplateName:"",TemplateCode:"",TemplateDescription:"",ContractAmount:0,ContractDurationDays:30,ContractDurationMonths:12,TemplateType:"employment",ContractCategory:"Full-time",IsPublic:!1,IsActive:!0,IsDefault:!1,PayTypes:[]})},[s,t]),j.useEffect(()=>{t&&(s!=null&&s.ContractTemplateID)&&A.length>0&&!y.PayTypes.length&&V(s.ContractTemplateID)},[s,t,A,y.PayTypes.length]);const V=async a=>{try{const i=X.contracttemplatepaytype.list,h=await i({exact_filters:{ContractTemplateID:a}});let C=[];if(Array.isArray(h))C=h;else if(h&&h.data){const P=h.data;Array.isArray(P)?C=P:P.data&&Array.isArray(P.data)&&(C=P.data)}console.log("Template Pay Types found:",C),console.log("Available Pay Types:",A),D(P=>({...P,PayTypes:C.map(T=>{const z=A.find(r=>r.ContractPayTypeID===T.ContractPayTypeID);return{ContractPayTypeID:T.ContractPayTypeID,ContractPayTypeName:(z==null?void 0:z.ContractPayTypeName)||`Pay Type ${T.ContractPayTypeID}`,Description:(z==null?void 0:z.Description)||"",IsAdd:(z==null?void 0:z.IsAdd)||0,ContractPAmount:T.ContractPAmount||0,ContractPAmountHour:T.ContractPAmountHour||0,ContractNote:T.ContractNote||""}})}))}catch(i){console.error("Error fetching template pay types:",i),D(h=>({...h,PayTypes:[]}))}};j.useEffect(()=>{N()},[]);const N=async()=>{try{const a=X.contractpaytype.list,i=await a();let h=[];if(Array.isArray(i))h=i;else if(i&&i.data){const C=i.data;Array.isArray(C)?h=C:C.data&&Array.isArray(C.data)&&(h=C.data)}v(h)}catch(a){console.error("Error fetching pay types:",a),v([])}},p=(a,i)=>{D(h=>{const C=h.PayTypes||[];return i?{...h,PayTypes:[...C,{ContractPayTypeID:a.ContractPayTypeID,ContractPayTypeName:a.ContractPayTypeName,Description:a.Description||"",IsAdd:a.IsAdd,ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}]}:{...h,PayTypes:C.filter(P=>P.ContractPayTypeID!==a.ContractPayTypeID)}})},S=(a,i,h)=>{let C=h;i!=="ContractNote"&&(C=typeof h=="string"?parseFloat(h)||0:h),D(P=>({...P,PayTypes:P.PayTypes.map(T=>T.ContractPayTypeID===a?{...T,[i]:C}:T)}))},K=()=>!y.PayTypes||!Array.isArray(y.PayTypes)?0:y.PayTypes.reduce((a,i)=>i.IsAdd===1?a+i.ContractPAmount:a,0),E=async a=>{var i,h;a.preventDefault(),w(!0);try{const C=K(),P={...y,ContractAmount:C};let T;if(s!=null&&s.ContractTemplateID)await X.contractstemplate.update(s.ContractTemplateID,P),T=s.ContractTemplateID,await x(T);else{const z=await X.contractstemplate.create(P);console.log("Template creation response:",z);const r=z;T=(r==null?void 0:r.ContractTemplateID)||((i=r==null?void 0:r.data)==null?void 0:i.ContractTemplateID)||(r==null?void 0:r.id)||((h=r==null?void 0:r.data)==null?void 0:h.id),console.log("Extracted template ID:",T)}y.PayTypes&&y.PayTypes.length>0&&(console.log("Calling saveTemplatePayTypes with ID:",T),await l(T,y.PayTypes)),c(P),d&&d(),n(!1)}catch(C){console.error("Error saving template:",C)}finally{w(!1)}},x=async a=>{try{const i=X.contracttemplatepaytype.delete;await i(a)}catch(i){console.error("Error deleting existing pay types:",i)}},l=async(a,i)=>{try{console.log("Saving pay types for template ID:",a),console.log("Pay types to save:",i);const h=X.contracttemplatepaytype.create;for(const C of i){const P={ContractTemplateID:a,ContractPayTypeID:C.ContractPayTypeID,ContractPAmount:C.ContractPAmount||0,ContractPAmountHour:C.ContractPAmountHour||0,ContractNote:C.ContractNote||"",SortOrder:0};console.log("Pay type data being sent:",P),await h(P)}}catch(h){throw console.error("Error saving template pay types:",h),h}};return e.jsx(yt,{open:t,onOpenChange:n,children:e.jsxs(jt,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ct,{children:[e.jsx(ft,{children:m(s?"contracts.template.edit":"contracts.template.create")}),e.jsx(Nt,{children:m("contracts.template.description")})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{children:m("contracts.template.info")})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"TemplateName",children:m("contracts.template.name")}),e.jsx(Q,{id:"TemplateName",value:y.TemplateName||"",onChange:a=>D({...y,TemplateName:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"TemplateCode",children:m("contracts.template.code")}),e.jsx(Q,{id:"TemplateCode",value:y.TemplateCode||"",onChange:a=>D({...y,TemplateCode:a.target.value.toUpperCase()}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"TemplateDescription",children:m("contracts.template.description")}),e.jsx(Ue,{id:"TemplateDescription",value:y.TemplateDescription||"",onChange:a=>D({...y,TemplateDescription:a.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"TemplateType",children:m("contracts.template.type")}),e.jsxs(he,{value:y.TemplateType,onValueChange:a=>D({...y,TemplateType:a}),children:[e.jsx(pe,{children:e.jsx(ye,{})}),e.jsxs(je,{children:[e.jsx(H,{value:"employment",children:"Employment"}),e.jsx(H,{value:"freelance",children:"Freelance"}),e.jsx(H,{value:"internship",children:"Internship"}),e.jsx(H,{value:"consultancy",children:"Consultancy"}),e.jsx(H,{value:"service",children:"Service"}),e.jsx(H,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"ContractCategory",children:m("contracts.template.category")}),e.jsx(Q,{id:"ContractCategory",value:y.ContractCategory||"",onChange:a=>D({...y,ContractCategory:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"ContractDuration",children:[m("contracts.template.duration")," (months)"]}),e.jsx("div",{className:"flex gap-1",children:e.jsxs(he,{value:(y.ContractDurationMonths||12).toString(),onValueChange:a=>{const i=parseInt(a);D({...y,ContractDurationMonths:i,ContractDurationDays:i*30})},children:[e.jsx(pe,{className:"w-65",children:e.jsx(ye,{placeholder:"Select"})}),e.jsxs(je,{children:[e.jsx(H,{value:"3",children:"3 months"}),e.jsx(H,{value:"6",children:"6 months"}),e.jsx(H,{value:"12",children:"12 months"}),e.jsx(H,{value:"24",children:"24 months"})]})]})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Duration: ",y.ContractDurationMonths||12," months (",y.ContractDurationDays||360," days)"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"IsPublic",checked:y.IsPublic,onCheckedChange:a=>D({...y,IsPublic:!!a})}),e.jsx(b,{htmlFor:"IsPublic",children:m("contracts.template.public")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"IsActive",checked:y.IsActive,onCheckedChange:a=>D({...y,IsActive:!!a})}),e.jsx(b,{htmlFor:"IsActive",children:m("contracts.template.active")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"IsDefault",checked:y.IsDefault,onCheckedChange:a=>D({...y,IsDefault:!!a})}),e.jsx(b,{htmlFor:"IsDefault",children:m("contracts.template.default")})]})]})]})]}),e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(J,{children:m("contracts.template.payTypes")})}),e.jsxs(R,{children:[e.jsx("div",{className:"space-y-4",children:A.map(a=>{var C,P;const i=(C=y.PayTypes)==null?void 0:C.some(T=>T.ContractPayTypeID===a.ContractPayTypeID),h=(P=y.PayTypes)==null?void 0:P.find(T=>T.ContractPayTypeID===a.ContractPayTypeID);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(te,{id:`paytype-${a.ContractPayTypeID}`,checked:i,onCheckedChange:T=>p(a,!!T)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{htmlFor:`paytype-${a.ContractPayTypeID}`,className:"font-medium",children:a.ContractPayTypeName}),e.jsx(Z,{variant:a.IsAdd===1?"default":"destructive",children:a.IsAdd===1?"+":"-"})]}),a.Description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.Description})]})]})}),i&&h&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 pl-7",children:[a.IsHour===1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:`hourly-${a.ContractPayTypeID}`,children:m("contracts.template.hourlyRate")}),e.jsx(Q,{id:`hourly-${a.ContractPayTypeID}`,type:"text",value:h.ContractPAmountHour,onChange:T=>S(a.ContractPayTypeID,"ContractPAmountHour",T.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:`amount-${a.ContractPayTypeID}`,children:m("contracts.template.amount")}),e.jsx(Q,{id:`amount-${a.ContractPayTypeID}`,type:"text",value:h.ContractPAmount,onChange:T=>S(a.ContractPayTypeID,"ContractPAmount",T.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:`note-${a.ContractPayTypeID}`,children:m("contracts.template.note")}),e.jsx(Q,{id:`note-${a.ContractPayTypeID}`,value:h.ContractNote,onChange:T=>S(a.ContractPayTypeID,"ContractNote",T.target.value)})]})]})]},a.ContractPayTypeID)})}),e.jsx("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:m("contracts.template.totalAmount")}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",K().toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsxs(f,{type:"button",variant:"outline",onClick:()=>n(!1),children:[e.jsx(Vt,{className:"mr-2 h-4 w-4"}),m("common.cancel")]}),e.jsxs(f,{type:"submit",disabled:u,children:[e.jsx(aa,{className:"mr-2 h-4 w-4"}),m(u?"common.saving":"common.save")]})]})]})]})})}function pa(){const{t}=Fe(),[n,s]=j.useState([]),[c,g]=j.useState(!0),[d,m]=j.useState(!1),[u,w]=j.useState();j.useEffect(()=>{A()},[]);const A=async()=>{try{const p=await X.contractstemplate.list();let S=[];if(Array.isArray(p))S=p;else if(p&&typeof p=="object"){const E=p;Array.isArray(E.data)?S=E.data:E.data&&Array.isArray(E.data.data)&&(S=E.data.data)}const K=S.filter((E,x,l)=>x===l.findIndex(a=>a.ContractTemplateID===E.ContractTemplateID));s(K)}catch(p){console.error("Error fetching templates:",p),s([])}finally{g(!1)}},v=()=>{w(void 0),m(!0)},y=p=>{w(p),m(!0)},D=async p=>{await A(),m(!1),w(void 0)},V=async p=>{if(confirm(t("contracts.template.deleteConfirm")))try{await X.contractstemplate.delete(p),await A()}catch(S){console.error("Error deleting template:",S)}},N=async p=>{const S={...p,TemplateName:`${p.TemplateName} (Copy)`,TemplateCode:`${p.TemplateCode}_COPY`,ContractTemplateID:void 0};w(S),m(!0)};return c?e.jsx("div",{className:"flex justify-center p-8",children:t("common.loading")}):e.jsxs("div",{className:"h-full flex flex-col space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t("contracts.templates.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("contracts.templates.description")})]}),e.jsxs(f,{onClick:v,children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),t("contracts.templates.create")]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(p=>e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(U,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(J,{className:"text-lg",children:p.TemplateName}),e.jsx(xt,{className:"text-xs mt-1",children:p.TemplateCode})]}),e.jsxs("div",{className:"flex gap-1",children:[p.IsDefault&&e.jsx(Z,{variant:"default",className:"text-xs",children:t("contracts.template.default")}),p.IsPublic&&e.jsx(Z,{variant:"secondary",className:"text-xs",children:t("contracts.template.public")}),!p.IsActive&&e.jsx(Z,{variant:"destructive",className:"text-xs",children:t("contracts.template.inactive")})]})]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-2",children:[p.TemplateDescription&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:p.TemplateDescription}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.amount")}),e.jsxs("span",{className:"font-semibold",children:["$",p.ContractAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.duration")}),e.jsxs("span",{className:"font-semibold",children:[p.ContractDurationDays," ",t("common.days")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.usage")}),e.jsx("span",{className:"font-semibold",children:p.UsageCount})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(f,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>y(p),children:[e.jsx(gt,{className:"h-3 w-3 mr-1"}),t("common.edit")]}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>N(p),children:e.jsx(Xt,{className:"h-3 w-3"})}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>V(p.ContractTemplateID),children:e.jsx(ve,{className:"h-3 w-3"})})]})]})})]},p.ContractTemplateID))}),n.length===0&&e.jsx(M,{children:e.jsxs(R,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t("contracts.templates.empty")}),e.jsxs(f,{onClick:v,children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),t("contracts.templates.create")]})]})})]}),e.jsx(ha,{open:d,onOpenChange:m,template:u,onSave:D,onCancel:()=>{m(!1),w(void 0)}})]})}function Qa(){return e.jsxs(zt,{children:[e.jsxs(ce,{element:e.jsx(xa,{}),children:[e.jsx(ce,{index:!0,element:e.jsx(ma,{})}),e.jsx(ce,{path:"templates",element:e.jsx(pa,{})}),e.jsx(ce,{path:"reports",element:e.jsx(ua,{})})]}),e.jsx(ce,{path:":id",element:e.jsx(oa,{})}),e.jsx(ce,{path:":id/edit",element:e.jsx(ia,{})})]})}export{oa as ContractDetails,pa as ContractTemplates,xa as ContractsLayout,Qa as ContractsModule,ua as ContractsReports,ia as EditContract,ma as EmployeeContracts};
