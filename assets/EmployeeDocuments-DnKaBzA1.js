import{o as F,a4 as E,b as I,r as l,$ as _,j as e,B as h,S as k,C as M,F as $}from"./index-DOKDlu5z.js";import{I as z}from"./input-8l6hFLlx.js";import{L as y}from"./label-CyjSVjeg.js";import{S as B,a as H,b as P,c as q,d as n}from"./select-BruEyd3_.js";import{T as R,a as V,b as f,c as i,d as J,e as m}from"./table-3BpGTakO.js";import{D as O,a as W,b as G,c as K}from"./dialog-CExpfMQj.js";import{a as Q}from"./api-cTyB4nM2.js";import{A as U}from"./arrow-left-BPTb2Zva.js";import{D as X}from"./download-l837z28C.js";import"./index-D13m8HN9.js";const v={1:"passport",2:"cpr/iqama",3:"photo",4:"medical_certificate",5:"employment_contract",6:"leave_contract",7:"visa",8:"insurance",9:"other"},me=()=>{var x;const{t:s}=F(),{employeeId:c}=E(),N=I(),[g,w]=l.useState([]),[T,p]=l.useState(!1),[o,b]=l.useState(""),[d,D]=l.useState("all"),[r,u]=l.useState(null);l.useEffect(()=>{c&&C(c)},[c]);const C=async t=>{try{p(!0);const a=await Q.list("arch",{exact_filters:{ArchEmp:parseInt(t,10)},select_fields:["id","ArchEmp","ArchType","ArchNote","ArchFile","CreatedDate"].join(","),sort:"CreatedDate",order:"desc"});w(a.data||[])}catch(a){console.error("Error:",a),_.error("Failed to load documents")}finally{p(!1)}},A=g.filter(t=>{var j;const a=v[t.ArchType]||"other",L=s(`employees.documents.types.${a}`);return(o===""||((j=t.ArchNote)==null?void 0:j.toLowerCase().includes(o.toLowerCase()))||L.toLowerCase().includes(o.toLowerCase()))&&(d==="all"||a===d)}),S=t=>{if(!t.ArchFile)return;const a=document.createElement("a");a.href=t.ArchFile,a.download=`document-${t.id}.${t.ArchFile.split(";")[0].split("/")[1]}`,document.body.appendChild(a),a.click(),document.body.removeChild(a)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>N(-1),className:"me-2",children:e.jsx(U,{className:"h-5 w-5 rtl:rotate-180"})}),e.jsx("h1",{className:"text-2xl font-bold",children:s("employees.documents.title",{id:c})})]}),e.jsx("div",{className:"grid gap-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{children:s("employees.documents.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute start-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:s("employees.documents.searchPlaceholder"),className:"ps-8",value:o,onChange:t=>b(t.target.value)})]})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx(y,{children:s("employees.documents.filterType")}),e.jsxs(B,{value:d,onValueChange:D,children:[e.jsx(H,{children:e.jsx(P,{placeholder:s("employees.documents.selectType")})}),e.jsxs(q,{children:[e.jsx(n,{value:"all",children:s("employees.documents.allTypes")}),e.jsx(n,{value:"contract",children:s("employees.documents.types.employment_contract")}),e.jsx(n,{value:"id",children:s("employees.documents.types.cpr/iqama")}),e.jsx(n,{value:"other",children:s("employees.documents.types.other")})]})]})]})]})}),T?e.jsx("div",{children:s("common.loading")}):e.jsx(M,{children:e.jsxs(R,{children:[e.jsx(V,{children:e.jsxs(f,{children:[e.jsx(i,{children:s("employees.documents.table.type")}),e.jsx(i,{children:s("employees.documents.table.note")}),e.jsx(i,{children:s("employees.documents.table.date")}),e.jsx(i,{className:"text-end",children:s("common.actions")})]})}),e.jsx(J,{children:A.map(t=>e.jsxs(f,{children:[e.jsx(m,{children:s(`employees.documents.types.${v[t.ArchType]||"other"}`)}),e.jsx(m,{children:t.ArchNote||"N/A"}),e.jsx(m,{children:new Date(t.CreatedDate).toLocaleDateString()}),e.jsxs(m,{className:"text-end",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>u(t),children:s("common.view")}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>S(t),className:"ms-2",children:[e.jsx(X,{className:"h-4 w-4 me-1"}),s("employees.documents.download")]})]})]},t.id))})]})}),e.jsx(O,{open:!!r,onOpenChange:t=>!t&&u(null),children:e.jsx(W,{className:"max-w-4xl",children:r&&e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsx(K,{children:s("employees.documents.preview")})}),e.jsx("div",{className:"mt-4",children:(x=r.ArchFile)!=null&&x.startsWith("data:image/")?e.jsx("img",{src:r.ArchFile,alt:"Document preview",className:"max-w-full h-auto mx-auto"}):e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx($,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"ms-2",children:s("employees.documents.noPreview")})]})})]})})})]})};export{me as default};
