import{aX as It,aR as Ct,r as x,ax as kt,j as e,ay as ne,aS as pe,aA as At,aq as De,aU as Rt,aY as Xe,Q as Tt,o as re,b as Ge,B as z,C as A,e as M,f as $,g as R,n as Q,u as Je,F as Be,h as ue,d as J,i as Fe,D as Ie,T as Ue,a5 as Ft,t as Mt,c as ze,at as Ce,av as Et,aw as Ve}from"./index-BvW6vA_w.js";import{I as ee}from"./input-B90b-HjG.js";import{L as U}from"./label-SlGcAB4q.js";import{S as We,a as Ze,b as et,c as tt,d as je}from"./select-CgTQIsYR.js";import{u as _t}from"./index-LHsGcG95.js";import{T as Ne,a as we,b as G,c as P,d as Se,e as D}from"./table-RcngSmQx.js";import{C as st}from"./date-picker-BYk77_ec.js";import{A as $t}from"./arrow-left-QCNW_w7_.js";import{u as Ot}from"./useMutation-EM1F2Qwl.js";import{T as xe,a as he,b as _,c as ge}from"./tabs-CNqDDOx9.js";import{S as Z}from"./skeleton-Bdw8EXgx.js";import{D as ie,a as ce,b as de,c as me,d as be}from"./dialog-Dz39hnJR.js";import{P as qt}from"./progress-BsSVyHMm.js";import{a as B}from"./api-YnBVhvg1.js";import{o as Bt,n as se,s as ae,u as Ut,t as zt}from"./types-BaGLVKrj.js";import{E as Vt}from"./EmployeeDropdown-DgM-kTJZ.js";import{L as Ke}from"./loader-circle-BhqU31H3.js";import{P as Kt}from"./plus-c3UHNGiE.js";import{p as ke}from"./parseISO-Bp-q_kgq.js";import{C as le}from"./circle-check-big-Dz5mM00v.js";import{T as Ht}from"./trending-up-BpAHveYY.js";import{R as at}from"./ReportViewer-_4XuxDPc.js";import{C as He}from"./circle-x-BvA2xP7m.js";import{P as Yt}from"./pencil-Dlj72cit.js";import"./popover-C9ru1Mgl.js";import"./getDaysInMonth-2as7pjyD.js";import"./chevron-left-Cr-a-3Sv.js";import"./alert-Bp7wk0IP.js";import"./download-DqWMZ82E.js";var nt=["PageUp","PageDown"],rt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ot={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},oe="Slider",[Ae,Qt,Xt]=It(oe),[lt,Ys]=Ct(oe,[Xt]),[Gt,Le]=lt(oe),it=x.forwardRef((t,c)=>{const{name:r,min:s=0,max:n=100,step:u=1,orientation:a="horizontal",disabled:p=!1,minStepsBetweenThumbs:f=0,defaultValue:g=[s],value:I,onValueChange:j=()=>{},onValueCommit:d=()=>{},inverted:b=!1,form:L,...w}=t,o=x.useRef(new Set),l=x.useRef(0),S=a==="horizontal"?Jt:Wt,[v=[],y]=kt({prop:I,defaultProp:g,onChange:N=>{var H;(H=[...o.current][l.current])==null||H.focus(),j(N)}}),K=x.useRef(v);function T(N){const C=as(v,N);F(N,C)}function te(N){F(N,l.current)}function O(){const N=K.current[l.current];v[l.current]!==N&&d(v)}function F(N,C,{commit:H}={commit:!1}){const Y=ls(u),W=is(Math.round((N-s)/u)*u+s,Y),q=Xe(W,[s,n]);y((X=[])=>{const k=ts(X,q,C);if(os(k,f*u)){l.current=k.indexOf(q);const fe=String(k)!==String(X);return fe&&H&&d(k),fe?k:X}else return X})}return e.jsx(Gt,{scope:t.__scopeSlider,name:r,disabled:p,min:s,max:n,valueIndexToChangeRef:l,thumbs:o.current,values:v,orientation:a,form:L,children:e.jsx(Ae.Provider,{scope:t.__scopeSlider,children:e.jsx(Ae.Slot,{scope:t.__scopeSlider,children:e.jsx(S,{"aria-disabled":p,"data-disabled":p?"":void 0,...w,ref:c,onPointerDown:ne(w.onPointerDown,()=>{p||(K.current=v)}),min:s,max:n,inverted:b,onSlideStart:p?void 0:T,onSlideMove:p?void 0:te,onSlideEnd:p?void 0:O,onHomeKeyDown:()=>!p&&F(s,0,{commit:!0}),onEndKeyDown:()=>!p&&F(n,v.length-1,{commit:!0}),onStepKeyDown:({event:N,direction:C})=>{if(!p){const W=nt.includes(N.key)||N.shiftKey&&rt.includes(N.key)?10:1,q=l.current,X=v[q],k=u*W*C;F(X+k,q,{commit:!0})}}})})})})});it.displayName=oe;var[ct,dt]=lt(oe,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Jt=x.forwardRef((t,c)=>{const{min:r,max:s,dir:n,inverted:u,onSlideStart:a,onSlideMove:p,onSlideEnd:f,onStepKeyDown:g,...I}=t,[j,d]=x.useState(null),b=pe(c,S=>d(S)),L=x.useRef(),w=At(n),o=w==="ltr",l=o&&!u||!o&&u;function m(S){const v=L.current||j.getBoundingClientRect(),y=[0,v.width],T=Me(y,l?[r,s]:[s,r]);return L.current=v,T(S-v.left)}return e.jsx(ct,{scope:t.__scopeSlider,startEdge:l?"left":"right",endEdge:l?"right":"left",direction:l?1:-1,size:"width",children:e.jsx(mt,{dir:w,"data-orientation":"horizontal",...I,ref:b,style:{...I.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:S=>{const v=m(S.clientX);a==null||a(v)},onSlideMove:S=>{const v=m(S.clientX);p==null||p(v)},onSlideEnd:()=>{L.current=void 0,f==null||f()},onStepKeyDown:S=>{const y=ot[l?"from-left":"from-right"].includes(S.key);g==null||g({event:S,direction:y?-1:1})}})})}),Wt=x.forwardRef((t,c)=>{const{min:r,max:s,inverted:n,onSlideStart:u,onSlideMove:a,onSlideEnd:p,onStepKeyDown:f,...g}=t,I=x.useRef(null),j=pe(c,I),d=x.useRef(),b=!n;function L(w){const o=d.current||I.current.getBoundingClientRect(),l=[0,o.height],S=Me(l,b?[s,r]:[r,s]);return d.current=o,S(w-o.top)}return e.jsx(ct,{scope:t.__scopeSlider,startEdge:b?"bottom":"top",endEdge:b?"top":"bottom",size:"height",direction:b?1:-1,children:e.jsx(mt,{"data-orientation":"vertical",...g,ref:j,style:{...g.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:w=>{const o=L(w.clientY);u==null||u(o)},onSlideMove:w=>{const o=L(w.clientY);a==null||a(o)},onSlideEnd:()=>{d.current=void 0,p==null||p()},onStepKeyDown:w=>{const l=ot[b?"from-bottom":"from-top"].includes(w.key);f==null||f({event:w,direction:l?-1:1})}})})}),mt=x.forwardRef((t,c)=>{const{__scopeSlider:r,onSlideStart:s,onSlideMove:n,onSlideEnd:u,onHomeKeyDown:a,onEndKeyDown:p,onStepKeyDown:f,...g}=t,I=Le(oe,r);return e.jsx(De.span,{...g,ref:c,onKeyDown:ne(t.onKeyDown,j=>{j.key==="Home"?(a(j),j.preventDefault()):j.key==="End"?(p(j),j.preventDefault()):nt.concat(rt).includes(j.key)&&(f(j),j.preventDefault())}),onPointerDown:ne(t.onPointerDown,j=>{const d=j.target;d.setPointerCapture(j.pointerId),j.preventDefault(),I.thumbs.has(d)?d.focus():s(j)}),onPointerMove:ne(t.onPointerMove,j=>{j.target.hasPointerCapture(j.pointerId)&&n(j)}),onPointerUp:ne(t.onPointerUp,j=>{const d=j.target;d.hasPointerCapture(j.pointerId)&&(d.releasePointerCapture(j.pointerId),u(j))})})}),ut="SliderTrack",xt=x.forwardRef((t,c)=>{const{__scopeSlider:r,...s}=t,n=Le(ut,r);return e.jsx(De.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...s,ref:c})});xt.displayName=ut;var Re="SliderRange",ht=x.forwardRef((t,c)=>{const{__scopeSlider:r,...s}=t,n=Le(Re,r),u=dt(Re,r),a=x.useRef(null),p=pe(c,a),f=n.values.length,g=n.values.map(d=>ft(d,n.min,n.max)),I=f>1?Math.min(...g):0,j=100-Math.max(...g);return e.jsx(De.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...s,ref:p,style:{...t.style,[u.startEdge]:I+"%",[u.endEdge]:j+"%"}})});ht.displayName=Re;var Te="SliderThumb",pt=x.forwardRef((t,c)=>{const r=Qt(t.__scopeSlider),[s,n]=x.useState(null),u=pe(c,p=>n(p)),a=x.useMemo(()=>s?r().findIndex(p=>p.ref.current===s):-1,[r,s]);return e.jsx(Zt,{...t,ref:u,index:a})}),Zt=x.forwardRef((t,c)=>{const{__scopeSlider:r,index:s,name:n,...u}=t,a=Le(Te,r),p=dt(Te,r),[f,g]=x.useState(null),I=pe(c,m=>g(m)),j=f?a.form||!!f.closest("form"):!0,d=Rt(f),b=a.values[s],L=b===void 0?0:ft(b,a.min,a.max),w=ss(s,a.values.length),o=d==null?void 0:d[p.size],l=o?ns(o,L,p.direction):0;return x.useEffect(()=>{if(f)return a.thumbs.add(f),()=>{a.thumbs.delete(f)}},[f,a.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[p.startEdge]:`calc(${L}% + ${l}px)`},children:[e.jsx(Ae.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(De.span,{role:"slider","aria-label":t["aria-label"]||w,"aria-valuemin":a.min,"aria-valuenow":b,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...u,ref:I,style:b===void 0?{display:"none"}:t.style,onFocus:ne(t.onFocus,()=>{a.valueIndexToChangeRef.current=s})})}),j&&e.jsx(es,{name:n??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:b},s)]})});pt.displayName=Te;var es=t=>{const{value:c,...r}=t,s=x.useRef(null),n=_t(c);return x.useEffect(()=>{const u=s.current,a=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(a,"value").set;if(n!==c&&f){const g=new Event("input",{bubbles:!0});f.call(u,c),u.dispatchEvent(g)}},[n,c]),e.jsx("input",{style:{display:"none"},...r,ref:s,defaultValue:c})};function ts(t=[],c,r){const s=[...t];return s[r]=c,s.sort((n,u)=>n-u)}function ft(t,c,r){const u=100/(r-c)*(t-c);return Xe(u,[0,100])}function ss(t,c){return c>2?`Value ${t+1} of ${c}`:c===2?["Minimum","Maximum"][t]:void 0}function as(t,c){if(t.length===1)return 0;const r=t.map(n=>Math.abs(n-c)),s=Math.min(...r);return r.indexOf(s)}function ns(t,c,r){const s=t/2,u=Me([0,50],[0,s]);return(s-u(c)*r)*r}function rs(t){return t.slice(0,-1).map((c,r)=>t[r+1]-c)}function os(t,c){if(c>0){const r=rs(t);return Math.min(...r)>=c}return!0}function Me(t,c){return r=>{if(t[0]===t[1]||c[0]===c[1])return c[0];const s=(c[1]-c[0])/(t[1]-t[0]);return c[0]+s*(r-t[0])}}function ls(t){return(String(t).split(".")[1]||"").length}function is(t,c){const r=Math.pow(10,c);return Math.round(t*r)/r}var yt=it,cs=xt,ds=ht,ms=pt;const ve=x.forwardRef(({className:t,...c},r)=>e.jsxs(yt,{ref:r,className:Tt("relative flex w-full touch-none select-none items-center",t),...c,children:[e.jsx(cs,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(ds,{className:"absolute h-full bg-primary"})}),e.jsx(ms,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ve.displayName=yt.displayName;function us(){const{t}=re(),c=Ge(),[r,s]=x.useState(1e4),[n,u]=x.useState(0),[a,p]=x.useState(12),[f,g]=x.useState("monthly"),[I,j]=x.useState(new Date().toISOString().split("T")[0]),[d,b]=x.useState([]),[L,w]=x.useState({totalPayment:0,totalInterest:0,monthlyPayment:0}),o=()=>{if(n===0){const O=a*(f==="monthly"?1:f==="biweekly"?2.1666666666666665:4.333333333333333),F=r/O;let N=r;const C=[],H=new Date(I);for(let Y=1;Y<=Math.ceil(O);Y++){const W=Y===Math.ceil(O)?N:F;if(N<.01)break;const q=Math.min(W,N);C.push({paymentNumber:Y,paymentDate:Q(l(H,Y,f),"MMM d, yyyy"),payment:parseFloat(q.toFixed(2)),principal:parseFloat(q.toFixed(2)),interest:0,remainingBalance:Math.max(0,parseFloat((N-q).toFixed(2)))}),N-=q}b(C),w({totalPayment:r,totalInterest:0,monthlyPayment:parseFloat(F.toFixed(2))});return}const m=n/100/(f==="monthly"?12:f==="biweekly"?26:52),S=a*(f==="monthly"?1:f==="biweekly"?26/12:52/12),v=r*m*Math.pow(1+m,S)/(Math.pow(1+m,S)-1);let y=r;const K=[];let T=0;const te=new Date(I);for(let O=1;O<=Math.ceil(S);O++){const F=y*m,N=O===Math.ceil(S)?y:v-F;if(y<.01)break;const C=Math.min(v,y+F);K.push({paymentNumber:O,paymentDate:Q(l(te,O,f),"MMM d, yyyy"),payment:parseFloat(C.toFixed(2)),principal:parseFloat(N.toFixed(2)),interest:parseFloat(F.toFixed(2)),remainingBalance:Math.max(0,parseFloat((y-N).toFixed(2)))}),T+=F,y-=N}b(K),w({totalPayment:parseFloat((r+T).toFixed(2)),totalInterest:parseFloat(T.toFixed(2)),monthlyPayment:parseFloat(v.toFixed(2))})},l=(m,S,v)=>{const y=new Date(m);return v==="monthly"?y.setMonth(y.getMonth()+S):v==="biweekly"?y.setDate(y.getDate()+S*14):y.setDate(y.getDate()+S*7),y};return x.useEffect(()=>{o()},[r,n,a,f,I]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>c("/loans"),className:"gap-2",children:[e.jsx($t,{className:"h-4 w-4"}),t("common.back")]})}),e.jsxs(A,{children:[e.jsx(M,{children:e.jsx($,{children:t("loans.calculator.title")})}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"principal",children:t("loans.calculator.amount")}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"$"}),e.jsx(ee,{id:"principal",type:"number",value:r,onChange:m=>s(Number(m.target.value)),min:"100",step:"100"})]}),e.jsx(ve,{value:[r],onValueChange:([m])=>s(m),min:100,max:1e5,step:100,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"interest",children:t("loans.calculator.interest")}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(ee,{id:"interest",type:"number",value:n,onChange:m=>u(Number(m.target.value)),min:"0",step:"0.1"})}),e.jsx(ve,{value:[n],onValueChange:([m])=>u(m),min:0,max:30,step:.1,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"term",children:t("loans.calculator.term")}),e.jsx(ee,{id:"term",type:"number",value:a,onChange:m=>p(Number(m.target.value)),min:"1",max:"30"}),e.jsx(ve,{value:[a],onValueChange:([m])=>p(m),min:1,max:30,className:"mt-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"frequency",children:t("loans.calculator.frequency")}),e.jsxs(We,{value:f,onValueChange:m=>g(m),children:[e.jsx(Ze,{children:e.jsx(et,{placeholder:t("common.select")})}),e.jsxs(tt,{children:[e.jsx(je,{value:"monthly",children:t("loans.calculator.monthly")},"monthly"),e.jsx(je,{value:"biweekly",children:t("loans.calculator.biweekly")},"biweekly"),e.jsx(je,{value:"weekly",children:t("loans.calculator.weekly")},"weekly")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"startDate",children:t("loans.calculator.startDate")}),e.jsx(st,{date:I?new Date(I):void 0,onChange:m=>j(m?Q(m,"yyyy-MM-dd"):"")})]})]})})]}),e.jsxs(A,{children:[e.jsx(M,{children:e.jsx($,{children:t("loans.calculator.summary")})}),e.jsxs(R,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t(f==="monthly"?"loans.calculator.monthly":f==="biweekly"?"loans.calculator.biweekly":"loans.calculator.weekly")," ",t("loans.calculator.payment")]}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",L.monthlyPayment.toLocaleString()]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:t("loans.interestRate")}),e.jsxs("div",{className:`text-2xl font-bold ${n===0?"text-green-600":""}`,children:["$",L.totalInterest.toLocaleString(),n===0&&e.jsxs("span",{className:"text-xs ms-1 text-green-600",children:["(",t("loans.calculator.interestFree"),")"]})]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:t("loans.totalPayment")}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",L.totalPayment.toLocaleString()]})]})]}),n===0&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-green-800",children:["ðŸ’° ",e.jsxs("strong",{children:[t("loans.calculator.interestFree"),":"]})," ",t("loans.calculator.interestFreeMsg")]})})]})]}),e.jsxs(A,{children:[e.jsx(M,{children:e.jsx($,{children:t("loans.calculator.schedule")})}),e.jsx(R,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsxs(G,{children:[e.jsx(P,{children:"#"}),e.jsx(P,{children:t("loans.calculator.date")}),e.jsx(P,{children:t("loans.calculator.payment")}),e.jsx(P,{children:t("loans.calculator.principal")}),e.jsx(P,{children:t("loans.interestRate")}),e.jsx(P,{children:t("loans.calculator.remaining")})]})}),e.jsx(Se,{children:d.map(m=>e.jsxs(G,{children:[e.jsx(D,{children:m.paymentNumber}),e.jsx(D,{children:m.paymentDate}),e.jsxs(D,{children:["$",m.payment.toFixed(2)]}),e.jsxs(D,{children:["$",m.principal.toFixed(2)]}),e.jsxs(D,{children:["$",m.interest.toFixed(2)]}),e.jsxs(D,{children:["$",m.remainingBalance.toFixed(2)]})]},m.paymentNumber))})]})})})]})]})}const Ye=[{id:121416201,name:"Fixed Installment",description:"Equal monthly payments from salary",requiresApproval:!0,isActive:!0},{id:121416202,name:"% of Salary",description:"Deducted as a percentage of gross salary",requiresApproval:!0,isActive:!0},{id:121416203,name:"Emergency Loan",description:"One-time short-term loan",requiresApproval:!1,isActive:!0}],xs=Bt({LoanID:se().optional(),EmployeeID:se().min(1,"Employee is required"),LoanAmount:se().min(1,"Amount must be greater than 0"),LoanPayQty:se().min(1,"Number of payments is required"),LoanPayType:se().min(1,"Payment type is required"),LoanDate:ae().min(1,"Loan date is required"),LoanNote:ae().optional(),RemainingLoan:se().optional(),Status:ae().default("pending"),ApprovalDate:ae().optional(),CreatedDate:ae().optional(),UpdatedDate:ae().optional()});function Qe({isOpen:t,onOpenChange:c,onSuccess:r,initialValues:s,isApprover:n=!1,currentUserId:u}){var L,w;const{t:a}=re(),{toast:p}=Je(),[f,g]=x.useState(!1),[I,j]=x.useState(!1),d=Ut({resolver:zt(xs),defaultValues:{EmployeeID:0,LoanAmount:0,LoanPayQty:12,LoanPayType:Ye[0].id,LoanDate:Q(new Date,"yyyy-MM-dd"),LoanNote:"",RemainingLoan:0,Status:"pending",...s}});x.useEffect(()=>{s&&d.reset({...d.getValues(),...s})},[s,d]);const b=async o=>{try{g(!0);const l=Q(new Date,"yyyy-MM-dd HH:mm:ss");if(o.LoanID){const m={...o,UpdatedDate:l};await B.loan.update(o.LoanID,m),p({title:"Success",description:"Loan updated successfully"})}else{const m={...o,CreatedDate:l,UpdatedDate:l,Status:n?"approved":"pending",ApprovalDate:n?l:void 0};await B.loan.create(m),p({title:"Success",description:"Loan created successfully"})}r==null||r(),c(!1)}catch(l){console.error("Error saving loan:",l),p({title:"Error",description:"Failed to save loan",variant:"destructive"})}finally{g(!1)}};return I?e.jsx(ie,{open:t,onOpenChange:c,children:e.jsxs(ce,{className:"max-w-2xl",children:[e.jsx(de,{children:e.jsxs(me,{children:[a("common.loading"),"..."]})}),e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Ke,{className:"h-8 w-8 animate-spin"})})]})}):e.jsx(ie,{open:t,onOpenChange:c,children:e.jsxs(ce,{className:"max-w-2xl",children:[e.jsxs(de,{children:[e.jsx(me,{children:s!=null&&s.LoanID?a("loans.form.editTitle"):a("loans.form.newTitle")}),e.jsx(be,{children:s!=null&&s.LoanID?a("loans.form.editDesc"):a("loans.form.newDesc")})]}),e.jsx("form",{onSubmit:d.handleSubmit(b),className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:a("loans.form.info")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.form.employee")}),e.jsx(Vt,{value:(L=d.watch("EmployeeID"))==null?void 0:L.toString(),onValueChange:o=>d.setValue("EmployeeID",parseInt(o)),placeholder:a("loans.form.placeholder"),employmentStatus:"Active"}),d.formState.errors.EmployeeID&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:d.formState.errors.EmployeeID.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.amount")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-muted-foreground",children:"$"}),e.jsx(ee,{type:"number",step:"0.01",className:"pl-8",...d.register("LoanAmount",{valueAsNumber:!0})})]}),d.formState.errors.LoanAmount&&e.jsx("p",{className:"text-sm text-red-500",children:d.formState.errors.LoanAmount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.form.paymentsCount")}),e.jsx(ee,{type:"number",...d.register("LoanPayQty",{valueAsNumber:!0})}),d.formState.errors.LoanPayQty&&e.jsx("p",{className:"text-sm text-red-500",children:d.formState.errors.LoanPayQty.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.type")}),e.jsxs(We,{onValueChange:o=>d.setValue("LoanPayType",Number(o)),value:(w=d.watch("LoanPayType"))==null?void 0:w.toString(),children:[e.jsx(Ze,{children:e.jsx(et,{placeholder:a("common.select")})}),e.jsx(tt,{children:Ye.map(o=>e.jsx(je,{value:o.id.toString(),children:o.name},o.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.form.date")}),e.jsx(st,{date:d.watch("LoanDate")?new Date(d.watch("LoanDate")):void 0,onChange:o=>{o?d.setValue("LoanDate",Q(o,"yyyy-MM-dd"),{shouldValidate:!0}):d.setValue("LoanDate","",{shouldValidate:!0})}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.form.remaining")}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-muted-foreground",children:"$"}),e.jsx(ee,{type:"number",step:"0.01",className:"pl-8",...d.register("RemainingLoan",{valueAsNumber:!0}),disabled:!(s!=null&&s.LoanID)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("common.status")}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${d.watch("Status")==="approved"?"bg-green-100 text-green-800":d.watch("Status")==="pending"?"bg-yellow-100 text-yellow-800":d.watch("Status")==="rejected"?"bg-red-100 text-red-800":d.watch("Status")==="active"?"bg-blue-100 text-blue-800":d.watch("Status")==="completed"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:a(`loans.status.${d.watch("Status")||"pending"}`)}),n&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a("loans.form.approverNote"),")"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{children:a("loans.form.notes")}),e.jsx(ee,{placeholder:a("loans.form.notes"),...d.register("LoanNote")})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[e.jsx(z,{type:"button",variant:"outline",onClick:()=>c(!1),disabled:f,children:a("common.cancel")}),e.jsx(z,{type:"submit",disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"mr-2 h-4 w-4 animate-spin"}),s!=null&&s.LoanID?a("common.updating"):a("common.creating")]}):e.jsx(e.Fragment,{children:s!=null&&s.LoanID?a("loans.form.update"):a("loans.form.create")})})]})]})})]})})}function hs({loansLoading:t,paymentsLoading:c,filteredLoans:r,filteredPayments:s,activeTab:n,setActiveTab:u,paymentTab:a,setPaymentTab:p,setViewingLoan:f,setViewingPayment:g,setIsCreateDialogOpen:I,handleOpenCalculator:j,handleStatusUpdate:d,updatingStatus:b,LOAN_STATUS:L,isRTL:w}){const{t:o}=re();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:o("loans.title")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{onClick:j,variant:"outline",children:[e.jsx(Be,{className:"me-2 h-4 w-4"}),o("loans.tabs.calculator")]}),e.jsxs(z,{onClick:()=>I(!0),children:[e.jsx(Kt,{className:"me-2 h-4 w-4"}),o("loans.request")]})]})]}),e.jsxs(xe,{value:n,onValueChange:u,className:"w-full",dir:w?"rtl":"ltr",children:[e.jsxs(he,{className:"grid w-full grid-cols-5",children:[e.jsx(_,{value:"all",children:o("loans.tabs.all")}),e.jsx(_,{value:"pending",children:o("loans.status.pending")}),e.jsx(_,{value:"approved",children:o("loans.status.approved")}),e.jsx(_,{value:"completed",children:o("loans.status.completed")}),e.jsx(_,{value:"rejected",children:o("loans.status.rejected")})]}),e.jsxs(ge,{value:n,className:"space-y-4",children:[e.jsxs(A,{children:[e.jsxs(M,{children:[e.jsx($,{children:o("loans.title")}),e.jsx(ue,{children:o("loans.dashboard.latestApps")})]}),e.jsx(R,{children:t?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Be,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-medium",children:o("common.noRecords")}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:o("loans.dashboard.latestApps")})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsxs(G,{children:[e.jsx(P,{children:o("loans.reports.cols.id")}),e.jsx(P,{children:o("loans.form.employee")}),e.jsx(P,{children:o("loans.amount")}),e.jsx(P,{children:o("loans.type")}),e.jsx(P,{children:o("common.status")}),e.jsx(P,{children:o("common.date")}),e.jsx(P,{children:o("loans.remainingBalance")}),e.jsx(P,{className:"text-end",children:o("common.actions")})]})}),e.jsx(Se,{children:r.map(l=>{var m,S,v,y;return e.jsxs(G,{children:[e.jsx(D,{className:"font-medium",children:l.LoanID}),e.jsx(D,{children:`${l.employees_FirstName} ${l.employees_LastName}`}),e.jsxs(D,{children:["$",(m=l.LoanAmount)==null?void 0:m.toLocaleString()]}),e.jsx(D,{children:l.loanpaytype_LoanPayTypeName||o("common.unknown")}),e.jsx(D,{children:e.jsx(J,{className:((S=L[l.LoanStatus])==null?void 0:S.color)||"bg-gray-100 text-gray-800",children:((v=L[l.LoanStatus])==null?void 0:v.label)||l.LoanStatus})}),e.jsx(D,{children:l.LoanDate?Q(ke(l.LoanDate),"MMM d, yyyy"):"-"}),e.jsxs(D,{children:["$",(y=l.RemainingLoan)==null?void 0:y.toLocaleString()]}),e.jsx(D,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>f(l),children:o("common.view")}),l.LoanStatus==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>d(l.LoanID,"approved"),disabled:b===l.LoanID,children:b===l.LoanID?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):o("loans.approve")}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>d(l.LoanID,"rejected"),disabled:b===l.LoanID,children:o("loans.reject")})]})]})})]},l.LoanID)})})]})})})]}),e.jsxs(A,{children:[e.jsxs(M,{children:[e.jsx($,{children:o("loans.tabs.payments")}),e.jsx(ue,{children:o("loans.dashboard.latestApps")})]}),e.jsxs(R,{children:[e.jsx(xe,{value:a,onValueChange:p,className:"w-full mb-4",dir:w?"rtl":"ltr",children:e.jsxs(he,{className:"grid w-full grid-cols-3",children:[e.jsx(_,{value:"all",children:o("loans.tabs.all")}),e.jsx(_,{value:"paid",children:o("loans.tabs.paid")}),e.jsx(_,{value:"unpaid",children:o("loans.tabs.unpaid")})]})}),c?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Fe,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-medium",children:o("common.noRecords")}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:o("loans.dashboard.latestApps")})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsxs(G,{children:[e.jsx(P,{children:o("loans.reports.cols.id")}),e.jsx(P,{children:o("loans.form.employee")}),e.jsx(P,{children:o("loans.amount")}),e.jsxs(P,{children:[o("loans.calculator.installment")," #"]}),e.jsx(P,{children:o("common.date")}),e.jsx(P,{children:o("common.status")}),e.jsx(P,{className:"text-end",children:o("common.actions")})]})}),e.jsx(Se,{children:s.map(l=>{var m;return e.jsxs(G,{children:[e.jsx(D,{className:"font-medium",children:l.LoanPaymentID}),e.jsx(D,{children:l.EmployeeName}),e.jsxs(D,{children:["$",(m=l.LoanPaymentAmount)==null?void 0:m.toLocaleString()]}),e.jsx(D,{children:l.LoanPaymentS}),e.jsx(D,{children:l.LoanPaymentDate?Q(ke(l.LoanPaymentDate),"MMM d, yyyy"):"-"}),e.jsx(D,{children:e.jsx(J,{variant:l.IsPaid?"default":"outline",className:l.IsPaid?"bg-green-100 text-green-800":"",children:l.IsPaid?o("loans.tabs.paid"):o("loans.tabs.unpaid")})}),e.jsx(D,{children:e.jsx(z,{variant:"outline",size:"sm",onClick:()=>g(l),children:o("common.view")})})]},l.LoanPaymentID)})})]})})]})]})]})]})]})}function ps({loanStats:t,recentLoans:c}){const{t:r}=re(),s=n=>{switch(n){case"Active":case"active":return"bg-green-100 text-green-800";case"Overdue":case"overdue":return"bg-red-100 text-red-800";case"Completed":case"completed":return"bg-gray-100 text-gray-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:[e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-xs sm:text-sm font-medium",children:r("loans.dashboard.totalLoans")}),e.jsx(Ie,{className:"h-3 w-3 sm:h-4 sm:w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold break-words",children:t.totalLoans}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("loans.dashboard.allTime")})]})]}),e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-xs sm:text-sm font-medium",children:r("loans.dashboard.activeLoans")}),e.jsx(le,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-600"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-green-600 break-words",children:t.activeLoans}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("loans.dashboard.current")})]})]}),e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-xs sm:text-sm font-medium",children:r("loans.dashboard.disbursed")}),e.jsx(Ht,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-blue-600 break-words",children:["$",t.totalDisbursed.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("loans.dashboard.disbursedDesc")})]})]}),e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-xs sm:text-sm font-medium",children:r("loans.dashboard.outstanding")}),e.jsx(Ue,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-lg sm:text-xl font-bold text-yellow-600 break-words",children:["$",t.totalOutstanding.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("loans.dashboard.remaining")})]})]}),e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-xs sm:text-sm font-medium",children:r("loans.dashboard.overdue")}),e.jsx(Ue,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-600"})]}),e.jsxs(R,{children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-red-600 break-words",children:t.overdueLoans}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("loans.dashboard.pastDue")})]})]}),e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-xs sm:text-sm font-medium",children:r("loans.dashboard.avgAmount")}),e.jsx(Ie,{className:"h-3 w-3 sm:h-4 sm:w-4 text-muted-foreground"})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"text-lg sm:text-xl font-bold break-words",children:["$",t.avgLoanAmount.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("loans.dashboard.avgSize")})]})]})]}),e.jsxs(A,{children:[e.jsxs(M,{children:[e.jsx($,{className:"text-sm sm:text-base md:text-lg",children:r("loans.dashboard.recentActivity")}),e.jsx(ue,{className:"text-xs sm:text-sm",children:r("loans.dashboard.latestApps")})]}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:c.map(n=>{var u;return e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ie,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:n.employee}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",(u=n.amount)==null?void 0:u.toLocaleString()," ",r("loans.amount")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium",children:n.status==="Completed"||n.status==="completed"?r("loans.status.completed"):`${r("loans.dashboard.nextPayment")}: ${n.nextPayment}`}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(Fe,{className:"inline h-3 w-3 me-1"}),n.status==="Completed"||n.status==="completed"?r("loans.status.completed"):r("loans.dashboard.pastDue")]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s(n.status)}`,children:r(`loans.status.${n.status.toLowerCase()}`)})]})]},n.id)})})})]})]})}function fs({activeReport:t,setActiveReport:c,isRTL:r}){const{t:s}=re(),u={loan_requests:{type:"report_loan_requests",title:s("loans.reports.requestsTitle"),description:s("loans.reports.requestsDesc"),columns:[{key:"LoanID",label:s("loans.reports.cols.id")},{key:"EmployeeName",label:s("loans.reports.cols.employee")},{key:"LoanPayTypeName",label:s("loans.reports.cols.type")},{key:"LoanAmount",label:s("loans.amount"),format:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a)},{key:"RemainingLoan",label:s("loans.remainingBalance"),format:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a)},{key:"LoanDate",label:s("common.date"),format:a=>a?new Date(a).toLocaleDateString():"-"},{key:"LoanStatus",label:s("common.status"),format:a=>e.jsx(J,{variant:a==="Approved"?"default":a==="Completed"?"secondary":a==="Rejected"?"destructive":"outline",children:s(`loans.status.${a==null?void 0:a.toLowerCase()}`)})}],filters:[{key:"start_date",label:s("common.startDate"),type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:s("common.endDate"),type:"date",defaultValue:new Date().toISOString().split("T")[0]}]},loan_payments:{type:"report_loan_payments",title:s("loans.reports.paymentsTitle"),description:s("loans.reports.paymentsDesc"),columns:[{key:"LoanPaymentID",label:s("loans.reports.cols.id")},{key:"EmployeeName",label:s("loans.reports.cols.employee")},{key:"LoanPaymentAmount",label:s("loans.amount"),format:a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a)},{key:"LoanPaymentDate",label:s("common.date"),format:a=>a?new Date(a).toLocaleDateString():"-"},{key:"InstallmentNumber",label:s("loans.calculator.installment")},{key:"Status",label:s("common.status"),format:a=>e.jsx(J,{variant:a==="Paid"?"default":"secondary",children:s(a==="Paid"?"loans.tabs.paid":"loans.tabs.unpaid")})}],filters:[{key:"start_date",label:s("common.startDate"),type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:s("common.endDate"),type:"date",defaultValue:new Date().toISOString().split("T")[0]}]}}[t];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{children:e.jsx(R,{className:"p-4",children:e.jsx(xe,{value:t,onValueChange:c,className:"w-full",dir:r?"rtl":"ltr",children:e.jsxs(he,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(_,{value:"loan_requests",children:s("loans.tabs.overview")}),e.jsx(_,{value:"loan_payments",children:s("loans.tabs.payments")})]})})})}),e.jsx(at,{reportType:u.type,title:u.title,description:u.description,columns:u.columns,filterFields:u.filters,disableAutoFetch:!0})]})}function ys(){var _e,$e,Oe;const{t,i18n:c}=re(),r=Ge(),s=Ft(),{toast:n}=Je(),u=c.dir()==="rtl",a={pending:{label:t("loans.status.pending"),icon:Fe,color:"bg-yellow-100 text-yellow-800"},approved:{label:t("loans.status.approved"),icon:le,color:"bg-green-100 text-green-800"},rejected:{label:t("loans.status.rejected"),icon:He,color:"bg-red-100 text-red-800"},active:{label:t("loans.status.active"),icon:le,color:"bg-blue-100 text-blue-800"},completed:{label:t("loans.status.completed"),icon:le,color:"bg-gray-100 text-gray-800"},default:{label:t("common.unknown"),icon:Mt,color:"bg-gray-100 text-gray-800"}},[p,f]=x.useState("all"),[g,I]=x.useState("all"),[j,d]=x.useState(!1),[b,L]=x.useState(null),[w,o]=x.useState(null),[l,m]=x.useState(null),[S,v]=x.useState(null),[y,K]=x.useState(null),[T,te]=x.useState([]),[O,F]=x.useState(!0),[N,C]=x.useState(!1),[H,Y]=x.useState("loan_requests"),{data:W,isLoading:q,refetch:X}=ze({queryKey:["loans"],queryFn:async()=>(await B.list("loan",{pageSize:10,sortBy:"LoanDate",sortOrder:"desc"})).data||[]}),k=W||[],{data:fe,isLoading:Ee}=ze({queryKey:["loanPayments"],queryFn:async()=>(await B.list("loanpayment",{pageSize:10,sortBy:"LoanPaymentDate",sortOrder:"desc"})).data||[]}),ye=fe||[],jt=Ot({mutationFn:async({loanId:i,status:h})=>{const E=Number(i);if(isNaN(E))throw new Error(`Invalid loan ID: ${i}`);const V={LoanStatus:h};return h==="approved"?(V.ApprovalBy=1,V.ApprovalDate=new Date().toISOString()):h==="rejected"&&(V.ApprovalBy=1,V.ApprovalDate=new Date().toISOString()),await B.update("loan",E,V)},onSuccess:()=>{s.invalidateQueries({queryKey:["loans"]}),n({title:t("common.success"),description:t("loans.statusUpdated")}),o(null)},onError:i=>{console.error("Error updating loan status:",i),n({title:t("common.error"),description:t("loans.statusUpdateFailed"),variant:"destructive"}),o(null)}});Ce.useEffect(()=>{(async()=>{if(l)try{F(!0);const[h,E]=await Promise.all([B.list("loan",{pageSize:100}),B.list("loanpayment",{pageSize:100,sortBy:"LoanPaymentDate",sortOrder:"desc"})]),V=(h.data||[]).find(Pe=>Pe.LoanID===l.LoanID),qe=(E.data||[]).filter(Pe=>Pe.LoanID===l.LoanID);K(V),te(qe)}catch(h){console.error("Error fetching loan details:",h),n({title:t("common.error"),description:t("loans.detailsLoadFailed"),variant:"destructive"})}finally{F(!1)}})()},[l,n]);const gt=async()=>{if(l)try{C(!0),await B.loan.approve(l.LoanID,1,"Approved via details page");const i=await B.list("loan",{filters:JSON.stringify([{field:"LoanID",operator:"eq",value:l.LoanID}]),pageSize:1}),h=i.data&&i.data.length>0?i.data[0]:null;K(h),n({title:t("common.success"),description:t("loans.approved")})}catch(i){console.error("Error approving loan:",i),n({title:t("common.error"),description:t("loans.approveFailed"),variant:"destructive"})}finally{C(!1)}},bt=async()=>{if(!l)return;const i=window.prompt("Please enter the reason for rejection:");if(i)try{C(!0),await B.loan.reject(l.LoanID,1,i);const h=await B.list("loan",{filters:JSON.stringify([{field:"LoanID",operator:"eq",value:l.LoanID}]),pageSize:1}),E=h.data&&h.data.length>0?h.data[0]:null;K(E),n({title:t("common.success"),description:t("loans.rejected")})}catch(h){console.error("Error rejecting loan:",h),n({title:t("common.error"),description:t("loans.rejectFailed"),variant:"destructive"})}finally{C(!1)}},vt=async i=>{if(l)try{C(!0),await B.loan.updatePayment(l.LoanID,i,{IsPaid:!0,PaidDate:Q(new Date,"yyyy-MM-dd")});const E=((await B.list("loanpayment",{pageSize:100,sortBy:"LoanPaymentDate",sortOrder:"desc"})).data||[]).filter(V=>V.LoanID===l.LoanID);te(E),n({title:t("common.success"),description:t("loans.paymentMarked")})}catch(h){console.error("Error making payment:",h),n({title:t("common.error"),description:t("loans.paymentFailed"),variant:"destructive"})}finally{C(!1)}},Nt=Ce.useMemo(()=>{const i=k||[];return p==="all"?i:i.filter(h=>{var E;return((E=h.LoanStatus)==null?void 0:E.toLowerCase())===p.toLowerCase()})},[k,p]),wt=Ce.useMemo(()=>{const i=ye||[];return g==="all"?i:i.filter(h=>g==="paid"?h.IsPaid:g==="unpaid"?!h.IsPaid:!0)},[ye,g]),St=(i,h)=>{o(i),jt.mutate({loanId:i,status:h})},Dt=()=>{r("/loans/calculator")},Lt={totalLoans:k.length,activeLoans:k.filter(i=>i.LoanStatus==="active").length,totalDisbursed:k.reduce((i,h)=>i+(Number(h.LoanAmount)||0),0),totalOutstanding:k.reduce((i,h)=>i+(Number(h.RemainingLoan)||0),0),overdueLoans:ye.filter(i=>i.Status==="unpaid").length,avgLoanAmount:k.length>0?Math.round(k.reduce((i,h)=>i+(Number(h.LoanAmount)||0),0)/k.length):0},Pt=k.slice(0,3).map(i=>({id:i.LoanID,employee:`${i.employees_FirstName} ${i.employees_LastName}`,amount:i.LoanAmount,status:i.LoanStatus,nextPayment:i.NextPaymentDate||"N/A"}));return q||Ee?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(Z,{className:"h-10 w-48"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Z,{className:"h-10 w-96 rounded-md"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:[...Array(3)].map((i,h)=>e.jsxs(A,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Z,{className:"h-4 w-24"}),e.jsx(Z,{className:"h-4 w-4"})]}),e.jsx(R,{children:e.jsx(Z,{className:"h-8 w-16"})})]},h))}),e.jsxs(A,{children:[e.jsx(M,{children:e.jsx(Z,{className:"h-6 w-32 mb-2"})}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((i,h)=>e.jsx(Z,{className:"h-16 w-full"},h))})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"text-3xl font-bold",children:t("loans.title")})}),e.jsxs(xe,{defaultValue:"overview",className:"w-full",dir:u?"rtl":"ltr",children:[e.jsxs(he,{className:"grid w-full grid-cols-3",children:[e.jsx(_,{value:"overview",children:t("loans.tabs.overview")}),e.jsx(_,{value:"dashboard",children:t("loans.tabs.dashboard")}),e.jsx(_,{value:"reports",children:t("loans.tabs.reports")})]}),e.jsx(ge,{value:"overview",children:e.jsx(hs,{loansData:k,paymentsData:ye,loansLoading:q,paymentsLoading:Ee,filteredLoans:Nt,filteredPayments:wt,activeTab:p,setActiveTab:f,paymentTab:g,setPaymentTab:I,setViewingLoan:m,setViewingPayment:v,setIsCreateDialogOpen:d,handleOpenCalculator:Dt,handleStatusUpdate:St,updatingStatus:w,LOAN_STATUS:a,isRTL:u})}),e.jsx(ge,{value:"dashboard",children:e.jsx(ps,{loanStats:Lt,recentLoans:Pt})}),e.jsx(ge,{value:"reports",children:e.jsx(fs,{activeReport:H,setActiveReport:Y,isRTL:u})})]}),e.jsx(ie,{open:j,onOpenChange:d,children:e.jsxs(ce,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("loans.form.newTitle")}),e.jsx(be,{children:t("loans.form.newDesc")})]}),e.jsx(Qe,{isOpen:j,onOpenChange:d,onSuccess:()=>{d(!1),X()},currentUserId:1,isApprover:!0})]})}),l&&e.jsx(ie,{open:!!l,onOpenChange:()=>m(null),children:e.jsxs(ce,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("loans.tabs.details")}),e.jsx(be,{children:t("loans.form.editDesc")})]}),O||!y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(J,{variant:"outline",className:`${((_e=a[y.LoanStatus])==null?void 0:_e.color)||"bg-gray-100 text-gray-800"} border-0 text-sm px-3 py-1`,children:(($e=a[y.LoanStatus])==null?void 0:$e.label)||y.LoanStatus})}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[y.LoanStatus==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"default",onClick:gt,disabled:N,children:[e.jsx(le,{className:"h-4 w-4 me-2"}),t("loans.approve")]}),e.jsxs(z,{variant:"outline",onClick:bt,disabled:N,children:[e.jsx(He,{className:"h-4 w-4 me-2"}),t("loans.reject")]})]}),e.jsxs(z,{variant:"outline",onClick:()=>{L(l),m(null)},children:[e.jsx(Yt,{className:"h-4 w-4 mr-2"}),t("common.edit")]})]})]}),e.jsxs(A,{children:[e.jsxs(M,{children:[e.jsxs($,{className:"text-2xl",children:[t("loans.title")," #",y.LoanID]}),e.jsx(ue,{children:y.LoanNote||t("common.noRecords")})]}),e.jsx(R,{children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("loans.amount")}),e.jsxs("p",{className:"text-2xl font-semibold",children:["$",(Oe=y.LoanAmount)==null?void 0:Oe.toLocaleString()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("loans.paymentHistory")}),e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-lg font-semibold",children:["$",T.filter(i=>i.IsPaid).reduce((i,h)=>i+(h.LoanPaymentAmount||0),0).toLocaleString()]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:(()=>{const i=y.LoanPayQty||T.length,h=T.filter(V=>V.IsPaid).length,E=i>0?Math.round(h/i*100):0;return t("loans.tabs.percentComplete",{progress:E})})()})]}),e.jsx(qt,{value:(()=>{const i=y.LoanPayQty||T.length,h=T.filter(E=>E.IsPaid).length;return i>0?Math.round(h/i*100):0})(),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("loans.remainingBalance")}),e.jsxs("span",{className:"font-medium",children:["$",(y.RemainingLoan!==void 0?y.RemainingLoan:y.LoanAmount-T.filter(i=>i.IsPaid).reduce((i,h)=>i+(h.LoanPaymentAmount||0),0)).toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("loans.form.employee")}),e.jsxs("p",{className:"font-medium",children:[y.employees_FirstName," ",y.employees_LastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y.employees_Email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("loans.type")}),e.jsx("p",{className:"font-medium",children:y.loanpaytype_LoanPayTypeName||t("common.unknown")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[y.LoanPayQty," ",t("loans.form.paymentsCount")]})]})]})})]}),e.jsxs(A,{children:[e.jsxs(M,{children:[e.jsx($,{children:t("loans.tabs.payments")}),e.jsx(ue,{children:t("loans.dashboard.latestApps")})]}),e.jsx(R,{children:e.jsxs(Ne,{children:[e.jsx(we,{children:e.jsxs(G,{children:[e.jsxs(P,{children:[t("loans.calculator.installment")," #"]}),e.jsx(P,{children:t("loans.amount")}),e.jsx(P,{children:t("common.date")}),e.jsx(P,{children:t("common.status")}),e.jsx(P,{className:"text-end",children:t("common.actions")})]})}),e.jsx(Se,{children:T.length===0?e.jsx(G,{children:e.jsx(D,{colSpan:5,className:"h-24 text-center",children:t("common.noRecords")})}):T.map(i=>{var h;return e.jsxs(G,{children:[e.jsxs(D,{className:"font-medium",children:["#",i.LoanPaymentS]}),e.jsxs(D,{children:["$",(h=i.LoanPaymentAmount)==null?void 0:h.toLocaleString()]}),e.jsx(D,{children:i.LoanPaymentDate?Q(ke(i.LoanPaymentDate),"MMM d, yyyy"):t("common.unknown")}),e.jsx(D,{children:e.jsx(J,{variant:i.IsPaid?"default":"outline",className:i.IsPaid?"bg-green-100 text-green-800":"",children:i.IsPaid?t("loans.tabs.paid"):t("loans.tabs.unpaid")})}),e.jsx(D,{children:!i.IsPaid&&e.jsx(z,{variant:"outline",size:"sm",onClick:()=>vt(i.LoanPaymentID),disabled:N,children:t("loans.tabs.paid")})})]},i.LoanPaymentID)})})]})})]})]})]})}),b&&e.jsx(ie,{open:!!b,onOpenChange:()=>L(null),children:e.jsxs(ce,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("loans.form.editTitle")}),e.jsx(be,{children:t("loans.form.editDesc")})]}),e.jsx(Qe,{isOpen:!!b,onOpenChange:()=>L(null),onSuccess:()=>{L(null),X()},initialValues:{LoanID:b.LoanID},currentUserId:1,isApprover:!0})]})})]})}const Qs=()=>{const[t,c]=x.useState("loan_requests"),s={loan_requests:{type:"report_loan_requests",title:"Loan Requests Report",description:"List of all loan requests with their status and details.",columns:[{key:"LoanID",label:"ID"},{key:"EmployeeName",label:"Employee"},{key:"LoanPayTypeName",label:"Pay Type"},{key:"LoanAmount",label:"Amount",format:n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)},{key:"RemainingLoan",label:"Remaining",format:n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)},{key:"LoanDate",label:"Date",format:n=>n?new Date(n).toLocaleDateString():"-"},{key:"LoanStatus",label:"Status",format:n=>e.jsx(J,{variant:n==="Approved"?"default":n==="Completed"?"secondary":n==="Rejected"?"destructive":"outline",children:n})}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]},loan_payments:{type:"report_loan_payments",title:"Loan Payments Report",description:"List of loan payments and their status.",columns:[{key:"LoanPaymentID",label:"ID"},{key:"EmployeeName",label:"Employee"},{key:"LoanPaymentAmount",label:"Amount",format:n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)},{key:"LoanPaymentDate",label:"Date",format:n=>n?new Date(n).toLocaleDateString():"-"},{key:"InstallmentNumber",label:"Installment #"},{key:"Status",label:"Status",format:n=>e.jsx(J,{variant:n==="Paid"?"default":"secondary",children:n})}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]}}[t];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{children:e.jsx(R,{className:"p-4",children:e.jsx(xe,{value:t,onValueChange:c,className:"w-full",children:e.jsxs(he,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(_,{value:"loan_requests",children:"Loan Requests"}),e.jsx(_,{value:"loan_payments",children:"Loan Payments"})]})})})}),e.jsx(at,{reportType:s.type,title:s.title,description:s.description,columns:s.columns,filterFields:s.filters,disableAutoFetch:!0})]})};function Xs(){return e.jsxs(Et,{children:[e.jsx(Ve,{index:!0,element:e.jsx(ys,{})}),e.jsx(Ve,{path:"calculator",element:e.jsx(us,{})})]})}export{us as LoanCalculator,ys as LoansModule,Xs as LoansModuleRouter,Qs as LoansReports};
