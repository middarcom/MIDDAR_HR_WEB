import{w as H,r as l,j as e,C as v,e as k,f as E,g as I,h as O,n as m,B as b,$ as c}from"./index-DOKDlu5z.js";import{L as d}from"./label-CyjSVjeg.js";import{C as F}from"./checkbox-DeAc7_k8.js";import{I as N}from"./input-8l6hFLlx.js";import{a as y}from"./api-cTyB4nM2.js";import{E as P}from"./EmployeeDropdown-DJ9DbyzC.js";import"./index-D13m8HN9.js";import"./select-BruEyd3_.js";import"./loader-circle-CiopRRXq.js";const Y=()=>{H();const[o,C]=l.useState(""),[i,u]=l.useState(null),[h,M]=l.useState(new Date),[D,f]=l.useState(!1),[r,p]=l.useState({checkIn:!1,checkOut:!1}),[n,g]=l.useState(!1),[s,x]=l.useState({hours:"",minutes:""});l.useEffect(()=>{(async()=>{if(!o){u(null);return}try{f(!0);const t=await y.employees.list({exact_filters:{EmployeeID:parseInt(o)}});t.data&&t.data.length>0?u(t.data[0]):(console.error("No employee found with ID:",o),c.error("Employee not found"),u(null))}catch(t){console.error("Error fetching employee:",t),c.error("Failed to load employee data. Please try again."),u(null)}finally{f(!1)}})()},[o]),l.useEffect(()=>{const a=setInterval(()=>M(new Date),1e3);return()=>clearInterval(a)},[]),l.useEffect(()=>{i||(g(!1),x({hours:"",minutes:""}))},[i]);const j=()=>{if(n&&s.hours&&s.minutes){const a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),parseInt(s.hours),parseInt(s.minutes))}return new Date},w=async()=>{if(!i){c.error("Employee data not loaded");return}if(n&&(!s.hours||!s.minutes)){c.error("Please enter manual time (hours and minutes)");return}p({...r,checkIn:!0});try{await y.create("timeattendance",{EmployeeID:i.EmployeeID,AttendanceDate:m(j(),"yyyy-MM-dd HH:mm:ss")}),c.success("Successfully checked in")}catch(a){console.error("Error checking in:",a),c.error("Failed to check in")}finally{p({...r,checkIn:!1})}},S=async()=>{if(!i){c.error("Employee data not loaded");return}if(n&&(!s.hours||!s.minutes)){c.error("Please enter manual time (hours and minutes)");return}p({...r,checkOut:!0});try{await y.create("timeattendance",{EmployeeID:i.EmployeeID,AttendanceDate:m(j(),"yyyy-MM-dd HH:mm:ss")}),c.success("Successfully checked out")}catch(a){console.error("Error checking out:",a),c.error("Failed to check out")}finally{p({...r,checkOut:!1})}},T=a=>a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return D?e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs(v,{children:[e.jsx(k,{children:e.jsx(E,{children:"Loading..."})}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-8 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-12 bg-muted rounded w-1/4"})]})})]})}):e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs(v,{className:"max-w-4xl mx-auto",children:[e.jsxs(k,{children:[e.jsx(E,{children:"Check-In / Check-Out"}),e.jsx(O,{children:"Select an employee and record their attendance"})]}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"employee",children:"Select Employee *"}),e.jsx(P,{value:o,onValueChange:C,placeholder:"Select an employee",employmentStatus:"Active"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Status"}),e.jsx("div",{className:"h-10 flex items-center",children:i?e.jsx("span",{className:"text-green-600 font-medium",children:"Ready to record attendance"}):e.jsx("span",{className:"text-gray-400",children:"Please select an employee"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Current Date"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:m(h,"EEEE, MMMM d, yyyy")})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Current Time"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:m(h,"HH:mm:ss")})]})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-blue-50/50 dark:bg-blue-900/10",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:"manual-mode",checked:n,onCheckedChange:a=>{g(a),a||x({hours:"",minutes:""})}}),e.jsx(d,{htmlFor:"manual-mode",className:"text-sm font-medium",children:"Manual Time Entry"})]}),n&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"manual-hours",children:"Hours (0-23)"}),e.jsx(N,{id:"manual-hours",type:"number",min:"0",max:"23",placeholder:"HH",value:s.hours,onChange:a=>{const t=a.target.value;(t===""||parseInt(t)>=0&&parseInt(t)<=23)&&x({...s,hours:t})},className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"manual-minutes",children:"Minutes (0-59)"}),e.jsx(N,{id:"manual-minutes",type:"number",min:"0",max:"59",placeholder:"MM",value:s.minutes,onChange:a=>{const t=a.target.value;(t===""||parseInt(t)>=0&&parseInt(t)<=59)&&x({...s,minutes:t})},className:"w-full"})]})]}),n&&e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 p-2 rounded",children:["Manual time will be used: ",s.hours.padStart(2,"0"),":",s.minutes.padStart(2,"0")]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4",children:[e.jsx(b,{onClick:w,disabled:!i||r.checkIn||r.checkOut||n&&(!s.hours||!s.minutes),variant:"default",className:"w-full",size:"lg",children:r.checkIn?"Processing...":"Check In"}),e.jsx(b,{onClick:S,disabled:!i||r.checkIn||r.checkOut||n&&(!s.hours||!s.minutes),variant:"outline",className:"w-full",size:"lg",children:r.checkOut?"Processing...":"Check Out"})]}),e.jsx("div",{className:"mt-6 p-4 bg-muted/30 rounded-md",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Time to use: ",n&&s.hours&&s.minutes?`${s.hours.padStart(2,"0")}:${s.minutes.padStart(2,"0")} (Manual)`:T(h)+" (Current)"]}),e.jsxs("div",{children:["Date: ",m(h,"MMM d, yyyy")]}),n&&e.jsx("div",{className:"text-blue-600 font-medium",children:"Manual mode enabled - Enter time above to proceed"})]})})]})})]})})};export{Y as default};
