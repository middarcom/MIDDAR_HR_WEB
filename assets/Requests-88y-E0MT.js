import{r as n,$ as i,j as e,C as p,e as b,g as y,f as q,F as X,i as K,S as fe,y as ve,z as ge,B as A,G as we,H as Ne,I as L,J as C,n as Q,d as F,D as De,k as Se}from"./index-BbrTghgW.js";import{I as Y}from"./input-CQIgNovL.js";import{L as h}from"./label-DCY7_wqV.js";import{S as I,a as P,b as M,c as B,d as c}from"./select-BPHtPkSE.js";import{T as Re,a as be,b as Z,c as x,d as Ce,e as u}from"./table-C0s5XoLk.js";import{D as Ee,a as Te,b as qe,c as Ae,d as Le,f as Fe}from"./dialog-DiSuHpBo.js";import{T as ee}from"./textarea-Bmm9txAP.js";import{a as w}from"./api-DrQz22N6.js";import{E as ke}from"./empty-state-D-OP1gji.js";import{E as Ie}from"./error-state-HjCFOT3n.js";import{T as Pe}from"./loading-skeletons-e3orwHHd.js";import{S as d}from"./skeleton-DnDXPQ8a.js";import{C as se}from"./date-picker-Di2FZ_8r.js";import{C as Me}from"./circle-check-big-Ssxgx59z.js";import{C as te}from"./circle-x-CRgi__6U.js";import{E as Be}from"./ellipsis-CNyI4h-M.js";import{E as Ve}from"./eye-CgLGBXai.js";import{P as $e}from"./pencil-CFtAbIDE.js";import{C as Oe}from"./circle-check-BIThnqhY.js";import{T as _e}from"./trash-2-C8y46xRR.js";import"./index-DjN-I_zr.js";import"./plus-DjxLo3j8.js";import"./popover-C4V-Cu3m.js";import"./getDaysInMonth-S2lyXVBb.js";import"./chevron-left-Dcmi5lMJ.js";const xs=()=>{const[N,ae]=n.useState([]),[re,le]=n.useState([]),[V,$]=n.useState(!1),[O,_]=n.useState(null),[j,ne]=n.useState(""),[v,ce]=n.useState("all"),[g,oe]=n.useState("all"),[o,H]=n.useState(null),[ie,D]=n.useState(!1),[a,J]=n.useState("create"),[z,S]=n.useState(""),[t,f]=n.useState({RequestType:"Leave",Status:"Pending",Description:"",StartDate:"",EndDate:"",Amount:null});n.useEffect(()=>{E(),de()},[]);const E=async()=>{try{$(!0),_(null);const l=(await w.requests.list({includeEmployee:!0,sort:"RequestDate",sortOrder:"desc"})).data||[];console.log("Raw API response:",l);const m=l.map(r=>(console.log("Processing item:",r),{RequestID:r.RequestID,EmployeeID:r.EmployeeID,RequestType:r.RequestType,RequestDate:r.RequestDate,Status:r.Status,Description:r.Description,StartDate:r.StartDate,EndDate:r.EndDate,Amount:r.Amount,employee:{FirstName:r.employees_FirstName||r.FirstName,LastName:r.employees_LastName||r.LastName,EmployeeCode:r.employees_EmployeeCode||r.EmployeeCode,JobID:r.employees_JobID||r.JobID},ApprovalComments:r.ApprovalComments,RejectionComments:r.RejectionComments,ApprovedBy:r.ApprovedBy,RejectedBy:r.RejectedBy,ApprovalDate:r.ApprovalDate,RejectionDate:r.RejectionDate}));console.log("Mapped requests:",m),ae(m)}catch(s){console.error("Error fetching requests:",s),_(s instanceof Error?s.message:"Failed to load requests"),i.error("Failed to load requests")}finally{$(!1)}},de=async()=>{try{const s=await w.employees.listWithFields(["EmployeeID","FirstName","LastName","EmployeeCode"]);le(s||[])}catch(s){console.error("Error fetching employees:",s)}},k=s=>{if(!s)return"Unknown Employee";if(s.employee&&s.employee.FirstName&&s.employee.LastName)return`${s.employee.FirstName} ${s.employee.LastName}`;const l=re.find(m=>m.EmployeeID===s.EmployeeID);return l?`${l.FirstName} ${l.LastName}`:`Employee ${s.EmployeeID}`},U=N.filter(s=>{var G,W;const l=k(s).toLowerCase(),m=((W=(G=s.employee)==null?void 0:G.EmployeeCode)==null?void 0:W.toLowerCase())||"",r=j===""||l.includes(j.toLowerCase())||m.includes(j.toLowerCase())||s.Description&&s.Description.toLowerCase().includes(j.toLowerCase()),je=v==="all"||s.Status&&s.Status.toLowerCase()===v.toLowerCase(),ye=g==="all"||s.RequestType&&s.RequestType.toLowerCase()===g.toLowerCase();return r&&je&&ye}),me=async(s,l,m)=>{try{switch(l){case"approve":await w.requests.approve(s.RequestID,1,m),i.success("Request approved successfully");break;case"reject":await w.requests.reject(s.RequestID,1,m),i.success("Request rejected successfully");break;case"view":i.info("Viewing request details");break;case"edit":i.info("Edit functionality would be implemented here");break;case"delete":await w.requests.delete(s.RequestID),i.success("Request deleted successfully");break}(l==="approve"||l==="reject"||l==="delete")&&await E(),D(!1),S(""),H(null)}catch(r){console.error("Error handling action:",r),i.error(`Failed to ${l} request`)}},pe=async()=>{try{if(!t.RequestType||!t.Description){i.error("Please fill in all required fields");return}if((t.RequestType==="Leave"||t.RequestType==="Sick Leave")&&(!t.StartDate||!t.EndDate)){i.error("Please select start and end dates for leave requests");return}if(t.RequestType==="Loan"&&!t.Amount){i.error("Please enter loan amount");return}const s={RequestType:t.RequestType,Description:t.Description,Status:"Pending",...t.StartDate&&{StartDate:t.StartDate},...t.EndDate&&{EndDate:t.EndDate},...t.Amount&&{Amount:t.Amount}};await w.requests.create(s),i.success("Request created successfully"),f({RequestType:"Leave",Status:"Pending",Description:"",StartDate:"",EndDate:"",Amount:null}),D(!1),S(""),await E()}catch(s){console.error("Error creating request:",s),i.error("Failed to create request")}},R=(s,l)=>{H(s),J(l),S(""),D(!0)},T=s=>s?new Date(s).toLocaleDateString():"N/A",he=s=>s?new Intl.NumberFormat("en-US",{style:"currency",currency:"SAR"}).format(s):"N/A",xe=s=>{switch(s){case"Approved":return e.jsx(F,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Approved"});case"Rejected":return e.jsx(F,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Rejected"});case"Pending":return e.jsx(F,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Pending"});default:return e.jsx(F,{variant:"secondary",children:s})}},ue=s=>{switch(s){case"Leave":return e.jsx(Se,{className:"h-4 w-4"});case"Loan":return e.jsx(De,{className:"h-4 w-4"});case"Sick Leave":return e.jsx(K,{className:"h-4 w-4"});default:return e.jsx(X,{className:"h-4 w-4"})}};return V?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[...Array(4)].map((s,l)=>e.jsxs(p,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"h-4 w-24"}),e.jsx(d,{className:"h-4 w-4 rounded-full"})]}),e.jsx(y,{children:e.jsx(d,{className:"h-8 w-16"})})]},l))}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"h-4 w-32"}),e.jsx(d,{className:"h-10 w-full"})]})}),e.jsxs("div",{className:"w-full md:w-64 space-y-2",children:[e.jsx(d,{className:"h-4 w-16"}),e.jsx(d,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"w-full md:w-64 space-y-2",children:[e.jsx(d,{className:"h-4 w-24"}),e.jsx(d,{className:"h-10 w-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{className:"h-12 w-full rounded-md"}),e.jsx("div",{className:"space-y-2",children:[...Array(8)].map((s,l)=>e.jsx(d,{className:"h-16 w-full"},l))})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[e.jsxs(p,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Total Requests"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold",children:N.length})})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Pending"}),e.jsx(K,{className:"h-4 w-4 text-yellow-600"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:N.filter(s=>s.Status==="Pending").length})})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Approved"}),e.jsx(Me,{className:"h-4 w-4 text-green-600"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N.filter(s=>s.Status==="Approved").length})})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(q,{className:"text-sm font-medium",children:"Rejected"}),e.jsx(te,{className:"h-4 w-4 text-red-600"})]}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:N.filter(s=>s.Status==="Rejected").length})})]})]}),e.jsx("div",{className:"grid gap-4 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{children:"Search Requests"}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"Search by employee name, code, or description...",className:"pl-8",value:j,onChange:s=>ne(s.target.value)})]})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx(h,{children:"Status"}),e.jsxs(I,{value:v,onValueChange:ce,children:[e.jsx(P,{children:e.jsx(M,{placeholder:"Select status"})}),e.jsxs(B,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"approved",children:"Approved"}),e.jsx(c,{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx(h,{children:"Request Type"}),e.jsxs(I,{value:g,onValueChange:oe,children:[e.jsx(P,{children:e.jsx(M,{placeholder:"Select type"})}),e.jsxs(B,{children:[e.jsx(c,{value:"all",children:"All Types"}),e.jsx(c,{value:"leave",children:"Leave"}),e.jsx(c,{value:"loan",children:"Loan"}),e.jsx(c,{value:"sick leave",children:"Sick Leave"}),e.jsx(c,{value:"other",children:"Other"})]})]})]})]})}),O?e.jsx(p,{children:e.jsx(y,{className:"p-0",children:e.jsx(Ie,{type:"server",error:O,onRetry:E})})}):V?e.jsx(p,{children:e.jsx(y,{className:"p-0",children:e.jsx(Pe,{rows:8,columns:9})})}):U.length===0?e.jsx(p,{children:e.jsx(y,{className:"p-0",children:e.jsx(ke,{type:j||v!=="all"||g!=="all"?"no-results":"no-data",title:j||v!=="all"||g!=="all"?"No requests found":"No requests yet",description:j||v!=="all"||g!=="all"?"Try adjusting your search or filters to find what you're looking for.":"Requests will appear here once employees submit them."})})}):e.jsx(e.Fragment,{children:e.jsx(p,{children:e.jsxs(Re,{children:[e.jsx(be,{children:e.jsxs(Z,{children:[e.jsx(x,{children:"Employee"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Start Date"}),e.jsx(x,{children:"End Date"}),e.jsx(x,{children:"Amount"}),e.jsx(x,{children:"Description"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Ce,{children:U.map(s=>{var l;return e.jsxs(Z,{children:[e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:k(s)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:(l=s.employee)==null?void 0:l.EmployeeCode})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[ue(s.RequestType),s.RequestType]})}),e.jsx(u,{children:T(s.RequestDate)}),e.jsx(u,{children:s.StartDate?T(s.StartDate):"N/A"}),e.jsx(u,{children:s.EndDate?T(s.EndDate):"N/A"}),e.jsx(u,{children:he(s.Amount)}),e.jsx(u,{children:e.jsx("div",{className:"max-w-xs truncate",title:s.Description,children:s.Description})}),e.jsx(u,{children:xe(s.Status)}),e.jsx(u,{className:"text-right",children:e.jsxs(ve,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Be,{className:"h-4 w-4"})})}),e.jsxs(we,{align:"end",children:[e.jsx(Ne,{children:"Actions"}),e.jsx(L,{}),e.jsxs(C,{onClick:()=>R(s,"view"),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"View Details"]}),s.Status==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsxs(C,{onClick:()=>R(s,"edit"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Edit Request"]}),e.jsx(L,{}),e.jsxs(C,{onClick:()=>R(s,"approve"),className:"text-green-600",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Approve"]}),e.jsxs(C,{onClick:()=>R(s,"reject"),className:"text-red-600",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Reject"]})]}),e.jsx(L,{}),e.jsxs(C,{onClick:()=>R(s,"delete"),className:"text-red-600",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},s.RequestID)})})]})})}),e.jsx(Ee,{open:ie,onOpenChange:D,children:e.jsxs(Te,{className:"sm:max-w-[425px]",children:[e.jsxs(qe,{children:[e.jsxs(Ae,{children:[a==="create"&&"New Request",a==="approve"&&"Approve Request",a==="reject"&&"Reject Request",a==="view"&&"View Request Details",a==="edit"&&"Edit Request",a==="delete"&&"Delete Request"]}),e.jsxs(Le,{children:[a==="create"&&"Create a new request",a==="approve"&&"Are you sure you want to approve this request?",a==="reject"&&"Are you sure you want to reject this request?",a==="view"&&"View the details of this request below.",a==="edit"&&"Edit the details of this request below.",a==="delete"&&"Are you sure you want to delete this request? This action cannot be undone."]})]}),e.jsx("div",{className:"grid gap-4 py-4",children:a==="create"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"requestType",children:"Request Type"}),e.jsxs(I,{value:t.RequestType,onValueChange:s=>f({...t,RequestType:s}),children:[e.jsx(P,{children:e.jsx(M,{placeholder:"Select request type"})}),e.jsxs(B,{children:[e.jsx(c,{value:"Leave",children:"Leave"}),e.jsx(c,{value:"Loan",children:"Loan"}),e.jsx(c,{value:"Sick Leave",children:"Sick Leave"}),e.jsx(c,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(ee,{id:"description",placeholder:"Enter request description...",value:t.Description||"",onChange:s=>f({...t,Description:s.target.value}),className:"min-h-[80px]",rows:3})]}),(t.RequestType==="Leave"||t.RequestType==="Sick Leave")&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"startDate",children:"Start Date"}),e.jsx(se,{date:t.StartDate?new Date(t.StartDate):void 0,onChange:s=>f({...t,StartDate:s?Q(s,"yyyy-MM-dd"):""})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"endDate",children:"End Date"}),e.jsx(se,{date:t.EndDate?new Date(t.EndDate):void 0,onChange:s=>f({...t,EndDate:s?Q(s,"yyyy-MM-dd"):""})})]})]})}),t.RequestType==="Loan"&&e.jsxs("div",{children:[e.jsx(h,{htmlFor:"amount",children:"Amount"}),e.jsx(Y,{id:"amount",type:"number",step:"0.01",placeholder:"Enter loan amount...",value:t.Amount||"",onChange:s=>f({...t,Amount:parseFloat(s.target.value)||null})})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Employee:"}),e.jsx("span",{children:k(o)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Type:"}),e.jsx("span",{children:o==null?void 0:o.RequestType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:T(o==null?void 0:o.RequestDate)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Description:"}),e.jsx("span",{className:"text-right max-w-48",children:o==null?void 0:o.Description})]}),(a==="approve"||a==="reject")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsxs(h,{htmlFor:"comments",className:"text-right",children:[a==="approve"?"Approval":"Rejection"," Comments"]}),e.jsx(ee,{id:"comments",placeholder:`Enter ${a==="approve"?"approval":"rejection"} comments...`,value:z,onChange:s=>S(s.target.value),className:"col-span-3",rows:3})]})]})}),e.jsxs(Fe,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>{D(!1),J("create"),f({RequestType:"Leave",Status:"Pending",Description:"",StartDate:"",EndDate:"",Amount:null}),S("")},children:a==="view"?"Close":"Cancel"}),a==="create"?e.jsx(A,{type:"submit",onClick:()=>pe(),className:"bg-blue-600 hover:bg-blue-700",children:"Create Request"}):a!=="view"&&e.jsxs(A,{type:"submit",onClick:()=>o&&me(o,a,z),className:a==="approve"?"bg-green-600 hover:bg-green-700":a==="reject"?"bg-red-600 hover:bg-red-700":a==="edit"?"bg-orange-600 hover:bg-orange-700":"bg-red-600 hover:bg-red-700",children:[a==="approve"&&"Approve Request",a==="reject"&&"Reject Request",a==="edit"&&"Save Changes",a==="delete"&&"Delete Request"]})]})]})})]})};export{xs as default};
