import{l as ie,aa as Xe,ap as It,r as y,j as e,aq as St,Q as ke,a3 as ut,b as Me,c as Pe,t as _e,B as N,d as ae,K as et,C as H,e as Q,f as X,F as Ee,g as L,k as oe,i as kt,h as xt,n as K,$ as B,o as $e,a5 as Ft,D as Et,S as Mt,ar as tt,y as at,z as st,G as rt,J as de,as as $t,a8 as Ae,at as Ht,W as _t,Y as Vt,au as Rt,a as se,a7 as zt,av as Lt,aw as me}from"./index-CkfjAkll.js";import{T as Be,a as Ue,b as le,c as nt}from"./tabs-QhraDKzC.js";import{T as Ve,a as Re,b as Z,c as O,d as ze,e as M}from"./table-V6Jm1CEI.js";import{a as S}from"./api-CfJ5uvZN.js";import{A as ht}from"./arrow-left-DRpoLo94.js";import{P as ge}from"./plus-CHlBUmpP.js";import{o as Le,n as re,d as ue,s as G,u as pt,t as yt,a as ve,b as qt,c as Bt}from"./types-Doi2yQ0A.js";import{I as $}from"./input-B3Ua0CpA.js";import{L as v}from"./label-20KB7TUv.js";import{T as Oe}from"./textarea-88mwUXv7.js";import{P as xe,b as he,c as pe,C as ye,i as Ut,f as Ot}from"./popover-mLtRudyP.js";import{u as ct}from"./useMutation-Cm0la9L0.js";import{S as je,a as Ce,b as fe,c as Ne,d as R}from"./select-Be1s5w90.js";import{S as te}from"./skeleton-DYNXBO9n.js";import{C as ce}from"./checkbox-oqvvbcak.js";import{D as jt,a as Ct,b as ft,c as Nt,d as gt,f as Kt}from"./dialog-Cc6rlESa.js";import{T as Te}from"./trash-2-B_w6iijv.js";import{C as Qt}from"./circle-check-CerQrW5n.js";import{F as Yt}from"./filter-D5i0eGsD.js";import{D as ot}from"./download-059FbxaT.js";import{E as lt}from"./eye-DFahpqzW.js";import{S as Jt}from"./square-pen-BFEZhky5.js";import{P as vt}from"./pencil-CcnYQj2G.js";import{C as Wt}from"./chevron-left-D_5HhcND.js";import{p as qe}from"./parseISO-B1tXpWBu.js";import{R as Gt}from"./ReportViewer-B57gVbQq.js";import"./getDaysInMonth-CYghVt_-.js";import"./index-BgCQi53_.js";import"./alert-CUgta5P-.js";import"./date-picker-CPPWb-3h.js";import"./loader-circle-D1D1vGyD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=ie("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=ie("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=ie("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=ie("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=ie("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=ie("FileType2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 13v-1h6v1",key:"1dh9dg"}],["path",{d:"M5 12v6",key:"150t9c"}],["path",{d:"M4 18h2",key:"1xrofg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=ie("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function ra(t,l){const s=Xe(t),d=Xe(l),D=dt(s,d),c=Math.abs(It(s,d));s.setDate(s.getDate()-D*c);const u=+(dt(s,d)===-D),h=D*(c-u);return h===0?0:h}function dt(t,l){const s=t.getFullYear()-l.getFullYear()||t.getMonth()-l.getMonth()||t.getDate()-l.getDate()||t.getHours()-l.getHours()||t.getMinutes()-l.getMinutes()||t.getSeconds()-l.getSeconds()||t.getMilliseconds()-l.getMilliseconds();return s<0?-1:s>0?1:s}const ee={getContracts:async(t={})=>{const l=t.page!==void 0?Math.max(0,t.page-1):0,s={sort:(t.sortOrder||"desc").toLowerCase(),pageSize:t.pageSize||10,page:l};return t.search&&(s.search=t.search),t.status&&(s.status=t.status),t.type&&(s.type=t.type),t.sortBy&&(s.sortBy=t.sortBy),await S.contract.list(s)},getContractById:async t=>{const l=await S.contract.get(t,{columns:"ContractID,EmployeeID,employees_FirstName,employees_LastName,ContractAmount,ContractDate,ContractStartDate,ContractEndDate,ContractNote,ContractType,ContractTitle,ContractStatus,ContractDescription,Status,CreatedAt,UpdatedAt,CreatedBy,UpdatedBy"}),s=await ee.getContractPayments(t),d=s.filter(T=>T.contractpaytype_IsAdd===1),D=s.filter(T=>T.contractpaytype_IsAdd===0),c=d.reduce((T,A)=>{const w=A.contractpaytype_IsHour===1?parseFloat(A.ContractPAmountHour)||0:parseFloat(A.ContractPAmount)||0;return T+w},0),u=D.reduce((T,A)=>{const w=A.contractpaytype_IsHour===1?parseFloat(A.ContractPAmountHour)||0:parseFloat(A.ContractPAmount)||0;return T+w},0),h=(parseFloat(l.ContractAmount)||0)+c-u;return{...l,payments:s,additions:d,deductions:D,totalAdditions:c,totalDeductions:u,netAmount:h}},createContract:async t=>S.contract.create(t),updateContract:async(t,l)=>S.contract.update(t,l),deleteContract:async t=>S.contract.delete(t),getContractPayments:async t=>(await S.list("contractp",{exact_filters:JSON.stringify({ContractID:t}),select_fields:"ContractPID,ContractID,ContractPayTypeID,ContractPAmount,ContractPAmountHour,ContractNote,contractpaytype_ContractPayTypeName,contractpaytype_IsAdd,contractpaytype_IsHour",sort:"ContractPID asc"})).data||[],addPayment:async t=>S.create("contractp",t),updatePayment:async(t,l)=>S.update("contractp",t,l),deletePayment:async t=>S.delete("contractp",t),getPaymentTypes:async()=>(await S.list("contractpaytype",{exact_filters:JSON.stringify({IsActive:!0}),sort:"ContractPayTypeName asc"})).data||[],getContractDocuments:async t=>(await S.list("contractdocument",{exact_filters:JSON.stringify({ContractID:t,IsActive:!0}),sort:"UploadedAt desc"})).data||[],uploadDocument:async t=>S.create("contractdocument",t),deleteDocument:async t=>S.update("contractdocument",t,{IsActive:!1}),getTemplates:async()=>(await S.list("contractstemplate",{exact_filters:JSON.stringify({IsActive:!0}),sort:"TemplateName asc"})).data||[],getTemplateById:async t=>S.get("contractstemplate",t),exportContracts:async(t="pdf",l)=>{var s,d;return(d=(s=S.contract).export)==null?void 0:d.call(s,t,l)},submitForApproval:async(t,l,s)=>S.contract.update(t,{Status:"pending_approval",SubmittedBy:l,Comments:s}),approveContract:async(t,l,s)=>S.contract.update(t,{Status:"active",ApprovedBy:l,ApprovalDate:new Date().toISOString(),Comments:s}),rejectContract:async(t,l,s)=>S.contract.update(t,{Status:"rejected",RejectedBy:l,RejectionDate:new Date().toISOString(),RejectionReason:s}),terminateContract:async(t,l,s,d)=>S.contract.update(t,{Status:"terminated",TerminatedBy:l,TerminationDate:s,TerminationReason:d})};var na="Separator",mt="horizontal",ca=["horizontal","vertical"],Dt=y.forwardRef((t,l)=>{const{decorative:s,orientation:d=mt,...D}=t,c=oa(d)?d:mt,h=s?{role:"none"}:{"aria-orientation":c==="vertical"?c:void 0,role:"separator"};return e.jsx(St.div,{"data-orientation":c,...h,...D,ref:l})});Dt.displayName=na;function oa(t){return ca.includes(t)}var wt=Dt;const Fe=y.forwardRef(({className:t,orientation:l="horizontal",decorative:s=!0,...d},D)=>e.jsx(wt,{ref:D,decorative:s,orientation:l,className:ke("shrink-0 bg-border",l==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...d}));Fe.displayName=wt.displayName;const la=()=>{const{id:t}=ut(),l=Me();y.useState("overview");const{data:s,isLoading:d,error:D}=Pe({queryKey:["contract",t],queryFn:()=>ee.getContractById(Number(t)),enabled:!!t}),c=f=>{if(!f)return"N/A";try{return K(new Date(f),"PPP")}catch{return f}},u=f=>{const p=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(p||0)};if(d)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})});if(D||!s)return e.jsxs("div",{className:"p-8 text-center bg-destructive/10 rounded-lg",children:[e.jsx(_e,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-destructive mb-2",children:"Error Loading Contract"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The contract details could not be retrieved."}),e.jsx(N,{onClick:()=>l("/contracts"),children:"Back to Contracts"})]});const h=s,T=h.ContractID||h.id,A=h.additions||[],w=h.deductions||[],j=h.totalAdditions||0,P=h.totalDeductions||0,q=h.netAmount||0;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-2",children:e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>l("/contracts"),className:"p-0 hover:bg-transparent",children:[e.jsx(ht,{className:"h-5 w-5 mr-1"}),"Back to Contracts"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Contract #",T]}),e.jsx(ae,{variant:h.ContractStatus==="Active"?"success":"outline",children:h.ContractStatus||"New"})]}),e.jsxs("p",{className:"text-muted-foreground flex items-center",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),h.employees_FirstName," ",h.employees_LastName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(N,{variant:"outline",onClick:()=>l(`/contracts/${T}/edit`),children:"Edit Contract"}),e.jsx(N,{children:"Download PDF"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(X,{className:"flex items-center",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2 text-primary"}),"Contract Overview"]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Base Salary"}),e.jsx("p",{className:"text-2xl font-bold",children:u(h.ContractAmount)})]}),e.jsx(Fe,{}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(oe,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Dates"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c(h.ContractStartDate)," - ",h.ContractEndDate?c(h.ContractEndDate):"Open Ended"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Contract Type"}),e.jsx("p",{className:"text-lg",children:h.ContractType||"Standard Employment"})]}),e.jsx(Fe,{}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(kt,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Status"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current Status: ",e.jsx("span",{className:"font-semibold text-foreground",children:h.ContractStatus||"New"})]})]})]})]})]}),h.ContractNote&&e.jsxs("div",{className:"mt-8 p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Administrative Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:h.ContractNote})]})]})]}),e.jsxs(Be,{defaultValue:"payments",className:"w-full",children:[e.jsxs(Ue,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(le,{value:"payments",children:"Financial Details"}),e.jsx(le,{value:"documents",children:"Documents"})]}),e.jsx(nt,{value:"payments",className:"space-y-4 mt-6",children:e.jsxs(H,{children:[e.jsxs(Q,{children:[e.jsx(X,{className:"text-lg",children:"Salary Components"}),e.jsx(xt,{children:"All additions and deductions related to this contract"})]}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center text-sm font-semibold text-green-600 mb-3",children:[e.jsx(Xt,{className:"h-4 w-4 mr-1"}),"Additions & Allowances"]}),e.jsxs(Ve,{children:[e.jsx(Re,{children:e.jsxs(Z,{children:[e.jsx(O,{children:"Type"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Hourly"}),e.jsx(O,{children:"Note"})]})}),e.jsx(ze,{children:A.length>0?A.map(f=>e.jsxs(Z,{children:[e.jsx(M,{className:"font-medium",children:f.contractpaytype_ContractPayTypeName}),e.jsxs(M,{className:"text-green-600",children:["+",u(f.ContractPAmount)]}),e.jsx(M,{children:f.ContractPAmountHour>0?u(f.ContractPAmountHour):"-"}),e.jsx(M,{className:"text-xs text-muted-foreground",children:f.ContractNote||"-"})]},f.ContractPID)):e.jsx(Z,{children:e.jsx(M,{colSpan:4,className:"text-center py-4 text-muted-foreground",children:"No additional payments"})})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center text-sm font-semibold text-red-600 mb-3",children:[e.jsx(Zt,{className:"h-4 w-4 mr-1"}),"Deductions"]}),e.jsxs(Ve,{children:[e.jsx(Re,{children:e.jsxs(Z,{children:[e.jsx(O,{children:"Type"}),e.jsx(O,{children:"Amount"}),e.jsx(O,{children:"Hourly"}),e.jsx(O,{children:"Note"})]})}),e.jsx(ze,{children:w.length>0?w.map(f=>e.jsxs(Z,{children:[e.jsx(M,{className:"font-medium",children:f.contractpaytype_ContractPayTypeName}),e.jsxs(M,{className:"text-red-600",children:["-",u(f.ContractPAmount)]}),e.jsx(M,{children:f.ContractPAmountHour>0?u(f.ContractPAmountHour):"-"}),e.jsx(M,{className:"text-xs text-muted-foreground",children:f.ContractNote||"-"})]},f.ContractPID)):e.jsx(Z,{children:e.jsx(M,{colSpan:4,className:"text-center py-4 text-muted-foreground",children:"No deductions"})})})]})]})]})})]})}),e.jsx(nt,{value:"documents",className:"mt-6",children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{className:"text-lg",children:"Contract Documents"})}),e.jsxs(L,{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(Ee,{className:"h-12 w-12 opacity-20 mb-2"}),e.jsx("p",{children:"No documents uploaded for this contract."}),e.jsxs(N,{variant:"outline",size:"sm",className:"mt-4",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Upload Document"]})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(H,{className:"bg-primary/5 border-primary/20",children:[e.jsx(Q,{children:e.jsx(X,{className:"text-lg",children:"Financial Summary"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Base Salary"}),e.jsx("span",{className:"font-medium",children:u(h.ContractAmount)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Additions"}),e.jsxs("span",{className:"text-green-600 font-medium",children:["+",u(j)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["-",u(P)]})]}),e.jsx(Fe,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold",children:"Net Salary"}),e.jsx("span",{className:"text-xl font-bold text-primary",children:u(q)})]})]})]}),e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{className:"text-lg",children:"Employee Info"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(et,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",children:[h.employees_FirstName," ",h.employees_LastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Employee ID: ",h.EmployeeID]})]})]}),e.jsx(N,{variant:"outline",className:"w-full",onClick:()=>l(`/employees/${h.EmployeeID}`),children:"View Employee Profile"})]})]})]})]})]})},ia=Le({ContractID:re(),EmployeeID:re().min(1,"Employee ID is required"),ContractAmount:re().min(0,"Amount must be positive"),ContractDate:ue(),ContractStartDate:ue(),ContractEndDate:ue(),ContractNote:G().optional()}),da=()=>{const{id:t}=ut(),[l,s]=y.useState(!1),[d,D]=y.useState(!0),[c,u]=y.useState([]),[h,T]=y.useState([]),A=Me(),w=pt({resolver:yt(ia),defaultValues:{ContractID:0,EmployeeID:0,ContractAmount:0,ContractDate:new Date,ContractStartDate:new Date,ContractEndDate:new Date,ContractNote:""}}),j=n=>{const a=typeof n=="string"?parseFloat(n):n;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a||0)},P=n=>n.contractpaytype_IsHour?n.ContractPAmountHour||0:n.ContractPAmount||0,q=y.useMemo(()=>h.filter(n=>n.contractpaytype_IsAdd===1),[h]),f=y.useMemo(()=>h.filter(n=>n.contractpaytype_IsAdd===0),[h]),p=y.useMemo(()=>{const n=h.find(i=>i.ContractPayTypeID==1),a=n?parseFloat(P(n)):0;return isNaN(a)?0:a},[h]),b=y.useMemo(()=>q.filter(n=>n.ContractPayTypeID!=1).reduce((n,a)=>n+(parseFloat(P(a))||0),0),[q]),U=y.useMemo(()=>f.reduce((n,a)=>n+(parseFloat(P(a))||0),0),[f]),E=y.useMemo(()=>p+b-U,[p,b,U]);y.useEffect(()=>{(async()=>{if(t)try{D(!0);const i=(await S.contract.get(parseInt(t))).data;i&&w.reset({ContractID:i.ContractID,EmployeeID:i.EmployeeID,ContractAmount:parseFloat(i.ContractAmount)||0,ContractDate:i.ContractDate?new Date(i.ContractDate):new Date,ContractStartDate:i.ContractStartDate?new Date(i.ContractStartDate):new Date,ContractEndDate:i.ContractEndDate?new Date(i.ContractEndDate):new Date,ContractNote:i.ContractNote||""});const o=await S.list("contractp",{exact_filters:{ContractID:parseInt(t)},sort:"ContractPID:asc",pageSize:200});Array.isArray(o.data)&&T(o.data);const x=await S.list("contractpaytype",{pageSize:100});Array.isArray(x.data)&&u(x.data)}catch(a){console.error("Error fetching data:",a),B.error("Failed to load contract data.")}finally{D(!1)}})()},[t,w]);const Y=async n=>{try{s(!0);const a={EmployeeID:n.EmployeeID,ContractAmount:n.ContractAmount,ContractDate:K(n.ContractDate,"yyyy-MM-dd"),ContractStartDate:K(n.ContractStartDate,"yyyy-MM-dd"),ContractEndDate:K(n.ContractEndDate,"yyyy-MM-dd"),ContractNote:n.ContractNote};await S.contract.update(n.ContractID,a),B.success("Contract updated successfully"),A("/contracts")}catch(a){console.error("Error updating contract:",a),B.error("Failed to update contract.")}finally{s(!1)}};return d?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(N,{variant:"ghost",className:"w-fit p-0 hover:bg-transparent",onClick:()=>A(-1),children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"Back to Contracts"]}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Edit Contract #",t]})]}),e.jsxs("form",{onSubmit:w.handleSubmit(Y),className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{children:"Contract Information"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ContractAmount",children:"Base Salary Amount"}),e.jsx($,{id:"ContractAmount",type:"number",step:"0.01",...w.register("ContractAmount",{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Contract Date"}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:ke("w-full justify-start text-left font-normal",!w.watch("ContractDate")&&"text-muted-foreground"),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),w.watch("ContractDate")?K(w.watch("ContractDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(ye,{mode:"single",selected:w.watch("ContractDate"),onSelect:n=>w.setValue("ContractDate",n||new Date),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Start Date"}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:ke("w-full justify-start text-left font-normal"),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),w.watch("ContractStartDate")?K(w.watch("ContractStartDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(ye,{mode:"single",selected:w.watch("ContractStartDate"),onSelect:n=>w.setValue("ContractStartDate",n||new Date),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"End Date"}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:ke("w-full justify-start text-left font-normal"),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),w.watch("ContractEndDate")?K(w.watch("ContractEndDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(ye,{mode:"single",selected:w.watch("ContractEndDate"),onSelect:n=>w.setValue("ContractEndDate",n||new Date),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ContractNote",children:"Notes"}),e.jsx(Oe,{id:"ContractNote",...w.register("ContractNote")})]})]})]}),e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{children:"Financial Summary"})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Base Salary"}),e.jsx("span",{children:j(p)})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Total Additions"}),e.jsxs("span",{children:["+",j(b)]})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"Total Deductions"}),e.jsxs("span",{children:["-",j(U)]})]}),e.jsxs("div",{className:"pt-4 border-t flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Net Amount"}),e.jsx("span",{children:j(E)})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>A(-1),children:"Cancel"}),e.jsx(N,{type:"submit",disabled:l,children:l?"Saving...":"Update Contract"})]})]})]})},ma=Le({ContractTemplate:G().optional(),EmployeeID:G().min(1,"Employee ID is required"),ContractAmount:ve([G(),re()]).transform(t=>typeof t=="string"?parseFloat(t)||0:t),ContractDate:ue(),ContractStartDate:ue(),ContractEndDate:ue(),ContractNote:G().optional(),payments:qt(Le({ContractPayTypeID:G().min(1,"Payment type is required"),ContractPAmount:ve([G(),re()]).transform(t=>typeof t=="string"?parseFloat(t)||0:t),ContractPAmountHour:ve([G(),re()]).optional().transform(t=>typeof t=="string"?parseFloat(t)||0:t),ContractNote:G().optional(),Hours:ve([G(),re()]).optional().transform(t=>typeof t=="string"?parseFloat(t)||0:t),Multiplier:ve([G(),re()]).optional().transform(t=>typeof t=="string"?parseFloat(t)||1:t)})).min(1,"At least one payment is required")}),Pt=({open:t,onOpenChange:l,onSuccess:s})=>{const[d,D]=y.useState(!1),c=pt({resolver:yt(ma),defaultValues:{ContractDate:new Date,ContractStartDate:new Date,ContractEndDate:new Date(new Date().setFullYear(new Date().getFullYear()+1)),payments:[{ContractPayTypeID:"",ContractPAmount:0,ContractPAmountHour:0,ContractNote:"",Hours:0,Multiplier:0}]}}),{fields:u,append:h,remove:T,replace:A}=Bt({control:c.control,name:"payments"}),{data:w=[],isLoading:j}=Pe({queryKey:["employees","withoutContract"],queryFn:()=>S.list("employees",{hasContract:!1}).then(n=>n.data||[])}),P=y.useMemo(()=>{const n=new Set;return w.filter(a=>n.has(a.EmployeeID)?!1:(n.add(a.EmployeeID),!0))},[w]),{data:q=[]}=Pe({queryKey:["contractpaytype"],queryFn:()=>ee.getPaymentTypes()}),f=y.useMemo(()=>{const n=new Set;return q.filter(a=>n.has(a.ContractPayTypeID)?!1:(n.add(a.ContractPayTypeID),!0))},[q]),{data:p=[]}=Pe({queryKey:["contractstemplate"],queryFn:()=>ee.getTemplates()}),b=y.useMemo(()=>{const n=new Set;return p.filter(a=>n.has(a.ContractTemplateID)?!1:(n.add(a.ContractTemplateID),!0))},[p]),U=y.useCallback((n,a,i)=>{var g,k,r,I;const x=c.getValues("payments")[n],C=f.find(z=>z.ContractPayTypeID.toString()===x.ContractPayTypeID);if(C){if((C.ContractPayTypeName.includes("Delay Deduct")||C.ContractPayTypeName.includes("Absent Deduct"))&&(a==="Hours"||a==="ContractPAmountHour")){const z=a==="Hours"?parseFloat(i)||0:parseFloat(((g=x.Hours)==null?void 0:g.toString())||"0")||0,J=a==="ContractPAmountHour"?parseFloat(i)||0:parseFloat(((k=x.ContractPAmountHour)==null?void 0:k.toString())||"0")||0;c.setValue(`payments.${n}.Hours`,z),c.setValue(`payments.${n}.ContractPAmount`,z*J)}if(C.ContractPayTypeName.includes("Overtime")&&(a==="Multiplier"||a==="ContractPAmountHour")){const z=a==="Multiplier"?parseFloat(i)||1:parseFloat(((r=x.Multiplier)==null?void 0:r.toString())||"1")||1,J=a==="ContractPAmountHour"?parseFloat(i)||0:parseFloat(((I=x.ContractPAmountHour)==null?void 0:I.toString())||"0")||0;c.setValue(`payments.${n}.Multiplier`,z),c.setValue(`payments.${n}.ContractPAmount`,J*z)}}},[c,f]),E=y.useCallback(async n=>{const a=b.find(i=>{var o;return((o=i.ContractTemplateID)==null?void 0:o.toString())===n});if(a){c.setValue("ContractAmount",parseFloat(a.ContractAmount)||0);const i=new Date;if(c.setValue("ContractStartDate",i),a.ContractDurationDays){const o=new Date(i);o.setDate(i.getDate()+a.ContractDurationDays),c.setValue("ContractEndDate",o)}try{const o=await S.list("contracttemplatepaytype",{exact_filters:{ContractTemplateID:n}});if(Array.isArray(o.data)&&o.data.length>0){const x=o.data.map(C=>({ContractPayTypeID:C.ContractPayTypeID.toString(),ContractPAmount:parseFloat(C.ContractPAmount)||0,ContractPAmountHour:parseFloat(C.ContractPAmountHour)||0,ContractNote:C.ContractNote||"",Hours:0,Multiplier:1}));A(x)}}catch(o){console.error("Error fetching template pay types:",o)}}},[b,c,A]),Y=async n=>{try{D(!0);const a={EmployeeID:parseInt(n.EmployeeID),ContractAmount:parseFloat(n.ContractAmount.toString())||0,ContractDate:K(n.ContractDate,"yyyy-MM-dd"),ContractStartDate:K(n.ContractStartDate,"yyyy-MM-dd"),ContractEndDate:K(n.ContractEndDate,"yyyy-MM-dd"),ContractNote:n.ContractNote,ContractStatus:"New"},i=await S.contract.create(a),o=i.ContractID||i.id;if(!o)throw new Error("Failed to get ContractID from response");for(const x of n.payments)await S.create("contractp",{ContractID:o,ContractPayTypeID:parseInt(x.ContractPayTypeID),ContractPAmount:parseFloat(x.ContractPAmount.toString())||0,ContractPAmountHour:parseFloat(x.ContractPAmountHour.toString())||0,ContractNote:x.ContractNote||""});B.success("Contract created successfully"),s==null||s(),l(!1),c.reset()}catch(a){console.error("Failed to create contract:",a),B.error("Failed to create contract")}finally{D(!1)}};return e.jsx(jt,{open:t,onOpenChange:l,children:e.jsxs(Ct,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ft,{children:[e.jsx(Nt,{children:"Create New Contract"}),e.jsx(gt,{children:"Create a new employment contract for an employee"})]}),e.jsxs("form",{onSubmit:c.handleSubmit(Y),className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{className:"text-lg text-primary",children:"Contract Details"})}),e.jsx(L,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"EmployeeID",children:"Employee"}),e.jsxs(je,{value:c.watch("EmployeeID"),onValueChange:n=>c.setValue("EmployeeID",n),children:[e.jsx(Ce,{id:"EmployeeID",className:c.formState.errors.EmployeeID?"border-destructive":"",children:e.jsx(fe,{placeholder:j?"Loading employees...":"Select an employee"})}),e.jsx(Ne,{children:P.map(n=>e.jsxs(R,{value:n.EmployeeID.toString(),children:[n.FirstName," ",n.LastName," (",n.EmployeeCode,")"]},n.EmployeeID))})]}),c.formState.errors.EmployeeID&&e.jsx("p",{className:"text-sm text-destructive",children:c.formState.errors.EmployeeID.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ContractTemplate",children:"Contract Template"}),e.jsxs(je,{value:c.watch("ContractTemplate"),onValueChange:n=>{c.setValue("ContractTemplate",n),E(n)},children:[e.jsx(Ce,{id:"ContractTemplate",children:e.jsx(fe,{placeholder:"Select a template"})}),e.jsx(Ne,{children:b.map(n=>e.jsx(R,{value:n.ContractTemplateID.toString(),children:n.TemplateName},n.ContractTemplateID))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ContractAmount",children:"Base Salary Amount"}),e.jsx($,{id:"ContractAmount",type:"number",step:"0.01",...c.register("ContractAmount",{valueAsNumber:!0}),className:c.formState.errors.ContractAmount?"border-destructive":""}),c.formState.errors.ContractAmount&&e.jsx("p",{className:"text-sm text-destructive",children:c.formState.errors.ContractAmount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Contract Date"}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),c.watch("ContractDate")?K(c.watch("ContractDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(ye,{mode:"single",selected:c.watch("ContractDate"),onSelect:n=>c.setValue("ContractDate",n||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Start Date"}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),c.watch("ContractStartDate")?K(c.watch("ContractStartDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(ye,{mode:"single",selected:c.watch("ContractStartDate"),onSelect:n=>c.setValue("ContractStartDate",n||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"End Date"}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),c.watch("ContractEndDate")?K(c.watch("ContractEndDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(ye,{mode:"single",selected:c.watch("ContractEndDate"),onSelect:n=>c.setValue("ContractEndDate",n||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(v,{htmlFor:"ContractNote",children:"Notes"}),e.jsx(Oe,{id:"ContractNote",...c.register("ContractNote"),className:"min-h-[80px]",placeholder:"Any additional notes about this contract"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Payment Items"}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:()=>h({ContractPayTypeID:"",ContractPAmount:0,ContractPAmountHour:0,ContractNote:"",Hours:0,Multiplier:1}),children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),u.map((n,a)=>{var g,k,r;const i=c.watch(`payments.${a}`),o=f.find(I=>I.ContractPayTypeID.toString()===(i==null?void 0:i.ContractPayTypeID)),x=((g=o==null?void 0:o.ContractPayTypeName)==null?void 0:g.includes("Delay Deduct"))||((k=o==null?void 0:o.ContractPayTypeName)==null?void 0:k.includes("Absent Deduct")),C=(r=o==null?void 0:o.ContractPayTypeName)==null?void 0:r.includes("Overtime");return e.jsx(H,{children:e.jsx(L,{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-5 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Payment Type"}),e.jsxs(je,{onValueChange:I=>c.setValue(`payments.${a}.ContractPayTypeID`,I),value:c.watch(`payments.${a}.ContractPayTypeID`),children:[e.jsx(Ce,{children:e.jsx(fe,{placeholder:"Type"})}),e.jsx(Ne,{className:"max-h-60",children:f.map(I=>e.jsxs(R,{value:I.ContractPayTypeID.toString(),children:[I.ContractPayTypeName," ",I.IsAdd===1?"(+)":"(-)"]},I.ContractPayTypeID))})]})]}),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Hours"}),e.jsx($,{...c.register(`payments.${a}.Hours`),onChange:I=>U(a,"Hours",I.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Amount"}),e.jsx($,{...c.register(`payments.${a}.ContractPAmount`),disabled:!0,className:"bg-muted"})]})]}):C?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Multiplier"}),e.jsx($,{...c.register(`payments.${a}.Multiplier`),onChange:I=>U(a,"Multiplier",I.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Amount"}),e.jsx($,{...c.register(`payments.${a}.ContractPAmount`),disabled:!0,className:"bg-muted"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Amount"}),e.jsx($,{...c.register(`payments.${a}.ContractPAmount`)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Hourly Rate (Optional)"}),e.jsx($,{...c.register(`payments.${a}.ContractPAmountHour`),onChange:I=>U(a,"ContractPAmountHour",I.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(v,{children:"Note"}),e.jsx($,{...c.register(`payments.${a}.ContractNote`)})]}),e.jsx(N,{type:"button",variant:"ghost",size:"icon",className:"text-destructive mb-0.5",onClick:()=>T(a),disabled:u.length===1,children:e.jsx(Te,{className:"h-4 w-4"})})]})]})})},n.id)})]}),e.jsxs(Kt,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>l(!1),disabled:d,children:"Cancel"}),e.jsx(N,{type:"submit",disabled:d,children:d?"Saving...":"Create Contract"})]})]})]})})},be=10,Ie=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),De=(t,l="MMM dd, yyyy")=>{if(!t)return"N/A";try{return K(qe(t),l)}catch{return"Invalid date"}},we=t=>{const l=new Date,s=t.ContractEndDate?qe(t.ContractEndDate):null,d=t.ContractStartDate?qe(t.ContractStartDate):null;if(!s||!d)return{label:"Draft",variant:"outline"};if(Ut(l,d))return{label:"Upcoming",variant:"secondary"};if(Ot(l,s))return{label:"Expired",variant:"destructive"};const D=ra(s,l);return D<=30?{label:`Expires in ${D} days`,variant:"warning"}:{label:"Active",variant:"success"}},ua=()=>{var Qe,Ye;const{t,i18n:l}=$e();l.dir();const s=Me(),d=Ft(),[D,c]=y.useState(""),[u,h]=y.useState("all"),[T,A]=y.useState("all"),[w,j]=y.useState({}),[P,q]=y.useState(1),[f,p]=y.useState("ContractStartDate"),[b,U]=y.useState("desc"),[E,Y]=y.useState([]),[n,a]=y.useState({}),[i,o]=y.useState(!1),{data:x,isLoading:C,error:g,refetch:k}=Pe({queryKey:["contract",{page:P,search:D,status:u,type:T,sortBy:f,sortOrder:b}],queryFn:()=>ee.getContracts({page:P,pageSize:be,search:D,status:u!=="all"?[u]:void 0,type:T!=="all"?[T]:void 0,sortBy:f,sortOrder:b==="asc"?"asc":"desc"}),placeholderData:m=>m}),r=x,I=y.useMemo(()=>{if(!x)return{totalContracts:0,activeContracts:0,total:0,active:0,expiringSoon:0,expiring30:0,terminated:0,avgAmount:0};const m=Array.isArray(r)?r:(r==null?void 0:r.data)||[],F=Array.isArray(r)?r.length:(r==null?void 0:r.total)||0,_=new Date;new Date().setDate(_.getDate()+30);let W=0,Je=0,We=0,Ge=0;return m.forEach(Ze=>{const He=we(Ze);He.label==="Active"&&W++,He.variant==="destructive"&&We++,He.variant==="warning"&&Je++;const bt=parseFloat(Ze.ContractAmount)||0;Ge+=bt}),{total:F,active:W,expiringSoon:Je,terminated:We,avgAmount:F>0?Ge/F:0}},[r]);ct({mutationFn:ee.deleteContract,onSuccess:()=>{d.invalidateQueries({queryKey:["contracts"]}),d.invalidateQueries({queryKey:["contract-stats"]}),B.success(t("common.success"))},onError:m=>{B.error(`${t("common.error")}: ${m.message}`)}});const z=ct({mutationFn:m=>ee.exportContracts(m),onSuccess:(m,F)=>{const _=new Blob([m],{type:`application/${F}`}),V=window.URL.createObjectURL(_),W=document.createElement("a");W.href=V,W.download=`contracts-${new Date().toISOString().split("T")[0]}.${F}`,document.body.appendChild(W),W.click(),window.URL.revokeObjectURL(V),document.body.removeChild(W),B.success(`Exported contracts as ${F.toUpperCase()}`)},onError:m=>{B.error(`Error exporting contracts: ${m.message}`)}}),J=m=>{f===m?U(b==="asc"?"desc":"asc"):(p(m),U("desc"))},Ke=()=>{var m;E.length===(Array.isArray(r)?r.length:((m=r==null?void 0:r.data)==null?void 0:m.length)||0)?Y([]):Y((Array.isArray(r)?r:(r==null?void 0:r.data)||[]).map(F=>F.ContractID)||[])},Tt=(m,F)=>{Y(F?_=>[..._,m]:_=>_.filter(V=>V!==m))},At=m=>{a(F=>({...F,[m]:!F[m]}))},ne=y.useMemo(()=>!r||Array.isArray(r)?1:Math.ceil((r.total||0)/(r.pageSize||be)),[r]);return C?e.jsxs("div",{className:"container mx-auto py-2 space-y-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((m,F)=>e.jsxs(H,{children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(te,{className:"h-4 w-24"}),e.jsx(te,{className:"h-4 w-4"})]}),e.jsx(L,{children:e.jsx(te,{className:"h-8 w-16"})})]},F))}),e.jsx(H,{children:e.jsx(Q,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[e.jsx(te,{className:"h-10 w-full md:w-1/3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{className:"h-10 w-32"}),e.jsx(te,{className:"h-10 w-24"})]})]})})}),e.jsx(H,{children:e.jsx(L,{className:"p-0",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(te,{className:"h-8 w-48"}),e.jsx(te,{className:"h-8 w-24"})]}),[...Array(5)].map((m,F)=>e.jsx(te,{className:"h-16 w-full"},F))]})})})]}):e.jsxs("div",{className:"h-full flex flex-col gap-3 overflow-hidden",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-2 lg:grid-cols-4 flex-shrink-0 pt-2",children:[e.jsx(Se,{title:t("contracts.stats.total"),value:I.total.toString(),icon:e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(Se,{title:t("contracts.stats.active"),value:I.active.toString(),icon:e.jsx(Qt,{className:"h-4 w-4 text-muted-foreground"}),variant:"success"}),e.jsx(Se,{title:t("contracts.stats.expiringSoon"),value:I.expiringSoon.toString(),icon:e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"}),variant:"warning"}),e.jsx(Se,{title:t("contracts.stats.totalValue"),value:Ie(I.avgAmount),icon:e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),variant:"accent"})]}),e.jsx(H,{className:"flex-shrink-0 pt-2",children:e.jsx(Q,{className:"pb-3 py-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(v,{htmlFor:"search",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground rtl:left-auto rtl:right-3"}),e.jsx($,{id:"search",placeholder:t("contracts.filters.searchPlaceholder"),className:"ps-10",value:D,onChange:m=>c(m.target.value)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(je,{value:u,onValueChange:h,children:[e.jsxs(Ce,{className:"w-[180px]",children:[e.jsx(Yt,{className:"me-2 h-4 w-4"}),e.jsx(fe,{placeholder:t("contracts.table.status")})]}),e.jsxs(Ne,{children:[e.jsx(R,{value:"all",children:t("contracts.filters.allStatuses")}),e.jsx(R,{value:"active",children:t("contracts.status.active")}),e.jsx(R,{value:"expired",children:t("contracts.status.expired")}),e.jsx(R,{value:"upcoming",children:t("contracts.status.upcoming")}),e.jsx(R,{value:"draft",children:t("contracts.status.draft")})]})]}),e.jsxs(N,{variant:"outline",onClick:()=>{c(""),h("all"),A("all"),j({})},children:[e.jsx(tt,{className:"me-2 h-4 w-4"}),t("contracts.filters.reset")]})]})]})})}),e.jsxs(H,{className:"flex flex-col min-h-[300px] flex-1 pt-2",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"select-all",checked:E.length>0&&E.length===(Array.isArray(r)?r.length:((Qe=r==null?void 0:r.data)==null?void 0:Qe.length)||0),onCheckedChange:Ke,className:"h-4 w-4"}),e.jsx(v,{htmlFor:"select-all",className:"text-sm font-medium",children:E.length>0?`${E.length} ${t("contracts.table.selected")}`:t("contracts.table.selectAll")}),E.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(N,{variant:"ghost",size:"sm",className:"h-8",onClick:()=>{B.info("Bulk action triggered")},children:[e.jsx(ot,{className:"me-2 h-4 w-4"}),t("contracts.table.exportSelected")]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"h-8 text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>{confirm(t("common.confirmDelete"))&&Promise.all(E.map(m=>ee.deleteContract(m))).then(()=>{d.invalidateQueries({queryKey:["contracts"]}),d.invalidateQueries({queryKey:["contract-stats"]}),Y([]),B.success(t("common.success"))}).catch(m=>{B.error(`${t("common.error")}: ${m.message}`)})},children:[e.jsx(Te,{className:"me-2 h-4 w-4"}),t("common.delete")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(N,{variant:"outline",size:"sm",className:"h-8",onClick:()=>k(),disabled:C,children:[e.jsx(tt,{className:`me-2 h-4 w-4 ${C?"animate-spin":""}`}),t("common.refresh")]}),e.jsxs(at,{children:[e.jsx(st,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(ot,{className:"mr-2 h-4 w-4"}),"Export"]})}),e.jsxs(rt,{align:"end",children:[e.jsxs(de,{onClick:()=>z.mutate("pdf"),children:[e.jsx(aa,{className:"me-2 h-4 w-4"}),t("common.exportPdf")]}),e.jsxs(de,{onClick:()=>z.mutate("excel"),children:[e.jsx(it,{className:"me-2 h-4 w-4"}),t("common.exportExcel")]}),e.jsxs(de,{onClick:()=>z.mutate("csv"),children:[e.jsx(it,{className:"me-2 h-4 w-4"}),t("common.exportCsv")]})]})]})]})]}),e.jsx($t,{className:"flex-1 min-h-[200px]",children:e.jsxs(Ve,{children:[e.jsx(Re,{className:"bg-muted/50",children:e.jsxs(Z,{children:[e.jsx(O,{className:"w-12",children:e.jsx(ce,{id:"select-all-header",checked:E.length>0&&E.length===(Array.isArray(r)?r.length:((Ye=r==null?void 0:r.data)==null?void 0:Ye.length)||0),onCheckedChange:Ke,className:"h-4 w-4"})}),e.jsx(O,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>J("employees_LastName"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.employee"),f==="employees_LastName"&&e.jsx(Ae,{className:`ms-1 h-4 w-4 ${b==="desc"?"rotate-180":""}`})]})}),e.jsx(O,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>J("ContractAmount"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.amount"),f==="ContractAmount"&&e.jsx(Ae,{className:`ms-1 h-4 w-4 ${b==="desc"?"rotate-180":""}`})]})}),e.jsx(O,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>J("ContractStartDate"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.startDate"),f==="ContractStartDate"&&e.jsx(Ae,{className:`ms-1 h-4 w-4 ${b==="desc"?"rotate-180":""}`})]})}),e.jsx(O,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>J("ContractEndDate"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.endDate"),f==="ContractEndDate"&&e.jsx(Ae,{className:`ms-1 h-4 w-4 ${b==="desc"?"rotate-180":""}`})]})}),e.jsx(O,{children:t("contracts.table.status")}),e.jsx(O,{className:"text-end",children:t("contracts.table.actions")})]})}),e.jsx(ze,{children:g?e.jsx(Z,{children:e.jsx(M,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-destructive",children:[e.jsx(_e,{className:"h-8 w-8"}),e.jsx("p",{children:t("contracts.errorLoading")}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>k(),children:t("common.retry")})]})})}):!r||Array.isArray(r)&&r.length===0||!Array.isArray(r)&&(!r.data||r.data.length===0)?e.jsx(Z,{children:e.jsx(M,{colSpan:8,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx(Ee,{className:"h-12 w-12 opacity-20"}),e.jsx("p",{className:"text-lg font-medium",children:t("contracts.noContractsFound")}),e.jsx("p",{className:"text-sm",children:t("contracts.noContractsFoundDesc")}),e.jsxs(N,{variant:"outline",className:"mt-4",onClick:()=>o(!0),children:[e.jsx(ge,{className:"me-2 h-4 w-4"}),t("contracts.add")]})]})})}):(Array.isArray(r)?r:(r==null?void 0:r.data)||[]).map(m=>{var F,_;return e.jsxs(Ht.Fragment,{children:[e.jsxs(Z,{className:`${n[m.ContractID]?"bg-muted/20":""} hover:bg-muted/10`,onClick:()=>At(m.ContractID),children:[e.jsx(M,{onClick:V=>V.stopPropagation(),children:e.jsx(ce,{checked:E.includes(m.ContractID),onCheckedChange:V=>Tt(m.ContractID,!!V),onClick:V=>V.stopPropagation(),className:"h-4 w-4"})}),e.jsxs(M,{children:[e.jsxs("div",{className:"font-medium",children:[m.employees_FirstName," ",m.employees_LastName]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",m.EmployeeID]})]}),e.jsx(M,{children:Ie(m.ContractAmount)}),e.jsx(M,{children:De(m.ContractStartDate)}),e.jsx(M,{children:De(m.ContractEndDate)}),e.jsx(M,{children:e.jsx(ae,{variant:we(m).variant,className:"capitalize",children:we(m).label})}),e.jsx(M,{className:"text-end",children:e.jsxs(at,{children:[e.jsx(st,{asChild:!0,children:e.jsxs(N,{variant:"ghost",size:"icon",onClick:V=>V.stopPropagation(),children:[e.jsx(ta,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:t("contracts.table.actions")})]})}),e.jsxs(rt,{align:"end",children:[e.jsxs(de,{onClick:()=>s(`/contracts/${m.ContractID}`),children:[e.jsx(lt,{className:"me-2 h-4 w-4"}),t("common.view")]}),e.jsxs(de,{onClick:()=>s(`/contracts/${m.ContractID}/edit`),children:[e.jsx(Jt,{className:"me-2 h-4 w-4"}),t("common.edit")]}),e.jsxs(de,{className:"text-destructive",onClick:V=>{V.stopPropagation(),confirm(t("common.confirmDelete"))&&ee.deleteContract(m.ContractID).then(()=>{d.invalidateQueries({queryKey:["contracts"]}),d.invalidateQueries({queryKey:["contract-stats"]}),B.success(t("common.success"))}).catch(W=>{B.error(`${t("common.error")}: ${W.message}`)})},children:[e.jsx(Te,{className:"me-2 h-4 w-4"}),t("common.delete")]})]})]})})]}),n[m.ContractID]&&e.jsx(Z,{className:"hover:bg-muted/30",children:e.jsx(M,{colSpan:8,className:"px-6 py-0 border-t-0",children:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.contractInfo")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.id"),":"]})," ",m.ContractID]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.type"),":"]})," ",m.ContractType||"N/A"]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.status"),":"]})," ",e.jsx(ae,{variant:we(m).variant,className:"capitalize",children:we(m).label})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.dates")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.created"),":"]})," ",De(m.ContractDate)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.startDate"),":"]})," ",De(m.ContractStartDate)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.endDate"),":"]})," ",De(m.ContractEndDate)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.financials")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.amount"),":"]})," ",Ie(m.ContractAmount)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.payments"),":"]})," ",((F=m.payments)==null?void 0:F.length)||0]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.totalPaid"),":"]})," ",Ie(((_=m.payments)==null?void 0:_.reduce((V,W)=>V+W.ContractPAmount,0))||0)]})]})]})]}),m.ContractNote&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.notes")}),e.jsx("p",{className:"text-sm",children:m.ContractNote})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(N,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px]",onClick:()=>s(`/contracts/${m.ContractID}`),"aria-label":t("contracts.viewDetails"),children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px]",onClick:()=>s(`/contracts/${m.ContractID}/edit`),"aria-label":t("contracts.edit"),children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px] text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>{confirm(t("common.confirmDelete"))&&ee.deleteContract(m.ContractID).then(()=>{d.invalidateQueries({queryKey:["contract"]}),d.invalidateQueries({queryKey:["contract-stats"]}),B.success(t("common.success"))}).catch(V=>{B.error(`${t("common.error")}: ${V.message}`)})},"aria-label":t("contracts.delete"),children:e.jsx(Te,{className:"h-4 w-4"})})]})]})})})]},m.ContractID)})})]})}),!Array.isArray(x)&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-medium",children:(((r==null?void 0:r.page)||1)-1)*((r==null?void 0:r.pageSize)||be)+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(((r==null?void 0:r.page)||1)*((r==null?void 0:r.pageSize)||be),(r==null?void 0:r.total)||0)})," ","of ",e.jsx("span",{className:"font-medium",children:(r==null?void 0:r.total)||0})," contracts"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>q(m=>Math.max(m-1,1)),disabled:P===1||C,children:[e.jsx(Wt,{className:"h-4 w-4 rtl:rotate-180"}),e.jsx("span",{className:"ms-1",children:t("common.previous")})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,ne)},(m,F)=>{let _;return ne<=5||P<=3?_=F+1:P>=ne-2?_=ne-4+F:_=P-2+F,e.jsx(N,{variant:_===P?"default":"outline",size:"sm",className:"w-10 h-10 p-0",onClick:()=>q(_),disabled:C,children:_},_)})}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>q(m=>Math.min(m+1,ne)),disabled:P===ne||C||ne===0,children:[e.jsx("span",{className:"me-1",children:t("common.next")}),e.jsx(_t,{className:"h-4 w-4 rtl:rotate-180"})]})]})]})]}),e.jsx(Pt,{open:i,onOpenChange:o,onSuccess:()=>k()})]})},Se=({title:t,value:l,icon:s,variant:d="default"})=>{const D={default:"bg-background",success:"bg-green-50 dark:bg-green-900/20",warning:"bg-yellow-50 dark:bg-yellow-900/20",destructive:"bg-red-50 dark:bg-red-900/20",accent:"bg-blue-50 dark:bg-blue-900/20"},c={default:"text-foreground",success:"text-green-600 dark:text-green-400",warning:"text-yellow-600 dark:text-yellow-400",destructive:"text-red-600 dark:text-red-400",accent:"text-blue-600 dark:text-blue-400"};return e.jsx(H,{className:`${D[d]} transition-colors`,children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("h3",{className:`text-2xl font-bold ${c[d]}`,children:typeof l=="number"?l.toLocaleString():l})]}),e.jsx("div",{className:`rounded-full p-2 ${c[d]} bg-opacity-20 ${D[d]}`,children:s})]})})})};function xa(){const t=Vt(),l=Me(),[s,d]=y.useState(!1),{t:D,i18n:c}=$e(),u=c.dir()==="rtl",h=t.pathname.endsWith("/reports")?"reports":t.pathname.endsWith("/templates")?"templates":"overview";return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-130px)]",children:[e.jsxs("div",{className:"flex-shrink-0 space-y-2 pt-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:D("contracts.title")}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 pt-2",children:[e.jsx(Be,{value:h,onValueChange:T=>{T==="overview"?l("/contracts"):T==="reports"?l("/contracts/reports"):T==="templates"&&l("/contracts/templates")},dir:u?"rtl":"ltr",children:e.jsxs(Ue,{children:[e.jsx(le,{value:"overview",children:D("contracts.tabs.overview")}),e.jsx(le,{value:"templates",children:D("contracts.tabs.templates")}),e.jsx(le,{value:"reports",children:D("contracts.tabs.reports")})]})}),h==="overview"&&e.jsxs(N,{onClick:()=>d(!0),children:[e.jsx(ge,{className:"me-2 h-4 w-4"}),D("contracts.add")]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Rt,{})}),e.jsx(Pt,{open:s,onOpenChange:d,onSuccess:()=>{window.location.reload()}})]})}const ha=()=>{const[t,l]=y.useState("contract_summary"),s={contract_summary:{type:"report_contract_summary",title:"Contract Summary Report",description:"List of all employee contracts with their status and details.",columns:[{key:"ContractID",label:"ID"},{key:"EmployeeName",label:"Employee"},{key:"ContractAmount",label:"Amount",format:d=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d)},{key:"ContractStartDate",label:"Start Date",format:d=>d?new Date(d).toLocaleDateString():"-"},{key:"ContractEndDate",label:"End Date",format:d=>d?new Date(d).toLocaleDateString():"-"},{key:"ContractStatus",label:"Status",format:d=>e.jsx(ae,{variant:d==="Running"?"default":d==="Completed"?"secondary":d==="Terminated"?"destructive":"outline",children:d})}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]},contract_components:{type:"report_contract_components",title:"Contract Pay Components Report",description:"Breakdown of salary components and deductions per contract.",columns:[{key:"ContractID",label:"Contract ID"},{key:"EmployeeName",label:"Employee"},{key:"ContractPayTypeName",label:"Component"},{key:"ComponentType",label:"Type",format:d=>e.jsx(ae,{variant:d==="Addition"?"default":"secondary",children:d})},{key:"ContractPAmount",label:"Amount",format:d=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d)},{key:"ContractPAmountHour",label:"Hourly Rate",format:d=>d>0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d):"-"}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]}};return e.jsxs("div",{className:"h-full flex flex-col space-y-4 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Be,{value:t,onValueChange:l,children:e.jsxs(Ue,{children:[e.jsx(le,{value:"contract_summary",children:"Contract Summary"}),e.jsx(le,{value:"contract_components",children:"Pay Components"})]})})}),e.jsx(H,{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(L,{className:"h-full p-0",children:e.jsx(Gt,{type:s[t].type,title:s[t].title,description:s[t].description,columns:s[t].columns,filters:s[t].filters})})})]})};function pa({open:t,onOpenChange:l,template:s,onSave:d,onCancel:D,onRefresh:c}){const{t:u}=$e(),[h,T]=y.useState(!1),[A,w]=y.useState([]),[j,P]=y.useState(s||{TemplateName:"",TemplateCode:"",TemplateDescription:"",ContractAmount:0,ContractDurationDays:30,ContractDurationMonths:12,TemplateType:"employment",ContractCategory:"Full-time",IsPublic:!1,IsActive:!0,IsDefault:!1,PayTypes:[]});y.useEffect(()=>{if(t)if(s!=null&&s.ContractTemplateID){const a={TemplateName:s.TemplateName||"",TemplateCode:s.TemplateCode||"",TemplateDescription:s.TemplateDescription||"",ContractAmount:s.ContractAmount||0,ContractDurationDays:s.ContractDurationDays||30,ContractDurationMonths:s.ContractDurationMonths||Math.round((s.ContractDurationDays||30)/30),TemplateType:s.TemplateType||"employment",ContractCategory:s.ContractCategory||"Full-time",IsPublic:s.IsPublic||!1,IsActive:s.IsActive!==void 0?s.IsActive:!0,IsDefault:s.IsDefault||!1,PayTypes:s.PayTypes||[],...s};P(a),A.length>0&&q(s.ContractTemplateID)}else P({TemplateName:"",TemplateCode:"",TemplateDescription:"",ContractAmount:0,ContractDurationDays:30,ContractDurationMonths:12,TemplateType:"employment",ContractCategory:"Full-time",IsPublic:!1,IsActive:!0,IsDefault:!1,PayTypes:[]})},[s,t]),y.useEffect(()=>{t&&(s!=null&&s.ContractTemplateID)&&A.length>0&&!j.PayTypes.length&&q(s.ContractTemplateID)},[s,t,A,j.PayTypes.length]);const q=async a=>{try{const i=se.contracttemplatepaytype.list,o=await i({exact_filters:{ContractTemplateID:a}});let x=[];if(Array.isArray(o))x=o;else if(o&&o.data){const C=o.data;Array.isArray(C)?x=C:C.data&&Array.isArray(C.data)&&(x=C.data)}console.log("Template Pay Types found:",x),console.log("Available Pay Types:",A),P(C=>({...C,PayTypes:x.map(g=>{const k=A.find(r=>r.ContractPayTypeID===g.ContractPayTypeID);return{ContractPayTypeID:g.ContractPayTypeID,ContractPayTypeName:(k==null?void 0:k.ContractPayTypeName)||`Pay Type ${g.ContractPayTypeID}`,Description:(k==null?void 0:k.Description)||"",IsAdd:(k==null?void 0:k.IsAdd)||0,ContractPAmount:g.ContractPAmount||0,ContractPAmountHour:g.ContractPAmountHour||0,ContractNote:g.ContractNote||""}})}))}catch(i){console.error("Error fetching template pay types:",i),P(o=>({...o,PayTypes:[]}))}};y.useEffect(()=>{f()},[]);const f=async()=>{try{const a=se.contractpaytype.list,i=await a();let o=[];if(Array.isArray(i))o=i;else if(i&&i.data){const x=i.data;Array.isArray(x)?o=x:x.data&&Array.isArray(x.data)&&(o=x.data)}w(o)}catch(a){console.error("Error fetching pay types:",a),w([])}},p=(a,i)=>{P(o=>{const x=o.PayTypes||[];return i?{...o,PayTypes:[...x,{ContractPayTypeID:a.ContractPayTypeID,ContractPayTypeName:a.ContractPayTypeName,Description:a.Description||"",IsAdd:a.IsAdd,ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}]}:{...o,PayTypes:x.filter(C=>C.ContractPayTypeID!==a.ContractPayTypeID)}})},b=(a,i,o)=>{let x=o;(i!=="ContractNote"&&i!=="Hours"&&i!=="Multiplier"||i==="Hours"||i==="Multiplier")&&(x=typeof o=="string"?parseFloat(o)||0:o),P(C=>{const g=C.PayTypes.map(k=>{if(k.ContractPayTypeID===a){const r={...k,[i]:x},I=A.find(z=>z.ContractPayTypeID===a);if(I&&(I.ContractPayTypeName.includes("Delay Deduct")||I.ContractPayTypeName.includes("Absent Deduct"))){const z=r.Hours||0,J=r.ContractPAmountHour||0;r.ContractPAmount=z*J}if(I&&I.ContractPayTypeName.includes("Overtime")){const z=r.Multiplier||1,J=r.ContractPAmountHour||0;r.ContractPAmount=J*z}return r}return k});return{...C,PayTypes:g}})},U=()=>!j.PayTypes||!Array.isArray(j.PayTypes)?0:j.PayTypes.reduce((a,i)=>i.IsAdd===1?a+i.ContractPAmount:a,0),E=async a=>{var i,o;a.preventDefault(),T(!0);try{const x=U(),C={...j,ContractAmount:x};let g;if(s!=null&&s.ContractTemplateID)await se.contractstemplate.update(s.ContractTemplateID,C),g=s.ContractTemplateID,await Y(g);else{const k=await se.contractstemplate.create(C);console.log("Template creation response:",k);const r=k;g=(r==null?void 0:r.ContractTemplateID)||((i=r==null?void 0:r.data)==null?void 0:i.ContractTemplateID)||(r==null?void 0:r.id)||((o=r==null?void 0:r.data)==null?void 0:o.id),console.log("Extracted template ID:",g)}j.PayTypes&&j.PayTypes.length>0&&(console.log("Calling saveTemplatePayTypes with ID:",g),await n(g,j.PayTypes)),d(C),c&&c(),l(!1)}catch(x){console.error("Error saving template:",x)}finally{T(!1)}},Y=async a=>{try{const i=se.contracttemplatepaytype.delete;await i(a)}catch(i){console.error("Error deleting existing pay types:",i)}},n=async(a,i)=>{try{console.log("Saving pay types for template ID:",a),console.log("Pay types to save:",i);const o=se.contracttemplatepaytype.create;for(const x of i){const C={ContractTemplateID:a,ContractPayTypeID:x.ContractPayTypeID,ContractPAmount:x.ContractPAmount||0,ContractPAmountHour:x.ContractPAmountHour||0,ContractNote:x.ContractNote||"",SortOrder:0};console.log("Pay type data being sent:",C),await o(C)}}catch(o){throw console.error("Error saving template pay types:",o),o}};return e.jsx(jt,{open:t,onOpenChange:l,children:e.jsxs(Ct,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ft,{children:[e.jsx(Nt,{children:u(s?"contracts.template.edit":"contracts.template.create")}),e.jsx(gt,{children:u("contracts.template.description")})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{children:u("contracts.template.info")})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"TemplateName",children:u("contracts.template.name")}),e.jsx($,{id:"TemplateName",value:j.TemplateName||"",onChange:a=>P({...j,TemplateName:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"TemplateCode",children:u("contracts.template.code")}),e.jsx($,{id:"TemplateCode",value:j.TemplateCode||"",onChange:a=>P({...j,TemplateCode:a.target.value.toUpperCase()}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"TemplateDescription",children:u("contracts.template.description")}),e.jsx(Oe,{id:"TemplateDescription",value:j.TemplateDescription||"",onChange:a=>P({...j,TemplateDescription:a.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"TemplateType",children:u("contracts.template.type")}),e.jsxs(je,{value:j.TemplateType,onValueChange:a=>P({...j,TemplateType:a}),children:[e.jsx(Ce,{children:e.jsx(fe,{})}),e.jsxs(Ne,{children:[e.jsx(R,{value:"employment",children:"Employment"}),e.jsx(R,{value:"freelance",children:"Freelance"}),e.jsx(R,{value:"internship",children:"Internship"}),e.jsx(R,{value:"consultancy",children:"Consultancy"}),e.jsx(R,{value:"service",children:"Service"}),e.jsx(R,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"ContractCategory",children:u("contracts.template.category")}),e.jsx($,{id:"ContractCategory",value:j.ContractCategory||"",onChange:a=>P({...j,ContractCategory:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"ContractDuration",children:[u("contracts.template.duration")," (months)"]}),e.jsx("div",{className:"flex gap-1",children:e.jsxs(je,{value:(j.ContractDurationMonths||12).toString(),onValueChange:a=>{const i=parseInt(a);P({...j,ContractDurationMonths:i,ContractDurationDays:i*30})},children:[e.jsx(Ce,{className:"w-65",children:e.jsx(fe,{placeholder:"Select"})}),e.jsxs(Ne,{children:[e.jsx(R,{value:"3",children:"3 months"}),e.jsx(R,{value:"6",children:"6 months"}),e.jsx(R,{value:"12",children:"12 months"}),e.jsx(R,{value:"24",children:"24 months"})]})]})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Duration: ",j.ContractDurationMonths||12," months (",j.ContractDurationDays||360," days)"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"IsPublic",checked:j.IsPublic,onCheckedChange:a=>P({...j,IsPublic:!!a})}),e.jsx(v,{htmlFor:"IsPublic",children:u("contracts.template.public")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"IsActive",checked:j.IsActive,onCheckedChange:a=>P({...j,IsActive:!!a})}),e.jsx(v,{htmlFor:"IsActive",children:u("contracts.template.active")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:"IsDefault",checked:j.IsDefault,onCheckedChange:a=>P({...j,IsDefault:!!a})}),e.jsx(v,{htmlFor:"IsDefault",children:u("contracts.template.default")})]})]})]})]}),e.jsxs(H,{children:[e.jsx(Q,{children:e.jsx(X,{children:u("contracts.template.payTypes")})}),e.jsxs(L,{children:[e.jsx("div",{className:"space-y-4",children:A.map(a=>{var x,C;const i=(x=j.PayTypes)==null?void 0:x.some(g=>g.ContractPayTypeID===a.ContractPayTypeID),o=(C=j.PayTypes)==null?void 0:C.find(g=>g.ContractPayTypeID===a.ContractPayTypeID);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(ce,{id:`paytype-${a.ContractPayTypeID}`,checked:i,onCheckedChange:g=>p(a,!!g)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:`paytype-${a.ContractPayTypeID}`,className:"font-medium",children:a.ContractPayTypeName}),e.jsx(ae,{variant:a.IsAdd===1?"default":"destructive",children:a.IsAdd===1?"+":"-"})]}),a.Description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.Description})]})]})}),i&&o&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-4 gap-4 pl-7",children:[a.IsHour===1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`hourly-${a.ContractPayTypeID}`,children:u("contracts.template.hourlyRate")}),e.jsx($,{id:`hourly-${a.ContractPayTypeID}`,type:"text",value:o.ContractPAmountHour,onChange:g=>b(a.ContractPayTypeID,"ContractPAmountHour",g.target.value),placeholder:"0.00"})]}),a.ContractPayTypeName.includes("Delay Deduct")||a.ContractPayTypeName.includes("Absent Deduct")?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`hours-${a.ContractPayTypeID}`,children:"Hours"}),e.jsx($,{id:`hours-${a.ContractPayTypeID}`,type:"text",value:o.Hours||"",onChange:g=>b(a.ContractPayTypeID,"Hours",g.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`amount-${a.ContractPayTypeID}`,children:u("contracts.template.amount")}),e.jsx($,{id:`amount-${a.ContractPayTypeID}`,type:"text",value:o.ContractPAmount,disabled:!0,className:"bg-muted"})]})]}):a.ContractPayTypeName.includes("Overtime")?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`multiplier-${a.ContractPayTypeID}`,children:"Multiplier"}),e.jsx($,{id:`multiplier-${a.ContractPayTypeID}`,type:"text",value:o.Multiplier||"",onChange:g=>b(a.ContractPayTypeID,"Multiplier",g.target.value),placeholder:"1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`amount-${a.ContractPayTypeID}`,children:u("contracts.template.amount")}),e.jsx($,{id:`amount-${a.ContractPayTypeID}`,type:"text",value:o.ContractPAmount,disabled:!0,className:"bg-muted"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`amount-${a.ContractPayTypeID}`,children:u("contracts.template.amount")}),e.jsx($,{id:`amount-${a.ContractPayTypeID}`,type:"text",value:o.ContractPAmount,onChange:g=>b(a.ContractPayTypeID,"ContractPAmount",g.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:`note-${a.ContractPayTypeID}`,children:u("contracts.template.note")}),e.jsx($,{id:`note-${a.ContractPayTypeID}`,value:o.ContractNote,onChange:g=>b(a.ContractPayTypeID,"ContractNote",g.target.value)})]})]})]},a.ContractPayTypeID)})}),e.jsx("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:u("contracts.template.totalAmount")}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",U().toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsxs(N,{type:"button",variant:"outline",onClick:()=>l(!1),children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),u("common.cancel")]}),e.jsxs(N,{type:"submit",disabled:h,children:[e.jsx(sa,{className:"mr-2 h-4 w-4"}),u(h?"common.saving":"common.save")]})]})]})]})})}function ya(){const{t}=$e(),[l,s]=y.useState([]),[d,D]=y.useState(!0),[c,u]=y.useState(!1),[h,T]=y.useState();y.useEffect(()=>{A()},[]);const A=async()=>{try{const p=await se.contractstemplate.list();let b=[];if(Array.isArray(p))b=p;else if(p&&typeof p=="object"){const E=p;Array.isArray(E.data)?b=E.data:E.data&&Array.isArray(E.data.data)&&(b=E.data.data)}const U=b.filter((E,Y,n)=>Y===n.findIndex(a=>a.ContractTemplateID===E.ContractTemplateID));s(U)}catch(p){console.error("Error fetching templates:",p),s([])}finally{D(!1)}},w=()=>{T(void 0),u(!0)},j=p=>{T(p),u(!0)},P=async p=>{await A(),u(!1),T(void 0)},q=async p=>{if(confirm(t("contracts.template.deleteConfirm")))try{await se.contractstemplate.delete(p),await A()}catch(b){console.error("Error deleting template:",b)}},f=async p=>{const b={...p,TemplateName:`${p.TemplateName} (Copy)`,TemplateCode:`${p.TemplateCode}_COPY`,ContractTemplateID:void 0};T(b),u(!0)};return d?e.jsx("div",{className:"flex justify-center p-8",children:t("common.loading")}):e.jsxs("div",{className:"h-full flex flex-col space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t("contracts.templates.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("contracts.templates.description")})]}),e.jsxs(N,{onClick:w,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),t("contracts.templates.create")]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(p=>e.jsxs(H,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(X,{className:"text-lg",children:p.TemplateName}),e.jsx(xt,{className:"text-xs mt-1",children:p.TemplateCode})]}),e.jsxs("div",{className:"flex gap-1",children:[p.IsDefault&&e.jsx(ae,{variant:"default",className:"text-xs",children:t("contracts.template.default")}),p.IsPublic&&e.jsx(ae,{variant:"secondary",className:"text-xs",children:t("contracts.template.public")}),!p.IsActive&&e.jsx(ae,{variant:"destructive",className:"text-xs",children:t("contracts.template.inactive")})]})]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-2",children:[p.TemplateDescription&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:p.TemplateDescription}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.amount")}),e.jsxs("span",{className:"font-semibold",children:["$",p.ContractAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.duration")}),e.jsxs("span",{className:"font-semibold",children:[p.ContractDurationDays," ",t("common.days")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.usage")}),e.jsx("span",{className:"font-semibold",children:p.UsageCount})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(N,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>j(p),children:[e.jsx(vt,{className:"h-3 w-3 mr-1"}),t("common.edit")]}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>f(p),children:e.jsx(ea,{className:"h-3 w-3"})}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>q(p.ContractTemplateID),children:e.jsx(Te,{className:"h-3 w-3"})})]})]})})]},p.ContractTemplateID))}),l.length===0&&e.jsx(H,{children:e.jsxs(L,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t("contracts.templates.empty")}),e.jsxs(N,{onClick:w,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),t("contracts.templates.create")]})]})})]}),e.jsx(pa,{open:c,onOpenChange:u,template:h,onSave:P,onCancel:()=>{u(!1),T(void 0)}})]})}function Ya(){return e.jsxs(Lt,{children:[e.jsxs(me,{element:e.jsx(xa,{}),children:[e.jsx(me,{index:!0,element:e.jsx(ua,{})}),e.jsx(me,{path:"templates",element:e.jsx(ya,{})}),e.jsx(me,{path:"reports",element:e.jsx(ha,{})})]}),e.jsx(me,{path:":id",element:e.jsx(la,{})}),e.jsx(me,{path:":id/edit",element:e.jsx(da,{})})]})}export{la as ContractDetails,ya as ContractTemplates,xa as ContractsLayout,Ya as ContractsModule,ha as ContractsReports,da as EditContract,ua as EmployeeContracts};
