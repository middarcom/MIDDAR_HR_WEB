import{w as $,r as n,j as e,C,e as E,f as I,g as S,h as L,n as d,B as j,Q as A,k as U,$ as c}from"./index-BvW6vA_w.js";import{L as m}from"./label-SlGcAB4q.js";import{C as z}from"./checkbox-BqyLDdHE.js";import{I as w}from"./input-B90b-HjG.js";import{P as B,b as R,c as Y,C as J}from"./popover-C9ru1Mgl.js";import{a as v}from"./api-YnBVhvg1.js";import{E as Q}from"./EmployeeDropdown-DgM-kTJZ.js";import"./index-LHsGcG95.js";import"./getDaysInMonth-2as7pjyD.js";import"./chevron-left-Cr-a-3Sv.js";import"./select-CgTQIsYR.js";import"./loader-circle-BhqU31H3.js";const ne=()=>{$();const[u,D]=n.useState(""),[o,x]=n.useState(null),[h,T]=n.useState(new Date),[P,k]=n.useState(!1),[l,p]=n.useState({checkIn:!1,checkOut:!1}),[i,M]=n.useState(!1),[s,y]=n.useState({hours:"",minutes:""}),[r,b]=n.useState(void 0);n.useEffect(()=>{(async()=>{if(!u){x(null);return}try{k(!0);const t=await v.employees.list({exact_filters:{EmployeeID:parseInt(u)}});t.data&&t.data.length>0?x(t.data[0]):(console.error("No employee found with ID:",u),c.error("Employee not found"),x(null))}catch(t){console.error("Error fetching employee:",t),c.error("Failed to load employee data. Please try again."),x(null)}finally{k(!1)}})()},[u]),n.useEffect(()=>{const a=setInterval(()=>T(new Date),1e3);return()=>clearInterval(a)},[]),n.useEffect(()=>{o||(M(!1),y({hours:"",minutes:""}),b(void 0))},[o]);const N=()=>{if(i&&s.hours&&s.minutes){let a,t,f;if(r)a=r.getFullYear(),t=r.getMonth(),f=r.getDate();else{const g=new Date;a=g.getFullYear(),t=g.getMonth(),f=g.getDate()}return new Date(a,t,f,parseInt(s.hours),parseInt(s.minutes),0)}return new Date},F=async()=>{if(!o){c.error("Employee data not loaded");return}if(i&&(!s.hours||!s.minutes)){c.error("Please enter manual time (hours and minutes)");return}p({...l,checkIn:!0});try{const a=N(),t=d(a,"yyyy-MM-dd HH:mm:ss");console.log("Check-in time being sent:",t),await v.create("timeattendance",{EmployeeID:o.EmployeeID,AttendanceDate:t}),c.success("Successfully checked in")}catch(a){console.error("Error checking in:",a),c.error("Failed to check in")}finally{p({...l,checkIn:!1})}},O=async()=>{if(!o){c.error("Employee data not loaded");return}if(i&&(!s.hours||!s.minutes)){c.error("Please enter manual time (hours and minutes)");return}p({...l,checkOut:!0});try{const a=N(),t=d(a,"yyyy-MM-dd HH:mm:ss");console.log("Check-out time being sent:",t),await v.create("timeattendance",{EmployeeID:o.EmployeeID,AttendanceDate:t}),c.success("Successfully checked out")}catch(a){console.error("Error checking out:",a),c.error("Failed to check out")}finally{p({...l,checkOut:!1})}},H=a=>a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return P?e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(I,{children:"Loading..."})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-8 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-12 bg-muted rounded w-1/4"})]})})]})}):e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs(C,{className:"max-w-4xl mx-auto",children:[e.jsxs(E,{children:[e.jsx(I,{children:"Check-In / Check-Out"}),e.jsx(L,{children:"Select an employee and record their attendance"})]}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"employee",children:"Select Employee *"}),e.jsx(Q,{value:u,onValueChange:D,placeholder:"Select an employee",employmentStatus:"Active"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Status"}),e.jsx("div",{className:"h-10 flex items-center",children:o?e.jsx("span",{className:"text-green-600 font-medium",children:"Ready to record attendance"}):e.jsx("span",{className:"text-gray-400",children:"Please select an employee"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Current Date"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:d(h,"EEEE, MMMM d, yyyy")})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Current Time"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:d(h,"HH:mm:ss")})]})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-blue-50/50 dark:bg-blue-900/10",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"manual-mode",checked:i,onCheckedChange:a=>{M(a),a||y({hours:"",minutes:""})}}),e.jsx(m,{htmlFor:"manual-mode",className:"text-sm font-medium",children:"Manual Time Entry"})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium mb-2 block",children:"Manual Date Entry (Optional)"}),e.jsxs(B,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:A("w-full justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),r?d(r,"PPP"):"Pick a date"]})}),e.jsx(Y,{className:"w-auto p-0",children:e.jsx(J,{mode:"single",selected:r,onSelect:b,initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm font-medium mb-2 block",children:"Manual Time Entry"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"manual-hours",children:"Hours (0-23)"}),e.jsx(w,{id:"manual-hours",type:"number",min:"0",max:"23",placeholder:"HH",value:s.hours,onChange:a=>{const t=a.target.value;(t===""||parseInt(t)>=0&&parseInt(t)<=23)&&y({...s,hours:t})},className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"manual-minutes",children:"Minutes (0-59)"}),e.jsx(w,{id:"manual-minutes",type:"number",min:"0",max:"59",placeholder:"MM",value:s.minutes,onChange:a=>{const t=a.target.value;(t===""||parseInt(t)>=0&&parseInt(t)<=59)&&y({...s,minutes:t})},className:"w-full"})]})]})]})]}),i&&e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 p-2 rounded",children:r?e.jsxs(e.Fragment,{children:["Manual date/time will be used: ",d(r,"yyyy-MM-dd")," ",s.hours.padStart(2,"0"),":",s.minutes.padStart(2,"0")]}):e.jsxs(e.Fragment,{children:["Manual time will be used: ",s.hours.padStart(2,"0"),":",s.minutes.padStart(2,"0")," (with current date)"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4",children:[e.jsx(j,{onClick:F,disabled:!o||l.checkIn||l.checkOut||i&&(!s.hours||!s.minutes),variant:"default",className:"w-full",size:"lg",children:l.checkIn?"Processing...":"Check In"}),e.jsx(j,{onClick:O,disabled:!o||l.checkIn||l.checkOut||i&&(!s.hours||!s.minutes),variant:"outline",className:"w-full",size:"lg",children:l.checkOut?"Processing...":"Check Out"})]}),e.jsx("div",{className:"mt-6 p-4 bg-muted/30 rounded-md",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Date/Time to use: ",i&&s.hours&&s.minutes?r?`${d(r,"MMM d, yyyy")} ${s.hours.padStart(2,"0")}:${s.minutes.padStart(2,"0")} (Manual)`:`${d(h,"MMM d, yyyy")} ${s.hours.padStart(2,"0")}:${s.minutes.padStart(2,"0")} (Manual time, current date)`:`${d(h,"MMM d, yyyy")} ${H(h)} (Current)`]}),i&&e.jsx("div",{className:"text-blue-600 font-medium",children:"Manual mode enabled - Enter date and/or time above to proceed"})]})})]})})]})})};export{ne as default};
