import{l as Se,r as d,j as e,K as be,B as L,W as oe,n as he,aQ as xe,t as ke,C as Ae,e as $e,k as Fe,R as Le,S as Re,g as Oe,a as Y}from"./index-BvW6vA_w.js";import{S as ye}from"./skeleton-Bdw8EXgx.js";import{A as ze,a as Ve,b as Ye}from"./alert-Bp7wk0IP.js";import{T as Pe,a as Ue,b as ee,c as te}from"./tabs-CNqDDOx9.js";import{S as se,a as ne,b as re,c as ae,d as w}from"./select-CgTQIsYR.js";import{I as G}from"./input-B90b-HjG.js";import{a as ge}from"./constants-DcYcutvt.js";import{C as ie}from"./chevron-left-Cr-a-3Sv.js";import{o as He,s as V,n as We,u as qe,t as Be}from"./types-BaGLVKrj.js";import{D as Ge,a as _e,b as Je,c as Ke,f as Xe}from"./dialog-Dz39hnJR.js";import{L as O}from"./label-SlGcAB4q.js";import{T as fe}from"./textarea-NB_NAYSZ.js";import{C as Qe}from"./date-picker-BYk77_ec.js";import{E as Ze}from"./EmployeeDropdown-DgM-kTJZ.js";import{L as et}from"./layout-grid-gyTo-FUk.js";import{P as tt}from"./plus-c3UHNGiE.js";import"./index-LHsGcG95.js";import"./popover-C9ru1Mgl.js";import"./getDaysInMonth-2as7pjyD.js";import"./api-YnBVhvg1.js";import"./loader-circle-BhqU31H3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=Se("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=Se("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),rt=({employeeId:t,timeSlot:l,slotHeight:x,appointment:j,isAppointmentStart:S,isDragOver:b,isWorking:c=!0,onDrop:a,onDragOver:D,onDragLeave:n,onDragStart:r,onResizeStart:m,onSlotClick:i,formatTime:h,calculateAppointmentHeight:T})=>{var R,A;return e.jsxs("div",{className:`border-r p-1 transition-colors ${c?b?"bg-blue-100 border-blue-400 cursor-pointer":"hover:bg-blue-50 hover:border-blue-300 cursor-pointer":"bg-gray-200 cursor-not-allowed"}`,style:{height:`${x}px`},onDrop:v=>c&&a(v,t,l),onDragOver:v=>c&&D(v,t,l),onDragLeave:n,onClick:()=>c&&i(t,l),children:[!c&&e.jsx("div",{className:"flex items-center justify-center h-full text-gray-600 text-xs font-medium",children:"Day Off"}),j&&e.jsx("div",{draggable:!0,onDragStart:v=>r(v,j),className:`p-2 rounded border-l-4 ${((R=ge[j.Type])==null?void 0:R.bg)||"bg-gray-100"} ${((A=ge[j.Type])==null?void 0:A.border)||"border-gray-300"} cursor-grab active:cursor-grabbing shadow-sm hover:shadow-md transition-shadow overflow-hidden`,style:{height:S?T(j.StartTime,j.EndTime):"auto",position:S?"relative":"static",zIndex:S?10:"auto"},children:S&&e.jsxs("div",{className:"flex items-start justify-between h-full flex-col relative",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"text-xs font-medium truncate cursor-ns-resize select-none",onMouseDown:v=>{v.preventDefault(),m(j,"start",v)},children:j.Title}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5 truncate",children:[h(j.StartTime)," - ",h(j.EndTime)]})]}),e.jsx(nt,{className:"h-3 w-3 text-muted-foreground flex-shrink-0"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize bg-blue-500 opacity-0 hover:opacity-50 transition-opacity",onMouseDown:v=>{v.preventDefault(),m(j,"end",v)}})]})})]})},at=({timeSlot:t,employees:l,slotHeight:x,appointments:j,dragOverSlot:S,selectedDate:b,isEmployeeWorkingOnDay:c,onDrop:a,onDragOver:D,onDragLeave:n,onDragStart:r,onResizeStart:m,onSlotClick:i,formatTime:h,calculateAppointmentHeight:T,getAppointmentForSlot:R})=>e.jsxs("div",{className:"grid gap-0 border-b",style:{gridTemplateColumns:`80px repeat(${l.length}, minmax(150px, 1fr))`},children:[e.jsx("div",{className:"bg-muted/30 p-2 border-r text-sm font-medium sticky left-0 z-10",children:h(t)}),l.map(A=>{const v=R(A.EmployeeID,t),W=(S==null?void 0:S.employeeId)===A.EmployeeID&&(S==null?void 0:S.time)===t,q=v&&v.StartTime===t,U=c?c(A.EmployeeID,b):!0;return e.jsx(rt,{employeeId:A.EmployeeID,timeSlot:t,slotHeight:x,appointment:v,isAppointmentStart:!!q,isDragOver:W,isWorking:U,onDrop:a,onDragOver:D,onDragLeave:n,onDragStart:r,onResizeStart:m,onSlotClick:i,formatTime:h,calculateAppointmentHeight:T},`${A.EmployeeID}-${t}`)})]}),ot=({selectedDate:t,appointments:l,employees:x,onDateChange:j,onDragStart:S,onDrop:b,onDragOver:c,onDragLeave:a,dragOverSlot:D,timeSlots:n,onAppointmentResize:r,onCreateAppointment:m,slotHeight:i=40,isEmployeeWorkingOnDay:h,formatTime:T})=>{const[R,A]=d.useState(!1),[v,W]=d.useState(null),q=d.useRef(null),U=d.useCallback(g=>{const f=g.getFullYear(),E=String(g.getMonth()+1).padStart(2,"0"),C=String(g.getDate()).padStart(2,"0");return`${f}-${E}-${C}`},[]),K=d.useCallback((g,f)=>{const E=U(t);return l.find(C=>{if(C.EmployeeID!==g||C.AppointmentDate!==E)return!1;const $=k(f),H=k(C.StartTime),z=k(C.EndTime);return $>=H&&$<z})},[l,t,U]),k=d.useCallback(g=>{if(typeof g=="number")return Math.floor(g);const f=String(g).split(":").map(Number),E=f[0]||0,C=f[1]||0,$=f[2]||0;return E*3600+C*60+$},[]),X=d.useCallback((g,f)=>{const E=k(g);return(k(f)-E)/60/30*i},[i,k]),_=d.useCallback((g,f)=>{const E=k(g)+f*60;return T(E)},[k,T]),le=d.useCallback((g,f)=>{m&&m(g,f)},[m]),ce=d.useCallback((g,f,E)=>{E.preventDefault(),E.stopPropagation(),A(!0),W({appointment:g,direction:f,startX:E.clientX,startY:E.clientY,originalStartTime:g.StartTime,originalEndTime:g.EndTime}),document.body.style.userSelect="none",document.body.style.cursor="ns-resize";const C=H=>{if(!v)return;const z=H.clientY-v.startY,de=30/i,P=Math.round(z*de/30)*30;if(P!==0)if(v.direction==="start"){const J=_(v.originalStartTime,P);r&&r(v.appointment.AppointmentID,J,void 0)}else{const J=_(v.originalEndTime,P);r&&r(v.appointment.AppointmentID,void 0,J)}},$=()=>{A(!1),W(null),document.body.style.userSelect="",document.body.style.cursor="",document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",$)};document.addEventListener("mousemove",C),document.addEventListener("mouseup",$)},[v,i,r,_]),me=d.useMemo(()=>`80px repeat(${x.length}, minmax(150px, 1fr))`,[x.length]);return e.jsx("div",{className:"space-y-4",ref:q,children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("div",{className:"min-w-full",children:[e.jsxs("div",{className:"grid gap-0",style:{gridTemplateColumns:me},children:[e.jsx("div",{className:"bg-muted p-2 border-r border-b font-medium text-sm sticky left-0 z-10",children:"Time"}),x.map(g=>{const f=h?h(g.EmployeeID,t):!0;return e.jsx("div",{className:`p-2 border-r border-b font-medium text-sm text-center ${f?"bg-muted":"bg-gray-200 text-gray-700"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsxs("span",{className:"truncate",children:[g.FirstName," ",g.LastName]}),!f&&e.jsx("span",{className:"text-xs font-normal",children:"(Day Off)"})]})},g.EmployeeID)})]}),n.map((g,f)=>e.jsx(at,{timeSlot:g,employees:x,slotHeight:i,appointments:l,dragOverSlot:D,selectedDate:t,isEmployeeWorkingOnDay:h,onDrop:b,onDragOver:c,onDragLeave:a,onDragStart:S,onResizeStart:ce,onSlotClick:le,formatTime:T,calculateAppointmentHeight:X,getAppointmentForSlot:K},f))]})})})},it=({selectedDate:t,appointments:l,onDateChange:x,onAppointmentClick:j})=>{const S=(n,r)=>new Date(n,r+1,0).getDate(),b=new Date(t.getFullYear(),t.getMonth(),1).getDay(),c=[],a=S(t.getFullYear(),t.getMonth()),D=new Date;for(let n=0;n<b;n++)c.push(e.jsx("div",{className:"h-24 border p-1 bg-muted/20"},`empty-${n}`));for(let n=1;n<=a;n++){const m=new Date(t.getFullYear(),t.getMonth(),n).toDateString()===D.toDateString(),i=l.filter(h=>{const T=new Date(h.AppointmentDate);return T.getDate()===n&&T.getMonth()===t.getMonth()&&T.getFullYear()===t.getFullYear()});c.push(e.jsxs("div",{className:`h-40 border p-1 overflow-y-auto ${m?"bg-blue-50":""}`,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${m?"text-blue-600":""}`,children:n}),e.jsxs("div",{className:"space-y-1",children:[i.slice(0,3).map(h=>e.jsx("div",{onClick:()=>j(h),className:"text-xs p-1 rounded bg-blue-100 text-blue-800 truncate cursor-pointer hover:bg-blue-200",children:h.Title},h.AppointmentID)),i.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",i.length-3," more"]})]})]},n))}return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"outline",size:"icon",onClick:()=>x(new Date(t.getFullYear(),t.getMonth()-1,1)),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"icon",onClick:()=>x(new Date(t.getFullYear(),t.getMonth()+1,1)),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg font-semibold",children:t.toLocaleDateString("en-US",{year:"numeric",month:"long"})})]})}),e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-border",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(n=>e.jsx("div",{className:"bg-muted/50 p-2 text-center font-medium text-sm",children:n},n)),c]})]})},lt=({selectedDate:t,appointments:l,onDateChange:x,onAppointmentClick:j})=>{const b=(r=>{const m=new Date(r);m.setDate(r.getDate()-r.getDay());const i=[];for(let h=0;h<7;h++){const T=new Date(m);T.setDate(m.getDate()+h),i.push(T)}return i})(t),c=new Date,a=Array.from({length:24},(r,m)=>m),D=(r,m)=>l.filter(i=>{const h=new Date(i.AppointmentDate),T=new Date(`2000-01-01T${i.StartTime}`).getHours();return h.getDate()===r.getDate()&&h.getMonth()===r.getMonth()&&h.getFullYear()===r.getFullYear()&&T===m}),n=r=>{const m=new Date(t);m.setDate(t.getDate()+(r==="prev"?-7:7)),x(m)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"outline",size:"icon",onClick:()=>n("prev"),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"icon",onClick:()=>n("next"),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-lg font-semibold",children:[b[0].toLocaleDateString("en-US",{month:"short",day:"numeric"})," -",b[6].toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]})}),e.jsxs("div",{className:"grid grid-cols-8 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"border-r",children:[e.jsx("div",{className:"h-10 border-b flex items-center justify-center font-medium bg-muted/50",children:"Time"}),a.map(r=>e.jsxs("div",{className:"h-16 border-b flex items-center justify-center text-sm text-muted-foreground",children:[r,":00"]},r))]}),b.map((r,m)=>{const i=r.toDateString()===c.toDateString();return e.jsxs("div",{className:"border-r last:border-r-0",children:[e.jsxs("div",{className:`h-10 border-b flex flex-col items-center justify-center font-medium ${i?"bg-blue-50":"bg-muted/50"}`,children:[e.jsx("div",{className:"text-sm",children:r.toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:`text-xs ${i?"text-blue-600":""}`,children:r.getDate()})]}),e.jsx("div",{className:"divide-y",children:a.map(h=>{const T=D(r,h);return e.jsx("div",{className:"h-16 p-0.5 overflow-hidden",children:T.map(R=>e.jsx("div",{onClick:()=>j(R),className:"text-xs p-1 mb-0.5 rounded bg-blue-100 text-blue-800 cursor-pointer hover:bg-blue-200 truncate",children:R.Title},R.AppointmentID))},h)})})]},m)})]})]})},ct=({selectedDate:t,appointments:l,onDateChange:x,onAppointmentClick:j})=>{const S=Array.from({length:24},(n,r)=>r),b=new Date,c=t.toDateString()===b.toDateString(),a=n=>l.filter(r=>{const m=new Date(r.AppointmentDate),i=new Date(`2000-01-01T${r.StartTime}`).getHours();return m.getDate()===t.getDate()&&m.getMonth()===t.getMonth()&&m.getFullYear()===t.getFullYear()&&i===n}),D=n=>{const r=new Date(t);r.setDate(t.getDate()+(n==="prev"?-1:1)),x(r)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"outline",size:"icon",onClick:()=>D("prev"),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"icon",onClick:()=>D("next"),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsxs("h2",{className:"text-lg font-semibold",children:[t.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),c&&e.jsx("span",{className:"ml-2 text-sm text-blue-600",children:"Today"})]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:S.map(n=>{const r=a(n),m=c&&b.getHours()===n;return e.jsxs("div",{className:`grid grid-cols-12 ${m?"bg-blue-50":""} ${n<23?"border-b":""}`,children:[e.jsx("div",{className:"col-span-1 p-2 border-r text-right pr-4 text-sm text-muted-foreground",children:n===0?"12 AM":n<12?`${n} AM`:n===12?"12 PM":`${n-12} PM`}),e.jsx("div",{className:"col-span-11 p-1",children:e.jsxs("div",{className:"h-full min-h-[60px] relative",children:[m&&e.jsx("div",{className:"absolute left-0 top-0 h-0.5 w-full bg-blue-500",children:e.jsx("div",{className:"absolute -top-1 -left-1 w-2 h-2 rounded-full bg-blue-500"})}),r.map(i=>e.jsxs("div",{onClick:()=>j(i),className:"p-2 mb-1 rounded bg-blue-100 border border-blue-200 text-blue-800 cursor-pointer hover:bg-blue-200",children:[e.jsx("div",{className:"font-medium text-sm",children:i.Title}),e.jsxs("div",{className:"text-xs text-blue-700",children:[new Date(`2000-01-01T${i.StartTime}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})," -",new Date(`2000-01-01T${i.EndTime}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]}),i.Location&&e.jsx("div",{className:"text-xs text-blue-600 truncate",children:i.Location})]},i.AppointmentID))]})})]},n)})})]})},je=t=>{const[l,x]=t.split(":").map(Number);return l*3600+x*60},ve=t=>{const l=Math.floor(t/3600),x=Math.floor(t%3600/60);return`${l.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`},mt=He({employeeId:V().min(1,"Employee is required"),title:V().min(1,"Title is required"),description:V().optional(),appointmentDate:V().min(1,"Date is required"),startTime:V().min(1,"Start time is required").refine(t=>{const[l]=t.split(":").map(Number);return l>=9},{message:"Start time must be 9:00 AM or later"}),endTime:V().min(1,"End time is required").refine(t=>{const[l]=t.split(":").map(Number);return l<=17},{message:"End time must be 5:00 PM or earlier"}),location:V().optional(),type:V().default("Meeting"),status:V().default("Scheduled"),reminderMinutes:We().min(0).default(15),notes:V().optional()}).refine(t=>{const l=je(t.startTime);return je(t.endTime)>l},{message:"End time must be after start time",path:["endTime"]});function dt({initialData:t,onSubmit:l,onCancel:x}){const[j,S]=d.useState(!0),[b,c]=d.useState(!1),a=qe({resolver:Be(mt),defaultValues:{employeeId:"",title:"",description:"",appointmentDate:"",startTime:"09:00",endTime:"10:00",location:"",type:"Meeting",status:"Scheduled",reminderMinutes:15,notes:""}});d.useEffect(()=>{if(t){const n=t.AppointmentDate||t.appointmentDate,r=t.StartTime||t.startTime,m=t.EndTime||t.endTime,i=typeof r=="number"?ve(r).substring(0,5):r?r.substring(0,5):"09:00",h=typeof m=="number"?ve(m).substring(0,5):m?m.substring(0,5):"10:00";a.reset({employeeId:String(t.EmployeeID||t.employeeId||""),title:t.Title||t.title||"",description:t.Description||t.description||"",appointmentDate:n?he(new Date(n),"yyyy-MM-dd"):"",startTime:i,endTime:h,location:t.Location||t.location||"",type:t.Type||t.type||"Meeting",status:t.Status||t.status||"Scheduled",reminderMinutes:t.ReminderMinutes||t.reminderMinutes||15,notes:t.Notes||t.notes||""})}else j&&a.reset({employeeId:"",title:"",description:"",appointmentDate:"",startTime:"09:00",endTime:"10:00",location:"",type:"Meeting",status:"Scheduled",reminderMinutes:15,notes:""})},[t,j,a]);const D=async n=>{try{console.log("AppointmentForm submitting data:",n),c(!0),await l({EmployeeID:parseInt(n.employeeId),Title:n.title,Description:n.description||null,AppointmentDate:n.appointmentDate,StartTime:n.startTime+":00",EndTime:n.endTime+":00",Location:n.location||null,Type:n.type,Status:n.status,ReminderMinutes:n.reminderMinutes,Notes:n.notes||null}),S(!1),xe({title:t?"Appointment updated successfully":"Appointment created successfully"})}catch(r){console.error("Error submitting appointment:",r),xe({title:"Error",description:"An error occurred while saving the appointment. Please try again.",variant:"destructive"})}finally{c(!1)}};return e.jsx(Ge,{open:j,onOpenChange:n=>{S(n),n||x()},children:e.jsx(_e,{className:"sm:max-w-[600px] max-h-[90vh] overflow-hidden bg-background",children:e.jsxs("form",{onSubmit:a.handleSubmit(D),className:"flex flex-col h-full",children:[e.jsx(Je,{children:e.jsx(Ke,{children:t?"Edit Appointment":"Schedule New Appointment"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"grid gap-4 py-4 max-h-[70vh] overflow-y-auto scrollbar-hide",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"employeeId",children:"Employee *"}),e.jsx(Ze,{value:a.watch("employeeId"),onValueChange:n=>a.setValue("employeeId",n),placeholder:"Select an employee",employmentStatus:"Active"}),a.formState.errors.employeeId&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.employeeId.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"type",children:"Appointment Type *"}),e.jsxs(se,{value:a.watch("type"),onValueChange:n=>a.setValue("type",n),children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Select type"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Meeting",children:"Meeting"}),e.jsx(w,{value:"Interview",children:"Interview"}),e.jsx(w,{value:"Training",children:"Training"}),e.jsx(w,{value:"Review",children:"Performance Review"}),e.jsx(w,{value:"OneOnOne",children:"One-on-One"}),e.jsx(w,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"title",children:"Title *"}),e.jsx(G,{id:"title",placeholder:"Enter appointment title",...a.register("title")}),a.formState.errors.title&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"description",children:"Description"}),e.jsx(fe,{id:"description",placeholder:"Enter appointment description",rows:3,...a.register("description")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"appointmentDate",children:"Date *"}),e.jsx(Qe,{date:a.watch("appointmentDate")?new Date(a.watch("appointmentDate")):void 0,onChange:n=>{n?a.setValue("appointmentDate",he(n,"yyyy-MM-dd"),{shouldValidate:!0}):a.setValue("appointmentDate","",{shouldValidate:!0})},placeholder:"Select appointment date"}),a.formState.errors.appointmentDate&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.appointmentDate.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"startTime",children:"Start Time *"}),e.jsx(G,{id:"startTime",type:"time",...a.register("startTime")}),a.formState.errors.startTime&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.startTime.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"endTime",children:"End Time *"}),e.jsx(G,{id:"endTime",type:"time",...a.register("endTime")}),a.formState.errors.endTime&&e.jsx("p",{className:"text-sm text-red-500",children:a.formState.errors.endTime.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"location",children:"Location"}),e.jsx(G,{id:"location",placeholder:"Enter location (e.g., Conference Room A, Online)",...a.register("location")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"status",children:"Status"}),e.jsxs(se,{value:a.watch("status"),onValueChange:n=>a.setValue("status",n),children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Select status"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"Scheduled",children:"Scheduled"}),e.jsx(w,{value:"Confirmed",children:"Confirmed"}),e.jsx(w,{value:"Completed",children:"Completed"}),e.jsx(w,{value:"Cancelled",children:"Cancelled"}),e.jsx(w,{value:"Rescheduled",children:"Rescheduled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"reminderMinutes",children:"Reminder (minutes before)"}),e.jsx(G,{id:"reminderMinutes",type:"number",min:"0",...a.register("reminderMinutes",{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"notes",children:"Notes"}),e.jsx(fe,{id:"notes",placeholder:"Additional notes",rows:2,...a.register("notes")})]})]})}),e.jsxs(Xe,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:x,disabled:b,children:"Cancel"}),e.jsx(L,{type:"submit",disabled:b,children:b?"Saving...":"Save Appointment"})]})]})})})}const ut=t=>{const l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],j=l[t.getDay()],S=t.getDate(),b=x[t.getMonth()],c=t.getFullYear();return`${j}, ${S}${(D=>{if(D>3&&D<21)return"th";switch(D%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}})(S)} ${b}, ${c}`},pt=()=>{const t=[];for(let l=9;l<=17;l++)t.push(`${l.toString().padStart(2,"0")}:00:00`),l<17&&t.push(`${l.toString().padStart(2,"0")}:30:00`);return t},Lt=()=>{const[t,l]=d.useState(new Date),[x,j]=d.useState("timeline"),[S,b]=d.useState(null),[c,a]=d.useState(null);d.useState(null);const[D,n]=d.useState({isOpen:!1,appointment:null}),[r,m]=d.useState([]),[i,h]=d.useState([]),[T,R]=d.useState(!1),[A,v]=d.useState(!0),[W,q]=d.useState(!1),[U,K]=d.useState(null),[k,X]=d.useState([]),[_,le]=d.useState([]),ce=40,me=pt();d.useEffect(()=>{(async()=>{v(!0),K(null);try{const[o,p,u]=await Promise.all([Y.list("employees"),Y.shiftEmployees.list(),Y.shifts.list({pageSize:1e3})]),y=o.data.map(M=>({EmployeeID:M.EmployeeID,FirstName:M.FirstName||"Unknown",LastName:M.LastName||"Employee",EmployeeCode:M.EmployeeCode})),N=p.data||[],I=y.map(M=>{const F=N.find(B=>B.EmployeeID===M.EmployeeID);return{...M,shiftId:F?F.ShiftID||F.shiftId:void 0}});m(I),le(u.data||[]),i.length===0&&h(I.map(M=>M.EmployeeID))}catch(o){console.error("Error fetching base data:",o),K("Failed to load employee data. Please try again.")}finally{v(!1)}})()},[]),d.useEffect(()=>{const s=async()=>{q(!0);try{const o=E(t,"yyyy-MM-dd"),u=(await Y.appointments.list({exact_filters:{AppointmentDate:o},pageSize:1e3})).data.map(y=>{const N=r.find(I=>I.EmployeeID===y.EmployeeID);return{...y,EmployeeName:N?`${N.FirstName} ${N.LastName}`:"Unknown Employee"}});X(u)}catch(o){console.error("Error fetching appointments:",o)}finally{q(!1)}};r.length>0&&s()},[t,r]);const g=d.useMemo(()=>r.filter(s=>i.includes(s.EmployeeID)),[r,i]),f=s=>{l(s)},E=(s,o)=>{const p=s.getFullYear(),u=String(s.getMonth()+1).padStart(2,"0"),y=String(s.getDate()).padStart(2,"0");return o.replace("yyyy",String(p)).replace("MM",u).replace("dd",y)},C=s=>{const o=Math.floor(s/3600),p=Math.floor(s%3600/60),u=Math.floor(s%60);return`${o.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`},$=s=>{if(typeof s=="number")return Math.floor(s);const o=String(s).split(":"),p=parseInt(o[0])||0,u=parseInt(o[1])||0,y=parseInt(o[2])||0;return p*3600+u*60+y},H=d.useMemo(()=>{const s=new Map;return k.forEach(o=>{var p;if(!s.has(o.EmployeeID)){const u=((p=o.EmployeeName)==null?void 0:p.split(" "))||["Unknown","Employee"],y=u[0],N=u.slice(1).join(" ")||"Employee";s.set(o.EmployeeID,{EmployeeID:o.EmployeeID,FirstName:y,LastName:N})}}),Array.from(s.values())},[k]);d.useEffect(()=>{H.length>0&&i.length===0&&h(H.map(s=>s.EmployeeID))},[H]);const[z,de]=d.useState(""),[P,J]=d.useState("all"),[Q,De]=d.useState("all"),pe=(s,o)=>{const p=r.find(F=>F.EmployeeID===s);if(!(p!=null&&p.shiftId))return console.log(`Employee ${s} has no shift assigned, defaulting to working day`),!0;const y=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][o.getDay()],N=_.find(F=>F.id===p.shiftId);if(!N)return console.log(`No shift data found for shift ID ${p.shiftId}, defaulting to working day`),!0;const I=!!N[y],M=N.isActive!==!1;return console.log(`Employee ${s} (${p.FirstName} ${p.LastName}) - Day: ${y}, ShiftID: ${p.shiftId}, IsWorking: ${I&&M}`,{shift:N}),I&&M},Z=d.useMemo(()=>k.filter(s=>{var M,F,B;const o=s.AppointmentDate,p=E(t,"yyyy-MM-dd"),u=o===p,y=z===""||((M=s.Title)==null?void 0:M.toLowerCase().includes(z.toLowerCase()))||((F=s.Description)==null?void 0:F.toLowerCase().includes(z.toLowerCase()))||((B=s.EmployeeName)==null?void 0:B.toLowerCase().includes(z.toLowerCase())),N=P==="all"||s.Status===P,I=Q==="all"||s.Type===Q;return u&&y&&N&&I}),[k,t,z,P,Q]),Ne=s=>{const o=typeof s=="number"?C(s):s,[p,u]=o.split(":"),y=parseInt(p),N=y>=12?"pm":"am";return`${y>12?y-12:y===0?12:y}:${u}${N}`},ue=s=>{n({isOpen:!0,appointment:s})},we=async(s,o,p)=>{try{const u=k.find(I=>I.AppointmentID===s);if(!u)return;const y={AppointmentID:s,EmployeeID:u.EmployeeID,Title:u.Title,Description:u.Description||"",AppointmentDate:E(t,"yyyy-MM-dd"),StartTime:o||u.StartTime,EndTime:p||u.EndTime,Location:u.Location||"",Type:u.Type||"Meeting",Status:u.Status||"Scheduled",ReminderMinutes:u.ReminderMinutes||15};await Y.appointments.update(s.toString(),y);const N=new Date(t);l(N)}catch(u){console.error("Error resizing appointment:",u)}},Te=(s,o)=>{a(o)},Ee=d.useCallback((s,o)=>{if(s&&o){const p={EmployeeID:s,AppointmentDate:E(t,"yyyy-MM-dd"),StartTime:o,EndTime:C($(o)+3600),Status:"Scheduled",Type:"Meeting"};n({isOpen:!0,appointment:p})}else n({isOpen:!0,appointment:null})},[t]),Me=(s,o,p)=>{s.preventDefault(),b({employeeId:o,time:p})},Ce=async(s,o,p)=>{if(s.preventDefault(),!!c){if(!pe(o,t)){alert("Cannot assign appointment to employee on their day off"),a(null),b(null);return}try{const u=$(p),y=$(c.StartTime),N=$(c.EndTime),I=u-y,M=y+I,F=N+I,B={AppointmentID:c.AppointmentID,EmployeeID:o,Title:c.Title,Description:c.Description||"",AppointmentDate:E(t,"yyyy-MM-dd"),StartTime:typeof c.StartTime=="number"?M:C(M),EndTime:typeof c.EndTime=="number"?F:C(F),Location:c.Location||"",Type:c.Type||"Meeting",Status:c.Status||"Scheduled",ReminderMinutes:c.ReminderMinutes||15};await Y.appointments.update(c.AppointmentID.toString(),B);const Ie=new Date(t);l(Ie),a(null),b(null)}catch(u){console.error("Error updating appointment:",u)}}};return U?e.jsxs(ze,{variant:"destructive",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(Ve,{children:"Error"}),e.jsx(Ye,{children:U})]}):A?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ye,{className:"h-10 w-64"}),e.jsx("div",{className:"grid gap-4",children:Array(5).fill(0).map((s,o)=>e.jsx(ye,{className:"h-20 w-full"},o))})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Ae,{className:"flex flex-col",children:[e.jsx($e,{className:"pb-3",children:e.jsxs(Pe,{value:x,onValueChange:j,className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 pl-4",children:[e.jsxs("div",{className:"text-lg font-semibold flex items-center gap-2",children:[ut(t),W&&e.jsx("div",{className:"h-4 w-4 border-2 border-primary border-t-transparent rounded-full animate-spin"})]}),e.jsxs(Ue,{children:[e.jsxs(ee,{value:"timeline",className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{children:"Timeline Grid"})]}),e.jsxs(ee,{value:"day",className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Day"})]}),e.jsxs(ee,{value:"week",className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{children:"Week"})]}),e.jsxs(ee,{value:"month",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Month"})]})]})]}),e.jsxs(L,{size:"sm",className:"mr-4",onClick:()=>n({isOpen:!0,appointment:null}),children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"New Appointment"]})]}),e.jsxs("div",{className:"flex items-center gap-4 pl-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:"Search appointments...",value:z,onChange:s=>de(s.target.value),className:"pl-10 w-64"})]}),e.jsxs(se,{value:P,onValueChange:J,children:[e.jsx(ne,{className:"w-32",children:e.jsx(re,{placeholder:"Status"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Status"}),e.jsx(w,{value:"Scheduled",children:"Scheduled"}),e.jsx(w,{value:"Confirmed",children:"Confirmed"}),e.jsx(w,{value:"Completed",children:"Completed"}),e.jsx(w,{value:"Cancelled",children:"Cancelled"}),e.jsx(w,{value:"Rescheduled",children:"Rescheduled"})]})]}),e.jsxs(se,{value:Q,onValueChange:De,children:[e.jsx(ne,{className:"w-32",children:e.jsx(re,{placeholder:"Type"})}),e.jsxs(ae,{children:[e.jsx(w,{value:"all",children:"All Types"}),e.jsx(w,{value:"Meeting",children:"Meeting"}),e.jsx(w,{value:"Interview",children:"Interview"}),e.jsx(w,{value:"Training",children:"Training"}),e.jsx(w,{value:"Review",children:"Review"}),e.jsx(w,{value:"OneOnOne",children:"One-on-One"}),e.jsx(w,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>{const s=new Date(t);x==="month"?s.setMonth(t.getMonth()-1):x==="week"?s.setDate(t.getDate()-7):s.setDate(t.getDate()-1),f(s)},children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>f(new Date),children:"Today"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>{const s=new Date(t);x==="month"?s.setMonth(t.getMonth()+1):x==="week"?s.setDate(t.getDate()+7):s.setDate(t.getDate()+1),f(s)},children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsxs(L,{size:"sm",variant:"outline",className:"ml-2",onClick:()=>R(!T),children:[e.jsx(be,{className:"h-4 w-4"}),"Employees"]})]})]}),T&&e.jsxs("div",{className:"mb-4 p-3 border rounded-lg bg-muted/50 max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Select Employees to Display:"}),e.jsx("div",{className:"space-y-2",children:r.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-muted/30 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:i.includes(s.EmployeeID),onChange:o=>{o.target.checked?h([...i,s.EmployeeID]):h(i.filter(p=>p!==s.EmployeeID))},className:"rounded"}),e.jsxs("span",{className:"text-sm",children:[s.FirstName," ",s.LastName]})]},s.EmployeeID))})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(te,{value:"timeline",className:"mt-0",children:e.jsx(ot,{selectedDate:t,appointments:Z,employees:g,onDateChange:f,onDragStart:Te,onDrop:Ce,onDragOver:Me,onDragLeave:()=>b(null),dragOverSlot:S,timeSlots:me,onAppointmentResize:we,onCreateAppointment:Ee,slotHeight:ce,isEmployeeWorkingOnDay:pe,formatTime:Ne})}),e.jsx(te,{value:"day",className:"mt-0",children:e.jsx(ct,{selectedDate:t,appointments:Z,onDateChange:f,onAppointmentClick:ue})}),e.jsx(te,{value:"week",className:"mt-0",children:e.jsx(lt,{selectedDate:t,appointments:Z,onDateChange:f,onAppointmentClick:ue})}),e.jsx(te,{value:"month",className:"mt-0",children:e.jsx(it,{selectedDate:t,appointments:Z,onDateChange:f,onAppointmentClick:ue})})]})]})}),e.jsx(Oe,{className:"overflow-hidden p-0"}),D.isOpen&&e.jsx(dt,{initialData:D.appointment,onSubmit:async s=>{try{D.appointment&&D.appointment.AppointmentID?await Y.appointments.update(D.appointment.AppointmentID.toString(),s):await Y.appointments.create(s);const o=E(t,"yyyy-MM-dd"),u=(await Y.appointments.list({date:o,page:0,pageSize:1e3})).data.map(y=>{const N=r.find(I=>I.EmployeeID===y.EmployeeID);return{...y,EmployeeName:N?`${N.FirstName} ${N.LastName}`:"Unknown Employee"}});X(u),n({isOpen:!1,appointment:null})}catch(o){console.error("Error saving appointment:",o)}},onCancel:()=>n({isOpen:!1,appointment:null})})]})})};export{Lt as default};
