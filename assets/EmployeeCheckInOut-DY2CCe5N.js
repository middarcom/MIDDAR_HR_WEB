import{v as H,r as d,j as e,C as v,e as N,f as k,g as b,h as L,n as u,B as E,_ as i}from"./index-Bt_qYF7e.js";import{L as o}from"./label-CTvvvVeK.js";import{C as O}from"./checkbox-T_0lB5pP.js";import{I}from"./input-Cs0r3c1h.js";import{a as g}from"./api-BYTcMetT.js";import"./index-da16CiNc.js";const _=()=>{const{user:c}=H(),[t,C]=d.useState(null),[h,M]=d.useState(new Date),[w,y]=d.useState(!0),[n,x]=d.useState({checkIn:!1,checkOut:!1}),[l,j]=d.useState(!1),[s,p]=d.useState({hours:"",minutes:""});d.useEffect(()=>{(async()=>{if(!(c!=null&&c.email)){console.error("No user email found");return}try{y(!0);const m=await g.employees.list({exact_filters:{Email:c.email}});m.data&&m.data.length>0?C(m.data[0]):(console.error("No employee found with email:",c.email),i.error("Employee record not found"))}catch(m){console.error("Error fetching employee:",m),i.error("Failed to load employee data. Please try again.")}finally{y(!1)}})();const r=setInterval(()=>M(new Date),1e3);return()=>clearInterval(r)},[c==null?void 0:c.email]),d.useEffect(()=>{t||(j(!1),p({hours:"",minutes:""}))},[t]);const f=()=>{if(l&&s.hours&&s.minutes){const a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),parseInt(s.hours),parseInt(s.minutes))}return new Date},D=async()=>{if(!t){i.error("Employee data not loaded");return}if(l&&(!s.hours||!s.minutes)){i.error("Please enter manual time (hours and minutes)");return}x({...n,checkIn:!0});try{await g.create("timeattendance",{EmployeeID:t.EmployeeID,AttendanceDate:u(f(),"yyyy-MM-dd HH:mm:ss")}),i.success("Successfully checked in")}catch(a){console.error("Error checking in:",a),i.error("Failed to check in")}finally{x({...n,checkIn:!1})}},S=async()=>{if(!t){i.error("Employee data not loaded");return}if(l&&(!s.hours||!s.minutes)){i.error("Please enter manual time (hours and minutes)");return}x({...n,checkOut:!0});try{await g.create("timeattendance",{EmployeeID:t.EmployeeID,AttendanceDate:u(f(),"yyyy-MM-dd HH:mm:ss")}),i.success("Successfully checked out")}catch(a){console.error("Error checking out:",a),i.error("Failed to check out")}finally{x({...n,checkOut:!1})}},T=a=>a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return w?e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(k,{children:"Loading..."})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"h-8 bg-muted rounded w-1/2"}),e.jsx("div",{className:"h-12 bg-muted rounded w-1/4"})]})})]})}):e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs(v,{className:"max-w-2xl mx-auto",children:[e.jsxs(N,{children:[e.jsx(k,{children:"Check-In / Check-Out"}),e.jsx(L,{children:"Record your attendance with a single click"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Employee"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:t?e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[t.FirstName," ",t.LastName]}),e.jsx("div",{className:"text-sm text-gray-600",children:t.Email})]}):e.jsx("span",{className:"text-gray-400",children:"Loading employee data..."})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Status"}),e.jsx("div",{className:"h-10 flex items-center",children:t?e.jsx("span",{className:"text-green-600 font-medium",children:"Ready to record attendance"}):e.jsx("span",{className:"text-gray-400",children:"Loading employee data..."})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Current Date"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:u(h,"EEEE, MMMM d, yyyy")})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Current Time"}),e.jsx("div",{className:"p-2 border rounded-md bg-muted/30",children:u(h,"HH:mm:ss")})]})]}),e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-blue-50/50 dark:bg-blue-900/10",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"manual-mode",checked:l,onCheckedChange:a=>{j(a),a||p({hours:"",minutes:""})}}),e.jsx(o,{htmlFor:"manual-mode",className:"text-sm font-medium",children:"Manual Time Entry"})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"manual-hours",children:"Hours (0-23)"}),e.jsx(I,{id:"manual-hours",type:"number",min:"0",max:"23",placeholder:"HH",value:s.hours,onChange:a=>{const r=a.target.value;(r===""||parseInt(r)>=0&&parseInt(r)<=23)&&p({...s,hours:r})},className:"w-full"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"manual-minutes",children:"Minutes (0-59)"}),e.jsx(I,{id:"manual-minutes",type:"number",min:"0",max:"59",placeholder:"MM",value:s.minutes,onChange:a=>{const r=a.target.value;(r===""||parseInt(r)>=0&&parseInt(r)<=59)&&p({...s,minutes:r})},className:"w-full"})]})]}),l&&e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 p-2 rounded",children:["Manual time will be used: ",s.hours.padStart(2,"0"),":",s.minutes.padStart(2,"0")]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4",children:[e.jsx(E,{onClick:D,disabled:!t||n.checkIn||n.checkOut||l&&(!s.hours||!s.minutes),variant:"default",className:"w-full",size:"lg",children:n.checkIn?"Processing...":"Check In"}),e.jsx(E,{onClick:S,disabled:!t||n.checkIn||n.checkOut||l&&(!s.hours||!s.minutes),variant:"outline",className:"w-full",size:"lg",children:n.checkOut?"Processing...":"Check Out"})]}),e.jsx("div",{className:"mt-6 p-4 bg-muted/30 rounded-md",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:["Time to use: ",l&&s.hours&&s.minutes?`${s.hours.padStart(2,"0")}:${s.minutes.padStart(2,"0")} (Manual)`:T(h)+" (Current)"]}),e.jsxs("div",{children:["Date: ",u(h,"MMM d, yyyy")]}),l&&e.jsx("div",{className:"text-blue-600 font-medium",children:"Manual mode enabled - Enter time above to proceed"})]})})]})})]})})};export{_ as default};
