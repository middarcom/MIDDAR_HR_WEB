import{r as i,j as e,C as k,e as z,f as L,g as $,B as A,P as v,k as F,n as f,_ as d}from"./index-Bt_qYF7e.js";import{I as x}from"./input-Cs0r3c1h.js";import{L as h}from"./label-CTvvvVeK.js";import{S as q,a as B,b as J,c as V,d as G}from"./select-AiO2ANK_.js";import{P as T,b,c as N,C as w}from"./popover-VONLzH8b.js";import{a as C}from"./api-BYTcMetT.js";import{E as O}from"./EmployeeDropdown-DI7Wva_F.js";import"./index-da16CiNc.js";import"./getDaysInMonth-DEtwUiq9.js";import"./chevron-left-3DLBy2_V.js";import"./loader-circle-d-5q11Hx.js";const ae=({EmployeeID:g})=>{const[W,m]=i.useState([]);i.useState([]),i.useState(!1);const[P,I]=i.useState([]),[j,D]=i.useState(!1),[s,l]=i.useState({ArchEmp:g||"",ArchType:"",ArchNote:"",ArchRef:"",ArchStartDate:"",ArchEndDate:"",ArchFile:"",IsActive:1}),[E,S]=i.useState(!1),[p,u]=i.useState({});i.useEffect(()=>{(async()=>{try{D(!0);const r=await C.list("archtype");console.log("Arch types response:",r),I(r.data||[])}catch(r){console.error("Error fetching arch types:",r),d.error("Failed to load document types")}finally{D(!1)}})()},[]);const M=t=>new Promise((r,a)=>{const n=new FileReader;n.readAsDataURL(t),n.onload=()=>{const o=n.result;if(o.startsWith("data:"))r(o);else{const c=`data:${t.type};base64,${o}`;r(c)}},n.onerror=o=>{console.error("Error reading file:",o),a(o)}}),R=async t=>{const r=t.target.files;if(!r||r.length===0){m([]),l(c=>({...c,ArchFile:""}));return}const a=r[0];if(!["image/jpeg","image/png","application/pdf"].includes(a.type)){d.error("Unsupported file type. Please upload a JPG, PNG, or PDF file.");return}const o=10*1024*1024;if(a.size>o){d.error("File size exceeds 10MB limit");return}try{const c=await M(a);m([a]),l(y=>({...y,ArchFile:c})),console.log("File processed:",{name:a.name,size:a.size,type:a.type,base64Preview:c.substring(0,50)+"..."})}catch(c){console.error("Error processing file:",c),d.error("Failed to process the file. Please try again."),m([]),l(y=>({...y,ArchFile:""}))}},U=async t=>{t.preventDefault();const r={};if(s.ArchEmp||(r.ArchEmp=!0),s.ArchType||(r.ArchType=!0),s.ArchFile||(r.ArchFile=!0),Object.keys(r).length>0){u(r),d.error("Please complete all required fields: Employee, Document Type, and File");return}u({});try{let a=s.ArchFile;if(typeof a=="string"&&a.startsWith("["))try{const c=JSON.parse(a);Array.isArray(c)&&c.length>0&&(a=c[0].base64)}catch(c){console.error("Error parsing file data:",c)}const n={...s,ArchEmp:Number(s.ArchEmp),ArchFile:a,ArchStartDate:s.ArchStartDate||null,ArchEndDate:s.ArchEndDate||null};console.log("Submitting document with file data:",{...n,ArchFile:typeof a=="string"?a.substring(0,100)+"...":"File data preview not available"}),S(!0);const o=await C.create("arch",n);console.log("API Response:",o),d.success("Document uploaded successfully"),l({ArchEmp:g||"",ArchType:"",ArchNote:"",ArchRef:"",ArchStartDate:"",ArchEndDate:"",ArchFile:"",IsActive:1}),m([])}catch(a){console.error("Error uploading document:",a),d.error(`Failed to upload document: ${a instanceof Error?a.message:"Unknown error"}`)}finally{S(!1)}};return e.jsxs(k,{children:[e.jsx(z,{children:e.jsx(L,{children:"Upload Document"})}),e.jsx($,{className:"max-h-[calc(100vh-200px)] overflow-y-auto p-6",children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Employee"}),e.jsx(O,{value:s.ArchEmp,onValueChange:t=>{l(r=>({...r,ArchEmp:t})),t&&u(r=>({...r,ArchEmp:!1}))},placeholder:"Select Employee",employmentStatus:"Active",className:p.ArchEmp?"border-red-500 focus:border-red-500":""}),p.ArchEmp&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Employee is required"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Document Type"}),e.jsxs(q,{onValueChange:t=>{l(r=>({...r,ArchType:t})),t&&u(r=>({...r,ArchType:!1}))},disabled:j,children:[e.jsx(B,{className:p.ArchType?"border-red-500 focus:border-red-500":"",children:e.jsx(J,{placeholder:j?"Loading types...":"Select Type"})}),e.jsx(V,{children:P.map(t=>e.jsx(G,{value:t.ArchTypeID.toString(),children:t.ArchTypeName||`Type ${t.ArchTypeID}`},t.ArchTypeID))})]}),p.ArchType&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Document type is required"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Reference"}),e.jsx(x,{type:"text",value:s.ArchRef,onChange:t=>l(r=>({...r,ArchRef:t.target.value}))})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{children:"Start Date"}),e.jsxs(T,{children:[e.jsx(b,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:v("w-full justify-start text-left font-normal",!s.ArchStartDate&&"text-muted-foreground"),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),s.ArchStartDate?f(new Date(s.ArchStartDate),"yyyy-MM-dd"):"Pick a date"]})}),e.jsx(N,{className:"w-auto p-0",children:e.jsx(w,{mode:"single",selected:s.ArchStartDate?new Date(s.ArchStartDate):void 0,onSelect:t=>{t&&l(r=>({...r,ArchStartDate:f(t,"yyyy-MM-dd")}))}})})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{children:"End Date / Expiry Date"}),e.jsxs(T,{children:[e.jsx(b,{asChild:!0,children:e.jsxs(A,{variant:"outline",className:v("w-full justify-start text-left font-normal",!s.ArchEndDate&&"text-muted-foreground"),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),s.ArchEndDate?f(new Date(s.ArchEndDate),"yyyy-MM-dd"):"Pick a date"]})}),e.jsx(N,{className:"w-auto p-0",children:e.jsx(w,{mode:"single",selected:s.ArchEndDate?new Date(s.ArchEndDate):void 0,onSelect:t=>{t&&l(r=>({...r,ArchEndDate:f(t,"yyyy-MM-dd")}))}})})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Notes"}),e.jsx(x,{type:"text",value:s.ArchNote,onChange:t=>l(r=>({...r,ArchNote:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Upload File"}),e.jsx(x,{type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:R,className:p.ArchFile?"border-red-500 focus:border-red-500":""}),p.ArchFile&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"File is required"})]}),e.jsx("div",{className:"text-right",children:e.jsx(A,{type:"submit",disabled:E||!s.ArchFile,children:E?"Uploading...":"Upload Document"})})]})})]})};export{ae as default};
