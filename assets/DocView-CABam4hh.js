import{l as Y,r as n,j as e,B as v,C as k,g as _,a as j,J as q,S as he,e as V,f as z,h as me,d as Q,aP as d,n as ue,ar as Te,aU as Ie,F as ke}from"./index-Bt_qYF7e.js";import{I as S}from"./input-Cs0r3c1h.js";import{S as K,a as W,c as Z,d as U,b as pe}from"./select-AiO2ANK_.js";import{C as xe}from"./date-picker-CRhZKckn.js";import{D as ee,e as _e,a as te,b as se,c as ae,d as Le,f as Pe}from"./dialog-CWEZULTY.js";import{L as N}from"./label-CTvvvVeK.js";import{T as Me,b as ye,c as fe}from"./tabs-nV_fVNZu.js";import{S as Ue}from"./ScrollableTabs-XdD_Oxex.js";import{T as Re}from"./textarea-B53SCRvp.js";import{P as Be}from"./plus-De3WeMOg.js";import{S as je}from"./square-pen-BdpVwC-X.js";import{T as Ne}from"./trash-2-ixp3286y.js";import{F as $e}from"./filter-vh9_Ffox.js";import{E as Oe}from"./eye-DRNexzEP.js";import"./index-da16CiNc.js";import"./popover-VONLzH8b.js";import"./getDaysInMonth-DEtwUiq9.js";import"./chevron-left-3DLBy2_V.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Y("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=Y("FilePenLine",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=Y("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),qe=({categories:i,onAdd:u,onEdit:y,onDelete:f})=>{const[L,C]=n.useState(!1),[p,E]=n.useState(null),[m,h]=n.useState({name:"",description:"",color:"#3B82F6"}),A=()=>{p?(y(p.id,m),E(null)):(u(m),C(!1)),h({name:"",description:"",color:"#3B82F6"})},T=l=>{E(l),h({name:l.name,description:l.description,color:l.color})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Categories"}),e.jsxs(ee,{open:L,onOpenChange:C,children:[e.jsx(_e,{asChild:!0,children:e.jsxs(v,{children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Add Category"]})}),e.jsxs(te,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Add Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name",children:"Name"}),e.jsx(S,{id:"name",value:m.name,onChange:l=>h(g=>({...g,name:l.target.value})),placeholder:"Category name"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"description",children:"Description"}),e.jsx(Re,{id:"description",value:m.description,onChange:l=>h(g=>({...g,description:l.target.value})),placeholder:"Category description"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"color",children:"Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"color",type:"color",value:m.color,onChange:l=>h(g=>({...g,color:l.target.value})),className:"w-16 h-10"}),e.jsx(S,{value:m.color,onChange:l=>h(g=>({...g,color:l.target.value})),placeholder:"#3B82F6",className:"flex-1"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsxs(v,{onClick:A,children:[p?"Update":"Add"," Category"]})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(l=>e.jsx(k,{className:"hover:shadow-md transition-shadow",children:e.jsxs(_,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:l.color}}),e.jsx("h4",{className:"font-medium",children:l.name})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>T(l),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>f(l.id),className:"text-red-600 hover:text-red-700",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:l.description})]})},l.id))})]})},X=[{value:"passport",label:"Passport"},{value:"photo",label:"Photo"},{value:"cpr/iqama",label:"CPR / IQAMA"},{value:"medical_certificate",label:"Medical Certificate"},{value:"employment_contract",label:"Employment Contract"},{value:"leave_contract",label:"Leave Contract"},{value:"visa",label:"Visa"},{value:"insurance",label:"Insurance"},{value:"other",label:"Other"}],He=i=>{switch(i){case"passport":return e.jsx(ke,{className:"h-5 w-5 text-blue-500"});case"photo":case"cpr/iqama":return e.jsx(q,{className:"h-5 w-5 text-green-500"});case"medical_certificate":return e.jsx(Ve,{className:"h-5 w-5 text-red-500"});case"employment_contract":return e.jsx(ze,{className:"h-5 w-5 text-purple-500"});case"leave_contract":return e.jsx(Ie,{className:"h-5 w-5 text-amber-500"});case"visa":case"insurance":case"other":default:return e.jsx(G,{className:"h-5 w-5 text-gray-500"})}},De=i=>{const u=X.find(y=>y.value===i);return u?u.label:i},ve=i=>{if(!i)return"N/A";const u=new Date(i);return isNaN(u.getTime())?"Invalid Date":u.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},ht=()=>{const[i,u]=n.useState([]),[y,f]=n.useState([]),[L,C]=n.useState([]),[p,E]=n.useState(null),[m,h]=n.useState(!1),[A,T]=n.useState(""),[l,g]=n.useState("all"),[b,F]=n.useState(""),[R,H]=n.useState(!1),[P,Ae]=n.useState("documents");n.useState({sortBy:"createdDate",sortOrder:"desc"}),n.useState([]),n.useState([]),n.useState("all"),n.useState(!1);const[we,B]=n.useState(!1),[w,re]=n.useState(null),[x,ce]=n.useState({title:"",description:"",documentType:"",status:"active",startDate:"",endDate:""}),Ce=async s=>{try{const t=parseInt(s,10);if(isNaN(t))return d({title:"Invalid Employee ID",description:"Please enter a valid employee ID",variant:"destructive"}),[];console.log("Fetching employee with ID:",t);const r=await j.list("employees",{exact_filters:{EmployeeID:t},select_fields:["EmployeeID","FirstName","LastName"].join(",")});if(console.log("Employee response:",r),!r.data||r.data.length===0)return d({title:"Employee Not Found",description:`No employee found with ID: ${s}`,variant:"destructive"}),[];console.log("Fetching documents for employee ID:",t);const a=await j.list("arch",{exact_filters:{ArchEmp:t},select_fields:["ArchID","ArchEmp","ArchType","ArchNote","ArchRef","ArchStartDate","ArchEndDate","CreatedDate","UpdatedDate","IsActive","employees_FirstName","employees_LastName"]});if(console.log("Documents response:",a),!a.data)return d({title:"No Documents Found",description:`No documents found for employee ID: ${s}`,variant:"destructive"}),[];const D=a.data.map(c=>{var M;return console.log("Employee document item:",c),console.log("ArchFile value:",c.ArchFile),console.log("ArchFile type:",typeof c.ArchFile),{id:c.ArchID,employeeId:c.ArchEmp,documentType:((M=c.ArchType)==null?void 0:M.toString())||"unknown",title:c.ArchNote||"Untitled Document",description:c.ArchRef||"",fileName:c.ArchFile,fileSize:0,mimeType:"application/octet-stream",uploadDate:c.CreatedDate,expiryDate:c.ArchEndDate,status:c.IsActive?"active":"archived",tags:[],categories:[c.ArchType],currentVersion:{id:1,documentId:c.ArchID,versionNumber:1,fileName:c.ArchFile,fileSize:0,checksum:"",uploadedBy:c.ArchEmp,uploadDate:c.CreatedDate,isCurrent:!0,changeNote:"Initial version"},versions:[],signatures:[],expiryNotifications:[],ocrResult:null,metadata:[],visibility:"private",retentionPeriod:365,complianceFlags:[],ArchID:c.ArchID,ArchEmp:c.ArchEmp,ArchType:c.ArchType,ArchNote:c.ArchNote,ArchRef:c.ArchRef,ArchStartDate:c.ArchStartDate,ArchEndDate:c.ArchEndDate,CreatedDate:c.CreatedDate,UpdatedDate:c.UpdatedDate,IsActive:c.IsActive,ArchFile:c.ArchFile,employees_FirstName:c.employees_FirstName,employees_LastName:c.employees_LastName}}).sort((c,M)=>{const oe=c.ArchType||0,de=M.ArchType||0;if(oe!==de)return oe-de;const Ee=new Date(c.CreatedDate||0).getTime();return new Date(M.CreatedDate||0).getTime()-Ee});return u(D),f(D),H(!0),D}catch(t){return console.error("Error fetching documents:",t),d({title:"Error",description:"Failed to fetch documents. Please try again.",variant:"destructive"}),[]}},J=async()=>{try{h(!0),console.log("Fetching all documents...");const s=await j.list("arch",{select_fields:["ArchID","ArchEmp","ArchType","ArchNote","ArchRef","ArchStartDate","ArchEndDate","CreatedDate","UpdatedDate","IsActive","employees_FirstName","employees_LastName"]});if(console.log("All documents response:",s),!s.data)return d({title:"No Documents Found",description:"No documents found in the system",variant:"destructive"}),[];const r=s.data.map(a=>{console.log("All documents item:",a),console.log("ArchFile value:",a.ArchFile),console.log("ArchFile type:",typeof a.ArchFile);let o=a.ArchFile;if(typeof o=="string")try{o=JSON.parse(o)}catch(D){console.warn("Failed to parse ArchFile JSON:",D),o={name:"document",size:0,type:"application/octet-stream"}}return{ArchID:a.ArchID,ArchEmp:a.ArchEmp,ArchType:a.ArchType||0,ArchNote:a.ArchNote||"Untitled Document",ArchRef:a.ArchRef||"",ArchStartDate:a.ArchStartDate||new Date().toISOString(),ArchEndDate:a.ArchEndDate||"",CreatedDate:a.CreatedDate||new Date().toISOString(),UpdatedDate:a.UpdatedDate||new Date().toISOString(),IsActive:a.IsActive!==!1,ArchFile:a.ArchFile,employees_FirstName:a.employees_FirstName||"",employees_LastName:a.employees_LastName||"",categories:[],tags:[],versions:[],signatures:[],expiryNotifications:[],ocrResult:null,metadata:[],complianceFlags:[]}}).sort((a,o)=>{const D=`${a.employees_FirstName||""} ${a.employees_LastName||""}`.toLowerCase(),c=`${o.employees_FirstName||""} ${o.employees_LastName||""}`.toLowerCase();return D<c?-1:D>c?1:(a.ArchType||0)-(o.ArchType||0)});return u(r),f(r),r}catch(s){return console.error("Error fetching documents:",s),d({title:"Error",description:"Failed to fetch documents. Please try again.",variant:"destructive"}),[]}finally{h(!1)}},$=async()=>{const s=b.trim();if(!s){d({title:"Missing Employee ID",description:"Please enter an employee ID",variant:"destructive"});return}h(!0),H(!0);try{const t=await Ce(s);u(t),f(t),t.length===0&&d({title:"No Documents Found",description:`No documents found for employee ID: ${s}`,variant:"destructive"})}catch(t){console.error("Error searching documents:",t),d({title:"Search Error",description:"Failed to fetch documents. Please try again.",variant:"destructive"}),u([]),f([])}finally{h(!1)}},Fe=s=>{s.key==="Enter"&&$()};n.useEffect(()=>{O(),Se()},[]),n.useEffect(()=>{P==="documents"&&J()},[P]);const le=s=>{var r;const t=i.find(a=>a.id===s);t&&(re(t),ce({title:t.title||t.ArchNote||"",description:t.description||t.ArchRef||"",documentType:((r=t.documentType)==null?void 0:r.toString())||"",status:t.status==="active"?"active":"archived",startDate:t.uploadDate||t.ArchStartDate||"",endDate:t.expiryDate||t.ArchEndDate||""}),B(!0))},be=async()=>{if(w)try{h(!0),await j.update("arch",w.id,{ArchNote:x.title,ArchRef:x.description,ArchType:x.documentType,ArchStartDate:x.startDate,ArchEndDate:x.endDate,IsActive:x.status==="active"}),P==="documents"?await J():R&&await $(),B(!1),re(null),d({title:"Document Updated",description:"Document has been successfully updated",variant:"default"})}catch(s){console.error("Error updating document:",s),d({title:"Update Error",description:"Failed to update document. Please try again.",variant:"destructive"})}finally{h(!1)}},ne=async s=>{if(confirm("Are you sure you want to delete this document? This action cannot be undone."))try{h(!0),await j.delete("arch",s),P==="documents"?await J():R&&await $(),d({title:"Document Deleted",description:"Document has been successfully deleted",variant:"default"})}catch(t){console.error("Error deleting document:",t),d({title:"Delete Error",description:"Failed to delete document. Please try again.",variant:"destructive"})}finally{h(!1)}},I=(s,t)=>{ce(r=>({...r,[s]:t}))};n.useEffect(()=>{if(i.length>0){const s=i.filter(t=>{const r=(t.title||"").toString(),a=(t.description||"").toString(),o=`Employee ${t.employeeId||"Unknown"}`,D=A===""||r.toLowerCase().includes(A.toLowerCase())||a.toLowerCase().includes(A.toLowerCase())||o.toLowerCase().includes(A.toLowerCase()),c=l==="all"||t.documentType&&t.documentType.toString()===l;return D&&c});f(s)}},[i,A,l]);const ie=s=>{try{let t=[];if(!s.fileName&&!s.ArchFile)return[];const r=s.fileName||s.ArchFile;if(typeof r=="string"&&r)if(r.startsWith("data:"))t=[{url:r,name:"document",type:r.split(";")[0].split(":")[1]||"application/octet-stream"}];else try{const a=JSON.parse(r);t=Array.isArray(a)?a:[a]}catch{t=[{url:r,name:"document",type:"application/octet-stream"}]}else Array.isArray(r)?t=r:r&&(t=[r]);return t.length===0&&(t=[{url:"",name:"No file",type:"application/octet-stream"}]),(Array.isArray(t)?t:[t]).filter(a=>a&&(a.url||a.base64||a.data||a.name==="No file"))}catch(t){return console.error("Error processing document files:",t,s),[]}},O=async()=>{try{const s=await j.list("archtype");C(s.data.map(t=>{var r;return{id:t.ArchTypeID,name:((r=t.ArchTypeName)==null?void 0:r.toString())||"",description:t.ArchTypeNote||"",color:"#3B82F6",isActive:t.IsActive}}))}catch(s){console.error("Error fetching categories:",s)}},Se=async()=>{try{const s=await j.list("arch");E({totalDocuments:s.data.length,activeDocuments:s.data.filter(t=>t.IsActive).length,archivedDocuments:s.data.filter(t=>!t.IsActive).length,documentsByType:s.data.reduce((t,r)=>(t[r.ArchType]=(t[r.ArchType]||0)+1,t),{}),recentUploads:s.data.filter(t=>t.CreatedDate).sort((t,r)=>new Date(r.CreatedDate).getTime()-new Date(t.CreatedDate).getTime()).slice(0,10)})}catch(s){console.error("Error fetching stats:",s)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Document Viewer"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage employee documents"})]}),e.jsx(k,{children:e.jsx(_,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Enter Employee ID",value:b,onChange:s=>F(s.target.value.replace(/\D/g,"")),onKeyPress:Fe,className:"pl-10",disabled:m})]}),e.jsxs(v,{onClick:$,disabled:!b.trim()||m,className:"px-6",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),m?"Searching...":"Search"]})]}),R&&e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{children:"Search within results"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Search documents...",className:"pl-10",value:A,onChange:s=>T(s.target.value)})]})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx(N,{children:"Document Type"}),e.jsxs(K,{value:l,onValueChange:g,children:[e.jsxs(W,{children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),l==="all"?"All Documents":De(l)]}),e.jsxs(Z,{children:[e.jsx(U,{value:"all",children:"All Documents"}),X.map(s=>e.jsx(U,{value:s.value,children:s.label},s.value))]})]})]})]})]})})}),e.jsxs(Me,{value:P,onValueChange:Ae,className:"w-full",children:[e.jsxs(Ue,{className:"md:grid md:grid-cols-2",children:[e.jsx(ye,{value:"documents",children:"Documents"}),e.jsx(ye,{value:"categories",children:"Categories"})]}),e.jsx(fe,{value:"documents",className:"mt-6",children:R?e.jsxs(k,{children:[e.jsxs(V,{children:[e.jsxs(z,{children:["Search Results (",y.length," documents)"]}),e.jsxs(me,{children:["Documents found for employee ID: ",b]})]}),e.jsx(_,{children:m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):y.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"No documents found matching your criteria"}),e.jsx(v,{onClick:()=>{H(!1),F(""),u([]),f([])},variant:"outline",className:"mt-4",children:"Clear Search & Show All Documents"})]}):e.jsx("div",{className:"space-y-6",children:(()=>{const s=y.reduce((t,r)=>{const a=`${r.employees_FirstName||"Unknown"} ${r.employees_LastName||"Employee"} (${r.ArchEmp})`;return t[a]||(t[a]=[]),t[a].push(r),t},{});return Object.entries(s).map(([t,r])=>e.jsxs(k,{className:"overflow-hidden",children:[e.jsx(V,{className:"bg-gray-50 dark:bg-gray-800 pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600"}),e.jsx(z,{className:"text-lg",children:t}),e.jsxs(Q,{variant:"secondary",children:[r.length," documents"]})]})})}),e.jsx(_,{className:"pt-4",children:e.jsx("div",{className:"space-y-3",children:r.map(a=>{try{const o=ie(a);return e.jsx(ge,{document:a,files:o,onDelete:ne,onEdit:le},`doc-${a.id}`)}catch(o){return console.error("Error parsing document files:",o,a),null}})})})]},t))})()})})]}):e.jsxs(k,{children:[e.jsxs(V,{children:[e.jsx(z,{children:"Document Management"}),e.jsx(me,{children:"Manage and organize your documents with advanced features"})]}),e.jsx(_,{children:m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):y.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No documents found"})}):e.jsx("div",{className:"space-y-6",children:(()=>{const s=y.reduce((t,r)=>{const a=`${r.employees_FirstName||"Unknown"} ${r.employees_LastName||"Employee"} (${r.ArchEmp})`;return t[a]||(t[a]=[]),t[a].push(r),t},{});return Object.entries(s).map(([t,r])=>e.jsxs(k,{className:"overflow-hidden",children:[e.jsx(V,{className:"bg-gray-50 dark:bg-gray-800 pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600"}),e.jsx(z,{className:"text-lg",children:t}),e.jsxs(Q,{variant:"secondary",children:[r.length," documents"]})]})})}),e.jsx(_,{className:"pt-4",children:e.jsx("div",{className:"space-y-3",children:r.map(a=>{try{const o=ie(a);return e.jsx(ge,{document:a,files:o,onDelete:ne,onEdit:le},`doc-${a.id}`)}catch(o){return console.error("Error parsing document files:",o,a),null}})})})]},t))})()})})]})}),e.jsx(fe,{value:"categories",children:e.jsx(qe,{categories:L,onAdd:async s=>{try{await j.documents.createCategory(s),O(),d({title:"Category Created",description:"Category has been successfully created",variant:"default"})}catch{d({title:"Create Error",description:"Failed to create category. Please try again.",variant:"destructive"})}},onEdit:async(s,t)=>{try{await j.documents.updateCategory(s,t),O(),d({title:"Category Updated",description:"Category has been successfully updated",variant:"default"})}catch{d({title:"Update Error",description:"Failed to update category. Please try again.",variant:"destructive"})}},onDelete:async s=>{try{await j.documents.deleteCategory(s),O(),d({title:"Category Deleted",description:"Category has been successfully deleted",variant:"default"})}catch{d({title:"Delete Error",description:"Failed to delete category. Please try again.",variant:"destructive"})}}})})]}),e.jsx(ee,{open:we,onOpenChange:B,children:e.jsxs(te,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Edit Document"}),e.jsxs(Le,{children:["Update document information for ",w==null?void 0:w.employees_FirstName," ",w==null?void 0:w.employees_LastName]})]}),w&&e.jsx("div",{className:"space-y-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"title",children:"Document Title"}),e.jsx(S,{id:"title",value:x.title,onChange:s=>I("title",s.target.value),placeholder:"Enter document title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"documentType",children:"Document Type"}),e.jsxs(K,{value:x.documentType,onValueChange:s=>I("documentType",s),children:[e.jsx(W,{children:e.jsx(pe,{placeholder:"Select document type"})}),e.jsx(Z,{children:X.map(s=>e.jsx(U,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Description"}),e.jsx(S,{id:"description",value:x.description,onChange:s=>I("description",s.target.value),placeholder:"Enter description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"status",children:"Status"}),e.jsxs(K,{value:x.status,onValueChange:s=>I("status",s),children:[e.jsx(W,{children:e.jsx(pe,{placeholder:"Select status"})}),e.jsxs(Z,{children:[e.jsx(U,{value:"active",children:"Active"}),e.jsx(U,{value:"archived",children:"Archived"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"startDate",children:"Start Date"}),e.jsx(xe,{date:x.startDate?new Date(x.startDate):void 0,onChange:s=>I("startDate",s?ue(s,"yyyy-MM-dd"):"")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"endDate",children:"End Date"}),e.jsx(xe,{date:x.endDate?new Date(x.endDate):void 0,onChange:s=>I("endDate",s?ue(s,"yyyy-MM-dd"):"")})]})]})}),e.jsxs(Pe,{children:[e.jsx(v,{variant:"outline",onClick:()=>B(!1),children:"Cancel"}),e.jsx(v,{onClick:be,children:"Save Changes"})]})]})})]})},ge=({document:i,files:u,onDelete:y,onEdit:f})=>{const[L,C]=n.useState(!1),[p,E]=n.useState(null),[m,h]=n.useState(!1),T={1:"passport",2:"cpr/iqama",3:"photo",4:"medical_certificate",5:"employment_contract",6:"leave_contract",7:"visa",8:"insurance",9:"other"}[i.ArchType]||"other",l=async b=>{try{h(!0);const F=await j.list("arch",{exact_filters:{ArchID:b},select_fields:["ArchFile"]});F.data&&F.data.length>0&&E(F.data[0].ArchFile)}catch(F){console.error("Error fetching ArchFile:",F)}finally{h(!1)}},g=()=>{C(!0),l(i.ArchID)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-1.5 rounded bg-gray-100 dark:bg-gray-800",children:He(T)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:i.ArchNote||"Untitled Document"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[De(T)," â€¢ Ref: ",i.ArchRef||"N/A"]}),e.jsxs("div",{className:"flex items-center mt-1 space-x-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Start: ",ve(i.ArchStartDate)]}),e.jsxs("span",{children:["End: ",ve(i.ArchEndDate)]}),e.jsx(Q,{variant:i.IsActive?"default":"outline",className:"text-xs",children:i.IsActive?"Active":"Inactive"})]})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:g,className:"text-primary hover:text-primary/80 h-8 px-2",disabled:m,title:"View document",children:m?e.jsx(Te,{className:"h-3 w-3 animate-spin"}):e.jsx(Oe,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>f==null?void 0:f(i.ArchID),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 px-2",title:"Edit document",children:e.jsx(je,{className:"h-3 w-3"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>y==null?void 0:y(i.ArchID),className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2",title:"Delete document",children:e.jsx(Ne,{className:"h-3 w-3"})})]})]}),e.jsx(ee,{open:L,onOpenChange:C,children:e.jsxs(te,{className:"max-w-4xl max-h-[90vh] h-[90vh] flex flex-col",children:[e.jsx(se,{children:e.jsx(ae,{children:"Document Preview"})}),e.jsx("div",{className:"flex-1 overflow-auto mt-4",children:m?e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),e.jsx("p",{className:"ml-4",children:"Loading document..."})]}):(console.log("Preview - archFile:",p),console.log("Preview - archFile type:",typeof p),!p||p==="null"||p===""?e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx(G,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"ml-2",children:"No file available"})]}):typeof p=="string"&&p.startsWith("data:image/")?e.jsx("div",{className:"flex justify-center h-full",children:e.jsx("img",{src:p,alt:"Document preview",className:"max-h-full max-w-full object-contain",onError:b=>{console.error("Image failed to load:",p)}})}):e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx(G,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"ml-2",children:"Preview not available"})]}))})]})})]})};export{ht as default};
