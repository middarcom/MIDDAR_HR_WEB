import{l as W,r as c,j as e,B as h,C as F,g as E,a as A,K as L,S as we,e as $,f as z,h as ce,d as Q,aQ as d,n as be,ar as ze,aV as Be,F as Oe}from"./index-BvW6vA_w.js";import{I as T}from"./input-B90b-HjG.js";import{S as H,a as K,c as J,d as b,b as Ce}from"./select-CgTQIsYR.js";import{C as Se}from"./date-picker-BYk77_ec.js";import{D as ye,e as qe,a as je,b as fe,c as ve,d as He,f as Ke}from"./dialog-Dz39hnJR.js";import{L as y}from"./label-SlGcAB4q.js";import{T as Je,b as Fe,c as Ee}from"./tabs-CNqDDOx9.js";import{S as Qe}from"./ScrollableTabs-EDBJq-7p.js";import{T as We}from"./textarea-NB_NAYSZ.js";import{P as Ze}from"./plus-c3UHNGiE.js";import{S as ie}from"./square-pen-BGu5ARYy.js";import{T as oe}from"./trash-2-Cibh5KAu.js";import{F as Ge}from"./filter-NMmCgUEe.js";import{E as me}from"./eye-cfsxeHQv.js";import"./index-LHsGcG95.js";import"./popover-C9ru1Mgl.js";import"./getDaysInMonth-2as7pjyD.js";import"./chevron-left-Cr-a-3Sv.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=W("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=W("FilePenLine",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=W("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=W("LayoutTemplate",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=W("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),st=({categories:i,onAdd:x,onEdit:m,onDelete:f})=>{const[O,C]=c.useState(!1),[u,M]=c.useState(null),[v,N]=c.useState({name:"",description:"",color:"#3B82F6"}),S=()=>{u?(m(u.id,v),M(null)):(x(v),C(!1)),N({name:"",description:"",color:"#3B82F6"})},j=n=>{M(n),N({name:n.name,description:n.description,color:n.color})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Categories"}),e.jsxs(ye,{open:O,onOpenChange:C,children:[e.jsx(qe,{asChild:!0,children:e.jsxs(h,{children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Add Category"]})}),e.jsxs(je,{children:[e.jsx(fe,{children:e.jsx(ve,{children:"Add Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"name",children:"Name"}),e.jsx(T,{id:"name",value:v.name,onChange:n=>N(g=>({...g,name:n.target.value})),placeholder:"Category name"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"description",children:"Description"}),e.jsx(We,{id:"description",value:v.description,onChange:n=>N(g=>({...g,description:n.target.value})),placeholder:"Category description"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"color",children:"Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"color",type:"color",value:v.color,onChange:n=>N(g=>({...g,color:n.target.value})),className:"w-16 h-10"}),e.jsx(T,{value:v.color,onChange:n=>N(g=>({...g,color:n.target.value})),placeholder:"#3B82F6",className:"flex-1"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsxs(h,{onClick:S,children:[u?"Update":"Add"," Category"]})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(n=>e.jsx(F,{className:"hover:shadow-md transition-shadow",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:n.color}}),e.jsx("h4",{className:"font-medium",children:n.name})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>j(n),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>f(n.id),className:"text-red-600 hover:text-red-700",children:e.jsx(oe,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:n.description})]})},n.id))})]})},xe=[{value:"passport",label:"Passport"},{value:"photo",label:"Photo"},{value:"cpr/iqama",label:"CPR / IQAMA"},{value:"medical_certificate",label:"Medical Certificate"},{value:"employment_contract",label:"Employment Contract"},{value:"leave_contract",label:"Leave Contract"},{value:"visa",label:"Visa"},{value:"insurance",label:"Insurance"},{value:"other",label:"Other"}],pe=i=>{switch(i){case"passport":return e.jsx(Oe,{className:"h-5 w-5 text-blue-500"});case"photo":case"cpr/iqama":return e.jsx(L,{className:"h-5 w-5 text-green-500"});case"medical_certificate":return e.jsx(Xe,{className:"h-5 w-5 text-red-500"});case"employment_contract":return e.jsx(Ye,{className:"h-5 w-5 text-purple-500"});case"leave_contract":return e.jsx(Be,{className:"h-5 w-5 text-amber-500"});case"visa":case"insurance":case"other":default:return e.jsx(ue,{className:"h-5 w-5 text-gray-500"})}},ne=i=>{const x=xe.find(m=>m.value===i);return x?x.label:i},B=i=>{if(!i)return"N/A";const x=new Date(i);return isNaN(x.getTime())?"Invalid Date":x.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},At=()=>{var De;const[i,x]=c.useState([]),[m,f]=c.useState([]),[O,C]=c.useState([]),[u,M]=c.useState([]),[v,N]=c.useState(null),[S,j]=c.useState(!1),[n,g]=c.useState(""),[I,k]=c.useState(""),[P,Ie]=c.useState("all"),[R,ke]=c.useState("all"),[U,Ne]=c.useState(""),[Z,de]=c.useState(!1),[q,_e]=c.useState("documents"),[G,Le]=c.useState("card");c.useState({sortBy:"createdDate",sortOrder:"desc"}),c.useState([]),c.useState([]),c.useState("all"),c.useState(!1);const[Me,X]=c.useState(!1),[w,ge]=c.useState(null),[p,Ae]=c.useState({title:"",description:"",documentType:"",status:"active",startDate:"",endDate:""}),Pe=async t=>{try{const s=parseInt(t,10);if(isNaN(s))return d({title:"Invalid Employee ID",description:"Please enter a valid employee ID",variant:"destructive"}),[];console.log("Fetching employee with ID:",s);const r=await A.list("employees",{exact_filters:{EmployeeID:s},select_fields:["EmployeeID","FirstName","LastName"].join(",")});if(console.log("Employee response:",r),!r.data||r.data.length===0)return d({title:"Employee Not Found",description:`No employee found with ID: ${t}`,variant:"destructive"}),[];console.log("Fetching documents for employee ID:",s);const a=await A.list("arch",{exact_filters:{ArchEmp:s},select_fields:["ArchID","ArchEmp","ArchType","ArchNote","ArchRef","ArchStartDate","ArchEndDate","CreatedDate","UpdatedDate","IsActive","employees_FirstName","employees_LastName"]});if(console.log("Documents response:",a),!a.data)return d({title:"No Documents Found",description:`No documents found for employee ID: ${t}`,variant:"destructive"}),[];const D=a.data.map(l=>{var _;return console.log("Employee document item:",l),console.log("ArchFile value:",l.ArchFile),console.log("ArchFile type:",typeof l.ArchFile),{id:l.ArchID,employeeId:l.ArchEmp,documentType:((_=l.ArchType)==null?void 0:_.toString())||"unknown",title:l.ArchNote||"Untitled Document",description:l.ArchRef||"",fileName:l.ArchFile,fileSize:0,mimeType:"application/octet-stream",uploadDate:l.CreatedDate,expiryDate:l.ArchEndDate,status:l.IsActive?"active":"archived",tags:[],categories:[l.ArchType],currentVersion:{id:1,documentId:l.ArchID,versionNumber:1,fileName:l.ArchFile,fileSize:0,checksum:"",uploadedBy:l.ArchEmp,uploadDate:l.CreatedDate,isCurrent:!0,changeNote:"Initial version"},versions:[],signatures:[],expiryNotifications:[],ocrResult:null,metadata:[],visibility:"private",retentionPeriod:365,complianceFlags:[],ArchID:l.ArchID,ArchEmp:l.ArchEmp,ArchType:l.ArchType,ArchNote:l.ArchNote,ArchRef:l.ArchRef,ArchStartDate:l.ArchStartDate,ArchEndDate:l.ArchEndDate,CreatedDate:l.CreatedDate,UpdatedDate:l.UpdatedDate,IsActive:l.IsActive,ArchFile:l.ArchFile,employees_FirstName:l.employees_FirstName,employees_LastName:l.employees_LastName}}).sort((l,_)=>{const re=l.ArchType||0,le=_.ArchType||0;if(re!==le)return re-le;const $e=new Date(l.CreatedDate||0).getTime();return new Date(_.CreatedDate||0).getTime()-$e});return x(D),f(D),de(!0),D}catch(s){return console.error("Error fetching documents:",s),d({title:"Error",description:"Failed to fetch documents. Please try again.",variant:"destructive"}),[]}},he=async()=>{try{j(!0),console.log("Fetching all documents...");const t=await A.list("arch",{select_fields:["ArchID","ArchEmp","ArchType","ArchNote","ArchRef","ArchStartDate","ArchEndDate","CreatedDate","UpdatedDate","IsActive","employees_FirstName","employees_LastName"]});if(console.log("All documents response:",t),!t.data)return d({title:"No Documents Found",description:"No documents found in the system",variant:"destructive"}),[];const r=t.data.map(a=>{console.log("All documents item:",a),console.log("ArchFile value:",a.ArchFile),console.log("ArchFile type:",typeof a.ArchFile);let o=a.ArchFile;if(typeof o=="string")try{o=JSON.parse(o)}catch(D){console.warn("Failed to parse ArchFile JSON:",D),o={name:"document",size:0,type:"application/octet-stream"}}return{ArchID:a.ArchID,ArchEmp:a.ArchEmp,ArchType:a.ArchType||0,ArchNote:a.ArchNote||"Untitled Document",ArchRef:a.ArchRef||"",ArchStartDate:a.ArchStartDate||new Date().toISOString(),ArchEndDate:a.ArchEndDate||"",CreatedDate:a.CreatedDate||new Date().toISOString(),UpdatedDate:a.UpdatedDate||new Date().toISOString(),IsActive:a.IsActive!==!1,ArchFile:a.ArchFile,employees_FirstName:a.employees_FirstName||"",employees_LastName:a.employees_LastName||"",categories:[],tags:[],versions:[],signatures:[],expiryNotifications:[],ocrResult:null,metadata:[],complianceFlags:[]}}).sort((a,o)=>{const D=`${a.employees_FirstName||""} ${a.employees_LastName||""}`.toLowerCase(),l=`${o.employees_FirstName||""} ${o.employees_LastName||""}`.toLowerCase();return D<l?-1:D>l?1:(a.ArchType||0)-(o.ArchType||0)});return x(r),f(r),r}catch(t){return console.error("Error fetching documents:",t),d({title:"Error",description:"Failed to fetch documents. Please try again.",variant:"destructive"}),[]}finally{j(!1)}},Y=async()=>{const t=U.trim();if(!t){d({title:"Missing Employee ID",description:"Please enter an employee ID",variant:"destructive"});return}j(!0),de(!0);try{const s=await Pe(t);x(s),f(s),s.length===0&&d({title:"No Documents Found",description:`No documents found for employee ID: ${t}`,variant:"destructive"})}catch(s){console.error("Error searching documents:",s),d({title:"Search Error",description:"Failed to fetch documents. Please try again.",variant:"destructive"}),x([]),f([])}finally{j(!1)}},Re=t=>{t.key==="Enter"&&Y()};c.useEffect(()=>{ae(),Ve()},[]),c.useEffect(()=>{q==="documents"&&he()},[q]);const ee=t=>{var r;const s=i.find(a=>a.id===t);s&&(ge(s),Ae({title:s.title||s.ArchNote||"",description:s.description||s.ArchRef||"",documentType:((r=s.documentType)==null?void 0:r.toString())||"",status:s.status==="active"?"active":"archived",startDate:s.uploadDate||s.ArchStartDate||"",endDate:s.expiryDate||s.ArchEndDate||""}),X(!0))},Ue=async()=>{if(w)try{j(!0),await A.update("arch",w.id,{ArchNote:p.title,ArchRef:p.description,ArchType:p.documentType,ArchStartDate:p.startDate,ArchEndDate:p.endDate,IsActive:p.status==="active"}),q==="documents"?await he():Z&&await Y(),X(!1),ge(null),d({title:"Document Updated",description:"Document has been successfully updated",variant:"default"})}catch(t){console.error("Error updating document:",t),d({title:"Update Error",description:"Failed to update document. Please try again.",variant:"destructive"})}finally{j(!1)}},te=async t=>{if(confirm("Are you sure you want to delete this document? This action cannot be undone."))try{j(!0),await A.delete("arch",t),q==="documents"?await he():Z&&await Y(),d({title:"Document Deleted",description:"Document has been successfully deleted",variant:"default"})}catch(s){console.error("Error deleting document:",s),d({title:"Delete Error",description:"Failed to delete document. Please try again.",variant:"destructive"})}finally{j(!1)}},V=(t,s)=>{Ae(r=>({...r,[t]:s}))};c.useEffect(()=>{if(i.length>0){const t=i.filter(s=>{const r=(s.title||"").toString(),a=(s.description||"").toString(),o=`${s.employees_FirstName||""} ${s.employees_LastName||""}`.trim(),D=`Employee ${s.employeeId||"Unknown"}`,l=n===""||r.toLowerCase().includes(n.toLowerCase())||a.toLowerCase().includes(n.toLowerCase())||o.toLowerCase().includes(n.toLowerCase())||D.toLowerCase().includes(n.toLowerCase()),_=I===""||o.toLowerCase().includes(I.toLowerCase()),re=P==="all"||s.documentType&&s.documentType.toString()===P,le=R==="all"||s.ArchType&&s.ArchType.toString()===R;return l&&re&&_&&le});f(t)}},[i,n,P,I,R]);const se=t=>{try{let s=[];if(!t.fileName&&!t.ArchFile)return[];const r=t.fileName||t.ArchFile;if(typeof r=="string"&&r)if(r.startsWith("data:"))s=[{url:r,name:"document",type:r.split(";")[0].split(":")[1]||"application/octet-stream"}];else try{const a=JSON.parse(r);s=Array.isArray(a)?a:[a]}catch{s=[{url:r,name:"document",type:"application/octet-stream"}]}else Array.isArray(r)?s=r:r&&(s=[r]);return s.length===0&&(s=[{url:"",name:"No file",type:"application/octet-stream"}]),(Array.isArray(s)?s:[s]).filter(a=>a&&(a.url||a.base64||a.data||a.name==="No file"))}catch(s){return console.error("Error processing document files:",s,t),[]}},ae=async()=>{try{const t=await A.list("archtype");C(t.data.map(s=>{var r;return{id:s.ArchTypeID,name:((r=s.ArchTypeName)==null?void 0:r.toString())||"",description:s.ArchTypeNote||"",color:"#3B82F6",isActive:s.IsActive}})),M(t.data.filter(s=>s.IsActive))}catch(t){console.error("Error fetching categories:",t)}},Ve=async()=>{try{const t=await A.list("arch");N({totalDocuments:t.data.length,activeDocuments:t.data.filter(s=>s.IsActive).length,archivedDocuments:t.data.filter(s=>!s.IsActive).length,documentsByType:t.data.reduce((s,r)=>(s[r.ArchType]=(s[r.ArchType]||0)+1,s),{}),recentUploads:t.data.filter(s=>s.CreatedDate).sort((s,r)=>new Date(r.CreatedDate).getTime()-new Date(s.CreatedDate).getTime()).slice(0,10)})}catch(t){console.error("Error fetching stats:",t)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Document Viewer"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage employee documents"})]}),e.jsx(F,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(T,{placeholder:"Enter Employee ID",value:U,onChange:t=>Ne(t.target.value.replace(/\D/g,"")),onKeyPress:Re,className:"pl-10",disabled:S})]}),e.jsxs(h,{onClick:Y,disabled:!U.trim()||S,className:"px-6",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),S?"Searching...":"Search"]})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-end md:gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{children:"Search within results"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(T,{placeholder:"Search documents...",className:"pl-10",value:n,onChange:t=>g(t.target.value)})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(y,{children:"Search by Employee Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(T,{placeholder:"Enter employee name...",className:"pl-10",value:I,onChange:t=>k(t.target.value)})]})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx(y,{children:"Document Type"}),e.jsxs(H,{value:P,onValueChange:Ie,children:[e.jsxs(K,{children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),P==="all"?"All Documents":ne(P)]}),e.jsxs(J,{children:[e.jsx(b,{value:"all",children:"All Documents"}),xe.map(t=>e.jsx(b,{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx(y,{children:"Archetype Category"}),e.jsxs(H,{value:R,onValueChange:ke,children:[e.jsxs(K,{children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),R==="all"?"All Categories":((De=u.find(t=>t.ArchTypeID.toString()===R))==null?void 0:De.ArchTypeName)||"Select Category"]}),e.jsxs(J,{children:[e.jsx(b,{value:"all",children:"All Categories"}),u.map(t=>e.jsx(b,{value:t.ArchTypeID.toString(),children:t.ArchTypeName},t.ArchTypeID))]})]})]}),e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx(y,{children:"View Mode"}),e.jsxs(H,{value:G,onValueChange:t=>Le(t),children:[e.jsxs(K,{children:[e.jsx(et,{className:"mr-2 h-4 w-4"}),G==="card"?"Card":"List"]}),e.jsxs(J,{children:[e.jsx(b,{value:"card",children:"Card View"}),e.jsx(b,{value:"list",children:"List View"})]})]})]})]}),Z&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Showing results for Employee ID: ",e.jsx("strong",{children:U})]})})]})})}),e.jsxs(Je,{value:q,onValueChange:_e,className:"w-full",children:[e.jsxs(Qe,{className:"md:grid md:grid-cols-2",children:[e.jsx(Fe,{value:"documents",children:"Documents"}),e.jsx(Fe,{value:"categories",children:"Categories"})]}),e.jsx(Ee,{value:"documents",className:"mt-6",children:Z?e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(z,{children:["Search Results (",m.length," documents)"]}),e.jsxs(ce,{children:["Documents found for employee ID: ",U]})]}),e.jsx(E,{children:S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:"No documents found matching your criteria"}),e.jsx(h,{onClick:()=>{de(!1),Ne(""),x([]),f([])},variant:"outline",className:"mt-4",children:"Clear Search & Show All Documents"})]}):e.jsx("div",{className:"space-y-6",children:G==="card"?(()=>{const t=m.reduce((s,r)=>{const a=`${r.employees_FirstName||"Unknown"} ${r.employees_LastName||"Employee"} (${r.ArchEmp})`;return s[a]||(s[a]=[]),s[a].push(r),s},{});return Object.entries(t).map(([s,r])=>e.jsxs(F,{className:"overflow-hidden",children:[e.jsx($,{className:"bg-gray-50 dark:bg-gray-800 pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600"}),e.jsx(z,{className:"text-lg",children:s}),e.jsxs(Q,{variant:"secondary",children:[r.length," documents"]})]})})}),e.jsx(E,{className:"pt-4",children:e.jsx("div",{className:"space-y-3",children:r.map(a=>{try{const o=se(a);return e.jsx(Te,{document:a,files:o,onDelete:te,onEdit:ee},`doc-${a.id}`)}catch(o){return console.error("Error parsing document files:",o,a),null}})})})]},s))})():e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(z,{children:["Search Results (",m.length," documents)"]}),e.jsxs(ce,{children:["Documents found for employee ID: ",U]})]}),e.jsx(E,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Employee"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Document Type"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Title"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Reference"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Start Date"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"End Date"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>{const r={1:"passport",2:"cpr/iqama",3:"photo",4:"medical_certificate",5:"employment_contract",6:"leave_contract",7:"visa",8:"insurance",9:"other"}[t.ArchType]||"other",a=`${t.employees_FirstName||"Unknown"} ${t.employees_LastName||""}`.trim();return e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:a})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[pe(r),e.jsx("span",{className:"text-sm",children:ne(r)})]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm font-medium",children:t.ArchNote||"Untitled Document"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm text-gray-500",children:t.ArchRef||"N/A"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm",children:B(t.ArchStartDate)})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm",children:B(t.ArchEndDate)})}),e.jsx("td",{className:"p-3",children:e.jsx(Q,{variant:t.IsActive?"default":"outline",className:"text-xs",children:t.IsActive?"Active":"Inactive"})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{se(t)},className:"text-primary hover:text-primary/80 h-8 px-2",title:"View document",children:e.jsx(me,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ee(t.id),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 px-2",title:"Edit document",children:e.jsx(ie,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>te(t.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2",title:"Delete document",children:e.jsx(oe,{className:"h-3 w-3"})})]})})]},t.id)})})]})})})]})})})]}):e.jsxs(F,{children:[e.jsxs($,{children:[e.jsx(z,{children:"Document Management"}),e.jsx(ce,{children:"Manage and organize your documents with advanced features"})]}),e.jsx(E,{children:S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):m.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No documents found"})}):e.jsx("div",{className:"space-y-6",children:G==="card"?(()=>{const t=m.reduce((s,r)=>{const a=`${r.employees_FirstName||"Unknown"} ${r.employees_LastName||"Employee"} (${r.ArchEmp})`;return s[a]||(s[a]=[]),s[a].push(r),s},{});return Object.entries(t).map(([s,r])=>e.jsxs(F,{className:"overflow-hidden",children:[e.jsx($,{className:"bg-gray-50 dark:bg-gray-800 pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600"}),e.jsx(z,{className:"text-lg",children:s}),e.jsxs(Q,{variant:"secondary",children:[r.length," documents"]})]})})}),e.jsx(E,{className:"pt-4",children:e.jsx("div",{className:"space-y-3",children:r.map(a=>{try{const o=se(a);return e.jsx(Te,{document:a,files:o,onDelete:te,onEdit:ee},`doc-${a.id}`)}catch(o){return console.error("Error parsing document files:",o,a),null}})})})]},s))})():e.jsxs(F,{children:[e.jsxs($,{children:[e.jsxs(z,{children:["Document List (",m.length," documents)"]}),e.jsx(ce,{children:"All documents in a table format"})]}),e.jsx(E,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Employee"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Document Type"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Title"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Reference"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Start Date"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"End Date"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>{const r={1:"passport",2:"cpr/iqama",3:"photo",4:"medical_certificate",5:"employment_contract",6:"leave_contract",7:"visa",8:"insurance",9:"other"}[t.ArchType]||"other",a=`${t.employees_FirstName||"Unknown"} ${t.employees_LastName||""}`.trim();return e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:a})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[pe(r),e.jsx("span",{className:"text-sm",children:ne(r)})]})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm font-medium",children:t.ArchNote||"Untitled Document"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm text-gray-500",children:t.ArchRef||"N/A"})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm",children:B(t.ArchStartDate)})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"text-sm",children:B(t.ArchEndDate)})}),e.jsx("td",{className:"p-3",children:e.jsx(Q,{variant:t.IsActive?"default":"outline",className:"text-xs",children:t.IsActive?"Active":"Inactive"})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{se(t)},className:"text-primary hover:text-primary/80 h-8 px-2",title:"View document",children:e.jsx(me,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ee(t.id),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 px-2",title:"Edit document",children:e.jsx(ie,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>te(t.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2",title:"Delete document",children:e.jsx(oe,{className:"h-3 w-3"})})]})})]},t.id)})})]})})})]})})})]})}),e.jsx(Ee,{value:"categories",children:e.jsx(st,{categories:O,onAdd:async t=>{try{await A.documents.createCategory(t),ae(),d({title:"Category Created",description:"Category has been successfully created",variant:"default"})}catch{d({title:"Create Error",description:"Failed to create category. Please try again.",variant:"destructive"})}},onEdit:async(t,s)=>{try{await A.documents.updateCategory(t,s),ae(),d({title:"Category Updated",description:"Category has been successfully updated",variant:"default"})}catch{d({title:"Update Error",description:"Failed to update category. Please try again.",variant:"destructive"})}},onDelete:async t=>{try{await A.documents.deleteCategory(t),ae(),d({title:"Category Deleted",description:"Category has been successfully deleted",variant:"default"})}catch{d({title:"Delete Error",description:"Failed to delete category. Please try again.",variant:"destructive"})}}})})]}),e.jsx(ye,{open:Me,onOpenChange:X,children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(fe,{children:[e.jsx(ve,{children:"Edit Document"}),e.jsxs(He,{children:["Update document information for ",w==null?void 0:w.employees_FirstName," ",w==null?void 0:w.employees_LastName]})]}),w&&e.jsx("div",{className:"space-y-6 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"title",children:"Document Title"}),e.jsx(T,{id:"title",value:p.title,onChange:t=>V("title",t.target.value),placeholder:"Enter document title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"documentType",children:"Document Type"}),e.jsxs(H,{value:p.documentType,onValueChange:t=>V("documentType",t),children:[e.jsx(K,{children:e.jsx(Ce,{placeholder:"Select document type"})}),e.jsx(J,{children:xe.map(t=>e.jsx(b,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"description",children:"Description"}),e.jsx(T,{id:"description",value:p.description,onChange:t=>V("description",t.target.value),placeholder:"Enter description"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"status",children:"Status"}),e.jsxs(H,{value:p.status,onValueChange:t=>V("status",t),children:[e.jsx(K,{children:e.jsx(Ce,{placeholder:"Select status"})}),e.jsxs(J,{children:[e.jsx(b,{value:"active",children:"Active"}),e.jsx(b,{value:"archived",children:"Archived"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"startDate",children:"Start Date"}),e.jsx(Se,{date:p.startDate?new Date(p.startDate):void 0,onChange:t=>V("startDate",t?be(t,"yyyy-MM-dd"):"")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"endDate",children:"End Date"}),e.jsx(Se,{date:p.endDate?new Date(p.endDate):void 0,onChange:t=>V("endDate",t?be(t,"yyyy-MM-dd"):"")})]})]})}),e.jsxs(Ke,{children:[e.jsx(h,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),e.jsx(h,{onClick:Ue,children:"Save Changes"})]})]})})]})},Te=({document:i,files:x,onDelete:m,onEdit:f})=>{const[O,C]=c.useState(!1),[u,M]=c.useState(null),[v,N]=c.useState(!1),j={1:"passport",2:"cpr/iqama",3:"photo",4:"medical_certificate",5:"employment_contract",6:"leave_contract",7:"visa",8:"insurance",9:"other"}[i.ArchType]||"other",n=async I=>{try{N(!0);const k=await A.list("arch",{exact_filters:{ArchID:I},select_fields:["ArchFile"]});k.data&&k.data.length>0&&M(k.data[0].ArchFile)}catch(k){console.error("Error fetching ArchFile:",k)}finally{N(!1)}},g=()=>{C(!0),n(i.ArchID)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-1.5 rounded bg-gray-100 dark:bg-gray-800",children:pe(j)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",children:i.ArchNote||"Untitled Document"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[ne(j)," â€¢ Ref: ",i.ArchRef||"N/A"]}),e.jsxs("div",{className:"flex items-center mt-1 space-x-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["Start: ",B(i.ArchStartDate)]}),e.jsxs("span",{children:["End: ",B(i.ArchEndDate)]}),e.jsx(Q,{variant:i.IsActive?"default":"outline",className:"text-xs",children:i.IsActive?"Active":"Inactive"})]})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:g,className:"text-primary hover:text-primary/80 h-8 px-2",disabled:v,title:"View document",children:v?e.jsx(ze,{className:"h-3 w-3 animate-spin"}):e.jsx(me,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>f==null?void 0:f(i.ArchID),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 px-2",title:"Edit document",children:e.jsx(ie,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>m==null?void 0:m(i.ArchID),className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-8 px-2",title:"Delete document",children:e.jsx(oe,{className:"h-3 w-3"})})]})]}),e.jsx(ye,{open:O,onOpenChange:C,children:e.jsxs(je,{className:"max-w-4xl max-h-[90vh] h-[90vh] flex flex-col",children:[e.jsx(fe,{children:e.jsx(ve,{children:"Document Preview"})}),e.jsx("div",{className:"flex-1 overflow-auto mt-4",children:v?e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),e.jsx("p",{className:"ml-4",children:"Loading document..."})]}):(console.log("Preview - archFile:",u),console.log("Preview - archFile type:",typeof u),!u||u==="null"||u===""?e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx(ue,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"ml-2",children:"No file available"})]}):typeof u=="string"&&u.startsWith("data:image/")?e.jsx("div",{className:"flex justify-center h-full",children:e.jsx("img",{src:u,alt:"Document preview",className:"max-h-full max-w-full object-contain",onError:I=>{console.error("Image failed to load:",u)}})}):e.jsxs("div",{className:"flex items-center justify-center h-full",children:[e.jsx(ue,{className:"h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"ml-2",children:"Preview not available"})]}))})]})})]})};export{At as default};
