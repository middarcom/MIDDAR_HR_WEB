import{l as te,ab as Ge,aq as Tt,r as y,j as e,ar as It,Q as Se,a4 as dt,b as Pe,c as pe,t as $e,B as j,d as J,K as Ze,C as E,e as L,f as O,F as Ie,g as $,k as X,i as Pt,h as mt,n as V,$ as _,o as ke,a6 as kt,D as Et,S as Ft,as as Xe,y as et,z as tt,G as at,J as ae,at as Mt,a8 as De,a1 as $t,W as _t,Y as Rt,au as Ht,a as ne,a0 as Vt,av as zt,aw as se}from"./index-DOKDlu5z.js";import{T as Le,a as qe,b as ee,c as st}from"./tabs-De6Ki3gV.js";import{T as _e,a as Re,b as K,c as H,d as He,e as k}from"./table-3BpGTakO.js";import{a as w}from"./api-cTyB4nM2.js";import{A as xt}from"./arrow-left-BPTb2Zva.js";import{P as xe}from"./plus-Y87kO0uS.js";import{o as Ve,n as ce,d as oe,s as re,u as ut,t as ht,b as Lt,c as qt}from"./types-gJJBYZrG.js";import{I as q}from"./input-8l6hFLlx.js";import{L as D}from"./label-CyjSVjeg.js";import{T as Be}from"./textarea-1hxBXo-Z.js";import{P as le,b as ie,c as de,C as me,i as Bt,f as Ut}from"./popover-BvA2A6IL.js";import{u as rt}from"./useMutation-CKy2gND6.js";import{S as ye,a as je,b as fe,c as Ce,d as z}from"./select-BruEyd3_.js";import{S as Y}from"./skeleton-BxpZ-mAT.js";import{C as Z}from"./checkbox-DeAc7_k8.js";import{D as pt,a as yt,b as jt,c as ft,d as Ct,f as Kt}from"./dialog-CExpfMQj.js";import{T as Ne}from"./trash-2-Bi0yTVyn.js";import{C as Ot}from"./circle-check-Gmly7nsu.js";import{F as Qt}from"./filter-DR7asEcS.js";import{D as nt}from"./download-l837z28C.js";import{E as ct}from"./eye-Kxjxfs2A.js";import{S as Yt}from"./square-pen-EsVfyLBM.js";import{P as Nt}from"./pencil-DEKMQBCg.js";import{C as Jt}from"./chevron-left-BjIkqYIa.js";import{p as ze}from"./parseISO-BPVUXpZH.js";import{R as Wt}from"./ReportViewer-C9XBkVbw.js";import"./getDaysInMonth-BbSThtNP.js";import"./index-D13m8HN9.js";import"./alert-BCtjVf7d.js";import"./date-picker-DRLSAGEe.js";import"./loader-circle-CiopRRXq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=te("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=te("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=te("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=te("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=te("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=te("FileType2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 13v-1h6v1",key:"1dh9dg"}],["path",{d:"M5 12v6",key:"150t9c"}],["path",{d:"M4 18h2",key:"1xrofg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=te("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function sa(t,o){const n=Ge(t),l=Ge(o),C=lt(n,l),s=Math.abs(Tt(n,l));n.setDate(n.getDate()-C*s);const N=+(lt(n,l)===-C),u=C*(s-N);return u===0?0:u}function lt(t,o){const n=t.getFullYear()-o.getFullYear()||t.getMonth()-o.getMonth()||t.getDate()-o.getDate()||t.getHours()-o.getHours()||t.getMinutes()-o.getMinutes()||t.getSeconds()-o.getSeconds()||t.getMilliseconds()-o.getMilliseconds();return n<0?-1:n>0?1:n}const Q={getContracts:async(t={})=>{const o=t.page!==void 0?Math.max(0,t.page-1):0,n={sort:(t.sortOrder||"desc").toLowerCase(),pageSize:t.pageSize||10,page:o};return t.search&&(n.search=t.search),t.status&&(n.status=t.status),t.type&&(n.type=t.type),t.sortBy&&(n.sortBy=t.sortBy),await w.contract.list(n)},getContractById:async t=>{const o=await w.contract.get(t,{columns:"ContractID,EmployeeID,employees_FirstName,employees_LastName,ContractAmount,ContractDate,ContractStartDate,ContractEndDate,ContractNote,ContractType,ContractTitle,ContractStatus,ContractDescription,Status,CreatedAt,UpdatedAt,CreatedBy,UpdatedBy"}),n=await Q.getContractPayments(t),l=n.filter(v=>v.contractpaytype_IsAdd===1),C=n.filter(v=>v.contractpaytype_IsAdd===0),s=l.reduce((v,S)=>{const m=S.contractpaytype_IsHour===1?parseFloat(S.ContractPAmountHour)||0:parseFloat(S.ContractPAmount)||0;return v+m},0),N=C.reduce((v,S)=>{const m=S.contractpaytype_IsHour===1?parseFloat(S.ContractPAmountHour)||0:parseFloat(S.ContractPAmount)||0;return v+m},0),u=(parseFloat(o.ContractAmount)||0)+s-N;return{...o,payments:n,additions:l,deductions:C,totalAdditions:s,totalDeductions:N,netAmount:u}},createContract:async t=>w.contract.create(t),updateContract:async(t,o)=>w.contract.update(t,o),deleteContract:async t=>w.contract.delete(t),getContractPayments:async t=>(await w.list("contractp",{exact_filters:JSON.stringify({ContractID:t}),select_fields:"ContractPID,ContractID,ContractPayTypeID,ContractPAmount,ContractPAmountHour,ContractNote,contractpaytype_ContractPayTypeName,contractpaytype_IsAdd,contractpaytype_IsHour",sort:"ContractPID asc"})).data||[],addPayment:async t=>w.create("contractp",t),updatePayment:async(t,o)=>w.update("contractp",t,o),deletePayment:async t=>w.delete("contractp",t),getPaymentTypes:async()=>(await w.list("contractpaytype",{exact_filters:JSON.stringify({IsActive:!0}),sort:"ContractPayTypeName asc"})).data||[],getContractDocuments:async t=>(await w.list("contractdocument",{exact_filters:JSON.stringify({ContractID:t,IsActive:!0}),sort:"UploadedAt desc"})).data||[],uploadDocument:async t=>w.create("contractdocument",t),deleteDocument:async t=>w.update("contractdocument",t,{IsActive:!1}),getTemplates:async()=>(await w.list("contractstemplate",{exact_filters:JSON.stringify({IsActive:!0}),sort:"TemplateName asc"})).data||[],getTemplateById:async t=>w.get("contractstemplate",t),exportContracts:async(t="pdf",o)=>{var n,l;return(l=(n=w.contract).export)==null?void 0:l.call(n,t,o)},submitForApproval:async(t,o,n)=>w.contract.update(t,{Status:"pending_approval",SubmittedBy:o,Comments:n}),approveContract:async(t,o,n)=>w.contract.update(t,{Status:"active",ApprovedBy:o,ApprovalDate:new Date().toISOString(),Comments:n}),rejectContract:async(t,o,n)=>w.contract.update(t,{Status:"rejected",RejectedBy:o,RejectionDate:new Date().toISOString(),RejectionReason:n}),terminateContract:async(t,o,n,l)=>w.contract.update(t,{Status:"terminated",TerminatedBy:o,TerminationDate:n,TerminationReason:l})};var ra="Separator",it="horizontal",na=["horizontal","vertical"],gt=y.forwardRef((t,o)=>{const{decorative:n,orientation:l=it,...C}=t,s=ca(l)?l:it,u=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return e.jsx(It.div,{"data-orientation":s,...u,...C,ref:o})});gt.displayName=ra;function ca(t){return na.includes(t)}var vt=gt;const Te=y.forwardRef(({className:t,orientation:o="horizontal",decorative:n=!0,...l},C)=>e.jsx(vt,{ref:C,decorative:n,orientation:o,className:Se("shrink-0 bg-border",o==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...l}));Te.displayName=vt.displayName;const oa=()=>{const{id:t}=dt(),o=Pe();y.useState("overview");const{data:n,isLoading:l,error:C}=pe({queryKey:["contract",t],queryFn:()=>Q.getContractById(Number(t)),enabled:!!t}),s=f=>{if(!f)return"N/A";try{return V(new Date(f),"PPP")}catch{return f}},N=f=>{const h=typeof f=="string"?parseFloat(f):f;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h||0)};if(l)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})});if(C||!n)return e.jsxs("div",{className:"p-8 text-center bg-destructive/10 rounded-lg",children:[e.jsx($e,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-destructive mb-2",children:"Error Loading Contract"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The contract details could not be retrieved."}),e.jsx(j,{onClick:()=>o("/contracts"),children:"Back to Contracts"})]});const u=n,v=u.ContractID||u.id,S=u.additions||[],m=u.deductions||[],b=u.totalAdditions||0,P=u.totalDeductions||0,R=u.netAmount||0;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-2",children:e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>o("/contracts"),className:"p-0 hover:bg-transparent",children:[e.jsx(xt,{className:"h-5 w-5 mr-1"}),"Back to Contracts"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Contract #",v]}),e.jsx(J,{variant:u.ContractStatus==="Active"?"success":"outline",children:u.ContractStatus||"New"})]}),e.jsxs("p",{className:"text-muted-foreground flex items-center",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),u.employees_FirstName," ",u.employees_LastName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"outline",onClick:()=>o(`/contracts/${v}/edit`),children:"Edit Contract"}),e.jsx(j,{children:"Download PDF"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(E,{children:[e.jsx(L,{children:e.jsxs(O,{className:"flex items-center",children:[e.jsx(Ie,{className:"h-5 w-5 mr-2 text-primary"}),"Contract Overview"]})}),e.jsxs($,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Base Salary"}),e.jsx("p",{className:"text-2xl font-bold",children:N(u.ContractAmount)})]}),e.jsx(Te,{}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(X,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Dates"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s(u.ContractStartDate)," - ",u.ContractEndDate?s(u.ContractEndDate):"Open Ended"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Contract Type"}),e.jsx("p",{className:"text-lg",children:u.ContractType||"Standard Employment"})]}),e.jsx(Te,{}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Pt,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Status"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current Status: ",e.jsx("span",{className:"font-semibold text-foreground",children:u.ContractStatus||"New"})]})]})]})]})]}),u.ContractNote&&e.jsxs("div",{className:"mt-8 p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Administrative Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:u.ContractNote})]})]})]}),e.jsxs(Le,{defaultValue:"payments",className:"w-full",children:[e.jsxs(qe,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(ee,{value:"payments",children:"Financial Details"}),e.jsx(ee,{value:"documents",children:"Documents"})]}),e.jsx(st,{value:"payments",className:"space-y-4 mt-6",children:e.jsxs(E,{children:[e.jsxs(L,{children:[e.jsx(O,{className:"text-lg",children:"Salary Components"}),e.jsx(mt,{children:"All additions and deductions related to this contract"})]}),e.jsx($,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center text-sm font-semibold text-green-600 mb-3",children:[e.jsx(Zt,{className:"h-4 w-4 mr-1"}),"Additions & Allowances"]}),e.jsxs(_e,{children:[e.jsx(Re,{children:e.jsxs(K,{children:[e.jsx(H,{children:"Type"}),e.jsx(H,{children:"Amount"}),e.jsx(H,{children:"Hourly"}),e.jsx(H,{children:"Note"})]})}),e.jsx(He,{children:S.length>0?S.map(f=>e.jsxs(K,{children:[e.jsx(k,{className:"font-medium",children:f.contractpaytype_ContractPayTypeName}),e.jsxs(k,{className:"text-green-600",children:["+",N(f.ContractPAmount)]}),e.jsx(k,{children:f.ContractPAmountHour>0?N(f.ContractPAmountHour):"-"}),e.jsx(k,{className:"text-xs text-muted-foreground",children:f.ContractNote||"-"})]},f.ContractPID)):e.jsx(K,{children:e.jsx(k,{colSpan:4,className:"text-center py-4 text-muted-foreground",children:"No additional payments"})})})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center text-sm font-semibold text-red-600 mb-3",children:[e.jsx(Gt,{className:"h-4 w-4 mr-1"}),"Deductions"]}),e.jsxs(_e,{children:[e.jsx(Re,{children:e.jsxs(K,{children:[e.jsx(H,{children:"Type"}),e.jsx(H,{children:"Amount"}),e.jsx(H,{children:"Hourly"}),e.jsx(H,{children:"Note"})]})}),e.jsx(He,{children:m.length>0?m.map(f=>e.jsxs(K,{children:[e.jsx(k,{className:"font-medium",children:f.contractpaytype_ContractPayTypeName}),e.jsxs(k,{className:"text-red-600",children:["-",N(f.ContractPAmount)]}),e.jsx(k,{children:f.ContractPAmountHour>0?N(f.ContractPAmountHour):"-"}),e.jsx(k,{className:"text-xs text-muted-foreground",children:f.ContractNote||"-"})]},f.ContractPID)):e.jsx(K,{children:e.jsx(k,{colSpan:4,className:"text-center py-4 text-muted-foreground",children:"No deductions"})})})]})]})]})})]})}),e.jsx(st,{value:"documents",className:"mt-6",children:e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{className:"text-lg",children:"Contract Documents"})}),e.jsxs($,{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(Ie,{className:"h-12 w-12 opacity-20 mb-2"}),e.jsx("p",{children:"No documents uploaded for this contract."}),e.jsxs(j,{variant:"outline",size:"sm",className:"mt-4",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Upload Document"]})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{className:"bg-primary/5 border-primary/20",children:[e.jsx(L,{children:e.jsx(O,{className:"text-lg",children:"Financial Summary"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Base Salary"}),e.jsx("span",{className:"font-medium",children:N(u.ContractAmount)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Additions"}),e.jsxs("span",{className:"text-green-600 font-medium",children:["+",N(b)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Deductions"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["-",N(P)]})]}),e.jsx(Te,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold",children:"Net Salary"}),e.jsx("span",{className:"text-xl font-bold text-primary",children:N(R)})]})]})]}),e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{className:"text-lg",children:"Employee Info"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(Ze,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-bold",children:[u.employees_FirstName," ",u.employees_LastName]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Employee ID: ",u.EmployeeID]})]})]}),e.jsx(j,{variant:"outline",className:"w-full",onClick:()=>o(`/employees/${u.EmployeeID}`),children:"View Employee Profile"})]})]})]})]})]})},la=Ve({ContractID:ce(),EmployeeID:ce().min(1,"Employee ID is required"),ContractAmount:ce().min(0,"Amount must be positive"),ContractDate:oe(),ContractStartDate:oe(),ContractEndDate:oe(),ContractNote:re().optional()}),ia=()=>{const{id:t}=dt(),[o,n]=y.useState(!1),[l,C]=y.useState(!0),[s,N]=y.useState([]),[u,v]=y.useState([]),S=Pe(),m=ut({resolver:ht(la),defaultValues:{ContractID:0,EmployeeID:0,ContractAmount:0,ContractDate:new Date,ContractStartDate:new Date,ContractEndDate:new Date,ContractNote:""}}),b=a=>{const x=typeof a=="string"?parseFloat(a):a;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(x||0)},P=a=>a.contractpaytype_IsHour?a.ContractPAmountHour||0:a.ContractPAmount||0,R=y.useMemo(()=>u.filter(a=>a.contractpaytype_IsAdd===1),[u]),f=y.useMemo(()=>u.filter(a=>a.contractpaytype_IsAdd===0),[u]),h=y.useMemo(()=>{const a=u.find(p=>p.ContractPayTypeID==1),x=a?parseFloat(P(a)):0;return isNaN(x)?0:x},[u]),A=y.useMemo(()=>R.filter(a=>a.ContractPayTypeID!=1).reduce((a,x)=>a+(parseFloat(P(x))||0),0),[R]),B=y.useMemo(()=>f.reduce((a,x)=>a+(parseFloat(P(x))||0),0),[f]),r=y.useMemo(()=>h+A-B,[h,A,B]);y.useEffect(()=>{(async()=>{if(t)try{C(!0);const p=(await w.contract.get(parseInt(t))).data;p&&m.reset({ContractID:p.ContractID,EmployeeID:p.EmployeeID,ContractAmount:parseFloat(p.ContractAmount)||0,ContractDate:p.ContractDate?new Date(p.ContractDate):new Date,ContractStartDate:p.ContractStartDate?new Date(p.ContractStartDate):new Date,ContractEndDate:p.ContractEndDate?new Date(p.ContractEndDate):new Date,ContractNote:p.ContractNote||""});const g=await w.list("contractp",{exact_filters:{ContractID:parseInt(t)},sort:"ContractPID:asc",pageSize:200});Array.isArray(g.data)&&v(g.data);const I=await w.list("contractpaytype",{pageSize:100});Array.isArray(I.data)&&N(I.data)}catch(x){console.error("Error fetching data:",x),_.error("Failed to load contract data.")}finally{C(!1)}})()},[t,m]);const c=async a=>{try{n(!0);const x={EmployeeID:a.EmployeeID,ContractAmount:a.ContractAmount,ContractDate:V(a.ContractDate,"yyyy-MM-dd"),ContractStartDate:V(a.ContractStartDate,"yyyy-MM-dd"),ContractEndDate:V(a.ContractEndDate,"yyyy-MM-dd"),ContractNote:a.ContractNote};await w.contract.update(a.ContractID,x),_.success("Contract updated successfully"),S("/contracts")}catch(x){console.error("Error updating contract:",x),_.error("Failed to update contract.")}finally{n(!1)}};return l?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(j,{variant:"ghost",className:"w-fit p-0 hover:bg-transparent",onClick:()=>S(-1),children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Back to Contracts"]}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Edit Contract #",t]})]}),e.jsxs("form",{onSubmit:m.handleSubmit(c),className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{children:"Contract Information"})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"ContractAmount",children:"Base Salary Amount"}),e.jsx(q,{id:"ContractAmount",type:"number",step:"0.01",...m.register("ContractAmount",{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Contract Date"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:Se("w-full justify-start text-left font-normal",!m.watch("ContractDate")&&"text-muted-foreground"),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),m.watch("ContractDate")?V(m.watch("ContractDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:m.watch("ContractDate"),onSelect:a=>m.setValue("ContractDate",a||new Date),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Start Date"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:Se("w-full justify-start text-left font-normal"),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),m.watch("ContractStartDate")?V(m.watch("ContractStartDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:m.watch("ContractStartDate"),onSelect:a=>m.setValue("ContractStartDate",a||new Date),initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"End Date"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:Se("w-full justify-start text-left font-normal"),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),m.watch("ContractEndDate")?V(m.watch("ContractEndDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:m.watch("ContractEndDate"),onSelect:a=>m.setValue("ContractEndDate",a||new Date),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"ContractNote",children:"Notes"}),e.jsx(Be,{id:"ContractNote",...m.register("ContractNote")})]})]})]}),e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{children:"Financial Summary"})}),e.jsx($,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Base Salary"}),e.jsx("span",{children:b(h)})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Total Additions"}),e.jsxs("span",{children:["+",b(A)]})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"Total Deductions"}),e.jsxs("span",{children:["-",b(B)]})]}),e.jsxs("div",{className:"pt-4 border-t flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Net Amount"}),e.jsx("span",{children:b(r)})]})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>S(-1),children:"Cancel"}),e.jsx(j,{type:"submit",disabled:o,children:o?"Saving...":"Update Contract"})]})]})]})},da=Ve({ContractTemplate:re().optional(),EmployeeID:re().min(1,"Employee ID is required"),ContractAmount:ce().min(0,"Amount must be positive"),ContractDate:oe(),ContractStartDate:oe(),ContractEndDate:oe(),ContractNote:re().optional(),payments:Lt(Ve({ContractPayTypeID:re().min(1,"Payment type is required"),ContractPAmount:ce().min(0,"Amount must be positive"),ContractPAmountHour:ce().optional(),ContractNote:re().optional()})).min(1,"At least one payment is required")}),Dt=({open:t,onOpenChange:o,onSuccess:n})=>{const[l,C]=y.useState(!1),s=ut({resolver:ht(da),defaultValues:{ContractDate:new Date,ContractStartDate:new Date,ContractEndDate:new Date(new Date().setFullYear(new Date().getFullYear()+1)),payments:[{ContractPayTypeID:"",ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}]}}),{fields:N,append:u,remove:v,replace:S}=qt({control:s.control,name:"payments"}),{data:m=[],isLoading:b}=pe({queryKey:["employees","withoutContract"],queryFn:()=>w.list("employees",{hasContract:!1}).then(c=>c.data||[])}),P=y.useMemo(()=>{const c=new Set;return m.filter(a=>c.has(a.EmployeeID)?!1:(c.add(a.EmployeeID),!0))},[m]),{data:R=[]}=pe({queryKey:["contractpaytype"],queryFn:()=>Q.getPaymentTypes()}),f=y.useMemo(()=>{const c=new Set;return R.filter(a=>c.has(a.ContractPayTypeID)?!1:(c.add(a.ContractPayTypeID),!0))},[R]),{data:h=[]}=pe({queryKey:["contractstemplate"],queryFn:()=>Q.getTemplates()}),A=y.useMemo(()=>{const c=new Set;return h.filter(a=>c.has(a.ContractTemplateID)?!1:(c.add(a.ContractTemplateID),!0))},[h]),B=y.useCallback(async c=>{const a=A.find(x=>{var p;return((p=x.ContractTemplateID)==null?void 0:p.toString())===c});if(a){s.setValue("ContractAmount",parseFloat(a.ContractAmount)||0);const x=new Date;if(s.setValue("ContractStartDate",x),a.ContractDurationDays){const p=new Date(x);p.setDate(x.getDate()+a.ContractDurationDays),s.setValue("ContractEndDate",p)}try{const p=await w.list("contracttemplatepaytype",{exact_filters:{ContractTemplateID:c}});if(Array.isArray(p.data)&&p.data.length>0){const g=p.data.map(I=>({ContractPayTypeID:I.ContractPayTypeID.toString(),ContractPAmount:parseFloat(I.ContractPAmount)||0,ContractPAmountHour:parseFloat(I.ContractPAmountHour)||0,ContractNote:I.ContractNote||""}));S(g)}}catch(p){console.error("Error fetching template pay types:",p)}}},[A,s,S]),r=async c=>{try{C(!0);const a={EmployeeID:parseInt(c.EmployeeID),ContractAmount:c.ContractAmount,ContractDate:V(c.ContractDate,"yyyy-MM-dd"),ContractStartDate:V(c.ContractStartDate,"yyyy-MM-dd"),ContractEndDate:V(c.ContractEndDate,"yyyy-MM-dd"),ContractNote:c.ContractNote,ContractStatus:"New"},x=await w.contract.create(a),p=x.ContractID||x.id;if(!p)throw new Error("Failed to get ContractID from response");for(const g of c.payments)await w.create("contractp",{ContractID:p,ContractPayTypeID:parseInt(g.ContractPayTypeID),ContractPAmount:g.ContractPAmount,ContractPAmountHour:g.ContractPAmountHour||0,ContractNote:g.ContractNote||""});_.success("Contract created successfully"),n==null||n(),o(!1),s.reset()}catch(a){console.error("Failed to create contract:",a),_.error("Failed to create contract")}finally{C(!1)}};return e.jsx(pt,{open:t,onOpenChange:o,children:e.jsxs(yt,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(jt,{children:[e.jsx(ft,{children:"Create New Contract"}),e.jsx(Ct,{children:"Create a new employment contract for an employee"})]}),e.jsxs("form",{onSubmit:s.handleSubmit(r),className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{className:"text-lg text-primary",children:"Contract Details"})}),e.jsx($,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"EmployeeID",children:"Employee"}),e.jsxs(ye,{value:s.watch("EmployeeID"),onValueChange:c=>s.setValue("EmployeeID",c),children:[e.jsx(je,{id:"EmployeeID",className:s.formState.errors.EmployeeID?"border-destructive":"",children:e.jsx(fe,{placeholder:b?"Loading employees...":"Select an employee"})}),e.jsx(Ce,{children:P.map(c=>e.jsxs(z,{value:c.EmployeeID.toString(),children:[c.FirstName," ",c.LastName," (",c.EmployeeCode,")"]},c.EmployeeID))})]}),s.formState.errors.EmployeeID&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.EmployeeID.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"ContractTemplate",children:"Contract Template"}),e.jsxs(ye,{value:s.watch("ContractTemplate"),onValueChange:c=>{s.setValue("ContractTemplate",c),B(c)},children:[e.jsx(je,{id:"ContractTemplate",children:e.jsx(fe,{placeholder:"Select a template"})}),e.jsx(Ce,{children:A.map(c=>e.jsx(z,{value:c.ContractTemplateID.toString(),children:c.TemplateName},c.ContractTemplateID))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"ContractAmount",children:"Base Salary Amount"}),e.jsx(q,{id:"ContractAmount",type:"number",step:"0.01",...s.register("ContractAmount",{valueAsNumber:!0}),className:s.formState.errors.ContractAmount?"border-destructive":""}),s.formState.errors.ContractAmount&&e.jsx("p",{className:"text-sm text-destructive",children:s.formState.errors.ContractAmount.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Contract Date"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),s.watch("ContractDate")?V(s.watch("ContractDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:s.watch("ContractDate"),onSelect:c=>s.setValue("ContractDate",c||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Start Date"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),s.watch("ContractStartDate")?V(s.watch("ContractStartDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:s.watch("ContractStartDate"),onSelect:c=>s.setValue("ContractStartDate",c||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"End Date"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),s.watch("ContractEndDate")?V(s.watch("ContractEndDate"),"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(me,{mode:"single",selected:s.watch("ContractEndDate"),onSelect:c=>s.setValue("ContractEndDate",c||new Date)})})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(D,{htmlFor:"ContractNote",children:"Notes"}),e.jsx(Be,{id:"ContractNote",...s.register("ContractNote"),className:"min-h-[80px]",placeholder:"Any additional notes about this contract"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Payment Items"}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:()=>u({ContractPayTypeID:"",ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),N.map((c,a)=>e.jsx(E,{children:e.jsx($,{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Payment Type"}),e.jsxs(ye,{onValueChange:x=>s.setValue(`payments.${a}.ContractPayTypeID`,x),value:s.watch(`payments.${a}.ContractPayTypeID`),children:[e.jsx(je,{children:e.jsx(fe,{placeholder:"Type"})}),e.jsx(Ce,{className:"max-h-60",children:f.map(x=>e.jsxs(z,{value:x.ContractPayTypeID.toString(),children:[x.ContractPayTypeName," ",x.IsAdd===1?"(+)":"(-)"]},x.ContractPayTypeID))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Amount"}),e.jsx(q,{type:"number",step:"0.01",...s.register(`payments.${a}.ContractPAmount`,{valueAsNumber:!0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Hourly Rate (Optional)"}),e.jsx(q,{type:"number",step:"0.01",...s.register(`payments.${a}.ContractPAmountHour`,{valueAsNumber:!0})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(D,{children:"Note"}),e.jsx(q,{...s.register(`payments.${a}.ContractNote`)})]}),e.jsx(j,{type:"button",variant:"ghost",size:"icon",className:"text-destructive mb-0.5",onClick:()=>v(a),disabled:N.length===1,children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})})},c.id))]}),e.jsxs(Kt,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>o(!1),disabled:l,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:l,children:l?"Saving...":"Create Contract"})]})]})]})})},we=10,be=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),ue=(t,o="MMM dd, yyyy")=>{if(!t)return"N/A";try{return V(ze(t),o)}catch{return"Invalid date"}},he=t=>{const o=new Date,n=t.ContractEndDate?ze(t.ContractEndDate):null,l=t.ContractStartDate?ze(t.ContractStartDate):null;if(!n||!l)return{label:"Draft",variant:"outline"};if(Bt(o,l))return{label:"Upcoming",variant:"secondary"};if(Ut(o,n))return{label:"Expired",variant:"destructive"};const C=sa(n,o);return C<=30?{label:`Expires in ${C} days`,variant:"warning"}:{label:"Active",variant:"success"}},ma=()=>{var Ke,Oe;const{t,i18n:o}=ke();o.dir();const n=Pe(),l=kt(),[C,s]=y.useState(""),[N,u]=y.useState("all"),[v,S]=y.useState("all"),[m,b]=y.useState({}),[P,R]=y.useState(1),[f,h]=y.useState("ContractStartDate"),[A,B]=y.useState("desc"),[r,c]=y.useState([]),[a,x]=y.useState({}),[p,g]=y.useState(!1),{data:I,isLoading:W,error:wt,refetch:Ee}=pe({queryKey:["contract",{page:P,search:C,status:N,type:v,sortBy:f,sortOrder:A}],queryFn:()=>Q.getContracts({page:P,pageSize:we,search:C,status:N!=="all"?[N]:void 0,type:v!=="all"?[v]:void 0,sortBy:f,sortOrder:A==="asc"?"asc":"desc"}),placeholderData:i=>i}),d=I,ge=y.useMemo(()=>{if(!I)return{totalContracts:0,activeContracts:0,total:0,active:0,expiringSoon:0,expiring30:0,terminated:0,avgAmount:0};const i=Array.isArray(d)?d:(d==null?void 0:d.data)||[],T=Array.isArray(d)?d.length:(d==null?void 0:d.total)||0,F=new Date;new Date().setDate(F.getDate()+30);let U=0,Qe=0,Ye=0,Je=0;return i.forEach(We=>{const Me=he(We);Me.label==="Active"&&U++,Me.variant==="destructive"&&Ye++,Me.variant==="warning"&&Qe++;const St=parseFloat(We.ContractAmount)||0;Je+=St}),{total:T,active:U,expiringSoon:Qe,terminated:Ye,avgAmount:T>0?Je/T:0}},[d]);rt({mutationFn:Q.deleteContract,onSuccess:()=>{l.invalidateQueries({queryKey:["contracts"]}),l.invalidateQueries({queryKey:["contract-stats"]}),_.success(t("common.success"))},onError:i=>{_.error(`${t("common.error")}: ${i.message}`)}});const Fe=rt({mutationFn:i=>Q.exportContracts(i),onSuccess:(i,T)=>{const F=new Blob([i],{type:`application/${T}`}),M=window.URL.createObjectURL(F),U=document.createElement("a");U.href=M,U.download=`contracts-${new Date().toISOString().split("T")[0]}.${T}`,document.body.appendChild(U),U.click(),window.URL.revokeObjectURL(M),document.body.removeChild(U),_.success(`Exported contracts as ${T.toUpperCase()}`)},onError:i=>{_.error(`Error exporting contracts: ${i.message}`)}}),ve=i=>{f===i?B(A==="asc"?"desc":"asc"):(h(i),B("desc"))},Ue=()=>{var i;r.length===(Array.isArray(d)?d.length:((i=d==null?void 0:d.data)==null?void 0:i.length)||0)?c([]):c((Array.isArray(d)?d:(d==null?void 0:d.data)||[]).map(T=>T.ContractID)||[])},bt=(i,T)=>{c(T?F=>[...F,i]:F=>F.filter(M=>M!==i))},At=i=>{x(T=>({...T,[i]:!T[i]}))},G=y.useMemo(()=>!d||Array.isArray(d)?1:Math.ceil((d.total||0)/(d.pageSize||we)),[d]);return W?e.jsxs("div",{className:"container mx-auto py-2 space-y-6",children:[e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((i,T)=>e.jsxs(E,{children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(Y,{className:"h-4 w-24"}),e.jsx(Y,{className:"h-4 w-4"})]}),e.jsx($,{children:e.jsx(Y,{className:"h-8 w-16"})})]},T))}),e.jsx(E,{children:e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[e.jsx(Y,{className:"h-10 w-full md:w-1/3"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{className:"h-10 w-32"}),e.jsx(Y,{className:"h-10 w-24"})]})]})})}),e.jsx(E,{children:e.jsx($,{className:"p-0",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(Y,{className:"h-8 w-48"}),e.jsx(Y,{className:"h-8 w-24"})]}),[...Array(5)].map((i,T)=>e.jsx(Y,{className:"h-16 w-full"},T))]})})})]}):e.jsxs("div",{className:"h-full flex flex-col gap-3 overflow-hidden",children:[e.jsxs("div",{className:"grid gap-2 md:grid-cols-2 lg:grid-cols-4 flex-shrink-0 pt-2",children:[e.jsx(Ae,{title:t("contracts.stats.total"),value:ge.total.toString(),icon:e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(Ae,{title:t("contracts.stats.active"),value:ge.active.toString(),icon:e.jsx(Ot,{className:"h-4 w-4 text-muted-foreground"}),variant:"success"}),e.jsx(Ae,{title:t("contracts.stats.expiringSoon"),value:ge.expiringSoon.toString(),icon:e.jsx($e,{className:"h-4 w-4 text-muted-foreground"}),variant:"warning"}),e.jsx(Ae,{title:t("contracts.stats.totalValue"),value:be(ge.avgAmount),icon:e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),variant:"accent"})]}),e.jsx(E,{className:"flex-shrink-0 pt-2",children:e.jsx(L,{className:"pb-3 py-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/3",children:[e.jsx(D,{htmlFor:"search",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ft,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground rtl:left-auto rtl:right-3"}),e.jsx(q,{id:"search",placeholder:t("contracts.filters.searchPlaceholder"),className:"ps-10",value:C,onChange:i=>s(i.target.value)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ye,{value:N,onValueChange:u,children:[e.jsxs(je,{className:"w-[180px]",children:[e.jsx(Qt,{className:"me-2 h-4 w-4"}),e.jsx(fe,{placeholder:t("contracts.table.status")})]}),e.jsxs(Ce,{children:[e.jsx(z,{value:"all",children:t("contracts.filters.allStatuses")}),e.jsx(z,{value:"active",children:t("contracts.status.active")}),e.jsx(z,{value:"expired",children:t("contracts.status.expired")}),e.jsx(z,{value:"upcoming",children:t("contracts.status.upcoming")}),e.jsx(z,{value:"draft",children:t("contracts.status.draft")})]})]}),e.jsxs(j,{variant:"outline",onClick:()=>{s(""),u("all"),S("all"),b({})},children:[e.jsx(Xe,{className:"me-2 h-4 w-4"}),t("contracts.filters.reset")]})]})]})})}),e.jsxs(E,{className:"flex flex-col min-h-[300px] flex-1 pt-2",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"select-all",checked:r.length>0&&r.length===(Array.isArray(d)?d.length:((Ke=d==null?void 0:d.data)==null?void 0:Ke.length)||0),onCheckedChange:Ue,className:"h-4 w-4"}),e.jsx(D,{htmlFor:"select-all",className:"text-sm font-medium",children:r.length>0?`${r.length} ${t("contracts.table.selected")}`:t("contracts.table.selectAll")}),r.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(j,{variant:"ghost",size:"sm",className:"h-8",onClick:()=>{_.info("Bulk action triggered")},children:[e.jsx(nt,{className:"me-2 h-4 w-4"}),t("contracts.table.exportSelected")]}),e.jsxs(j,{variant:"ghost",size:"sm",className:"h-8 text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>{confirm(t("common.confirmDelete"))&&Promise.all(r.map(i=>Q.deleteContract(i))).then(()=>{l.invalidateQueries({queryKey:["contracts"]}),l.invalidateQueries({queryKey:["contract-stats"]}),c([]),_.success(t("common.success"))}).catch(i=>{_.error(`${t("common.error")}: ${i.message}`)})},children:[e.jsx(Ne,{className:"me-2 h-4 w-4"}),t("common.delete")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(j,{variant:"outline",size:"sm",className:"h-8",onClick:()=>Ee(),disabled:W,children:[e.jsx(Xe,{className:`me-2 h-4 w-4 ${W?"animate-spin":""}`}),t("common.refresh")]}),e.jsxs(et,{children:[e.jsx(tt,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(nt,{className:"mr-2 h-4 w-4"}),"Export"]})}),e.jsxs(at,{align:"end",children:[e.jsxs(ae,{onClick:()=>Fe.mutate("pdf"),children:[e.jsx(ta,{className:"me-2 h-4 w-4"}),t("common.exportPdf")]}),e.jsxs(ae,{onClick:()=>Fe.mutate("excel"),children:[e.jsx(ot,{className:"me-2 h-4 w-4"}),t("common.exportExcel")]}),e.jsxs(ae,{onClick:()=>Fe.mutate("csv"),children:[e.jsx(ot,{className:"me-2 h-4 w-4"}),t("common.exportCsv")]})]})]})]})]}),e.jsx(Mt,{className:"flex-1 min-h-[200px]",children:e.jsxs(_e,{children:[e.jsx(Re,{className:"bg-muted/50",children:e.jsxs(K,{children:[e.jsx(H,{className:"w-12",children:e.jsx(Z,{id:"select-all-header",checked:r.length>0&&r.length===(Array.isArray(d)?d.length:((Oe=d==null?void 0:d.data)==null?void 0:Oe.length)||0),onCheckedChange:Ue,className:"h-4 w-4"})}),e.jsx(H,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>ve("employees_LastName"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.employee"),f==="employees_LastName"&&e.jsx(De,{className:`ms-1 h-4 w-4 ${A==="desc"?"rotate-180":""}`})]})}),e.jsx(H,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>ve("ContractAmount"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.amount"),f==="ContractAmount"&&e.jsx(De,{className:`ms-1 h-4 w-4 ${A==="desc"?"rotate-180":""}`})]})}),e.jsx(H,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>ve("ContractStartDate"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.startDate"),f==="ContractStartDate"&&e.jsx(De,{className:`ms-1 h-4 w-4 ${A==="desc"?"rotate-180":""}`})]})}),e.jsx(H,{className:"cursor-pointer hover:bg-muted/80",onClick:()=>ve("ContractEndDate"),children:e.jsxs("div",{className:"flex items-center",children:[t("contracts.table.endDate"),f==="ContractEndDate"&&e.jsx(De,{className:`ms-1 h-4 w-4 ${A==="desc"?"rotate-180":""}`})]})}),e.jsx(H,{children:t("contracts.table.status")}),e.jsx(H,{className:"text-end",children:t("contracts.table.actions")})]})}),e.jsx(He,{children:wt?e.jsx(K,{children:e.jsx(k,{colSpan:8,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-destructive",children:[e.jsx($e,{className:"h-8 w-8"}),e.jsx("p",{children:t("contracts.errorLoading")}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>Ee(),children:t("common.retry")})]})})}):!d||Array.isArray(d)&&d.length===0||!Array.isArray(d)&&(!d.data||d.data.length===0)?e.jsx(K,{children:e.jsx(k,{colSpan:8,className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx(Ie,{className:"h-12 w-12 opacity-20"}),e.jsx("p",{className:"text-lg font-medium",children:t("contracts.noContractsFound")}),e.jsx("p",{className:"text-sm",children:t("contracts.noContractsFoundDesc")}),e.jsxs(j,{variant:"outline",className:"mt-4",onClick:()=>g(!0),children:[e.jsx(xe,{className:"me-2 h-4 w-4"}),t("contracts.add")]})]})})}):(Array.isArray(d)?d:(d==null?void 0:d.data)||[]).map(i=>{var T,F;return e.jsxs($t.Fragment,{children:[e.jsxs(K,{className:`${a[i.ContractID]?"bg-muted/20":""} hover:bg-muted/10`,onClick:()=>At(i.ContractID),children:[e.jsx(k,{onClick:M=>M.stopPropagation(),children:e.jsx(Z,{checked:r.includes(i.ContractID),onCheckedChange:M=>bt(i.ContractID,!!M),onClick:M=>M.stopPropagation(),className:"h-4 w-4"})}),e.jsxs(k,{children:[e.jsxs("div",{className:"font-medium",children:[i.employees_FirstName," ",i.employees_LastName]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ID: ",i.EmployeeID]})]}),e.jsx(k,{children:be(i.ContractAmount)}),e.jsx(k,{children:ue(i.ContractStartDate)}),e.jsx(k,{children:ue(i.ContractEndDate)}),e.jsx(k,{children:e.jsx(J,{variant:he(i).variant,className:"capitalize",children:he(i).label})}),e.jsx(k,{className:"text-end",children:e.jsxs(et,{children:[e.jsx(tt,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"icon",onClick:M=>M.stopPropagation(),children:[e.jsx(ea,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:t("contracts.table.actions")})]})}),e.jsxs(at,{align:"end",children:[e.jsxs(ae,{onClick:()=>n(`/contracts/${i.ContractID}`),children:[e.jsx(ct,{className:"me-2 h-4 w-4"}),t("common.view")]}),e.jsxs(ae,{onClick:()=>n(`/contracts/${i.ContractID}/edit`),children:[e.jsx(Yt,{className:"me-2 h-4 w-4"}),t("common.edit")]}),e.jsxs(ae,{className:"text-destructive",onClick:M=>{M.stopPropagation(),confirm(t("common.confirmDelete"))&&Q.deleteContract(i.ContractID).then(()=>{l.invalidateQueries({queryKey:["contracts"]}),l.invalidateQueries({queryKey:["contract-stats"]}),_.success(t("common.success"))}).catch(U=>{_.error(`${t("common.error")}: ${U.message}`)})},children:[e.jsx(Ne,{className:"me-2 h-4 w-4"}),t("common.delete")]})]})]})})]}),a[i.ContractID]&&e.jsx(K,{className:"hover:bg-muted/30",children:e.jsx(k,{colSpan:8,className:"px-6 py-0 border-t-0",children:e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.contractInfo")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.id"),":"]})," ",i.ContractID]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.type"),":"]})," ",i.ContractType||"N/A"]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.status"),":"]})," ",e.jsx(J,{variant:he(i).variant,className:"capitalize",children:he(i).label})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.dates")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.created"),":"]})," ",ue(i.ContractDate)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.startDate"),":"]})," ",ue(i.ContractStartDate)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.endDate"),":"]})," ",ue(i.ContractEndDate)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.financials")}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.table.amount"),":"]})," ",be(i.ContractAmount)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.payments"),":"]})," ",((T=i.payments)==null?void 0:T.length)||0]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[t("contracts.details.totalPaid"),":"]})," ",be(((F=i.payments)==null?void 0:F.reduce((M,U)=>M+U.ContractPAmount,0))||0)]})]})]})]}),i.ContractNote&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("contracts.details.notes")}),e.jsx("p",{className:"text-sm",children:i.ContractNote})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(j,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px]",onClick:()=>n(`/contracts/${i.ContractID}`),"aria-label":t("contracts.viewDetails"),children:e.jsx(ct,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px]",onClick:()=>n(`/contracts/${i.ContractID}/edit`),"aria-label":t("contracts.edit"),children:e.jsx(Nt,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0 min-h-[44px] min-w-[44px] text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>{confirm(t("common.confirmDelete"))&&Q.deleteContract(i.ContractID).then(()=>{l.invalidateQueries({queryKey:["contract"]}),l.invalidateQueries({queryKey:["contract-stats"]}),_.success(t("common.success"))}).catch(M=>{_.error(`${t("common.error")}: ${M.message}`)})},"aria-label":t("contracts.delete"),children:e.jsx(Ne,{className:"h-4 w-4"})})]})]})})})]},i.ContractID)})})]})}),!Array.isArray(I)&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-medium",children:(((d==null?void 0:d.page)||1)-1)*((d==null?void 0:d.pageSize)||we)+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(((d==null?void 0:d.page)||1)*((d==null?void 0:d.pageSize)||we),(d==null?void 0:d.total)||0)})," ","of ",e.jsx("span",{className:"font-medium",children:(d==null?void 0:d.total)||0})," contracts"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>R(i=>Math.max(i-1,1)),disabled:P===1||W,children:[e.jsx(Jt,{className:"h-4 w-4 rtl:rotate-180"}),e.jsx("span",{className:"ms-1",children:t("common.previous")})]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,G)},(i,T)=>{let F;return G<=5||P<=3?F=T+1:P>=G-2?F=G-4+T:F=P-2+T,e.jsx(j,{variant:F===P?"default":"outline",size:"sm",className:"w-10 h-10 p-0",onClick:()=>R(F),disabled:W,children:F},F)})}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>R(i=>Math.min(i+1,G)),disabled:P===G||W||G===0,children:[e.jsx("span",{className:"me-1",children:t("common.next")}),e.jsx(_t,{className:"h-4 w-4 rtl:rotate-180"})]})]})]})]}),e.jsx(Dt,{open:p,onOpenChange:g,onSuccess:()=>Ee()})]})},Ae=({title:t,value:o,icon:n,variant:l="default"})=>{const C={default:"bg-background",success:"bg-green-50 dark:bg-green-900/20",warning:"bg-yellow-50 dark:bg-yellow-900/20",destructive:"bg-red-50 dark:bg-red-900/20",accent:"bg-blue-50 dark:bg-blue-900/20"},s={default:"text-foreground",success:"text-green-600 dark:text-green-400",warning:"text-yellow-600 dark:text-yellow-400",destructive:"text-red-600 dark:text-red-400",accent:"text-blue-600 dark:text-blue-400"};return e.jsx(E,{className:`${C[l]} transition-colors`,children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:t}),e.jsx("h3",{className:`text-2xl font-bold ${s[l]}`,children:typeof o=="number"?o.toLocaleString():o})]}),e.jsx("div",{className:`rounded-full p-2 ${s[l]} bg-opacity-20 ${C[l]}`,children:n})]})})})};function xa(){const t=Rt(),o=Pe(),[n,l]=y.useState(!1),{t:C,i18n:s}=ke(),N=s.dir()==="rtl",u=t.pathname.endsWith("/reports")?"reports":t.pathname.endsWith("/templates")?"templates":"overview";return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-130px)]",children:[e.jsxs("div",{className:"flex-shrink-0 space-y-2 pt-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:C("contracts.title")}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 pt-2",children:[e.jsx(Le,{value:u,onValueChange:v=>{v==="overview"?o("/contracts"):v==="reports"?o("/contracts/reports"):v==="templates"&&o("/contracts/templates")},dir:N?"rtl":"ltr",children:e.jsxs(qe,{children:[e.jsx(ee,{value:"overview",children:C("contracts.tabs.overview")}),e.jsx(ee,{value:"templates",children:C("contracts.tabs.templates")}),e.jsx(ee,{value:"reports",children:C("contracts.tabs.reports")})]})}),u==="overview"&&e.jsxs(j,{onClick:()=>l(!0),children:[e.jsx(xe,{className:"me-2 h-4 w-4"}),C("contracts.add")]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Ht,{})}),e.jsx(Dt,{open:n,onOpenChange:l,onSuccess:()=>{window.location.reload()}})]})}const ua=()=>{const[t,o]=y.useState("contract_summary"),n={contract_summary:{type:"report_contract_summary",title:"Contract Summary Report",description:"List of all employee contracts with their status and details.",columns:[{key:"ContractID",label:"ID"},{key:"EmployeeName",label:"Employee"},{key:"ContractAmount",label:"Amount",format:l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l)},{key:"ContractStartDate",label:"Start Date",format:l=>l?new Date(l).toLocaleDateString():"-"},{key:"ContractEndDate",label:"End Date",format:l=>l?new Date(l).toLocaleDateString():"-"},{key:"ContractStatus",label:"Status",format:l=>e.jsx(J,{variant:l==="Running"?"default":l==="Completed"?"secondary":l==="Terminated"?"destructive":"outline",children:l})}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]},contract_components:{type:"report_contract_components",title:"Contract Pay Components Report",description:"Breakdown of salary components and deductions per contract.",columns:[{key:"ContractID",label:"Contract ID"},{key:"EmployeeName",label:"Employee"},{key:"ContractPayTypeName",label:"Component"},{key:"ComponentType",label:"Type",format:l=>e.jsx(J,{variant:l==="Addition"?"default":"secondary",children:l})},{key:"ContractPAmount",label:"Amount",format:l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l)},{key:"ContractPAmountHour",label:"Hourly Rate",format:l=>l>0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l):"-"}],filters:[{key:"start_date",label:"Start Date",type:"date",defaultValue:new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0]},{key:"end_date",label:"End Date",type:"date",defaultValue:new Date().toISOString().split("T")[0]}]}};return e.jsxs("div",{className:"h-full flex flex-col space-y-4 overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Le,{value:t,onValueChange:o,children:e.jsxs(qe,{children:[e.jsx(ee,{value:"contract_summary",children:"Contract Summary"}),e.jsx(ee,{value:"contract_components",children:"Pay Components"})]})})}),e.jsx(E,{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx($,{className:"h-full p-0",children:e.jsx(Wt,{type:n[t].type,title:n[t].title,description:n[t].description,columns:n[t].columns,filters:n[t].filters})})})]})};function ha({open:t,onOpenChange:o,template:n,onSave:l,onCancel:C}){const{t:s}=ke(),[N,u]=y.useState(!1),[v,S]=y.useState([]),[m,b]=y.useState(n||{TemplateName:"",TemplateCode:"",TemplateDescription:"",ContractAmount:0,ContractDurationDays:30,TemplateType:"employment",ContractCategory:"Full-time",IsPublic:!1,IsActive:!0,IsDefault:!1,PayTypes:[]});y.useEffect(()=>{t&&(n!=null&&n.ContractTemplateID?(b(n),P(n.ContractTemplateID)):b({TemplateName:"",TemplateCode:"",TemplateDescription:"",ContractAmount:0,ContractDurationDays:30,TemplateType:"employment",ContractCategory:"Full-time",IsPublic:!1,IsActive:!0,IsDefault:!1,PayTypes:[]}))},[n,t]);const P=async r=>{try{const c=ne.contracttemplatepaytype.list,a=await c({exact_filters:{ContractTemplateID:r}});let x=[];if(Array.isArray(a))x=a;else if(a&&a.data){const p=a.data;Array.isArray(p)?x=p:p.data&&Array.isArray(p.data)&&(x=p.data)}b(p=>({...p,PayTypes:x.map(g=>{const I=v.find(W=>W.ContractPayTypeID===g.ContractPayTypeID);return{ContractPayTypeID:g.ContractPayTypeID,ContractPayTypeName:(I==null?void 0:I.ContractPayTypeName)||"",Description:(I==null?void 0:I.Description)||"",IsAdd:(I==null?void 0:I.IsAdd)||0,ContractPAmount:g.ContractPAmount||0,ContractPAmountHour:g.ContractPAmountHour||0,ContractNote:g.ContractNote||""}})}))}catch(c){console.error("Error fetching template pay types:",c)}};y.useEffect(()=>{R()},[]);const R=async()=>{try{const r=ne.contractpaytype.list,c=await r();let a=[];if(Array.isArray(c))a=c;else if(c&&c.data){const x=c.data;Array.isArray(x)?a=x:x.data&&Array.isArray(x.data)&&(a=x.data)}S(a)}catch(r){console.error("Error fetching pay types:",r),S([])}},f=(r,c)=>{b(a=>{const x=a.PayTypes||[];return c?{...a,PayTypes:[...x,{ContractPayTypeID:r.ContractPayTypeID,ContractPayTypeName:r.ContractPayTypeName,Description:r.Description||"",IsAdd:r.IsAdd,ContractPAmount:0,ContractPAmountHour:0,ContractNote:""}]}:{...a,PayTypes:x.filter(p=>p.ContractPayTypeID!==r.ContractPayTypeID)}})},h=(r,c,a)=>{let x=a;c!=="ContractNote"&&(x=typeof a=="string"?parseFloat(a)||0:a),b(p=>({...p,PayTypes:p.PayTypes.map(g=>g.ContractPayTypeID===r?{...g,[c]:x}:g)}))},A=()=>!m.PayTypes||!Array.isArray(m.PayTypes)?0:m.PayTypes.reduce((r,c)=>c.IsAdd===1?r+c.ContractPAmount:r,0),B=async r=>{r.preventDefault(),u(!0);try{const c=A(),a={...m,ContractAmount:c};n!=null&&n.ContractTemplateID?await ne.contractstemplate.update(n.ContractTemplateID,a):await ne.contractstemplate.create(a),l(a),o(!1)}catch(c){console.error("Error saving template:",c)}finally{u(!1)}};return e.jsx(pt,{open:t,onOpenChange:o,children:e.jsxs(yt,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(jt,{children:[e.jsx(ft,{children:s(n?"contracts.template.edit":"contracts.template.create")}),e.jsx(Ct,{children:s("contracts.template.description")})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{children:s("contracts.template.info")})}),e.jsxs($,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"TemplateName",children:s("contracts.template.name")}),e.jsx(q,{id:"TemplateName",value:m.TemplateName,onChange:r=>b({...m,TemplateName:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"TemplateCode",children:s("contracts.template.code")}),e.jsx(q,{id:"TemplateCode",value:m.TemplateCode,onChange:r=>b({...m,TemplateCode:r.target.value.toUpperCase()}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"TemplateDescription",children:s("contracts.template.description")}),e.jsx(Be,{id:"TemplateDescription",value:m.TemplateDescription,onChange:r=>b({...m,TemplateDescription:r.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"TemplateType",children:s("contracts.template.type")}),e.jsxs(ye,{value:m.TemplateType,onValueChange:r=>b({...m,TemplateType:r}),children:[e.jsx(je,{children:e.jsx(fe,{})}),e.jsxs(Ce,{children:[e.jsx(z,{value:"employment",children:"Employment"}),e.jsx(z,{value:"freelance",children:"Freelance"}),e.jsx(z,{value:"internship",children:"Internship"}),e.jsx(z,{value:"consultancy",children:"Consultancy"}),e.jsx(z,{value:"service",children:"Service"}),e.jsx(z,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"ContractCategory",children:s("contracts.template.category")}),e.jsx(q,{id:"ContractCategory",value:m.ContractCategory,onChange:r=>b({...m,ContractCategory:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"ContractDurationDays",children:s("contracts.template.duration")}),e.jsx(q,{id:"ContractDurationDays",type:"number",value:m.ContractDurationDays,onChange:r=>b({...m,ContractDurationDays:parseInt(r.target.value)||30})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"IsPublic",checked:m.IsPublic,onCheckedChange:r=>b({...m,IsPublic:!!r})}),e.jsx(D,{htmlFor:"IsPublic",children:s("contracts.template.public")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"IsActive",checked:m.IsActive,onCheckedChange:r=>b({...m,IsActive:!!r})}),e.jsx(D,{htmlFor:"IsActive",children:s("contracts.template.active")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"IsDefault",checked:m.IsDefault,onCheckedChange:r=>b({...m,IsDefault:!!r})}),e.jsx(D,{htmlFor:"IsDefault",children:s("contracts.template.default")})]})]})]})]}),e.jsxs(E,{children:[e.jsx(L,{children:e.jsx(O,{children:s("contracts.template.payTypes")})}),e.jsxs($,{children:[e.jsx("div",{className:"space-y-4",children:v.map(r=>{var x,p;const c=(x=m.PayTypes)==null?void 0:x.some(g=>g.ContractPayTypeID===r.ContractPayTypeID),a=(p=m.PayTypes)==null?void 0:p.find(g=>g.ContractPayTypeID===r.ContractPayTypeID);return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Z,{id:`paytype-${r.ContractPayTypeID}`,checked:c,onCheckedChange:g=>f(r,!!g)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{htmlFor:`paytype-${r.ContractPayTypeID}`,className:"font-medium",children:r.ContractPayTypeName}),e.jsx(J,{variant:r.IsAdd===1?"default":"destructive",children:r.IsAdd===1?"+":"-"})]}),r.Description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r.Description})]})]})}),c&&a&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 pl-7",children:[r.IsHour===1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:`hourly-${r.ContractPayTypeID}`,children:s("contracts.template.hourlyRate")}),e.jsx(q,{id:`hourly-${r.ContractPayTypeID}`,type:"text",value:a.ContractPAmountHour,onChange:g=>h(r.ContractPayTypeID,"ContractPAmountHour",g.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:`amount-${r.ContractPayTypeID}`,children:s("contracts.template.amount")}),e.jsx(q,{id:`amount-${r.ContractPayTypeID}`,type:"text",value:a.ContractPAmount,onChange:g=>h(r.ContractPayTypeID,"ContractPAmount",g.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:`note-${r.ContractPayTypeID}`,children:s("contracts.template.note")}),e.jsx(q,{id:`note-${r.ContractPayTypeID}`,value:a.ContractNote,onChange:g=>h(r.ContractPayTypeID,"ContractNote",g.target.value)})]})]})]},r.ContractPayTypeID)})}),e.jsx("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:s("contracts.template.totalAmount")}),e.jsxs("span",{className:"text-2xl font-bold",children:["$",A().toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsxs(j,{type:"button",variant:"outline",onClick:()=>o(!1),children:[e.jsx(Vt,{className:"mr-2 h-4 w-4"}),s("common.cancel")]}),e.jsxs(j,{type:"submit",disabled:N,children:[e.jsx(aa,{className:"mr-2 h-4 w-4"}),s(N?"common.saving":"common.save")]})]})]})]})})}function pa(){const{t}=ke(),[o,n]=y.useState([]),[l,C]=y.useState(!0),[s,N]=y.useState(!1),[u,v]=y.useState();y.useEffect(()=>{S()},[]);const S=async()=>{try{const h=await ne.contractstemplate.list();let A=[];if(Array.isArray(h))A=h;else if(h&&typeof h=="object"){const r=h;Array.isArray(r.data)?A=r.data:r.data&&Array.isArray(r.data.data)&&(A=r.data.data)}const B=A.filter((r,c,a)=>c===a.findIndex(x=>x.ContractTemplateID===r.ContractTemplateID));n(B)}catch(h){console.error("Error fetching templates:",h),n([])}finally{C(!1)}},m=()=>{v(void 0),N(!0)},b=h=>{v(h),N(!0)},P=async h=>{await S(),N(!1),v(void 0)},R=async h=>{if(confirm(t("contracts.template.deleteConfirm")))try{await ne.contractstemplate.delete(h),await S()}catch(A){console.error("Error deleting template:",A)}},f=async h=>{const A={...h,TemplateName:`${h.TemplateName} (Copy)`,TemplateCode:`${h.TemplateCode}_COPY`,ContractTemplateID:void 0};v(A),N(!0)};return l?e.jsx("div",{className:"flex justify-center p-8",children:t("common.loading")}):e.jsxs("div",{className:"h-full flex flex-col space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t("contracts.templates.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("contracts.templates.description")})]}),e.jsxs(j,{onClick:m,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),t("contracts.templates.create")]})]}),e.jsxs("div",{className:"flex-1 overflow-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(h=>e.jsxs(E,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(O,{className:"text-lg",children:h.TemplateName}),e.jsx(mt,{className:"text-xs mt-1",children:h.TemplateCode})]}),e.jsxs("div",{className:"flex gap-1",children:[h.IsDefault&&e.jsx(J,{variant:"default",className:"text-xs",children:t("contracts.template.default")}),h.IsPublic&&e.jsx(J,{variant:"secondary",className:"text-xs",children:t("contracts.template.public")}),!h.IsActive&&e.jsx(J,{variant:"destructive",className:"text-xs",children:t("contracts.template.inactive")})]})]})}),e.jsx($,{children:e.jsxs("div",{className:"space-y-2",children:[h.TemplateDescription&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:h.TemplateDescription}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.amount")}),e.jsxs("span",{className:"font-semibold",children:["$",h.ContractAmount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.duration")}),e.jsxs("span",{className:"font-semibold",children:[h.ContractDurationDays," ",t("common.days")]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:t("contracts.template.usage")}),e.jsx("span",{className:"font-semibold",children:h.UsageCount})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(j,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>b(h),children:[e.jsx(Nt,{className:"h-3 w-3 mr-1"}),t("common.edit")]}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>f(h),children:e.jsx(Xt,{className:"h-3 w-3"})}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>R(h.ContractTemplateID),children:e.jsx(Ne,{className:"h-3 w-3"})})]})]})})]},h.ContractTemplateID))}),o.length===0&&e.jsx(E,{children:e.jsxs($,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t("contracts.templates.empty")}),e.jsxs(j,{onClick:m,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),t("contracts.templates.create")]})]})})]}),e.jsx(ha,{open:s,onOpenChange:N,template:u,onSave:P,onCancel:()=>{N(!1),v(void 0)}})]})}function Qa(){return e.jsxs(zt,{children:[e.jsxs(se,{element:e.jsx(xa,{}),children:[e.jsx(se,{index:!0,element:e.jsx(ma,{})}),e.jsx(se,{path:"templates",element:e.jsx(pa,{})}),e.jsx(se,{path:"reports",element:e.jsx(ua,{})})]}),e.jsx(se,{path:":id",element:e.jsx(oa,{})}),e.jsx(se,{path:":id/edit",element:e.jsx(ia,{})})]})}export{oa as ContractDetails,pa as ContractTemplates,xa as ContractsLayout,Qa as ContractsModule,ua as ContractsReports,ia as EditContract,ma as EmployeeContracts};
